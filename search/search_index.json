{"config":{"lang":["en"],"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"","title":"Home"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/","text":"Scrapy 1.5 \u4e2d\u6587\u6587\u6863 \u8fd9\u4e2a\u6587\u6863\u5305\u542b\u4e86\u6240\u6709\u5173\u4e8eScrapy\u9700\u8981\u4e86\u89e3\u7684\u5185\u5bb9 \u83b7\u53d6\u5e2e\u52a9 \u6709\u9ebb\u70e6\u4e86\u4e48? \u6211\u4eec\u613f\u610f\u63d0\u4f9b\u5e2e\u52a9! \u5c1d\u8bd5 \u5e38\u89c1\u95ee\u9898 -\u5b83\u6709\u4e00\u4e9b\u5e38\u89c1\u95ee\u9898\u7684\u7b54\u6848\u3002 \u8bf7 \u5c1d\u8bd5\u7d22\u5f15 \u6216 \u6a21\u5757\u7d22\u5f15 \u6765\u5bfb\u627e\u7279\u5b9a\u4fe1\u606f\u3002 \u4f7f\u7528 scrapy\u6807\u7b7e\u5728StackOverflow \u67e5\u8be2\u6216\u641c\u7d22\u95ee\u9898\u3002 \u5728 reddit\u7684Scrapy\u7248\u5757 \u4e2d\u8be2\u95ee\u6216\u641c\u7d22\u95ee\u9898\u3002 \u5728 scrapy\u7528\u6237\u90ae\u4ef6\u5217\u8868\u7684\u6863\u6848 \u4e2d\u641c\u7d22\u95ee\u9898\u3002 \u5728 scrapy IRC\u9891\u9053 \u641c\u7d22\u95ee\u9898 \u62a5\u544ascrapy\u51fa\u73b0\u7684bug\u53d1\u9001\u7ed9 \u5b98\u65b9\u7684\u95ee\u9898\u8ddf\u8e2a\u5668 \u7b2c\u4e00\u6b65 \u5feb\u901f\u7406\u89e3Scrapy \u7406\u89e3\u4ec0\u4e48\u662fScrapy, \u5b83\u80fd\u5e2e\u52a9\u4f60\u505a\u4ec0\u4e48 \u5b89\u88c5\u6307\u5357 \u5728\u4f60\u7684\u7535\u8111\u4e0a\u5b89\u88c5Scrapy Scrapy\u6559\u7a0b \u7f16\u5199\u4f60\u7684\u7b2c\u4e00\u4e2aScrapy\u7a0b\u5e8f \u4f8b\u5b50 \u901a\u8fc7\u4e00\u4e2a\u5199\u597d\u7684Scrapy\u7a0b\u5e8f\u6765\u4e86\u89e3\u66f4\u591aScrapy\u7684\u77e5\u8bc6 \u57fa\u672c\u6982\u5ff5 \u547d\u4ee4\u884c\u5de5\u5177 \u4e86\u89e3\u7528\u4e8e\u7ba1\u7406Scrapy\u9879\u76ee\u7684\u547d\u4ee4\u884c\u5de5\u5177\u3002 Spiders(\u722c\u866b\u4e3b\u6587\u4ef6) \u7f16\u5199\u4f60\u6293\u53d6\u7f51\u7ad9\u7684\u89c4\u5219 Selectors(\u9009\u62e9\u5668) \u4f7f\u7528XPATH\u4ece\u7f51\u7ad9\u4e0a\u63d0\u53d6\u6570\u636e Scrapy shell \u5728\u4ea4\u4e92\u5f0f\u73af\u5883\u4e2d\u6d4b\u8bd5\u63d0\u53d6\u4ee3\u7801 Items \u5b9a\u4e49\u4f60\u60f3\u8981\u83b7\u53d6\u6570\u636e Item Loaders \u7528\u63d0\u53d6\u7684\u6570\u636e\u586b\u5145items Item Pipeline(\u6570\u636e\u7ba1\u9053) \u540e\u671f\u5904\u7406\u6216\u5c06\u4f60\u6293\u53d6\u7684\u6570\u636e\u4fdd\u5b58\u8d77\u6765 Feed exports \u4f7f\u7528\u4e0d\u540c\u7684\u683c\u5f0f\u548c\u5b58\u50a8\u6765\u8f93\u51fa\u6293\u53d6\u7684\u6570\u636e\u3002 Requests and Responses(\u8bf7\u6c42\u548c\u54cd\u5e94) \u4e86\u89e3\u7528\u4e8e\u8868\u793aHTTP\u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u7c7b\u3002 Link Extractors(\u94fe\u63a5\u62bd\u53d6\u5668) \u4e00\u4e2a\u5f88\u65b9\u4fbf\u7684\u7c7b\u7528\u4e8e\u4ece\u9875\u9762\u4e2d\u63d0\u53d6\u94fe\u63a5 Settings(\u8bbe\u7f6e) \u4e86\u89e3\u5982\u4f55\u914d\u7f6eScrapy\u5e76\u67e5\u770b\u6240\u6709 \u53ef\u7528\u7684\u8bbe\u7f6e \u3002 \u5185\u7f6e\u670d\u52a1 \u65e5\u5fd7\u6a21\u5757 \u4e86\u89e3\u5982\u4f55\u5728Scrapy\u4e0a\u4f7f\u7528Python\u7684\u5185\u7f6e\u65e5\u5fd7\u6a21\u5757\u3002 \u72b6\u6001\u6536\u96c6 \u6536\u96c6\u5173\u4e8e\u6293\u53d6\u722c\u866b\u7684\u7edf\u8ba1\u6570\u636e\u3002 \u90ae\u4ef6\u6a21\u5757 \u5f53\u67d0\u4e9b\u4e8b\u4ef6\u53d1\u751f\u65f6\u53d1\u9001\u7535\u5b50\u90ae\u4ef6\u901a\u77e5\u3002 Telnet\u63a7\u5236\u53f0 \u4f7f\u7528\u5185\u7f6e\u7684Python\u63a7\u5236\u53f0\u68c0\u67e5\u6b63\u5728\u8fd0\u884c\u7684\u722c\u866b\u7a0b\u5e8f\u3002 Web\u670d\u52a1 \u4f7f\u7528web\u670d\u52a1\u76d1\u89c6\u548c\u63a7\u5236\u722c\u866b\u7a0b\u5e8f\u3002 \u89e3\u51b3\u5177\u4f53\u95ee\u9898 \u5e38\u89c1\u95ee\u9898 \u627e\u51fa\u6700\u5e38\u89c1\u95ee\u9898\u7684\u7b54\u6848\u3002 \u8c03\u8bd5Spiders \u4e86\u89e3\u5982\u4f55\u8c03\u8bd5\u60a8\u7684spiders\u7684\u5e38\u89c1\u95ee\u9898\u3002 Spiders Contracts \u5b66\u4e60\u5982\u4f55\u4f7f\u7528\u5408\u540c\u6d4b\u8bd5\u60a8\u7684spiders\u3002 \u4e00\u822c\u505a\u6cd5 \u719f\u6089\u4e00\u4e9b\u5e38\u89c1\u7684\u6280\u5de7\u3002 \u5927\u89c4\u6a21\u722c\u53d6 \u5bf9\u5e76\u884c\u6293\u53d6\u5927\u91cf\u7f51\u7ad9\u7684Scrapy\u8fdb\u884c\u4f18\u5316\u3002 \u4f7f\u7528Firefox\u6293\u53d6 \u5b66\u4e60\u5982\u4f55\u7528Firefox\u8fdb\u884c\u6293\u53d6\u5e76\u9644\u52a0\u4e00\u4e9b\u6709\u7528\u7684\u9644\u52a0\u7ec4\u4ef6\u3002 \u4f7f\u7528Firebug\u6293\u53d6 \u5b66\u4e60\u5982\u4f55\u6709\u6548\u5730\u4f7f\u7528Firebug\u3002 \u8c03\u8bd5\u5185\u5b58\u6cc4\u6f0f \u4e86\u89e3\u5982\u4f55\u5728\u722c\u866b\u7a0b\u5e8f\u4e2d\u67e5\u627e\u548c\u6e05\u9664\u5185\u5b58\u6cc4\u6f0f\u3002 \u4e0b\u8f7d\u6216\u5904\u7406\u6587\u4ef6\u548c\u56fe\u50cf \u4eceScrapy items\u91cc\u4e0b\u8f7d\u6587\u4ef6\u6216\u56fe\u50cf \u90e8\u7f72\u722c\u866b \u90e8\u7f72\u60a8\u7684Scrapy\u722c\u866b\u5e76\u4e14\u653e\u5728\u8fdc\u7a0b\u670d\u52a1\u5668 \u81ea\u52a8\u8282\u6d41\u9600\u6269\u5c55 \u6839\u636e\u8d1f\u8f7d\u52a8\u6001\u8c03\u6574\u6293\u53d6\u901f\u5ea6\u3002 benchmarking \u68c0\u67e5\u4e00\u4e0bScrapy\u5728\u786c\u4ef6\u4e0a\u7684\u529f\u80fd\u3002 Jobs: \u6682\u505c\u548c\u6062\u590d\u722c\u53d6 \u5b66\u4e60\u5982\u4f55\u6682\u505c\u548c\u6062\u590d\u722c\u884c\u5927\u578b\u8718\u86db\u3002 Scrapy\u6269\u5c55 \u7ed3\u6784\u6982\u8ff0 \u7406\u89e3Scrapy\u67b6\u6784\u3002 Downloader Middleware(\u4e0b\u8f7d\u5668\u4e2d\u95f4\u4ef6) \u81ea\u5b9a\u4e49\u9875\u9762\u5982\u4f55\u88ab\u8bf7\u6c42\u548c\u4e0b\u8f7d\u3002 Spider Middleware(\u722c\u866b\u4e2d\u95f4\u4ef6) \u81ea\u5b9a\u4e49spiders\u7684\u8f93\u5165\u548c\u8f93\u51fa\u3002 \u6269\u5c55 \u4f7f\u7528\u81ea\u5b9a\u4e49\u529f\u80fd\u6269\u5c55Scrapy \u6838\u5fc3API \u5728\u6269\u5c55\u548c\u4e2d\u95f4\u4ef6\u4e0a\u4f7f\u7528\u5b83\u6765\u6269\u5c55Scrapy\u7684\u529f\u80fd \u4fe1\u53f7 \u67e5\u770b\u6240\u6709\u53ef\u7528\u7684\u4fe1\u53f7\u4ee5\u53ca\u5982\u4f55\u4f7f\u7528\u5b83\u4eec\u3002 Item Exporters \u5feb\u901f\u5bfc\u51fa\u4f60\u6293\u53d6\u7684\u6570\u636e\u5230\u4e00\u4e2a\u6587\u4ef6(XML, CSV\uff0c\u7b49\u7b49)\u3002 \u5176\u4ed6\u7684 \u53d1\u884c\u8bf4\u660e (\u6b64\u6587\u6863\u4ece1.5.1\u7248\u672c\u5f00\u59cb, \u4ee5\u524d\u7248\u672c\u4e0d\u5728\u505a\u4ecb\u7ecd) \u770b\u770b\u6700\u8fd1\u7684Scrapy\u6709\u4ec0\u4e48\u53d8\u5316\u3002 \u4e3aScrapy\u505a\u8d21\u732e \u5b66\u4e60\u5982\u4f55\u4e3aScrapy\u9879\u76ee\u8d21\u732e\u529b\u91cf\u3002 \u7248\u672c\u63a7\u5236\u548cAPI\u7684\u7a33\u5b9a\u6027 \u4e86\u89e3Scrapy\u7248\u672c\u63a7\u5236\u548cAPI\u7a33\u5b9a\u6027\u3002","title":"Scrapy 1.5 \u4e2d\u6587\u6587\u6863"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#scrapy-15","text":"\u8fd9\u4e2a\u6587\u6863\u5305\u542b\u4e86\u6240\u6709\u5173\u4e8eScrapy\u9700\u8981\u4e86\u89e3\u7684\u5185\u5bb9","title":"Scrapy 1.5 \u4e2d\u6587\u6587\u6863"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#_1","text":"\u6709\u9ebb\u70e6\u4e86\u4e48? \u6211\u4eec\u613f\u610f\u63d0\u4f9b\u5e2e\u52a9! \u5c1d\u8bd5 \u5e38\u89c1\u95ee\u9898 -\u5b83\u6709\u4e00\u4e9b\u5e38\u89c1\u95ee\u9898\u7684\u7b54\u6848\u3002 \u8bf7 \u5c1d\u8bd5\u7d22\u5f15 \u6216 \u6a21\u5757\u7d22\u5f15 \u6765\u5bfb\u627e\u7279\u5b9a\u4fe1\u606f\u3002 \u4f7f\u7528 scrapy\u6807\u7b7e\u5728StackOverflow \u67e5\u8be2\u6216\u641c\u7d22\u95ee\u9898\u3002 \u5728 reddit\u7684Scrapy\u7248\u5757 \u4e2d\u8be2\u95ee\u6216\u641c\u7d22\u95ee\u9898\u3002 \u5728 scrapy\u7528\u6237\u90ae\u4ef6\u5217\u8868\u7684\u6863\u6848 \u4e2d\u641c\u7d22\u95ee\u9898\u3002 \u5728 scrapy IRC\u9891\u9053 \u641c\u7d22\u95ee\u9898 \u62a5\u544ascrapy\u51fa\u73b0\u7684bug\u53d1\u9001\u7ed9 \u5b98\u65b9\u7684\u95ee\u9898\u8ddf\u8e2a\u5668","title":"\u83b7\u53d6\u5e2e\u52a9"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#_2","text":"","title":"\u7b2c\u4e00\u6b65"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#scrapy","text":"\u7406\u89e3\u4ec0\u4e48\u662fScrapy, \u5b83\u80fd\u5e2e\u52a9\u4f60\u505a\u4ec0\u4e48","title":"\u5feb\u901f\u7406\u89e3Scrapy"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#_3","text":"\u5728\u4f60\u7684\u7535\u8111\u4e0a\u5b89\u88c5Scrapy","title":"\u5b89\u88c5\u6307\u5357"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#scrapy_1","text":"\u7f16\u5199\u4f60\u7684\u7b2c\u4e00\u4e2aScrapy\u7a0b\u5e8f","title":"Scrapy\u6559\u7a0b"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#_4","text":"\u901a\u8fc7\u4e00\u4e2a\u5199\u597d\u7684Scrapy\u7a0b\u5e8f\u6765\u4e86\u89e3\u66f4\u591aScrapy\u7684\u77e5\u8bc6","title":"\u4f8b\u5b50"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#_5","text":"","title":"\u57fa\u672c\u6982\u5ff5"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#_6","text":"\u4e86\u89e3\u7528\u4e8e\u7ba1\u7406Scrapy\u9879\u76ee\u7684\u547d\u4ee4\u884c\u5de5\u5177\u3002","title":"\u547d\u4ee4\u884c\u5de5\u5177"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#spiders","text":"\u7f16\u5199\u4f60\u6293\u53d6\u7f51\u7ad9\u7684\u89c4\u5219","title":"Spiders(\u722c\u866b\u4e3b\u6587\u4ef6)"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#selectors","text":"\u4f7f\u7528XPATH\u4ece\u7f51\u7ad9\u4e0a\u63d0\u53d6\u6570\u636e","title":"Selectors(\u9009\u62e9\u5668)"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#scrapy-shell","text":"\u5728\u4ea4\u4e92\u5f0f\u73af\u5883\u4e2d\u6d4b\u8bd5\u63d0\u53d6\u4ee3\u7801","title":"Scrapy shell"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#items","text":"\u5b9a\u4e49\u4f60\u60f3\u8981\u83b7\u53d6\u6570\u636e","title":"Items"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#item-loaders","text":"\u7528\u63d0\u53d6\u7684\u6570\u636e\u586b\u5145items","title":"Item Loaders"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#item-pipeline","text":"\u540e\u671f\u5904\u7406\u6216\u5c06\u4f60\u6293\u53d6\u7684\u6570\u636e\u4fdd\u5b58\u8d77\u6765","title":"Item Pipeline(\u6570\u636e\u7ba1\u9053)"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#feed-exports","text":"\u4f7f\u7528\u4e0d\u540c\u7684\u683c\u5f0f\u548c\u5b58\u50a8\u6765\u8f93\u51fa\u6293\u53d6\u7684\u6570\u636e\u3002","title":"Feed exports"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#requests-and-responses","text":"\u4e86\u89e3\u7528\u4e8e\u8868\u793aHTTP\u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u7c7b\u3002","title":"Requests and Responses(\u8bf7\u6c42\u548c\u54cd\u5e94)"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#link-extractors","text":"\u4e00\u4e2a\u5f88\u65b9\u4fbf\u7684\u7c7b\u7528\u4e8e\u4ece\u9875\u9762\u4e2d\u63d0\u53d6\u94fe\u63a5","title":"Link Extractors(\u94fe\u63a5\u62bd\u53d6\u5668)"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#settings","text":"\u4e86\u89e3\u5982\u4f55\u914d\u7f6eScrapy\u5e76\u67e5\u770b\u6240\u6709 \u53ef\u7528\u7684\u8bbe\u7f6e \u3002","title":"Settings(\u8bbe\u7f6e)"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#_7","text":"","title":"\u5185\u7f6e\u670d\u52a1"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#_8","text":"\u4e86\u89e3\u5982\u4f55\u5728Scrapy\u4e0a\u4f7f\u7528Python\u7684\u5185\u7f6e\u65e5\u5fd7\u6a21\u5757\u3002","title":"\u65e5\u5fd7\u6a21\u5757"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#_9","text":"\u6536\u96c6\u5173\u4e8e\u6293\u53d6\u722c\u866b\u7684\u7edf\u8ba1\u6570\u636e\u3002","title":"\u72b6\u6001\u6536\u96c6"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#_10","text":"\u5f53\u67d0\u4e9b\u4e8b\u4ef6\u53d1\u751f\u65f6\u53d1\u9001\u7535\u5b50\u90ae\u4ef6\u901a\u77e5\u3002","title":"\u90ae\u4ef6\u6a21\u5757"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#telnet","text":"\u4f7f\u7528\u5185\u7f6e\u7684Python\u63a7\u5236\u53f0\u68c0\u67e5\u6b63\u5728\u8fd0\u884c\u7684\u722c\u866b\u7a0b\u5e8f\u3002","title":"Telnet\u63a7\u5236\u53f0"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#web","text":"\u4f7f\u7528web\u670d\u52a1\u76d1\u89c6\u548c\u63a7\u5236\u722c\u866b\u7a0b\u5e8f\u3002","title":"Web\u670d\u52a1"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#_11","text":"","title":"\u89e3\u51b3\u5177\u4f53\u95ee\u9898"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#_12","text":"\u627e\u51fa\u6700\u5e38\u89c1\u95ee\u9898\u7684\u7b54\u6848\u3002","title":"\u5e38\u89c1\u95ee\u9898"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#spiders_1","text":"\u4e86\u89e3\u5982\u4f55\u8c03\u8bd5\u60a8\u7684spiders\u7684\u5e38\u89c1\u95ee\u9898\u3002","title":"\u8c03\u8bd5Spiders"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#spiders-contracts","text":"\u5b66\u4e60\u5982\u4f55\u4f7f\u7528\u5408\u540c\u6d4b\u8bd5\u60a8\u7684spiders\u3002","title":"Spiders Contracts"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#_13","text":"\u719f\u6089\u4e00\u4e9b\u5e38\u89c1\u7684\u6280\u5de7\u3002","title":"\u4e00\u822c\u505a\u6cd5"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#_14","text":"\u5bf9\u5e76\u884c\u6293\u53d6\u5927\u91cf\u7f51\u7ad9\u7684Scrapy\u8fdb\u884c\u4f18\u5316\u3002","title":"\u5927\u89c4\u6a21\u722c\u53d6"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#firefox","text":"\u5b66\u4e60\u5982\u4f55\u7528Firefox\u8fdb\u884c\u6293\u53d6\u5e76\u9644\u52a0\u4e00\u4e9b\u6709\u7528\u7684\u9644\u52a0\u7ec4\u4ef6\u3002","title":"\u4f7f\u7528Firefox\u6293\u53d6"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#firebug","text":"\u5b66\u4e60\u5982\u4f55\u6709\u6548\u5730\u4f7f\u7528Firebug\u3002","title":"\u4f7f\u7528Firebug\u6293\u53d6"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#_15","text":"\u4e86\u89e3\u5982\u4f55\u5728\u722c\u866b\u7a0b\u5e8f\u4e2d\u67e5\u627e\u548c\u6e05\u9664\u5185\u5b58\u6cc4\u6f0f\u3002","title":"\u8c03\u8bd5\u5185\u5b58\u6cc4\u6f0f"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#_16","text":"\u4eceScrapy items\u91cc\u4e0b\u8f7d\u6587\u4ef6\u6216\u56fe\u50cf","title":"\u4e0b\u8f7d\u6216\u5904\u7406\u6587\u4ef6\u548c\u56fe\u50cf"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#_17","text":"\u90e8\u7f72\u60a8\u7684Scrapy\u722c\u866b\u5e76\u4e14\u653e\u5728\u8fdc\u7a0b\u670d\u52a1\u5668","title":"\u90e8\u7f72\u722c\u866b"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#_18","text":"\u6839\u636e\u8d1f\u8f7d\u52a8\u6001\u8c03\u6574\u6293\u53d6\u901f\u5ea6\u3002","title":"\u81ea\u52a8\u8282\u6d41\u9600\u6269\u5c55"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#benchmarking","text":"\u68c0\u67e5\u4e00\u4e0bScrapy\u5728\u786c\u4ef6\u4e0a\u7684\u529f\u80fd\u3002","title":"benchmarking"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#jobs","text":"\u5b66\u4e60\u5982\u4f55\u6682\u505c\u548c\u6062\u590d\u722c\u884c\u5927\u578b\u8718\u86db\u3002","title":"Jobs: \u6682\u505c\u548c\u6062\u590d\u722c\u53d6"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#scrapy_2","text":"","title":"Scrapy\u6269\u5c55"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#_19","text":"\u7406\u89e3Scrapy\u67b6\u6784\u3002","title":"\u7ed3\u6784\u6982\u8ff0"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#downloader-middleware","text":"\u81ea\u5b9a\u4e49\u9875\u9762\u5982\u4f55\u88ab\u8bf7\u6c42\u548c\u4e0b\u8f7d\u3002","title":"Downloader Middleware(\u4e0b\u8f7d\u5668\u4e2d\u95f4\u4ef6)"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#spider-middleware","text":"\u81ea\u5b9a\u4e49spiders\u7684\u8f93\u5165\u548c\u8f93\u51fa\u3002","title":"Spider Middleware(\u722c\u866b\u4e2d\u95f4\u4ef6)"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#_20","text":"\u4f7f\u7528\u81ea\u5b9a\u4e49\u529f\u80fd\u6269\u5c55Scrapy","title":"\u6269\u5c55"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#api","text":"\u5728\u6269\u5c55\u548c\u4e2d\u95f4\u4ef6\u4e0a\u4f7f\u7528\u5b83\u6765\u6269\u5c55Scrapy\u7684\u529f\u80fd","title":"\u6838\u5fc3API"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#_21","text":"\u67e5\u770b\u6240\u6709\u53ef\u7528\u7684\u4fe1\u53f7\u4ee5\u53ca\u5982\u4f55\u4f7f\u7528\u5b83\u4eec\u3002","title":"\u4fe1\u53f7"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#item-exporters","text":"\u5feb\u901f\u5bfc\u51fa\u4f60\u6293\u53d6\u7684\u6570\u636e\u5230\u4e00\u4e2a\u6587\u4ef6(XML, CSV\uff0c\u7b49\u7b49)\u3002","title":"Item Exporters"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#_22","text":"","title":"\u5176\u4ed6\u7684"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#151","text":"\u770b\u770b\u6700\u8fd1\u7684Scrapy\u6709\u4ec0\u4e48\u53d8\u5316\u3002","title":"\u53d1\u884c\u8bf4\u660e  (\u6b64\u6587\u6863\u4ece1.5.1\u7248\u672c\u5f00\u59cb, \u4ee5\u524d\u7248\u672c\u4e0d\u5728\u505a\u4ecb\u7ecd)"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#scrapy_3","text":"\u5b66\u4e60\u5982\u4f55\u4e3aScrapy\u9879\u76ee\u8d21\u732e\u529b\u91cf\u3002","title":"\u4e3aScrapy\u505a\u8d21\u732e"},{"location":"1. \u7b2c\u4e00\u6b65/01-index/#api_1","text":"\u4e86\u89e3Scrapy\u7248\u672c\u63a7\u5236\u548cAPI\u7a33\u5b9a\u6027\u3002","title":"\u7248\u672c\u63a7\u5236\u548cAPI\u7684\u7a33\u5b9a\u6027"},{"location":"1. \u7b2c\u4e00\u6b65/02-overview/","text":"\u4e00\u773c\u4e86\u89e3Scrapy Scrapy\u662f\u4e00\u4e2a\u7528\u4e8e\u6293\u53d6web\u7ad9\u70b9\u548c\u63d0\u53d6\u7ed3\u6784\u5316\u6570\u636e\u7684\u5e94\u7528\u7a0b\u5e8f\u6846\u67b6\uff0c\u53ef\u7528\u4e8e\u5404\u79cd\u6709\u7528\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u5982\u6570\u636e\u6316\u6398\u3001\u4fe1\u606f\u5904\u7406\u6216\u5386\u53f2\u6863\u6848\u3002 \u5c3d\u7ba1Scrapy\u6700\u521d\u662f\u4e3aweb\u6293\u53d6\u800c\u8bbe\u8ba1\u7684\uff0c\u4f46\u5b83\u8fd8\u53ef\u4ee5\u4f7f\u7528api(\u5982Amazon Associates web\u670d\u52a1)\u6216\u4f5c\u4e3a\u901a\u7528web\u722c\u866b\u7a0b\u5e8f\u6765\u63d0\u53d6\u6570\u636e\u3002 \u901a\u8fc7\u4e00\u4e2a\u793a\u4f8bspider \u4e3a\u4e86\u5411\u60a8\u5c55\u793aScrapy\u5e26\u6765\u4e86\u4ec0\u4e48\uff0c\u6211\u4eec\u5c06\u4ecb\u7ecd\u4e00\u4e2a\u4f7f\u7528\u6700\u7b80\u5355\u7684\u65b9\u5f0f\u8fd0\u884cSpider\u7684Scrapy\u722c\u866b\u793a\u4f8b\u3002 \u4e0b\u9762\u662f\u4e00\u4e2a\u722c\u866b\u7684\u4ee3\u7801\uff0c\u5b83\u4f1a\u4ecehttp://quotes.toscrape.com\u7f51\u7ad9\u4e0a\u7684\u8457\u540d\u5f15\u6587\u4e2d\u6293\u53d6\u5f15\u6587\uff0c\u7136\u540e\u8fdb\u884c\u5411\u540e\u7ffb\u9875: import scrapy class QuotesSpider(scrapy.Spider): name = \"quotes\" # \u722c\u866b\u9879\u76ee\u7684\u540d\u5b57 start_urls = [ 'http://quotes.toscrape.com/tag/humor/', # \u6700\u5f00\u59cb\u8981\u6293\u53d6\u7684\u9875\u9762 ] def parse(self, response): # \u89e3\u6790\u8981\u6293\u53d6\u7684\u9875\u9762 for quote in response.css('div.quote'): # \u9009\u62e9\u5668\u9009\u62e9\u8981\u6293\u53d6\u7684\u8282\u70b9 yield { 'text': quote.css('span.text::text').extract_first(), # \u83b7\u53d6\u5217\u8868\u91cc\u9762\u7b2c\u4e00\u4e2a, \u5982\u679c\u6ca1\u6709\u4f1a\u81ea\u52a8\u6355\u83b7\u5f02\u5e38 'author': quote.xpath('span/small/text()').extract_first(), } next_page = response.css('li.next a::attr(\"href\")').extract_first() # \u627e\u5230\u4e0b\u4e00\u9875\u7684\u8282\u70b9 if next_page is not None: # \u5982\u679c\u6709\u4e0b\u4e00\u9875\u7684\u8282\u70b9 yield response.follow(next_page, self.parse) # \u7ee7\u7eed\u901a\u8fc7parse\u51fd\u6570\u8fdb\u884c\u89e3\u6790 \u5c06\u5176\u653e\u5165\u6587\u672c\u6587\u4ef6\u4e2d\uff0c\u5c06\u5176\u547d\u540d\u4e3a quotes_spider.py \u5e76\u4f7f\u7528 runspider \u547d\u4ee4\u8fd0\u884c\u722c\u866b: scrapy runspider quotes_spider.py -o quotes.json \u5f53\u8fd9\u7ed3\u675f\u65f6\uff0c\u4f60\u4f1a\u5728 quotes.json \u6587\u4ef6\u5f97\u5230JSON\u683c\u5f0f\u5217\u8868\uff0c\u5305\u542b\u6587\u672c\u548c\u4f5c\u8005\uff0c\u5982\u4e0b\u6240\u793a(\u4e3a\u4e86\u66f4\u597d\u7684\u53ef\u8bfb\u6027\uff0c\u8fd9\u91cc\u91cd\u65b0\u683c\u5f0f\u5316): [{ \"author\": \"Jane Austen\", \"text\": \"\\u201cThe person, be it gentleman or lady, who has not pleasure in a good novel, must be intolerably stupid.\\u201d\" }, { \"author\": \"Groucho Marx\", \"text\": \"\\u201cOutside of a dog, a book is man's best friend. Inside of a dog it's too dark to read.\\u201d\" }, { \"author\": \"Steve Martin\", \"text\": \"\\u201cA day without sunshine is like, you know, night.\\u201d\" }, ...] \u521a\u521a\u53d1\u751f\u4e86\u4ec0\u4e48? \u5f53\u4f60\u8fd0\u884c\u547d\u4ee4 scrapy runspider quotes_spider.py , Scrapy\u5728\u91cc\u9762\u627e\u5230\u4e86\u6587\u4ef6\u540d\u4e3aquotes_spider\u7684\u722c\u866b, \u7136\u540e\u8ba9\u5b83\u901a\u8fc7\u722c\u866b\u5f15\u64ce\u8fd0\u884c\u3002 \u722c\u866b\u901a\u8fc7\u5411 start_urls \u5c5e\u6027\u4e2d\u5b9a\u4e49\u7684URL\u53d1\u51fa\u8bf7\u6c42(\u5728\u672c\u4f8b\u4e2d\uff0c\u4ec5\u4e3a\u5217\u8868\u4e2d\u7684\u5f15\u53f7URL)\u5e76\u8c03\u7528\u9ed8\u8ba4\u56de\u8c03\u65b9\u6cd5 parse \u51fd\u6570\uff0c\u5c06Response\u5bf9\u8c61\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u3002\u5728 parse \u65b9\u6cd5\u56de\u8c03\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528CSS\u9009\u62e9\u5668\u5faa\u73af\u5f15\u7528\u5143\u7d20\uff0c\u4f7f\u7528\u63d0\u53d6\u7684\u6587\u672c\u548c\u4f5c\u8005\u751f\u6210Python\u8bcd\u5178\uff0c\u67e5\u627e\u5230\u4e0b\u4e00\u9875\u7684\u94fe\u63a5\uff0c\u5e76\u4f7f\u7528\u4e0e\u56de\u8c03\u76f8\u540c\u7684 parse \u65b9\u6cd5\u8c03\u5ea6\u53e6\u4e00\u4e2a\u8bf7\u6c42\u3002\u5728\u8fd9\u91cc\uff0c\u60a8\u4f1a\u6ce8\u610f\u5230Scrapy\u7684\u4e00\u4e2a\u4e3b\u8981\u4f18\u70b9:requests\u662f\u5f02\u6b65\u8c03\u5ea6\u548c\u5904\u7406\u7684\u3002 \u8fd9\u610f\u5473\u7740Scrapy\u4e0d\u9700\u8981\u7b49\u5f85\u4e0a\u4e00\u4e2a\u8bf7\u6c42\u88ab\u5b8c\u6210\u548c\u5904\u7406\uff0c\u5b83\u53ef\u4ee5\u540c\u65f6\u53d1\u9001\u591a\u4e2a\u8bf7\u6c42\u6216\u505a\u5176\u4ed6\u4e8b\u60c5\u3002\u8fd9\u4e5f\u610f\u5473\u7740\uff0c\u5373\u4f7f\u67d0\u4e9b\u8bf7\u6c42\u5931\u8d25\u6216\u5728\u5904\u7406\u65f6\u53d1\u751f\u9519\u8bef\uff0c\u5176\u4ed6\u8bf7\u6c42\u4e5f\u53ef\u4ee5\u7ee7\u7eed\u8fd0\u884c\u3002 \u867d\u7136\u8fd9\u4f7f\u60a8\u80fd\u591f\u8fdb\u884c\u975e\u5e38\u5feb\u901f\u7684\u6293\u53d6(\u4ee5\u5bb9\u9519\u7684\u65b9\u5f0f\u540c\u65f6\u53d1\u9001\u591a\u4e2a\u5e76\u53d1\u8bf7\u6c42)\uff0c\u4f46\u662fScrapy\u8fd8\u8ba9\u60a8\u53ef\u4ee5\u63a7\u5236\u901a\u8fc7 \u4e00\u4e9b\u8bbe\u7f6e \u8fdb\u884c\u793c\u8c8c\u7684\u6293\u53d6\u3002\u60a8\u53ef\u4ee5\u5728\u6bcf\u4e2a\u8bf7\u6c42\u4e4b\u95f4\u8bbe\u7f6e\u4e0b\u8f7d\u5ef6\u8fdf\uff0c\u9650\u5236\u6bcf\u4e2a\u57df\u6216\u6bcf\u4e2aIP\u7684\u5e76\u53d1\u8bf7\u6c42\u6570\u91cf\uff0c\u751a\u81f3\u53ef\u4ee5 \u4f7f\u7528\u81ea\u52a8\u8282\u6d41\u6269\u5c55 \u6765\u81ea\u52a8\u8ba1\u7b97\u8fd9\u4e9b\u8bf7\u6c42\u3002 \u6ce8\u610f! \u8fd9\u662f\u4f7f\u7528feed exports\u5bfc\u51fa\u6765\u751f\u6210JSON\u6587\u4ef6\uff0c\u60a8\u53ef\u4ee5\u8f7b\u677e\u5730\u66f4\u6539\u5bfc\u51fa\u683c\u5f0f(\u4f8b\u5982XML\u6216CSV)\u6216\u5b58\u50a8\u540e\u7aef(\u4f8b\u5982FTP\u6216Amazon S3)\u3002\u60a8\u8fd8\u53ef\u4ee5\u7f16\u5199\u4e00\u4e2aitem pipeline\u6765\u5c06\u9879items\u5b58\u50a8\u5728\u6570\u636e\u5e93\u4e2d\u3002 \u8fd8\u6709\u5176\u4ed6\u7684\u4e48? \u60a8\u5df2\u7ecf\u770b\u5230\u4e86\u5982\u4f55\u4f7f\u7528Scrapy\u4ece\u7f51\u7ad9\u63d0\u53d6\u548c\u5b58\u50a8items\uff0c\u4f46\u8fd9\u53ea\u662f\u8868\u9762\u3002Scrapy\u63d0\u4f9b\u4e86\u8bb8\u591a\u529f\u80fd\u5f3a\u5927\u7684\u7279\u6027\uff0c\u4f7f\u6293\u53d6\u53d8\u5f97\u7b80\u5355\u548c\u9ad8\u6548\uff0c\u4f8b\u5982: \u5185\u7f6e\u652f\u6301\u4f7f\u7528CSS\u9009\u62e9\u5668\u548cXPath\u8868\u8fbe\u5f0f\u4eceHTML/XML\u6e90\u4e2d \u9009\u62e9\u548c\u63d0\u53d6 \u6570\u636e\uff0c\u4ee5\u53ca\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u63d0\u53d6\u7b49\u8f85\u52a9\u65b9\u6cd5\u3002 \u4e00\u4e2a\u4ea4\u4e92\u5f0fshell\u63a7\u5236\u53f0(\u652f\u6301IPython)\uff0c\u7528\u4e8e\u5c1d\u8bd5CSS\u548cXPath\u8868\u8fbe\u5f0f\u6765\u63d0\u53d6\u6570\u636e\uff0c\u5728\u7f16\u5199\u6216\u8c03\u8bd5\u722c\u866b\u65f6\u975e\u5e38\u6709\u7528\u3002 \u5185\u7f6e\u652f\u6301feed exports\u53ef\u4ee5\u751f\u6210\u591a\u79cd\u683c\u5f0f(JSON\u3001CSV\u3001XML)\uff0c\u5e76\u5c06\u5b83\u4eec\u5b58\u50a8\u5728\u591a\u4e2a\u540e\u7aef(FTP\u3001S3\u3001\u672c\u5730\u6587\u4ef6\u7cfb\u7edf)\u4e2d\u3002 \u5065\u58ee\u7684\u7f16\u7801\u652f\u6301\u548c\u81ea\u52a8\u68c0\u6d4b\uff0c\u7528\u4e8e\u5904\u7406\u5916\u90e8\u3001\u975e\u6807\u51c6\u548c\u7834\u788e\u7684\u7f16\u7801\u58f0\u660e\u3002 \u5f3a\u5927\u7684\u6269\u5c55\u6027\u652f\u6301 \uff0c\u5141\u8bb8\u60a8\u4f7f\u7528 \u4fe1\u53f7 \u548c\u660e\u786e\u7684API \u4e2d\u95f4\u4ef6 \u3001 \u6269\u5c55\u548c\u7ba1\u9053 \u63d2\u5165\u5230\u81ea\u5df1\u7684\u529f\u80fd\u3002 \u5e7f\u6cdb\u7684\u5185\u5efa\u6269\u5c55\u548c\u4e2d\u95f4\u4ef6\u5904\u7406: cookies\u548csession\u5904\u7406 HTTP\u7279\u6027\uff0c\u5982\u538b\u7f29\u3001\u8eab\u4efd\u9a8c\u8bc1\u548c\u7f13\u5b58 \u7528\u6237\u4ee3\u7406\u6b3a\u9a97 robots.txt \u722c\u884c\u6df1\u5ea6\u9650\u5236 \u751a\u81f3\u66f4\u591a \u4e00\u4e2a Telnet\u63a7\u5236\u53f0 \uff0c\u7528\u4e8e\u8fde\u63a5\u5230\u8fd0\u884c\u5728Scrapy\u8fdb\u7a0b\u5185\u90e8\u7684Python\u63a7\u5236\u53f0\uff0c\u4ee5\u81ea\u6211\u89c2\u5bdf\u548c\u8c03\u8bd5\u722c\u866b\u7a0b\u5e8f \u518d\u52a0\u4e0a\u5176\u4ed6\u597d\u4e1c\u897f\uff0c\u6bd4\u5982\u53ef\u590d\u7528\u7684\u722c\u866b\u4eceSitemaps\u548cXML/CSV feeds\u4e2d\u6293\u53d6\u7ad9\u70b9\uff0c\u4e00\u4e2a\u7528\u4e8e \u81ea\u52a8\u4e0b\u8f7d\u56fe\u50cf (\u6216\u4efb\u4f55\u5176\u4ed6\u5a92\u4f53)\u7684media pipeline\uff0c\u4e00\u4e2a\u7f13\u5b58DNS\u89e3\u6790\u5668\uff0c\u7b49\u7b49! \u4e0b\u4e00\u4e2a\u662f\u4ec0\u4e48? \u63a5\u4e0b\u6765\u7684\u6b65\u9aa4\u662f \u5b89\u88c5Scrapy \uff0c \u6309\u7167\u6559\u7a0b\u5b66\u4e60 \u5982\u4f55\u521b\u5efa\u4e00\u4e2a\u6210\u719f\u7684Scrapy\u9879\u76ee\u5e76 \u52a0\u5165\u793e\u533a \u3002\u8c22\u8c22\u4f60\u7684\u5174\u8da3!","title":"\u4e00\u773c\u4e86\u89e3Scrapy"},{"location":"1. \u7b2c\u4e00\u6b65/02-overview/#scrapy","text":"Scrapy\u662f\u4e00\u4e2a\u7528\u4e8e\u6293\u53d6web\u7ad9\u70b9\u548c\u63d0\u53d6\u7ed3\u6784\u5316\u6570\u636e\u7684\u5e94\u7528\u7a0b\u5e8f\u6846\u67b6\uff0c\u53ef\u7528\u4e8e\u5404\u79cd\u6709\u7528\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u5982\u6570\u636e\u6316\u6398\u3001\u4fe1\u606f\u5904\u7406\u6216\u5386\u53f2\u6863\u6848\u3002 \u5c3d\u7ba1Scrapy\u6700\u521d\u662f\u4e3aweb\u6293\u53d6\u800c\u8bbe\u8ba1\u7684\uff0c\u4f46\u5b83\u8fd8\u53ef\u4ee5\u4f7f\u7528api(\u5982Amazon Associates web\u670d\u52a1)\u6216\u4f5c\u4e3a\u901a\u7528web\u722c\u866b\u7a0b\u5e8f\u6765\u63d0\u53d6\u6570\u636e\u3002","title":"\u4e00\u773c\u4e86\u89e3Scrapy"},{"location":"1. \u7b2c\u4e00\u6b65/02-overview/#spider","text":"\u4e3a\u4e86\u5411\u60a8\u5c55\u793aScrapy\u5e26\u6765\u4e86\u4ec0\u4e48\uff0c\u6211\u4eec\u5c06\u4ecb\u7ecd\u4e00\u4e2a\u4f7f\u7528\u6700\u7b80\u5355\u7684\u65b9\u5f0f\u8fd0\u884cSpider\u7684Scrapy\u722c\u866b\u793a\u4f8b\u3002 \u4e0b\u9762\u662f\u4e00\u4e2a\u722c\u866b\u7684\u4ee3\u7801\uff0c\u5b83\u4f1a\u4ecehttp://quotes.toscrape.com\u7f51\u7ad9\u4e0a\u7684\u8457\u540d\u5f15\u6587\u4e2d\u6293\u53d6\u5f15\u6587\uff0c\u7136\u540e\u8fdb\u884c\u5411\u540e\u7ffb\u9875: import scrapy class QuotesSpider(scrapy.Spider): name = \"quotes\" # \u722c\u866b\u9879\u76ee\u7684\u540d\u5b57 start_urls = [ 'http://quotes.toscrape.com/tag/humor/', # \u6700\u5f00\u59cb\u8981\u6293\u53d6\u7684\u9875\u9762 ] def parse(self, response): # \u89e3\u6790\u8981\u6293\u53d6\u7684\u9875\u9762 for quote in response.css('div.quote'): # \u9009\u62e9\u5668\u9009\u62e9\u8981\u6293\u53d6\u7684\u8282\u70b9 yield { 'text': quote.css('span.text::text').extract_first(), # \u83b7\u53d6\u5217\u8868\u91cc\u9762\u7b2c\u4e00\u4e2a, \u5982\u679c\u6ca1\u6709\u4f1a\u81ea\u52a8\u6355\u83b7\u5f02\u5e38 'author': quote.xpath('span/small/text()').extract_first(), } next_page = response.css('li.next a::attr(\"href\")').extract_first() # \u627e\u5230\u4e0b\u4e00\u9875\u7684\u8282\u70b9 if next_page is not None: # \u5982\u679c\u6709\u4e0b\u4e00\u9875\u7684\u8282\u70b9 yield response.follow(next_page, self.parse) # \u7ee7\u7eed\u901a\u8fc7parse\u51fd\u6570\u8fdb\u884c\u89e3\u6790 \u5c06\u5176\u653e\u5165\u6587\u672c\u6587\u4ef6\u4e2d\uff0c\u5c06\u5176\u547d\u540d\u4e3a quotes_spider.py \u5e76\u4f7f\u7528 runspider \u547d\u4ee4\u8fd0\u884c\u722c\u866b: scrapy runspider quotes_spider.py -o quotes.json \u5f53\u8fd9\u7ed3\u675f\u65f6\uff0c\u4f60\u4f1a\u5728 quotes.json \u6587\u4ef6\u5f97\u5230JSON\u683c\u5f0f\u5217\u8868\uff0c\u5305\u542b\u6587\u672c\u548c\u4f5c\u8005\uff0c\u5982\u4e0b\u6240\u793a(\u4e3a\u4e86\u66f4\u597d\u7684\u53ef\u8bfb\u6027\uff0c\u8fd9\u91cc\u91cd\u65b0\u683c\u5f0f\u5316): [{ \"author\": \"Jane Austen\", \"text\": \"\\u201cThe person, be it gentleman or lady, who has not pleasure in a good novel, must be intolerably stupid.\\u201d\" }, { \"author\": \"Groucho Marx\", \"text\": \"\\u201cOutside of a dog, a book is man's best friend. Inside of a dog it's too dark to read.\\u201d\" }, { \"author\": \"Steve Martin\", \"text\": \"\\u201cA day without sunshine is like, you know, night.\\u201d\" }, ...]","title":"\u901a\u8fc7\u4e00\u4e2a\u793a\u4f8bspider"},{"location":"1. \u7b2c\u4e00\u6b65/02-overview/#_1","text":"\u5f53\u4f60\u8fd0\u884c\u547d\u4ee4 scrapy runspider quotes_spider.py , Scrapy\u5728\u91cc\u9762\u627e\u5230\u4e86\u6587\u4ef6\u540d\u4e3aquotes_spider\u7684\u722c\u866b, \u7136\u540e\u8ba9\u5b83\u901a\u8fc7\u722c\u866b\u5f15\u64ce\u8fd0\u884c\u3002 \u722c\u866b\u901a\u8fc7\u5411 start_urls \u5c5e\u6027\u4e2d\u5b9a\u4e49\u7684URL\u53d1\u51fa\u8bf7\u6c42(\u5728\u672c\u4f8b\u4e2d\uff0c\u4ec5\u4e3a\u5217\u8868\u4e2d\u7684\u5f15\u53f7URL)\u5e76\u8c03\u7528\u9ed8\u8ba4\u56de\u8c03\u65b9\u6cd5 parse \u51fd\u6570\uff0c\u5c06Response\u5bf9\u8c61\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u3002\u5728 parse \u65b9\u6cd5\u56de\u8c03\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528CSS\u9009\u62e9\u5668\u5faa\u73af\u5f15\u7528\u5143\u7d20\uff0c\u4f7f\u7528\u63d0\u53d6\u7684\u6587\u672c\u548c\u4f5c\u8005\u751f\u6210Python\u8bcd\u5178\uff0c\u67e5\u627e\u5230\u4e0b\u4e00\u9875\u7684\u94fe\u63a5\uff0c\u5e76\u4f7f\u7528\u4e0e\u56de\u8c03\u76f8\u540c\u7684 parse \u65b9\u6cd5\u8c03\u5ea6\u53e6\u4e00\u4e2a\u8bf7\u6c42\u3002\u5728\u8fd9\u91cc\uff0c\u60a8\u4f1a\u6ce8\u610f\u5230Scrapy\u7684\u4e00\u4e2a\u4e3b\u8981\u4f18\u70b9:requests\u662f\u5f02\u6b65\u8c03\u5ea6\u548c\u5904\u7406\u7684\u3002 \u8fd9\u610f\u5473\u7740Scrapy\u4e0d\u9700\u8981\u7b49\u5f85\u4e0a\u4e00\u4e2a\u8bf7\u6c42\u88ab\u5b8c\u6210\u548c\u5904\u7406\uff0c\u5b83\u53ef\u4ee5\u540c\u65f6\u53d1\u9001\u591a\u4e2a\u8bf7\u6c42\u6216\u505a\u5176\u4ed6\u4e8b\u60c5\u3002\u8fd9\u4e5f\u610f\u5473\u7740\uff0c\u5373\u4f7f\u67d0\u4e9b\u8bf7\u6c42\u5931\u8d25\u6216\u5728\u5904\u7406\u65f6\u53d1\u751f\u9519\u8bef\uff0c\u5176\u4ed6\u8bf7\u6c42\u4e5f\u53ef\u4ee5\u7ee7\u7eed\u8fd0\u884c\u3002 \u867d\u7136\u8fd9\u4f7f\u60a8\u80fd\u591f\u8fdb\u884c\u975e\u5e38\u5feb\u901f\u7684\u6293\u53d6(\u4ee5\u5bb9\u9519\u7684\u65b9\u5f0f\u540c\u65f6\u53d1\u9001\u591a\u4e2a\u5e76\u53d1\u8bf7\u6c42)\uff0c\u4f46\u662fScrapy\u8fd8\u8ba9\u60a8\u53ef\u4ee5\u63a7\u5236\u901a\u8fc7 \u4e00\u4e9b\u8bbe\u7f6e \u8fdb\u884c\u793c\u8c8c\u7684\u6293\u53d6\u3002\u60a8\u53ef\u4ee5\u5728\u6bcf\u4e2a\u8bf7\u6c42\u4e4b\u95f4\u8bbe\u7f6e\u4e0b\u8f7d\u5ef6\u8fdf\uff0c\u9650\u5236\u6bcf\u4e2a\u57df\u6216\u6bcf\u4e2aIP\u7684\u5e76\u53d1\u8bf7\u6c42\u6570\u91cf\uff0c\u751a\u81f3\u53ef\u4ee5 \u4f7f\u7528\u81ea\u52a8\u8282\u6d41\u6269\u5c55 \u6765\u81ea\u52a8\u8ba1\u7b97\u8fd9\u4e9b\u8bf7\u6c42\u3002 \u6ce8\u610f! \u8fd9\u662f\u4f7f\u7528feed exports\u5bfc\u51fa\u6765\u751f\u6210JSON\u6587\u4ef6\uff0c\u60a8\u53ef\u4ee5\u8f7b\u677e\u5730\u66f4\u6539\u5bfc\u51fa\u683c\u5f0f(\u4f8b\u5982XML\u6216CSV)\u6216\u5b58\u50a8\u540e\u7aef(\u4f8b\u5982FTP\u6216Amazon S3)\u3002\u60a8\u8fd8\u53ef\u4ee5\u7f16\u5199\u4e00\u4e2aitem pipeline\u6765\u5c06\u9879items\u5b58\u50a8\u5728\u6570\u636e\u5e93\u4e2d\u3002","title":"\u521a\u521a\u53d1\u751f\u4e86\u4ec0\u4e48?"},{"location":"1. \u7b2c\u4e00\u6b65/02-overview/#_2","text":"\u60a8\u5df2\u7ecf\u770b\u5230\u4e86\u5982\u4f55\u4f7f\u7528Scrapy\u4ece\u7f51\u7ad9\u63d0\u53d6\u548c\u5b58\u50a8items\uff0c\u4f46\u8fd9\u53ea\u662f\u8868\u9762\u3002Scrapy\u63d0\u4f9b\u4e86\u8bb8\u591a\u529f\u80fd\u5f3a\u5927\u7684\u7279\u6027\uff0c\u4f7f\u6293\u53d6\u53d8\u5f97\u7b80\u5355\u548c\u9ad8\u6548\uff0c\u4f8b\u5982: \u5185\u7f6e\u652f\u6301\u4f7f\u7528CSS\u9009\u62e9\u5668\u548cXPath\u8868\u8fbe\u5f0f\u4eceHTML/XML\u6e90\u4e2d \u9009\u62e9\u548c\u63d0\u53d6 \u6570\u636e\uff0c\u4ee5\u53ca\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u63d0\u53d6\u7b49\u8f85\u52a9\u65b9\u6cd5\u3002 \u4e00\u4e2a\u4ea4\u4e92\u5f0fshell\u63a7\u5236\u53f0(\u652f\u6301IPython)\uff0c\u7528\u4e8e\u5c1d\u8bd5CSS\u548cXPath\u8868\u8fbe\u5f0f\u6765\u63d0\u53d6\u6570\u636e\uff0c\u5728\u7f16\u5199\u6216\u8c03\u8bd5\u722c\u866b\u65f6\u975e\u5e38\u6709\u7528\u3002 \u5185\u7f6e\u652f\u6301feed exports\u53ef\u4ee5\u751f\u6210\u591a\u79cd\u683c\u5f0f(JSON\u3001CSV\u3001XML)\uff0c\u5e76\u5c06\u5b83\u4eec\u5b58\u50a8\u5728\u591a\u4e2a\u540e\u7aef(FTP\u3001S3\u3001\u672c\u5730\u6587\u4ef6\u7cfb\u7edf)\u4e2d\u3002 \u5065\u58ee\u7684\u7f16\u7801\u652f\u6301\u548c\u81ea\u52a8\u68c0\u6d4b\uff0c\u7528\u4e8e\u5904\u7406\u5916\u90e8\u3001\u975e\u6807\u51c6\u548c\u7834\u788e\u7684\u7f16\u7801\u58f0\u660e\u3002 \u5f3a\u5927\u7684\u6269\u5c55\u6027\u652f\u6301 \uff0c\u5141\u8bb8\u60a8\u4f7f\u7528 \u4fe1\u53f7 \u548c\u660e\u786e\u7684API \u4e2d\u95f4\u4ef6 \u3001 \u6269\u5c55\u548c\u7ba1\u9053 \u63d2\u5165\u5230\u81ea\u5df1\u7684\u529f\u80fd\u3002 \u5e7f\u6cdb\u7684\u5185\u5efa\u6269\u5c55\u548c\u4e2d\u95f4\u4ef6\u5904\u7406: cookies\u548csession\u5904\u7406 HTTP\u7279\u6027\uff0c\u5982\u538b\u7f29\u3001\u8eab\u4efd\u9a8c\u8bc1\u548c\u7f13\u5b58 \u7528\u6237\u4ee3\u7406\u6b3a\u9a97 robots.txt \u722c\u884c\u6df1\u5ea6\u9650\u5236 \u751a\u81f3\u66f4\u591a \u4e00\u4e2a Telnet\u63a7\u5236\u53f0 \uff0c\u7528\u4e8e\u8fde\u63a5\u5230\u8fd0\u884c\u5728Scrapy\u8fdb\u7a0b\u5185\u90e8\u7684Python\u63a7\u5236\u53f0\uff0c\u4ee5\u81ea\u6211\u89c2\u5bdf\u548c\u8c03\u8bd5\u722c\u866b\u7a0b\u5e8f \u518d\u52a0\u4e0a\u5176\u4ed6\u597d\u4e1c\u897f\uff0c\u6bd4\u5982\u53ef\u590d\u7528\u7684\u722c\u866b\u4eceSitemaps\u548cXML/CSV feeds\u4e2d\u6293\u53d6\u7ad9\u70b9\uff0c\u4e00\u4e2a\u7528\u4e8e \u81ea\u52a8\u4e0b\u8f7d\u56fe\u50cf (\u6216\u4efb\u4f55\u5176\u4ed6\u5a92\u4f53)\u7684media pipeline\uff0c\u4e00\u4e2a\u7f13\u5b58DNS\u89e3\u6790\u5668\uff0c\u7b49\u7b49!","title":"\u8fd8\u6709\u5176\u4ed6\u7684\u4e48?"},{"location":"1. \u7b2c\u4e00\u6b65/02-overview/#_3","text":"\u63a5\u4e0b\u6765\u7684\u6b65\u9aa4\u662f \u5b89\u88c5Scrapy \uff0c \u6309\u7167\u6559\u7a0b\u5b66\u4e60 \u5982\u4f55\u521b\u5efa\u4e00\u4e2a\u6210\u719f\u7684Scrapy\u9879\u76ee\u5e76 \u52a0\u5165\u793e\u533a \u3002\u8c22\u8c22\u4f60\u7684\u5174\u8da3!","title":"\u4e0b\u4e00\u4e2a\u662f\u4ec0\u4e48?"},{"location":"1. \u7b2c\u4e00\u6b65/03-install/","text":"\u5b89\u88c5\u6307\u5bfc \u672c\u9875\u4e0d\u5199\u4e86, \u6d6a\u8d39\u65f6\u95f4, \u57fa\u672c\u90fd\u4f1a\u5b89\u88c5","title":"\u5b89\u88c5\u6307\u5bfc"},{"location":"1. \u7b2c\u4e00\u6b65/03-install/#_1","text":"\u672c\u9875\u4e0d\u5199\u4e86, \u6d6a\u8d39\u65f6\u95f4, \u57fa\u672c\u90fd\u4f1a\u5b89\u88c5","title":"\u5b89\u88c5\u6307\u5bfc"},{"location":"1. \u7b2c\u4e00\u6b65/04-scrapy tutorial/","text":"Scrapy \u6559\u7a0b \u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u6211\u4eec\u5047\u8bbeScrapy\u5df2\u7ecf\u5b89\u88c5\u5728\u60a8\u7684\u7cfb\u7edf\u4e0a\u3002\u5982\u679c\u4e0d\u662f\u8fd9\u6837\uff0c\u8bf7\u53c2\u9605 \u5b89\u88c5\u6307\u5357 \u3002 \u6211\u4eec\u5c06\u6293\u53d6 toscrape.com \uff0c\u4e00\u4e2a\u5217\u51fa\u8457\u540d\u4f5c\u5bb6\u7684\u5f15\u7528\u7684\u7f51\u7ad9\u3002 \u672c\u6559\u7a0b\u5c06\u5e26\u9886\u60a8\u5b8c\u6210\u4ee5\u4e0b\u4efb\u52a1: \u521b\u5efa\u4e00\u4e2a\u65b0\u7684Scrapy\u9879\u76ee \u7f16\u5199\u4e00\u4e2a spider \u6765\u6293\u53d6\u7ad9\u70b9\u5e76\u63d0\u53d6\u6570\u636e \u4f7f\u7528\u547d\u4ee4\u884c\u5bfc\u51fa\u6293\u53d6\u7684\u6570\u636e \u5c06spider\u66f4\u6539\u4e3a\u9012\u5f52\u8ddf\u8e2a\u94fe\u63a5 \u4f7f\u7528spider\u53c2\u6570 Scrapy\u662f\u7528 Python \u7f16\u5199\u7684\u3002\u5982\u679c\u4f60\u5bf9\u8fd9\u95e8\u8bed\u8a00\u4e0d\u719f\u6089\uff0c\u4f60\u53ef\u80fd\u4f1a\u60f3\u5148\u4e86\u89e3\u4e00\u4e0b\u8fd9\u95e8\u8bed\u8a00\u662f\u4ec0\u4e48\u6837\u5b50\u7684\uff0c\u8fd9\u6837\u4f60\u5c31\u80fd\u6700\u5927\u9650\u5ea6\u5730\u4ece\u56f0\u5883\u4e2d\u89e3\u8131\u51fa\u6765\u3002 \u5982\u679c\u60a8\u5df2\u7ecf\u719f\u6089\u5176\u4ed6\u8bed\u8a00\uff0c\u5e76\u4e14\u5e0c\u671b\u5feb\u901f\u5b66\u4e60Python\uff0c\u6211\u4eec\u5efa\u8bae\u60a8 \u901a\u8bfbPython 3 \u3002\u6216\u8005\uff0c\u60a8\u53ef\u4ee5\u9075\u5faa Python\u6559\u7a0b \u3002 \u5982\u679c\u60a8\u662f\u4e00\u4e2a\u7f16\u7a0b\u65b0\u624b\uff0c\u5e76\u4e14\u60f3\u4ecePython\u5f00\u59cb\uff0c\u60a8\u53ef\u80fd\u4f1a\u53d1\u73b0\u5728\u7ebf\u4e66\u7c4d \u300a\u8270\u96be\u5730\u5b66\u4e60Python\u300b \u5f88\u6709\u7528\u3002\u60a8\u8fd8\u53ef\u4ee5\u67e5\u770b\u4e00\u4e0b \u9488\u5bf9\u975e\u7a0b\u5e8f\u5458\u7684Python\u8d44\u6e90\u5217\u8868 \u3002 \u521b\u5efa\u4e00\u4e2a\u9879\u76ee \u5728\u4f60\u5f00\u59cb\u6293\u53d6\u4e4b\u524d\uff0c\u4f60\u5fc5\u987b\u5efa\u7acb\u4e00\u4e2a\u65b0\u7684Scrapy\u9879\u76ee\u3002\u8f93\u5165\u60f3\u8981\u5b58\u50a8\u4ee3\u7801\u7684\u76ee\u5f55\u5e76\u8fd0\u884c: scrapy startproject quotes \u8fd9\u5c06\u521b\u5efa\u4e00\u4e2a\u5305\u542b\u4ee5\u4e0b\u5185\u5bb9\u7684\u76ee\u5f55: quotes/ scrapy.cfg # \u90e8\u7f72\u914d\u7f6e\u6587\u4ef6 quotes/ # \u9879\u76ee\u7684Python\u6a21\u5757\uff0c\u60a8\u5c06\u4ece\u8fd9\u91cc\u5bfc\u5165\u4ee3\u7801 __init__.py items.py # \u9879\u76ee\u7684items middlewares.py # \u9879\u76ee\u7684\u4e2d\u95f4\u4ef6 pipelines.py # \u9879\u76ee\u7684pipeline settings.py # \u9879\u76ee\u7684settings spiders/ # \u4e00\u4e2a\u76ee\u5f55\uff0c\u7a0d\u540e\u60a8\u5c06\u5728\u5176\u4e2d\u653e\u7f6e\u60a8\u7684spider(\u722c\u866b) __init__.py \u6211\u4eec\u7684\u7b2c\u4e00\u4e2a\u722c\u866b(Spider) Spiders\u662f\u60a8\u5b9a\u4e49\u7684\u7c7b\uff0cScrapy\u7528\u4e8e\u4ece\u7f51\u7ad9(\u6216\u4e00\u7ec4\u7f51\u7ad9)\u4e2d\u63d0\u53d6\u4fe1\u606f\u3002\u4ed6\u4eec\u5fc5\u987b\u662f scrapy.Spider \u7684\u5b50\u7c7b\u5e76\u4e14\u5b9a\u4e49\u521d\u59cbrequests\u3002\u53ef\u4ee5\u9009\u62e9\u5982\u4f55\u8ddf\u8e2a\u9875\u9762\u4e2d\u7684\u94fe\u63a5\uff0c\u4ee5\u53ca\u5982\u4f55\u89e3\u6790\u4e0b\u8f7d\u7684\u9875\u9762\u5185\u5bb9\u4ee5\u63d0\u53d6\u6570\u636e\u3002 \u8fd9\u662f\u7b2c\u4e00\u4e2aSpider(\u722c\u866b)\u7684\u4ee3\u7801\u3002\u5c06\u5176\u4fdd\u5b58\u5728\u540d\u4e3a quotes_spider.py \u7684\u6587\u4ef6\u4e2d\u3002\u7136\u540e\u653e\u5728\u9879\u76ee\u540d/spiders\u76ee\u5f55\u4e0b: import scrapy class QuotesSpider(scrapy.Spider): name = quotes def start_requests(self): urls = [ 'http://quotes.toscrape.com/page/1/', 'http://quotes.toscrape.com/page/2/', ] for url in urls: yield scrapy.Request(url=url, callback=self.parse) def parse(self, response): page = response.url.split( / )[-2] filename = 'quotes-%s.html' % page with open(filename, 'wb') as f: f.write(response.body) self.log('Saved file %s' % filename) \u5982\u60a8\u6240\u89c1\uff0c\u6211\u4eec\u7684Spider\u5b50\u7c7b scrapy.Spider \u3002\u5e76\u5b9a\u4e49\u4e86\u4e00\u4e9b\u5c5e\u6027\u548c\u65b9\u6cd5: name : \u6807\u8bc6\u4e86Spider\u3002\u5b83\u5fc5\u987b\u5728\u9879\u76ee\u4e2d\u662f\u552f\u4e00\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u60a8\u4e0d\u80fd\u4e3a\u4e0d\u540c\u7684Spider\u8bbe\u7f6e\u76f8\u540c\u7684\u540d\u79f0\u3002 start_requests() : \u5fc5\u987b\u8fd4\u56de\u53ef\u4ee5\u8fed\u4ee3\u7684\u8bf7\u6c42(\u60a8\u53ef\u4ee5\u5b9a\u4e49\u8bf7\u6c42\u5217\u8868\u6216\u7f16\u5199\u5217\u8868\u63a8\u5bfc\u5f0f)\uff0cSpider\u5c06\u4ece\u8be5\u8fed\u4ee3\u5f00\u59cb\u6293\u53d6\u3002\u540e\u7eed\u8bf7\u6c42\u5c06\u4ece\u8fd9\u4e9b\u521d\u59cb\u8bf7\u6c42\u4e2d\u4f9d\u6b21\u751f\u6210\u3002 parse() : \u88ab\u8c03\u7528\u5904\u7406\u6bcf\u4e2a\u8bf7\u6c42\u89e3\u6790\u5b8c\u4e4b\u540e\u540e\u7eed\u5904\u7406\u7684\u65b9\u6cd5\u3002response\u53c2\u6570\u662f TextResponse \u7684\u4e00\u4e2a\u5b9e\u4f8b\uff0c\u5b83\u4fdd\u5b58\u4e86\u9875\u9762\u5185\u5bb9\uff0c\u5e76\u6709\u8fdb\u4e00\u6b65\u6709\u7528\u7684\u65b9\u6cd5\u6765\u5904\u7406\u5b83\u3002 parse()\u65b9\u6cd5\u901a\u5e38\u89e3\u6790response\uff0c\u5c06\u6293\u53d6\u7684\u6570\u636e\u63d0\u53d6\u4e3a\u5b57\u5178\uff0c\u5e76\u627e\u5230\u8981\u8ddf\u8e2a\u7684\u65b0url\uff0c\u5e76\u4ece\u4e2d\u521b\u5efa\u65b0\u7684\u8bf7\u6c42( Request )\u3002 \u5982\u4f55\u8fd0\u884c\u6211\u4eec\u7684\u722c\u866b \u8981\u8ba9spider\u6b63\u5e38\u5de5\u4f5c\uff0c\u8bf7\u8f6c\u5230\u9879\u76ee\u7684\u8ddf\u76ee\u5f55\u5e76\u8fd0\u884c: scrapy crawl quotes \u8fd9\u4e2a\u547d\u4ee4\u7528\u6211\u4eec\u521a\u521a\u6dfb\u52a0\u7684Spider\u540d\u5b57 quotes \uff0c\u5b83\u5c06\u53d1\u9001\u4e00\u4e9b\u5bf9 http://quotes.toscrape.com/ \u57df\u7684\u8bf7\u6c42\u3002\u60a8\u5c06\u5f97\u5230\u4e00\u4e2a\u7c7b\u4f3c\u7684\u8f93\u51fa: ... (omitted for brevity) 2016-12-16 21:24:05 [scrapy.core.engine] INFO: Spider opened 2016-12-16 21:24:05 [scrapy.extensions.logstats] INFO: Crawled 0 pages (at 0 pages/min), scraped 0 items (at 0 items/min) 2016-12-16 21:24:05 [scrapy.extensions.telnet] DEBUG: Telnet console listening on 127.0.0.1:6023 2016-12-16 21:24:05 [scrapy.core.engine] DEBUG: Crawled (404) GET http://quotes.toscrape.com/robots.txt (referer: None) 2016-12-16 21:24:05 [scrapy.core.engine] DEBUG: Crawled (200) GET http://quotes.toscrape.com/page/1/ (referer: None) 2016-12-16 21:24:05 [scrapy.core.engine] DEBUG: Crawled (200) GET http://quotes.toscrape.com/page/2/ (referer: None) 2016-12-16 21:24:05 [quotes] DEBUG: Saved file quotes-1.html 2016-12-16 21:24:05 [quotes] DEBUG: Saved file quotes-2.html 2016-12-16 21:24:05 [scrapy.core.engine] INFO: Closing spider (finished) ... \u73b0\u5728\uff0c\u68c0\u67e5\u5f53\u524d\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\u3002\u60a8\u5e94\u8be5\u6ce8\u610f\u5230\u5df2\u7ecf\u521b\u5efa\u4e86\u4e24\u4e2a\u65b0\u6587\u4ef6:quotes-1.html\u548cquotes-2.html\uff0c\u4ee5\u53ca\u76f8\u5e94url\u7684\u5185\u5bb9\uff0c\u5982\u6211\u4eec\u7684 parse \u65b9\u6cd5\u6240\u793a\u3002 \u6ce8\u610f!!! \u5982\u679c\u60a8\u60f3\u77e5\u9053\u4e3a\u4ec0\u4e48\u6211\u4eec\u8fd8\u6ca1\u6709\u89e3\u6790HTML\uff0c\u8bf7\u7a0d\u7b49\uff0c\u6211\u4eec\u5f88\u5feb\u5c31\u4f1a\u8bb2\u5230\u3002 \u5f15\u64ce\u76d6\u4e0b\u9762\u53d1\u751f\u4e86\u4ec0\u4e48? Scrapy\u8c03\u5ea6\u7531Spider\u7684 start_requests \u65b9\u6cd5\u8fd4\u56de\u7684 scrapy.Request \u5bf9\u8c61\u3002\u5728\u63a5\u6536\u5230\u6bcf\u4e2aresponse\u4e4b\u540e\uff0c\u5b83\u5b9e\u4f8b\u5316 Response \u5bf9\u8c61\u5e76\u8c03\u7528\u4e0erequest\u5173\u8054\u7684\u56de\u8c03\u65b9\u6cd5(\u5728\u672c\u4f8b\u4e2d\u662f parse \u65b9\u6cd5)\uff0c\u5c06response\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u3002 \u4e00\u4e2a\u7b80\u77ed\u7684start_requests\u65b9\u6cd5 import scrapy class QuotesSpider(scrapy.Spider): name = quotes start_urls = [ 'http://quotes.toscrape.com/page/1/', 'http://quotes.toscrape.com/page/2/', ] def parse(self, response): page = response.url.split( / )[-2] filename = 'quotes-%s.html' % page with open(filename, 'wb') as f: f.write(response.body) parse() \u65b9\u6cd5\u88ab\u8c03\u7528\u6765\u5904\u7406\u8fd9\u4e9burl\u7684\u6bcf\u4e2arequests\uff0c\u5c3d\u7ba1\u6211\u4eec\u8fd8\u6ca1\u6709\u660e\u786e\u544a\u8bc9Scrapy\u8fd9\u6837\u505a\u3002\u8fd9\u662f\u56e0\u4e3a parse() \u662fScrapy\u7684\u9ed8\u8ba4\u56de\u8c03\u65b9\u6cd5\uff0c\u6240\u4ee5\u5728\u6ca1\u6709\u663e\u5f0f\u5206\u914d\u56de\u8c03\u7684\u60c5\u51b5\u4e0b\u8c03\u7528requests \u6570\u636e\u63d0\u53d6 \u5b66\u4e60\u5982\u4f55\u4f7f\u7528Scrapy\u6700\u4f73\u63d0\u53d6\u6570\u636e\u65b9\u6cd5\u662f\u4f7f\u7528 Scrapy shell \u5c1d\u8bd5\u9009\u62e9\u5668\u3002\u8fd0\u884c: scrapy shell 'http://quotes.toscrape.com/page/1/' \u6ce8\u610f!!!! \u8bb0\u4f4f\uff0c\u5728\u547d\u4ee4\u884c\u4e2d\u8fd0\u884cScrapy shell\u65f6\uff0c\u5fc5\u987b\u7528\u5f15\u53f7\u5c06url\u62ec\u8d77\u6765\uff0c\u5426\u5219url\u5305\u542b\u53c2\u6570(\u6bd4\u5982 \u5b57\u7b26)\u4e0d\u4f1a\u5de5\u4f5c\u3002 \u5728windows\u4e0a\u8bf7\u4f7f\u7528\u53cc\u5f15\u53f7 \u4f60\u4f1a\u770b\u5230\u8fd9\u6837\u7684\u4e1c\u897f: [ ... Scrapy log here ... ] 2016-09-19 12:09:27 [scrapy.core.engine] DEBUG: Crawled (200) GET http://quotes.toscrape.com/page/1/ (referer: None) [s] Available Scrapy objects: [s] scrapy scrapy module (contains scrapy.Request, scrapy.Selector, etc) [s] crawler scrapy.crawler.Crawler object at 0x7fa91d888c90 [s] item {} [s] request GET http://quotes.toscrape.com/page/1/ [s] response 200 http://quotes.toscrape.com/page/1/ [s] settings scrapy.settings.Settings object at 0x7fa91d888c10 [s] spider DefaultSpider 'default' at 0x7fa91c8af990 [s] Useful shortcuts: [s] shelp() Shell help (print this help) [s] fetch(req_or_url) Fetch request (or URL) and update local objects [s] view(response) View response in a browser \u4f7f\u7528shell\uff0c\u60a8\u53ef\u4ee5\u5c1d\u8bd5\u4f7f\u7528 CSS \u548cresponse\u5bf9\u8c61\u9009\u62e9\u5143\u7d20: response.css('title') [ Selector xpath='descendant-or-self::title' data=' title Quotes to Scrape /title ' ] \u8fd0\u884c response.css('title') \u7684\u7ed3\u679c\u662f\u4e00\u4e2a\u7c7b\u4f3c\u4e8e\u5217\u8868\u7684 SelectorList \u5bf9\u8c61\uff0c\u5b83\u8868\u793a\u4e00\u7ec4 Selector \u5bf9\u8c61\uff0c\u8fd9\u4e9b Selector \u5bf9\u8c61\u56f4\u7ed5XML/HTML\u5143\u7d20\uff0c\u5141\u8bb8\u60a8\u8fd0\u884c\u8fdb\u4e00\u6b65\u7684\u67e5\u8be2\u6765\u7ec6\u5316\u9009\u62e9\u6216\u63d0\u53d6\u6570\u636e\u3002 \u8981\u4ece\u4e0a\u9762\u7684\u6807\u9898\u4e2d\u63d0\u53d6\u6587\u672c\uff0c\u60a8\u53ef\u4ee5\u8fd9\u6837\u505a: response.css('title::text').extract() ['Quotes to Scrape'] \u8fd9\u91cc\u6709\u4e24\u4ef6\u4e8b\u9700\u8981\u6ce8\u610f:\u4e00\u662f\u6211\u4eec\u5df2\u7ecf\u5728CSS\u67e5\u8be2\u4e2d\u6dfb\u52a0\u4e86 ::text \uff0c\u610f\u601d\u662f\u6211\u4eec\u53ea\u60f3\u76f4\u63a5\u9009\u62e9\u91cc\u9762\u7684 title \u6587\u672c\u5143\u7d20, \u5982\u679c\u6211\u4eec\u4e0d\u6307\u5b9a ::text , \u6211\u4eec\u4f1a\u5f97\u5230\u5b8c\u6574\u7684\u6807\u9898\u5143\u7d20\uff0c\u5305\u62ec\u5b83\u7684\u6807\u7b7e: response.css('title').extract() [' title Quotes to Scrape /title '] \u53e6\u4e00\u4ef6\u4e8b\u662f\u8c03\u7528 .extract() \u7684\u7ed3\u679c\u662f\u4e00\u4e2a\u5217\u8868\uff0c\u56e0\u4e3a\u6211\u4eec\u6b63\u5728\u5904\u7406 SelectorList \u7684\u4e00\u4e2a\u5b9e\u4f8b\u3002\u5f53\u4f60\u77e5\u9053\u4f60\u53ea\u662f\u60f3\u8981\u7b2c\u4e00\u4e2a\u7ed3\u679c\u7684\u65f6\u5019\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4f60\u53ef\u4ee5\u8fd9\u6837\u505a: response.css('title::text').extract_first() 'Quotes to Scrape' \u4f5c\u4e3a\u66ff\u4ee3\uff0c\u4f60\u53ef\u4ee5\u8fd9\u6837\u5199: response.css('title::text')[0].extract() 'Quotes to Scrape' \u4f46\u662f\uff0c\u4f7f\u7528 .extract_first() \u53ef\u4ee5\u907f\u514d\u51fa\u73b0 IndexError \uff0c\u5e76\u4e14\u5f53\u5b83\u6ca1\u6709\u627e\u5230\u4efb\u4f55\u5339\u914d\u9009\u62e9\u7684\u5143\u7d20\u65f6\uff0c\u8fd4\u56de None \u3002 \u8fd9\u91cc\u6709\u4e00\u4e2a\u6559\u8bad:\u5bf9\u4e8e\u5927\u591a\u6570\u6293\u53d6\u4ee3\u7801\uff0c\u60a8\u5e0c\u671b\u5b83\u80fd\u591f\u5bf9\u7531\u4e8e\u5728\u9875\u9762\u4e0a\u627e\u4e0d\u5230\u4e1c\u897f\u800c\u5bfc\u81f4\u7684\u9519\u8bef\u4fdd\u6301\u5bb9\u9519, \u8fd9\u6837\u5373\u4f7f\u67d0\u4e9b\u90e8\u5206\u4e0d\u80fd\u88ab\u6293\u53d6\uff0c\u60a8\u81f3\u5c11\u53ef\u4ee5\u83b7\u5f97 \u4e00\u4e9b \u6570\u636e\u3002 \u9664\u4e86 extract() \u548c extract_first() \u65b9\u6cd5\u4e4b\u5916\uff0c\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f re() \u65b9\u6cd5\u8fdb\u884c\u63d0\u53d6: response.css('title::text').re(r'Quotes.*') ['Quotes to Scrape'] response.css('title::text').re(r'Q\\w+') ['Quotes'] response.css('title::text').re(r'(\\w+) to (\\w+)') ['Quotes', 'Scrape'] \u4e3a\u4e86\u627e\u5230\u5408\u9002\u7684CSS\u9009\u62e9\u5668\uff0c\u60a8\u53ef\u80fd\u4f1a\u53d1\u73b0\u4f7f\u7528 view(response) \u4eceweb\u6d4f\u89c8\u5668\u7684shell\u4e2d\u6253\u5f00response\u9875\u9762\u975e\u5e38\u6709\u7528\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u6d4f\u89c8\u5668\u5f00\u53d1\u5de5\u5177\u6216\u6269\u5c55\uff0c\u6bd4\u5982Firebug(\u8bf7\u53c2\u9605\u4f7f\u7528 Firebug\u8fdb\u884c\u6293\u53d6 \u548c \u4f7f\u7528Firefox\u8fdb\u884c\u6293\u53d6 \u90e8\u5206)\u3002 Selector Gadget \u4e5f\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u5de5\u5177\uff0c\u53ef\u4ee5\u901a\u8fc7\u53ef\u89c6\u5316\u7684CSS\u9009\u62e9\u5668\u5feb\u901f\u627e\u5230\u5143\u7d20\uff0c\u8fd9\u5728\u8bb8\u591a\u6d4f\u89c8\u5668\u4e2d\u90fd\u53ef\u4ee5\u5de5\u4f5c\u3002 XPATH \u7b80\u77ed\u4ecb\u7ecd \u9664\u4e86 CSS ,Scrapy selectors\u8fd8\u652f\u6301\u4f7f\u7528 XPath \u8868\u8fbe\u5f0f: response.xpath('//title') [ Selector xpath='//title' data=' title Quotes to Scrape /title ' ] response.xpath('//title/text()').extract_first() 'Quotes to Scrape' XPath\u8868\u8fbe\u5f0f\u975e\u5e38\u5f3a\u5927\uff0c\u662fScrapy Selectors\u7684\u57fa\u7840\u3002\u5b9e\u9645\u4e0a\uff0cCSS\u9009\u62e9\u5668\u5728\u5e95\u5c42\u88ab\u8f6c\u6362\u4e3aXPath\u3002\u5982\u679c\u4ed4\u7ec6\u9605\u8bfbshell\u4e2d\u7684\u9009\u62e9\u5668\u5bf9\u8c61\u7684\u6587\u672c\u8868\u793a\uff0c\u5c31\u4f1a\u53d1\u73b0\u8fd9\u4e00\u70b9\u3002 \u5c3d\u7ba1\u4e0d\u5982CSS\u9009\u62e9\u5668\u6d41\u884c\uff0cXPath\u8868\u8fbe\u5f0f\u63d0\u4f9b\u4e86\u66f4\u591a\u7684\u529f\u80fd\uff0c\u56e0\u4e3a\u9664\u4e86\u5bfc\u822a\u7ed3\u6784\u5916\uff0c\u5b83\u8fd8\u53ef\u4ee5\u67e5\u770b\u5185\u5bb9\u3002\u4f7f\u7528XPath\uff0c\u60a8\u53ef\u4ee5\u9009\u62e9\u5982\u4e0b\u5185\u5bb9:\u9009\u62e9\u5305\u542b\u6587\u672c\u201c\u4e0b\u4e00\u9875\u201d\u7684\u94fe\u63a5\u3002\u8fd9\u4f7f\u5f97XPath\u975e\u5e38\u9002\u5408\u4e8e\u6293\u53d6\u4efb\u52a1\uff0c\u6211\u4eec\u9f13\u52b1\u60a8\u5b66\u4e60XPath\uff0c\u5373\u4f7f\u60a8\u5df2\u7ecf\u77e5\u9053\u5982\u4f55\u6784\u9020CSS\u9009\u62e9\u5668\uff0c\u5b83\u4e5f\u4f1a\u4f7f\u6293\u53d6\u53d8\u5f97\u66f4\u52a0\u5bb9\u6613\u3002 \u6211\u4eec\u5728\u8fd9\u91cc\u4e0d\u4f1a\u4ecb\u7ecd\u592a\u591aXPath\uff0c\u4f46\u662f\u60a8\u53ef\u4ee5\u5728\u8fd9\u91cc\u9605\u8bfb\u5173\u4e8e\u4f7f\u7528 XPath\u548cScrapy\u9009\u62e9\u5668 \u7684\u66f4\u591a\u4fe1\u606f\u3002\u8981\u4e86\u89e3\u66f4\u591a\u5173\u4e8eXPath\u7684\u77e5\u8bc6\uff0c\u6211\u4eec\u63a8\u8350 \u672c\u6559\u7a0b\u901a\u8fc7\u793a\u4f8b\u5b66\u4e60XPath \uff0c \u672c\u6559\u7a0b\u5b66\u4e60\u201c\u5982\u4f55\u5728XPath\u4e2d\u601d\u8003\u201d \u3002 \u63d0\u53d6quotes\u548c\u4f5c\u8005 \u73b0\u5728\u60a8\u5df2\u7ecf\u4e86\u89e3\u4e86\u4e00\u4e9b\u5173\u4e8e\u9009\u62e9\u548c\u63d0\u53d6\u7684\u77e5\u8bc6\uff0c\u8ba9\u6211\u4eec\u901a\u8fc7\u7f16\u5199\u4eceweb\u9875\u9762\u4e2d\u63d0\u53d6quotes\u7684\u4ee3\u7801\u6765\u5b8c\u6210\u722c\u866b\u3002 http://quotes.toscrape.com \u4e2d\u7684\u6bcf\u4e2a\u5f15\u8bed\u90fd\u7531HTML\u5143\u7d20\u8868\u793a\uff0c\u5982\u4e0b\u6240\u793a: div class= quote span class= text \u201cThe world as we have created it is a process of our thinking. It cannot be changed without changing our thinking.\u201d /span span by small class= author Albert Einstein /small a href= /author/Albert-Einstein (about) /a /span div class= tags Tags: a class= tag href= /tag/change/page/1/ change /a a class= tag href= /tag/deep-thoughts/page/1/ deep-thoughts /a a class= tag href= /tag/thinking/page/1/ thinking /a a class= tag href= /tag/world/page/1/ world /a /div /div \u8ba9\u6211\u4eec\u6253\u5f00scrapy shell\u5e76\u6d4b\u8bd5\u8fd9\u4e2a\u7f51\u7ad9\uff0c\u4ee5\u4e86\u89e3\u5982\u4f55\u63d0\u53d6\u6211\u4eec\u60f3\u8981\u7684\u6570\u636e: $ scrapy shell 'http://quotes.toscrape.com' \u6211\u4eec\u5f97\u5230\u4e86\u4e00\u4e2a\u5f15\u7528HTML\u5143\u7d20\u7684\u9009\u62e9\u5668\u5217\u8868: response.css( div.quote ) \u4e0a\u9762\u67e5\u8be2\u8fd4\u56de\u7684\u6bcf\u4e2a\u9009\u62e9\u5668\u90fd\u5141\u8bb8\u6211\u4eec\u5bf9\u5b83\u4eec\u7684\u5b50\u5143\u7d20\u8fd0\u884c\u8fdb\u4e00\u6b65\u7684\u67e5\u8be2\u3002\u8ba9\u6211\u4eec\u628a\u7b2c\u4e00\u4e2a\u9009\u62e9\u5668\u5206\u914d\u7ed9\u4e00\u4e2a\u53d8\u91cf\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u76f4\u63a5\u5728\u4e00\u4e2a\u5f15\u7528\u4e0a\u8fd0\u884c\u6211\u4eec\u7684CSS\u9009\u62e9\u5668: quote = response.css( div.quote )[0] \u73b0\u5728\uff0c\u8ba9\u6211\u4eec\u4f7f\u7528\u521a\u624d\u521b\u5efa\u7684quote\u5bf9\u8c61\u4ece\u5f15\u7528\u4e2d\u63d0\u53d6\u6807\u9898\u3001\u4f5c\u8005\u548c\u6807\u7b7e: title = quote.css( span.text::text ).extract_first() title '\u201cThe world as we have created it is a process of our thinking. It cannot be changed without changing our thinking.\u201d' author = quote.css( small.author::text ).extract_first() author 'Albert Einstein' \u5047\u8bbe\u6807\u8bb0\u662f\u5b57\u7b26\u4e32\u5217\u8868\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 .extract() \u65b9\u6cd5\u83b7\u5f97\u6240\u6709\u5b57\u7b26\u4e32: tags = quote.css( div.tags a.tag::text ).extract() tags ['change', 'deep-thoughts', 'thinking', 'world'] \u77e5\u9053\u4e86\u5982\u4f55\u63d0\u53d6\u6bcf\u4e00\u4f4d\u7684\u6570\u636e\uff0c\u6211\u4eec\u73b0\u5728\u53ef\u4ee5\u904d\u5386\u6240\u6709\u7684quote\u5143\u7d20\uff0c\u5e76\u5c06\u5b83\u4eec\u653e\u5230Python\u5b57\u5178\u4e2d: for quote in response.css( div.quote ): ... text = quote.css( span.text::text ).extract_first() ... author = quote.css( small.author::text ).extract_first() ... tags = quote.css( div.tags a.tag::text ).extract() ... print(dict(text=text, author=author, tags=tags)) {'tags': ['change', 'deep-thoughts', 'thinking', 'world'], 'author': 'Albert Einstein', 'text': '\u201cThe world as we have created it is a process of our thinking. It cannot be changed without changing our thinking.\u201d'} {'tags': ['abilities', 'choices'], 'author': 'J.K. Rowling', 'text': '\u201cIt is our choices, Harry, that show what we truly are, far more than our abilities.\u201d'} ... a few more of these, omitted for brevity \u4ece\u6211\u4eec\u7684\u722c\u866b\u91cc\u63d0\u53d6\u6570\u636e \u8ba9\u6211\u4eec\u56de\u5230\u6211\u4eec\u7684spider\u3002\u5230\u76ee\u524d\u4e3a\u6b62\uff0c\u5b83\u5e76\u6ca1\u6709\u63d0\u53d6\u4efb\u4f55\u6570\u636e\uff0c\u53ea\u662f\u5c06\u6574\u4e2aHTML\u9875\u9762\u4fdd\u5b58\u5230\u672c\u5730\u6587\u4ef6\u4e2d\u3002\u8ba9\u6211\u4eec\u5c06\u4e0a\u9762\u7684\u63d0\u53d6\u903b\u8f91\u96c6\u6210\u5230\u6211\u4eec\u7684spider\u4e2d\u3002 Scrapy spider\u901a\u5e38\u751f\u6210\u8bb8\u591a\u5305\u542b\u4ece\u9875\u9762\u63d0\u53d6\u7684\u6570\u636e\u7684\u5b57\u5178\u3002\u4e3a\u6b64\uff0c\u6211\u4eec\u5728\u56de\u8c03\u4e2d\u4f7f\u7528 yield Python\u5173\u952e\u5b57\uff0c\u5982\u4e0b\u6240\u793a: import scrapy class QuotesSpider(scrapy.Spider): name = quotes start_urls = [ 'http://quotes.toscrape.com/page/1/', 'http://quotes.toscrape.com/page/2/', ] def parse(self, response): for quote in response.css('div.quote'): yield { 'text': quote.css('span.text::text').extract_first(), 'author': quote.css('small.author::text').extract_first(), 'tags': quote.css('div.tags a.tag::text').extract(), } \u5982\u679c\u60a8\u8fd0\u884c\u8fd9\u4e2a\u722c\u866b\uff0c\u5b83\u5c06\u8f93\u51fa\u5e26\u65e5\u5fd7\u7684\u63d0\u53d6\u6570\u636e: 2016-09-19 18:57:19 [scrapy.core.scraper] DEBUG: Scraped from 200 http://quotes.toscrape.com/page/1/ {'tags': ['life', 'love'], 'author': 'Andr\u00e9 Gide', 'text': '\u201cIt is better to be hated for what you are than to be loved for what you are not.\u201d'} 2016-09-19 18:57:19 [scrapy.core.scraper] DEBUG: Scraped from 200 http://quotes.toscrape.com/page/1/ {'tags': ['edison', 'failure', 'inspirational', 'paraphrased'], 'author': 'Thomas A. Edison', 'text': \u201cI have not failed. I've just found 10,000 ways that won't work.\u201d } \u5b58\u50a8\u6293\u53d6\u7684\u6570\u636e \u5b58\u50a8\u6293\u53d6\u7684\u6570\u636e\u7684\u6700\u7b80\u5355\u65b9\u6cd5\u662f\u4f7f\u7528 Feed exports \uff0c\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4: scrapy crawl quotes -o quotes.json \u8fd9\u4f1a\u4ea7\u751f\u4e00\u4e2aquotes.json\u6587\u4ef6\uff0c\u5305\u542b\u6240\u6709\u6293\u53d6\u8fc7\u7684items\u5e76 json \u5e8f\u5217\u5316\u3002 \u51fa\u4e8e\u5386\u53f2\u539f\u56e0\uff0cScrapy\u5c06\u8ffd\u52a0\u4e00\u4e2a\u7ed9\u5b9a\u7684\u6587\u4ef6\u800c\u4e0d\u662f\u8986\u76d6\u3002\u5982\u679c\u60a8\u5728\u7b2c\u4e8c\u6b21\u8fd0\u884c\u8be5\u547d\u4ee4\u4e24\u6b21\u800c\u6ca1\u6709\u5728\u7b2c\u4e8c\u6b21\u4e4b\u524d\u5220\u9664\u8be5\u6587\u4ef6\uff0c\u90a3\u4e48\u6700\u7ec8\u4f1a\u5f97\u5230\u4e00\u4e2a\u635f\u574f\u7684JSON\u6587\u4ef6\u3002 \u8fd8\u53ef\u4ee5\u4f7f\u7528\u5176\u4ed6\u683c\u5f0f\uff0c\u6bd4\u5982 JSON\u884c : scrapy crawl quotes -o quotes.jl JSON\u884c\u683c\u5f0f\u5f88\u6709\u7528\uff0c\u56e0\u4e3a\u5b83\u7c7b\u4f3c\u4e8e\u6d41\uff0c\u60a8\u53ef\u4ee5\u5f88\u5bb9\u6613\u5730\u5411\u5176\u8ffd\u52a0\u65b0\u8bb0\u5f55\u3002\u5f53\u4f60\u8fd0\u884c\u4e24\u6b21\u65f6\uff0c\u5b83\u4e0d\u4f1a\u6709JSON\u90a3\u6837\u7684\u95ee\u9898\u3002\u53e6\u5916\uff0c\u7531\u4e8e\u6bcf\u4e2a\u8bb0\u5f55\u90fd\u662f\u5355\u72ec\u7684\u4e00\u884c\uff0c\u60a8\u53ef\u4ee5\u5904\u7406\u5927\u6587\u4ef6\uff0c\u800c\u4e0d\u5fc5\u5c06\u6240\u6709\u5185\u5bb9\u90fd\u653e\u5728\u5185\u5b58\u4e2d\u3002 \u5728\u5c0f\u9879\u76ee\u4e2d(\u5982\u672c\u6559\u7a0b\u4e2d\u7684\u9879\u76ee)\uff0c\u8fd9\u5c31\u8db3\u591f\u4e86\u3002\u4f46\u662f\uff0c\u5982\u679c\u60a8\u60f3\u8981\u5bf9\u6293\u53d6\u7684\u6570\u636e\u6267\u884c\u66f4\u590d\u6742\u7684\u64cd\u4f5c\uff0c\u60a8\u53ef\u4ee5\u7f16\u5199\u4e00\u4e2a Item Pipeline \u3002\u5728 tutorial/pipelines.py \u4e2d\uff0c\u9879\u76ee\u521b\u5efa\u65f6\u4e3a\u60a8\u8bbe\u7f6e\u4e86Item Pipeline\u7684\u5360\u4f4d\u7b26\u6587\u4ef6\u3002\u4e0d\u8fc7\uff0c\u5982\u679c\u60a8\u53ea\u662f\u60f3\u8981\u5b58\u50a8\u6293\u53d6\u7684item\uff0c\u5219\u4e0d\u9700\u8981\u5b9e\u4f8b\u5316\u4efb\u4f55item pipelines\u3002 \u8ddf\u8e2a\u8fde\u63a5 \u6bd4\u65b9\u8bf4\uff0c\u4e0d\u8981\u53ea\u6293\u53d6 http://quotes.toscrape.com \u524d\u4e24\u9875\uff0c\u60f3\u6293\u53d6\u6240\u6709\u9875\u9762\u7684\u5f15\u6587\u3002 \u65e2\u7136\u60a8\u5df2\u7ecf\u77e5\u9053\u4e86\u5982\u4f55\u4ece\u9875\u9762\u4e2d\u63d0\u53d6\u6570\u636e\uff0c\u90a3\u4e48\u8ba9\u6211\u4eec\u770b\u770b\u5982\u4f55\u4ece\u9875\u9762\u4e2d\u8ddf\u8e2a\u94fe\u63a5\u3002 \u7b2c\u4e00\u4ef6\u4e8b\u662f\u63d0\u53d6\u5230\u6211\u4eec\u60f3\u8981\u8ddf\u968f\u7684\u9875\u9762\u7684\u94fe\u63a5\u3002\u68c0\u67e5\u6211\u4eec\u7684\u9875\u9762\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6709\u4e00\u4e2a\u94fe\u63a5\u5230\u4e0b\u4e00\u9875\u7684\u6807\u7b7e: ul class= pager li class= next a href= /page/2/ Next span aria-hidden= true rarr; /span /a /li /ul \u6211\u4eec\u53ef\u4ee5\u8bd5\u7740\u4eceshell\u4e2d\u63d0\u53d6\u51fa\u6765: response.css('li.next a').extract_first() ' a href= /page/2/ Next span aria-hidden= true \u2192 /span /a ' \u8fd9\u5c06\u83b7\u53d6\u8d85\u94fe\u63a5\u5143\u7d20\uff0c\u4f46\u6211\u4eec\u9700\u8981 href \u5c5e\u6027\u3002\u4e3a\u6b64\uff0cScrapy\u652f\u6301\u4e00\u4e2aCSS\u6269\u5c55\uff0c\u5141\u8bb8\u60a8\u9009\u62e9\u5c5e\u6027\u5185\u5bb9\uff0c\u5982\u4e0b\u6240\u793a: response.css('li.next a::attr(href)').extract_first() '/page/2/' \u73b0\u5728\u8ba9\u6211\u4eec\u770b\u770b\u6211\u4eec\u7684\u722c\u866b\u88ab\u4fee\u6539\u6210\u9012\u5f52\u5730\u8ddf\u968f\u94fe\u63a5\u5230\u4e0b\u4e00\u9875\uff0c\u7136\u540e\u4ece\u4e2d\u63d0\u53d6\u6570\u636e: import scrapy class QuotesSpider(scrapy.Spider): name = quotes start_urls = [ 'http://quotes.toscrape.com/page/1/', ] def parse(self, response): for quote in response.css('div.quote'): yield { 'text': quote.css('span.text::text').extract_first(), 'author': quote.css('small.author::text').extract_first(), 'tags': quote.css('div.tags a.tag::text').extract(), } next_page = response.css('li.next a::attr(href)').extract_first() if next_page is not None: next_page = response.urljoin(next_page) yield scrapy.Request(next_page, callback=self.parse) \u73b0\u5728,\u7ecf\u8fc7\u63d0\u53d6\u6570\u636e, parse() \u65b9\u6cd5\u5bfb\u627e\u5230\u4e0b\u4e00\u4e2a\u9875\u9762\u7684\u94fe\u63a5,\u4f7f\u7528 urljoin() \u65b9\u6cd5\u6784\u5efa\u5b8c\u6574\u7684\u7edd\u5bf9URL(\u56e0\u4e3a\u94fe\u63a5\u53ef\u4ee5\u662f\u76f8\u5bf9\u7684),\u5e76\u5411\u4e0b\u4e00\u9875\u751f\u6210\u4e00\u4e2a\u65b0\u8bf7\u6c42\uff0c\u8bbe\u7f6e\u5176\u56de\u8c03\u51fd\u6570\uff0c\u4ee5\u5904\u7406\u4e0b\u4e00\u9875\u7684\u6570\u636e\u63d0\u53d6\u5e76\u4fdd\u6301\u6240\u6709\u9875\u9762\u7684\u722c\u884c\u3002 \u60a8\u5728\u8fd9\u91cc\u770b\u5230\u7684\u662fScrapy\u7684\u94fe\u63a5\u673a\u5236:\u5f53\u60a8\u5728\u56de\u8c03\u65b9\u6cd5\u4e2d\u751f\u6210\u8bf7\u6c42\u65f6\uff0cScrapy\u5c06\u8c03\u5ea6\u53d1\u9001\u8be5\u8bf7\u6c42\uff0c\u5e76\u8bbe\u7f6e\u4e00\u4e2a\u56de\u8c03\u65b9\u6cd5\u4ee5\u4fbf\u5728\u8be5\u8bf7\u6c42\u5b8c\u6210\u65f6\u6267\u884c\u3002 \u4f7f\u7528\u6b64\u529f\u80fd\uff0c\u60a8\u53ef\u4ee5\u6784\u5efa\u590d\u6742\u7684\u722c\u866b\u7a0b\u5e8f\uff0c\u6839\u636e\u60a8\u5b9a\u4e49\u7684\u89c4\u5219\u8ddf\u8e2a\u94fe\u63a5\uff0c\u5e76\u6839\u636e\u8bbf\u95ee\u7684\u9875\u9762\u63d0\u53d6\u4e0d\u540c\u7c7b\u578b\u7684\u6570\u636e\u3002 \u5728\u6211\u4eec\u7684\u793a\u4f8b\u4e2d\uff0c\u5b83\u521b\u5efa\u4e86\u4e00\u79cd\u5faa\u73af\uff0c\u8ddf\u8e2a\u5230\u4e0b\u4e00\u4e2a\u9875\u9762\u7684\u6240\u6709\u94fe\u63a5\uff0c\u76f4\u5230\u627e\u4e0d\u5230\u4e3a\u6b62, \u8fd9\u5bf9\u4e8e\u5728\u5e26\u6709\u5206\u9875\u7684\u535a\u5ba2\u3001\u8bba\u575b\u548c\u5176\u4ed6\u7ad9\u70b9\u4e0a\u6293\u53d6\u975e\u5e38\u65b9\u4fbf\u3002 \u521b\u5efa\u4e00\u4e2a\u7b80\u5355\u7684Requests, \u5e76\u4e14\u7528\u4e0a\u8ffd\u8e2a\u8fde\u63a5 \u60a8\u53ef\u4ee5\u4f7f\u7528 response.follow : import scrapy class QuotesSpider(scrapy.Spider): name = quotes start_urls = [ 'http://quotes.toscrape.com/page/1/', ] def parse(self, response): for quote in response.css('div.quote'): yield { 'text': quote.css('span.text::text').extract_first(), 'author': quote.css('span small::text').extract_first(), 'tags': quote.css('div.tags a.tag::text').extract(), } next_page = response.css('li.next a::attr(href)').extract_first() if next_page is not None: yield response.follow(next_page, callback=self.parse) \u4e0d\u50cfscrapy.Request, response.follow \u652f\u6301url\u76f8\u5bf9\u8def\u5f84 -\u4e0d\u9700\u8981\u8c03\u7528urljoin\u3002 \u6ce8\u610f, response.follow \u53ea\u8fd4\u56de\u4e00\u4e2aRequest\u5b9e\u4f8b;\u60a8\u4ecd\u7136\u5fc5\u987byield\u6b64\u8bf7\u6c42\u3002 \u60a8\u8fd8\u53ef\u4ee5\u4f20\u9012\u4e00\u4e2a\u9009\u62e9\u5668\u7ed9 response.follow \u3002 \u800c\u4e0d\u662f\u5b57\u7b26\u4e32;\u8fd9\u4e2a\u9009\u62e9\u5668\u5e94\u8be5\u63d0\u53d6\u5fc5\u8981\u7684\u5c5e\u6027( PS:\u4e2a\u4eba\u7406\u89e3\u5fc5\u987b\u662f\u94fe\u63a5 ): for href in response.css('li.next a::attr(href)'): yield response.follow(href, callback=self.parse) \u5bf9\u4e8e a \u5143\u7d20\uff0c\u6709\u4e00\u4e2a\u7b80\u5355\u65b9\u5f0f: response.follow \u4f1a\u81ea\u52a8\u4f7f\u7528\u5b83\u4eec\u7684href\u5c5e\u6027\u3002\u56e0\u6b64\uff0c\u4ee3\u7801\u53ef\u4ee5\u8fdb\u4e00\u6b65\u7f29\u77ed: for a in response.css('li.next a'): yield response.follow(a, callback=self.parse) \u6ce8\u610f!!!! response.follow(response.css('li.next a')))\u662f\u65e0\u6548\u7684\uff0c \u56e0\u4e3aresponse.css\u8fd4\u56de\u4e00\u4e2a\u7c7b\u4f3c\u4e8e\u5217\u8868\u7684\u5bf9\u8c61\uff0c \u5176\u4e2d\u5305\u542b\u6240\u6709\u7ed3\u679c\u7684\u9009\u62e9\u5668\uff0c\u800c\u4e0d\u662f\u5355\u4e2a\u9009\u62e9\u5668\u3002 \u6b63\u786e\u7684\u65b9\u5f0f\u6bd4\u5982\u4e00\u4e2afor\u5faa\u73af\u5c31\u50cf\u4e0a\u9762\u7684\u4f8b\u5b50\uff0c\u6216\u8005response.follow(response.css('li.next a')[0])\u5c31\u5f88\u597d\u3002 \u66f4\u591a\u7684\u4f8b\u5b50\u548c\u6a21\u5f0f \u4e0b\u9762\u662f\u53e6\u4e00\u4e2a\u722c\u866b\uff0c\u5b83\u6f14\u793a\u4e86\u56de\u8c03\u548c\u8ffd\u8e2a\u94fe\u63a5\uff0c\u8fd9\u6b21\u662f\u4e3a\u4e86\u6293\u53d6\u4f5c\u8005\u4fe1\u606f: import scrapy class AuthorSpider(scrapy.Spider): name = 'author' start_urls = ['http://quotes.toscrape.com/'] def parse(self, response): # follow links to author pages for href in response.css('.author + a::attr(href)'): yield response.follow(href, self.parse_author) # follow pagination links for href in response.css('li.next a::attr(href)'): yield response.follow(href, self.parse) def parse_author(self, response): def extract_with_css(query): return response.css(query).extract_first().strip() yield { 'name': extract_with_css('h3.author-title::text'), 'birthdate': extract_with_css('.author-born-date::text'), 'bio': extract_with_css('.author-description::text'), } \u8fd9\u4e2a\u722c\u866b\u5c06\u4ece\u4e3b\u9875\u5f00\u59cb\uff0c\u5b83\u8ffd\u8e2a\u5f53\u524d\u9875\u9762\u7684\u4fe1\u606f\u56de\u8c03\u7ed9 parse_author , \u5e76\u4e14\u89e3\u6790\u4e0b\u4e00\u9875\u7684\u94fe\u63a5\u56de\u8c03\u7ed9 parse \u8fd9\u91cc\u6211\u4eec\u4f20\u9012\u56de\u8c03\u7528 response.follow \u4f5c\u4e3a\u4f4d\u7f6e\u53c2\u6570\u4f7f\u4ee3\u7801\u66f4\u77ed;\u5b83\u4e5f\u9002\u7528\u4e8e scrapy.Request \u3002 parse_author \u56de\u8c03\u51fd\u6570\u5b9a\u4e49\u4e86\u4e00\u4e2a\u6709\u7528\u7684\u51fd\u6570\uff0c\u7528\u4e8e\u4eceCSS\u67e5\u8be2\u4e2d\u63d0\u53d6\u548c\u6e05\u7406\u6570\u636e\uff0c\u5e76\u751f\u6210\u5e26\u6709\u4f5c\u8005\u6570\u636e\u7684Python\u5b57\u5178\u3002 \u8fd9\u4e2a\u722c\u866b\u6f14\u793a\u7684\u53e6\u4e00\u4ef6\u6709\u8da3\u7684\u4e8b\u60c5\u662f\uff0c\u5373\u4f7f\u6765\u81ea\u540c\u4e00\u4f5c\u8005\u7684\u5f15\u7528\u5f88\u591a\u6b21\uff0c\u6211\u4eec\u4e5f\u4e0d\u5fc5\u62c5\u5fc3\u591a\u6b21\u8bbf\u95ee\u540c\u4e00\u4f5c\u8005\u7684\u9875\u9762\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cScrapy\u4f1a\u8fc7\u6ee4\u6389\u5df2\u7ecf\u8bbf\u95ee\u8fc7\u7684url\u7684\u91cd\u590d\u8bf7\u6c42\uff0c\u4ece\u800c\u907f\u514d\u7531\u4e8e\u7f16\u7a0b\u9519\u8bef\u800c\u8fc7\u591a\u5730\u653b\u51fb\u670d\u52a1\u5668\u7684\u95ee\u9898\u3002\u8fd9\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e DUPEFILTER_CLASS \u6765\u914d\u7f6e\u3002 \u5e0c\u671b\u73b0\u5728\u60a8\u5df2\u7ecf\u5f88\u597d\u5730\u7406\u89e3\u4e86\u5982\u4f55\u4f7f\u7528Scrapy\u8ddf\u8e2a\u94fe\u63a5\u548c\u56de\u8c03\u673a\u5236\u3002 \u4f5c\u4e3a\u5229\u7528\u8ddf\u8e2a\u94fe\u63a5\u673a\u5236\u7684\u53e6\u4e00\u4e2a\u793a\u4f8b\uff0c\u8bf7\u67e5\u770b CrawlSpider \u7c7b\uff0c\u5b83\u662f\u4e00\u4e2a\u901a\u7528\u7684spider\uff0c\u5b83\u5b9e\u73b0\u4e86\u4e00\u4e2a\u5c0f\u89c4\u5219\u5f15\u64ce\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u5b83\u5728\u4e0a\u9762\u7f16\u5199\u722c\u866b\u7a0b\u5e8f\u3002 \u53e6\u5916\uff0c\u4e00\u79cd\u5e38\u89c1\u7684\u6a21\u5f0f\u662f\u4f7f\u7528\u591a\u4e2a\u9875\u9762\u7684\u6570\u636e\u6784\u5efa\u4e00\u4e2a\u9879\u76ee\uff0c\u4f7f\u7528 \u5411\u56de\u8c03\u51fd\u6570\u4f20\u9012\u989d\u5916\u6570\u636e\u7684\u6280\u5de7 \u3002 \u4f7f\u7528Spider\u53c2\u6570 \u5728\u8fd0\u884c\u722c\u866b\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528-a\u9009\u9879\u4e3a\u722c\u866b\u63d0\u4f9b\u547d\u4ee4\u884c\u53c2\u6570: scrapy crawl quotes -o quotes-humor.json -a tag=humor \u8fd9\u4e9b\u53c2\u6570\u88ab\u4f20\u9012\u7ed9Spider\u7684 __init__ \u65b9\u6cd5\uff0c\u5e76\u9ed8\u8ba4\u6210\u4e3aspider\u5c5e\u6027\u3002 \u5728\u672c\u4f8b\u4e2d\uff0c\u4f20\u9012\u7684 tag \u7684\u503c\u53ef\u4ee5\u901a\u8fc7 self.tag \u5c5e\u6027\u5f15\u7528\u3002\u4f60\u53ef\u4ee5\u7528\u5b83\u6765\u8ba9\u4f60\u7684\u722c\u884c\u5668\u6293\u53d6\u53ea\u5e26\u6709\u7279\u5b9a\u6807\u7b7e\u7684quotes\uff0c\u6839\u636e\u53c2\u6570\u5efa\u7acbURL: import scrapy class QuotesSpider(scrapy.Spider): name = quotes def start_requests(self): url = 'http://quotes.toscrape.com/' tag = getattr(self, 'tag', None) if tag is not None: url = url + 'tag/' + tag yield scrapy.Request(url, self.parse) def parse(self, response): for quote in response.css('div.quote'): yield { 'text': quote.css('span.text::text').extract_first(), 'author': quote.css('small.author::text').extract_first(), } next_page = response.css('li.next a::attr(href)').extract_first() if next_page is not None: yield response.follow(next_page, self.parse) \u5982\u679c\u60a8\u5c06 tag=humor \u53c2\u6570\u4f20\u9012\u7ed9\u8fd9\u4e2aspider\uff0c\u60a8\u4f1a\u6ce8\u610f\u5230\u5b83\u53ea\u4f1a\u8bbf\u95ee\u6765\u81ea humor \u6807\u8bb0\u7684url\uff0c\u6bd4\u5982 http://quotes.toscrape.com/tag/humor \u3002 \u60a8\u53ef\u4ee5 \u5728\u8fd9\u91cc\u5b66\u4e60\u66f4\u591a\u5173\u4e8e\u5904\u7406\u722c\u884c\u5668\u53c2\u6570\u7684\u77e5\u8bc6 \u3002 \u4e0b\u4e00\u6b65 \u672c\u6559\u7a0b\u53ea\u4ecb\u7ecd\u4e86Scrapy\u7684\u57fa\u7840\u77e5\u8bc6\uff0c\u4f46\u662f\u8fd9\u91cc\u6ca1\u6709\u63d0\u5230\u5176\u4ed6\u8bb8\u591a\u7279\u6027\u3002 \u8fd8\u6709\u5176\u4ed6\u7684\u4e48? \u56de\u987e\u4e00\u4e0b \u7b2c\u4e00\u6b65 \uff0c\u53ef\u4ee5\u5feb\u901f\u6d4f\u89c8\u6700\u91cd\u8981\u7684\u7ae0\u8282\u3002 \u60a8\u53ef\u4ee5\u7ee7\u7eed\u4ece\u57fa\u672c\u6982\u5ff5\u90e8\u5206\u4e86\u89e3\u66f4\u591a\u5173\u4e8e\u547d\u4ee4\u884c\u5de5\u5177\u3001spiders\u3001\u9009\u62e9\u5668\u548c\u5176\u4ed6\u672c\u6559\u7a0b\u6ca1\u6709\u6d89\u53ca\u5230\u7684\u5185\u5bb9\uff0c\u6bd4\u5982\u5bf9\u6293\u53d6\u7684\u6570\u636e\u8fdb\u884c\u5efa\u6a21\u3002\u5982\u679c\u60a8\u559c\u6b22\u4f7f\u7528\u793a\u4f8b\u9879\u76ee\uff0c\u8bf7\u68c0\u67e5\u793a\u4f8b\u90e8\u5206\u3002","title":"Scrapy \u6559\u7a0b"},{"location":"1. \u7b2c\u4e00\u6b65/04-scrapy tutorial/#scrapy","text":"\u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u6211\u4eec\u5047\u8bbeScrapy\u5df2\u7ecf\u5b89\u88c5\u5728\u60a8\u7684\u7cfb\u7edf\u4e0a\u3002\u5982\u679c\u4e0d\u662f\u8fd9\u6837\uff0c\u8bf7\u53c2\u9605 \u5b89\u88c5\u6307\u5357 \u3002 \u6211\u4eec\u5c06\u6293\u53d6 toscrape.com \uff0c\u4e00\u4e2a\u5217\u51fa\u8457\u540d\u4f5c\u5bb6\u7684\u5f15\u7528\u7684\u7f51\u7ad9\u3002 \u672c\u6559\u7a0b\u5c06\u5e26\u9886\u60a8\u5b8c\u6210\u4ee5\u4e0b\u4efb\u52a1: \u521b\u5efa\u4e00\u4e2a\u65b0\u7684Scrapy\u9879\u76ee \u7f16\u5199\u4e00\u4e2a spider \u6765\u6293\u53d6\u7ad9\u70b9\u5e76\u63d0\u53d6\u6570\u636e \u4f7f\u7528\u547d\u4ee4\u884c\u5bfc\u51fa\u6293\u53d6\u7684\u6570\u636e \u5c06spider\u66f4\u6539\u4e3a\u9012\u5f52\u8ddf\u8e2a\u94fe\u63a5 \u4f7f\u7528spider\u53c2\u6570 Scrapy\u662f\u7528 Python \u7f16\u5199\u7684\u3002\u5982\u679c\u4f60\u5bf9\u8fd9\u95e8\u8bed\u8a00\u4e0d\u719f\u6089\uff0c\u4f60\u53ef\u80fd\u4f1a\u60f3\u5148\u4e86\u89e3\u4e00\u4e0b\u8fd9\u95e8\u8bed\u8a00\u662f\u4ec0\u4e48\u6837\u5b50\u7684\uff0c\u8fd9\u6837\u4f60\u5c31\u80fd\u6700\u5927\u9650\u5ea6\u5730\u4ece\u56f0\u5883\u4e2d\u89e3\u8131\u51fa\u6765\u3002 \u5982\u679c\u60a8\u5df2\u7ecf\u719f\u6089\u5176\u4ed6\u8bed\u8a00\uff0c\u5e76\u4e14\u5e0c\u671b\u5feb\u901f\u5b66\u4e60Python\uff0c\u6211\u4eec\u5efa\u8bae\u60a8 \u901a\u8bfbPython 3 \u3002\u6216\u8005\uff0c\u60a8\u53ef\u4ee5\u9075\u5faa Python\u6559\u7a0b \u3002 \u5982\u679c\u60a8\u662f\u4e00\u4e2a\u7f16\u7a0b\u65b0\u624b\uff0c\u5e76\u4e14\u60f3\u4ecePython\u5f00\u59cb\uff0c\u60a8\u53ef\u80fd\u4f1a\u53d1\u73b0\u5728\u7ebf\u4e66\u7c4d \u300a\u8270\u96be\u5730\u5b66\u4e60Python\u300b \u5f88\u6709\u7528\u3002\u60a8\u8fd8\u53ef\u4ee5\u67e5\u770b\u4e00\u4e0b \u9488\u5bf9\u975e\u7a0b\u5e8f\u5458\u7684Python\u8d44\u6e90\u5217\u8868 \u3002","title":"Scrapy \u6559\u7a0b"},{"location":"1. \u7b2c\u4e00\u6b65/04-scrapy tutorial/#_1","text":"\u5728\u4f60\u5f00\u59cb\u6293\u53d6\u4e4b\u524d\uff0c\u4f60\u5fc5\u987b\u5efa\u7acb\u4e00\u4e2a\u65b0\u7684Scrapy\u9879\u76ee\u3002\u8f93\u5165\u60f3\u8981\u5b58\u50a8\u4ee3\u7801\u7684\u76ee\u5f55\u5e76\u8fd0\u884c: scrapy startproject quotes \u8fd9\u5c06\u521b\u5efa\u4e00\u4e2a\u5305\u542b\u4ee5\u4e0b\u5185\u5bb9\u7684\u76ee\u5f55: quotes/ scrapy.cfg # \u90e8\u7f72\u914d\u7f6e\u6587\u4ef6 quotes/ # \u9879\u76ee\u7684Python\u6a21\u5757\uff0c\u60a8\u5c06\u4ece\u8fd9\u91cc\u5bfc\u5165\u4ee3\u7801 __init__.py items.py # \u9879\u76ee\u7684items middlewares.py # \u9879\u76ee\u7684\u4e2d\u95f4\u4ef6 pipelines.py # \u9879\u76ee\u7684pipeline settings.py # \u9879\u76ee\u7684settings spiders/ # \u4e00\u4e2a\u76ee\u5f55\uff0c\u7a0d\u540e\u60a8\u5c06\u5728\u5176\u4e2d\u653e\u7f6e\u60a8\u7684spider(\u722c\u866b) __init__.py","title":"\u521b\u5efa\u4e00\u4e2a\u9879\u76ee"},{"location":"1. \u7b2c\u4e00\u6b65/04-scrapy tutorial/#spider","text":"Spiders\u662f\u60a8\u5b9a\u4e49\u7684\u7c7b\uff0cScrapy\u7528\u4e8e\u4ece\u7f51\u7ad9(\u6216\u4e00\u7ec4\u7f51\u7ad9)\u4e2d\u63d0\u53d6\u4fe1\u606f\u3002\u4ed6\u4eec\u5fc5\u987b\u662f scrapy.Spider \u7684\u5b50\u7c7b\u5e76\u4e14\u5b9a\u4e49\u521d\u59cbrequests\u3002\u53ef\u4ee5\u9009\u62e9\u5982\u4f55\u8ddf\u8e2a\u9875\u9762\u4e2d\u7684\u94fe\u63a5\uff0c\u4ee5\u53ca\u5982\u4f55\u89e3\u6790\u4e0b\u8f7d\u7684\u9875\u9762\u5185\u5bb9\u4ee5\u63d0\u53d6\u6570\u636e\u3002 \u8fd9\u662f\u7b2c\u4e00\u4e2aSpider(\u722c\u866b)\u7684\u4ee3\u7801\u3002\u5c06\u5176\u4fdd\u5b58\u5728\u540d\u4e3a quotes_spider.py \u7684\u6587\u4ef6\u4e2d\u3002\u7136\u540e\u653e\u5728\u9879\u76ee\u540d/spiders\u76ee\u5f55\u4e0b: import scrapy class QuotesSpider(scrapy.Spider): name = quotes def start_requests(self): urls = [ 'http://quotes.toscrape.com/page/1/', 'http://quotes.toscrape.com/page/2/', ] for url in urls: yield scrapy.Request(url=url, callback=self.parse) def parse(self, response): page = response.url.split( / )[-2] filename = 'quotes-%s.html' % page with open(filename, 'wb') as f: f.write(response.body) self.log('Saved file %s' % filename) \u5982\u60a8\u6240\u89c1\uff0c\u6211\u4eec\u7684Spider\u5b50\u7c7b scrapy.Spider \u3002\u5e76\u5b9a\u4e49\u4e86\u4e00\u4e9b\u5c5e\u6027\u548c\u65b9\u6cd5: name : \u6807\u8bc6\u4e86Spider\u3002\u5b83\u5fc5\u987b\u5728\u9879\u76ee\u4e2d\u662f\u552f\u4e00\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u60a8\u4e0d\u80fd\u4e3a\u4e0d\u540c\u7684Spider\u8bbe\u7f6e\u76f8\u540c\u7684\u540d\u79f0\u3002 start_requests() : \u5fc5\u987b\u8fd4\u56de\u53ef\u4ee5\u8fed\u4ee3\u7684\u8bf7\u6c42(\u60a8\u53ef\u4ee5\u5b9a\u4e49\u8bf7\u6c42\u5217\u8868\u6216\u7f16\u5199\u5217\u8868\u63a8\u5bfc\u5f0f)\uff0cSpider\u5c06\u4ece\u8be5\u8fed\u4ee3\u5f00\u59cb\u6293\u53d6\u3002\u540e\u7eed\u8bf7\u6c42\u5c06\u4ece\u8fd9\u4e9b\u521d\u59cb\u8bf7\u6c42\u4e2d\u4f9d\u6b21\u751f\u6210\u3002 parse() : \u88ab\u8c03\u7528\u5904\u7406\u6bcf\u4e2a\u8bf7\u6c42\u89e3\u6790\u5b8c\u4e4b\u540e\u540e\u7eed\u5904\u7406\u7684\u65b9\u6cd5\u3002response\u53c2\u6570\u662f TextResponse \u7684\u4e00\u4e2a\u5b9e\u4f8b\uff0c\u5b83\u4fdd\u5b58\u4e86\u9875\u9762\u5185\u5bb9\uff0c\u5e76\u6709\u8fdb\u4e00\u6b65\u6709\u7528\u7684\u65b9\u6cd5\u6765\u5904\u7406\u5b83\u3002 parse()\u65b9\u6cd5\u901a\u5e38\u89e3\u6790response\uff0c\u5c06\u6293\u53d6\u7684\u6570\u636e\u63d0\u53d6\u4e3a\u5b57\u5178\uff0c\u5e76\u627e\u5230\u8981\u8ddf\u8e2a\u7684\u65b0url\uff0c\u5e76\u4ece\u4e2d\u521b\u5efa\u65b0\u7684\u8bf7\u6c42( Request )\u3002","title":"\u6211\u4eec\u7684\u7b2c\u4e00\u4e2a\u722c\u866b(Spider)"},{"location":"1. \u7b2c\u4e00\u6b65/04-scrapy tutorial/#_2","text":"\u8981\u8ba9spider\u6b63\u5e38\u5de5\u4f5c\uff0c\u8bf7\u8f6c\u5230\u9879\u76ee\u7684\u8ddf\u76ee\u5f55\u5e76\u8fd0\u884c: scrapy crawl quotes \u8fd9\u4e2a\u547d\u4ee4\u7528\u6211\u4eec\u521a\u521a\u6dfb\u52a0\u7684Spider\u540d\u5b57 quotes \uff0c\u5b83\u5c06\u53d1\u9001\u4e00\u4e9b\u5bf9 http://quotes.toscrape.com/ \u57df\u7684\u8bf7\u6c42\u3002\u60a8\u5c06\u5f97\u5230\u4e00\u4e2a\u7c7b\u4f3c\u7684\u8f93\u51fa: ... (omitted for brevity) 2016-12-16 21:24:05 [scrapy.core.engine] INFO: Spider opened 2016-12-16 21:24:05 [scrapy.extensions.logstats] INFO: Crawled 0 pages (at 0 pages/min), scraped 0 items (at 0 items/min) 2016-12-16 21:24:05 [scrapy.extensions.telnet] DEBUG: Telnet console listening on 127.0.0.1:6023 2016-12-16 21:24:05 [scrapy.core.engine] DEBUG: Crawled (404) GET http://quotes.toscrape.com/robots.txt (referer: None) 2016-12-16 21:24:05 [scrapy.core.engine] DEBUG: Crawled (200) GET http://quotes.toscrape.com/page/1/ (referer: None) 2016-12-16 21:24:05 [scrapy.core.engine] DEBUG: Crawled (200) GET http://quotes.toscrape.com/page/2/ (referer: None) 2016-12-16 21:24:05 [quotes] DEBUG: Saved file quotes-1.html 2016-12-16 21:24:05 [quotes] DEBUG: Saved file quotes-2.html 2016-12-16 21:24:05 [scrapy.core.engine] INFO: Closing spider (finished) ... \u73b0\u5728\uff0c\u68c0\u67e5\u5f53\u524d\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\u3002\u60a8\u5e94\u8be5\u6ce8\u610f\u5230\u5df2\u7ecf\u521b\u5efa\u4e86\u4e24\u4e2a\u65b0\u6587\u4ef6:quotes-1.html\u548cquotes-2.html\uff0c\u4ee5\u53ca\u76f8\u5e94url\u7684\u5185\u5bb9\uff0c\u5982\u6211\u4eec\u7684 parse \u65b9\u6cd5\u6240\u793a\u3002 \u6ce8\u610f!!! \u5982\u679c\u60a8\u60f3\u77e5\u9053\u4e3a\u4ec0\u4e48\u6211\u4eec\u8fd8\u6ca1\u6709\u89e3\u6790HTML\uff0c\u8bf7\u7a0d\u7b49\uff0c\u6211\u4eec\u5f88\u5feb\u5c31\u4f1a\u8bb2\u5230\u3002","title":"\u5982\u4f55\u8fd0\u884c\u6211\u4eec\u7684\u722c\u866b"},{"location":"1. \u7b2c\u4e00\u6b65/04-scrapy tutorial/#_3","text":"Scrapy\u8c03\u5ea6\u7531Spider\u7684 start_requests \u65b9\u6cd5\u8fd4\u56de\u7684 scrapy.Request \u5bf9\u8c61\u3002\u5728\u63a5\u6536\u5230\u6bcf\u4e2aresponse\u4e4b\u540e\uff0c\u5b83\u5b9e\u4f8b\u5316 Response \u5bf9\u8c61\u5e76\u8c03\u7528\u4e0erequest\u5173\u8054\u7684\u56de\u8c03\u65b9\u6cd5(\u5728\u672c\u4f8b\u4e2d\u662f parse \u65b9\u6cd5)\uff0c\u5c06response\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u3002","title":"\u5f15\u64ce\u76d6\u4e0b\u9762\u53d1\u751f\u4e86\u4ec0\u4e48?"},{"location":"1. \u7b2c\u4e00\u6b65/04-scrapy tutorial/#start_requests","text":"import scrapy class QuotesSpider(scrapy.Spider): name = quotes start_urls = [ 'http://quotes.toscrape.com/page/1/', 'http://quotes.toscrape.com/page/2/', ] def parse(self, response): page = response.url.split( / )[-2] filename = 'quotes-%s.html' % page with open(filename, 'wb') as f: f.write(response.body) parse() \u65b9\u6cd5\u88ab\u8c03\u7528\u6765\u5904\u7406\u8fd9\u4e9burl\u7684\u6bcf\u4e2arequests\uff0c\u5c3d\u7ba1\u6211\u4eec\u8fd8\u6ca1\u6709\u660e\u786e\u544a\u8bc9Scrapy\u8fd9\u6837\u505a\u3002\u8fd9\u662f\u56e0\u4e3a parse() \u662fScrapy\u7684\u9ed8\u8ba4\u56de\u8c03\u65b9\u6cd5\uff0c\u6240\u4ee5\u5728\u6ca1\u6709\u663e\u5f0f\u5206\u914d\u56de\u8c03\u7684\u60c5\u51b5\u4e0b\u8c03\u7528requests","title":"\u4e00\u4e2a\u7b80\u77ed\u7684start_requests\u65b9\u6cd5"},{"location":"1. \u7b2c\u4e00\u6b65/04-scrapy tutorial/#_4","text":"\u5b66\u4e60\u5982\u4f55\u4f7f\u7528Scrapy\u6700\u4f73\u63d0\u53d6\u6570\u636e\u65b9\u6cd5\u662f\u4f7f\u7528 Scrapy shell \u5c1d\u8bd5\u9009\u62e9\u5668\u3002\u8fd0\u884c: scrapy shell 'http://quotes.toscrape.com/page/1/' \u6ce8\u610f!!!! \u8bb0\u4f4f\uff0c\u5728\u547d\u4ee4\u884c\u4e2d\u8fd0\u884cScrapy shell\u65f6\uff0c\u5fc5\u987b\u7528\u5f15\u53f7\u5c06url\u62ec\u8d77\u6765\uff0c\u5426\u5219url\u5305\u542b\u53c2\u6570(\u6bd4\u5982 \u5b57\u7b26)\u4e0d\u4f1a\u5de5\u4f5c\u3002 \u5728windows\u4e0a\u8bf7\u4f7f\u7528\u53cc\u5f15\u53f7 \u4f60\u4f1a\u770b\u5230\u8fd9\u6837\u7684\u4e1c\u897f: [ ... Scrapy log here ... ] 2016-09-19 12:09:27 [scrapy.core.engine] DEBUG: Crawled (200) GET http://quotes.toscrape.com/page/1/ (referer: None) [s] Available Scrapy objects: [s] scrapy scrapy module (contains scrapy.Request, scrapy.Selector, etc) [s] crawler scrapy.crawler.Crawler object at 0x7fa91d888c90 [s] item {} [s] request GET http://quotes.toscrape.com/page/1/ [s] response 200 http://quotes.toscrape.com/page/1/ [s] settings scrapy.settings.Settings object at 0x7fa91d888c10 [s] spider DefaultSpider 'default' at 0x7fa91c8af990 [s] Useful shortcuts: [s] shelp() Shell help (print this help) [s] fetch(req_or_url) Fetch request (or URL) and update local objects [s] view(response) View response in a browser \u4f7f\u7528shell\uff0c\u60a8\u53ef\u4ee5\u5c1d\u8bd5\u4f7f\u7528 CSS \u548cresponse\u5bf9\u8c61\u9009\u62e9\u5143\u7d20: response.css('title') [ Selector xpath='descendant-or-self::title' data=' title Quotes to Scrape /title ' ] \u8fd0\u884c response.css('title') \u7684\u7ed3\u679c\u662f\u4e00\u4e2a\u7c7b\u4f3c\u4e8e\u5217\u8868\u7684 SelectorList \u5bf9\u8c61\uff0c\u5b83\u8868\u793a\u4e00\u7ec4 Selector \u5bf9\u8c61\uff0c\u8fd9\u4e9b Selector \u5bf9\u8c61\u56f4\u7ed5XML/HTML\u5143\u7d20\uff0c\u5141\u8bb8\u60a8\u8fd0\u884c\u8fdb\u4e00\u6b65\u7684\u67e5\u8be2\u6765\u7ec6\u5316\u9009\u62e9\u6216\u63d0\u53d6\u6570\u636e\u3002 \u8981\u4ece\u4e0a\u9762\u7684\u6807\u9898\u4e2d\u63d0\u53d6\u6587\u672c\uff0c\u60a8\u53ef\u4ee5\u8fd9\u6837\u505a: response.css('title::text').extract() ['Quotes to Scrape'] \u8fd9\u91cc\u6709\u4e24\u4ef6\u4e8b\u9700\u8981\u6ce8\u610f:\u4e00\u662f\u6211\u4eec\u5df2\u7ecf\u5728CSS\u67e5\u8be2\u4e2d\u6dfb\u52a0\u4e86 ::text \uff0c\u610f\u601d\u662f\u6211\u4eec\u53ea\u60f3\u76f4\u63a5\u9009\u62e9\u91cc\u9762\u7684 title \u6587\u672c\u5143\u7d20, \u5982\u679c\u6211\u4eec\u4e0d\u6307\u5b9a ::text , \u6211\u4eec\u4f1a\u5f97\u5230\u5b8c\u6574\u7684\u6807\u9898\u5143\u7d20\uff0c\u5305\u62ec\u5b83\u7684\u6807\u7b7e: response.css('title').extract() [' title Quotes to Scrape /title '] \u53e6\u4e00\u4ef6\u4e8b\u662f\u8c03\u7528 .extract() \u7684\u7ed3\u679c\u662f\u4e00\u4e2a\u5217\u8868\uff0c\u56e0\u4e3a\u6211\u4eec\u6b63\u5728\u5904\u7406 SelectorList \u7684\u4e00\u4e2a\u5b9e\u4f8b\u3002\u5f53\u4f60\u77e5\u9053\u4f60\u53ea\u662f\u60f3\u8981\u7b2c\u4e00\u4e2a\u7ed3\u679c\u7684\u65f6\u5019\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4f60\u53ef\u4ee5\u8fd9\u6837\u505a: response.css('title::text').extract_first() 'Quotes to Scrape' \u4f5c\u4e3a\u66ff\u4ee3\uff0c\u4f60\u53ef\u4ee5\u8fd9\u6837\u5199: response.css('title::text')[0].extract() 'Quotes to Scrape' \u4f46\u662f\uff0c\u4f7f\u7528 .extract_first() \u53ef\u4ee5\u907f\u514d\u51fa\u73b0 IndexError \uff0c\u5e76\u4e14\u5f53\u5b83\u6ca1\u6709\u627e\u5230\u4efb\u4f55\u5339\u914d\u9009\u62e9\u7684\u5143\u7d20\u65f6\uff0c\u8fd4\u56de None \u3002 \u8fd9\u91cc\u6709\u4e00\u4e2a\u6559\u8bad:\u5bf9\u4e8e\u5927\u591a\u6570\u6293\u53d6\u4ee3\u7801\uff0c\u60a8\u5e0c\u671b\u5b83\u80fd\u591f\u5bf9\u7531\u4e8e\u5728\u9875\u9762\u4e0a\u627e\u4e0d\u5230\u4e1c\u897f\u800c\u5bfc\u81f4\u7684\u9519\u8bef\u4fdd\u6301\u5bb9\u9519, \u8fd9\u6837\u5373\u4f7f\u67d0\u4e9b\u90e8\u5206\u4e0d\u80fd\u88ab\u6293\u53d6\uff0c\u60a8\u81f3\u5c11\u53ef\u4ee5\u83b7\u5f97 \u4e00\u4e9b \u6570\u636e\u3002 \u9664\u4e86 extract() \u548c extract_first() \u65b9\u6cd5\u4e4b\u5916\uff0c\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f re() \u65b9\u6cd5\u8fdb\u884c\u63d0\u53d6: response.css('title::text').re(r'Quotes.*') ['Quotes to Scrape'] response.css('title::text').re(r'Q\\w+') ['Quotes'] response.css('title::text').re(r'(\\w+) to (\\w+)') ['Quotes', 'Scrape'] \u4e3a\u4e86\u627e\u5230\u5408\u9002\u7684CSS\u9009\u62e9\u5668\uff0c\u60a8\u53ef\u80fd\u4f1a\u53d1\u73b0\u4f7f\u7528 view(response) \u4eceweb\u6d4f\u89c8\u5668\u7684shell\u4e2d\u6253\u5f00response\u9875\u9762\u975e\u5e38\u6709\u7528\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u6d4f\u89c8\u5668\u5f00\u53d1\u5de5\u5177\u6216\u6269\u5c55\uff0c\u6bd4\u5982Firebug(\u8bf7\u53c2\u9605\u4f7f\u7528 Firebug\u8fdb\u884c\u6293\u53d6 \u548c \u4f7f\u7528Firefox\u8fdb\u884c\u6293\u53d6 \u90e8\u5206)\u3002 Selector Gadget \u4e5f\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u5de5\u5177\uff0c\u53ef\u4ee5\u901a\u8fc7\u53ef\u89c6\u5316\u7684CSS\u9009\u62e9\u5668\u5feb\u901f\u627e\u5230\u5143\u7d20\uff0c\u8fd9\u5728\u8bb8\u591a\u6d4f\u89c8\u5668\u4e2d\u90fd\u53ef\u4ee5\u5de5\u4f5c\u3002","title":"\u6570\u636e\u63d0\u53d6"},{"location":"1. \u7b2c\u4e00\u6b65/04-scrapy tutorial/#xpath","text":"\u9664\u4e86 CSS ,Scrapy selectors\u8fd8\u652f\u6301\u4f7f\u7528 XPath \u8868\u8fbe\u5f0f: response.xpath('//title') [ Selector xpath='//title' data=' title Quotes to Scrape /title ' ] response.xpath('//title/text()').extract_first() 'Quotes to Scrape' XPath\u8868\u8fbe\u5f0f\u975e\u5e38\u5f3a\u5927\uff0c\u662fScrapy Selectors\u7684\u57fa\u7840\u3002\u5b9e\u9645\u4e0a\uff0cCSS\u9009\u62e9\u5668\u5728\u5e95\u5c42\u88ab\u8f6c\u6362\u4e3aXPath\u3002\u5982\u679c\u4ed4\u7ec6\u9605\u8bfbshell\u4e2d\u7684\u9009\u62e9\u5668\u5bf9\u8c61\u7684\u6587\u672c\u8868\u793a\uff0c\u5c31\u4f1a\u53d1\u73b0\u8fd9\u4e00\u70b9\u3002 \u5c3d\u7ba1\u4e0d\u5982CSS\u9009\u62e9\u5668\u6d41\u884c\uff0cXPath\u8868\u8fbe\u5f0f\u63d0\u4f9b\u4e86\u66f4\u591a\u7684\u529f\u80fd\uff0c\u56e0\u4e3a\u9664\u4e86\u5bfc\u822a\u7ed3\u6784\u5916\uff0c\u5b83\u8fd8\u53ef\u4ee5\u67e5\u770b\u5185\u5bb9\u3002\u4f7f\u7528XPath\uff0c\u60a8\u53ef\u4ee5\u9009\u62e9\u5982\u4e0b\u5185\u5bb9:\u9009\u62e9\u5305\u542b\u6587\u672c\u201c\u4e0b\u4e00\u9875\u201d\u7684\u94fe\u63a5\u3002\u8fd9\u4f7f\u5f97XPath\u975e\u5e38\u9002\u5408\u4e8e\u6293\u53d6\u4efb\u52a1\uff0c\u6211\u4eec\u9f13\u52b1\u60a8\u5b66\u4e60XPath\uff0c\u5373\u4f7f\u60a8\u5df2\u7ecf\u77e5\u9053\u5982\u4f55\u6784\u9020CSS\u9009\u62e9\u5668\uff0c\u5b83\u4e5f\u4f1a\u4f7f\u6293\u53d6\u53d8\u5f97\u66f4\u52a0\u5bb9\u6613\u3002 \u6211\u4eec\u5728\u8fd9\u91cc\u4e0d\u4f1a\u4ecb\u7ecd\u592a\u591aXPath\uff0c\u4f46\u662f\u60a8\u53ef\u4ee5\u5728\u8fd9\u91cc\u9605\u8bfb\u5173\u4e8e\u4f7f\u7528 XPath\u548cScrapy\u9009\u62e9\u5668 \u7684\u66f4\u591a\u4fe1\u606f\u3002\u8981\u4e86\u89e3\u66f4\u591a\u5173\u4e8eXPath\u7684\u77e5\u8bc6\uff0c\u6211\u4eec\u63a8\u8350 \u672c\u6559\u7a0b\u901a\u8fc7\u793a\u4f8b\u5b66\u4e60XPath \uff0c \u672c\u6559\u7a0b\u5b66\u4e60\u201c\u5982\u4f55\u5728XPath\u4e2d\u601d\u8003\u201d \u3002","title":"XPATH \u7b80\u77ed\u4ecb\u7ecd"},{"location":"1. \u7b2c\u4e00\u6b65/04-scrapy tutorial/#quotes","text":"\u73b0\u5728\u60a8\u5df2\u7ecf\u4e86\u89e3\u4e86\u4e00\u4e9b\u5173\u4e8e\u9009\u62e9\u548c\u63d0\u53d6\u7684\u77e5\u8bc6\uff0c\u8ba9\u6211\u4eec\u901a\u8fc7\u7f16\u5199\u4eceweb\u9875\u9762\u4e2d\u63d0\u53d6quotes\u7684\u4ee3\u7801\u6765\u5b8c\u6210\u722c\u866b\u3002 http://quotes.toscrape.com \u4e2d\u7684\u6bcf\u4e2a\u5f15\u8bed\u90fd\u7531HTML\u5143\u7d20\u8868\u793a\uff0c\u5982\u4e0b\u6240\u793a: div class= quote span class= text \u201cThe world as we have created it is a process of our thinking. It cannot be changed without changing our thinking.\u201d /span span by small class= author Albert Einstein /small a href= /author/Albert-Einstein (about) /a /span div class= tags Tags: a class= tag href= /tag/change/page/1/ change /a a class= tag href= /tag/deep-thoughts/page/1/ deep-thoughts /a a class= tag href= /tag/thinking/page/1/ thinking /a a class= tag href= /tag/world/page/1/ world /a /div /div \u8ba9\u6211\u4eec\u6253\u5f00scrapy shell\u5e76\u6d4b\u8bd5\u8fd9\u4e2a\u7f51\u7ad9\uff0c\u4ee5\u4e86\u89e3\u5982\u4f55\u63d0\u53d6\u6211\u4eec\u60f3\u8981\u7684\u6570\u636e: $ scrapy shell 'http://quotes.toscrape.com' \u6211\u4eec\u5f97\u5230\u4e86\u4e00\u4e2a\u5f15\u7528HTML\u5143\u7d20\u7684\u9009\u62e9\u5668\u5217\u8868: response.css( div.quote ) \u4e0a\u9762\u67e5\u8be2\u8fd4\u56de\u7684\u6bcf\u4e2a\u9009\u62e9\u5668\u90fd\u5141\u8bb8\u6211\u4eec\u5bf9\u5b83\u4eec\u7684\u5b50\u5143\u7d20\u8fd0\u884c\u8fdb\u4e00\u6b65\u7684\u67e5\u8be2\u3002\u8ba9\u6211\u4eec\u628a\u7b2c\u4e00\u4e2a\u9009\u62e9\u5668\u5206\u914d\u7ed9\u4e00\u4e2a\u53d8\u91cf\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u76f4\u63a5\u5728\u4e00\u4e2a\u5f15\u7528\u4e0a\u8fd0\u884c\u6211\u4eec\u7684CSS\u9009\u62e9\u5668: quote = response.css( div.quote )[0] \u73b0\u5728\uff0c\u8ba9\u6211\u4eec\u4f7f\u7528\u521a\u624d\u521b\u5efa\u7684quote\u5bf9\u8c61\u4ece\u5f15\u7528\u4e2d\u63d0\u53d6\u6807\u9898\u3001\u4f5c\u8005\u548c\u6807\u7b7e: title = quote.css( span.text::text ).extract_first() title '\u201cThe world as we have created it is a process of our thinking. It cannot be changed without changing our thinking.\u201d' author = quote.css( small.author::text ).extract_first() author 'Albert Einstein' \u5047\u8bbe\u6807\u8bb0\u662f\u5b57\u7b26\u4e32\u5217\u8868\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 .extract() \u65b9\u6cd5\u83b7\u5f97\u6240\u6709\u5b57\u7b26\u4e32: tags = quote.css( div.tags a.tag::text ).extract() tags ['change', 'deep-thoughts', 'thinking', 'world'] \u77e5\u9053\u4e86\u5982\u4f55\u63d0\u53d6\u6bcf\u4e00\u4f4d\u7684\u6570\u636e\uff0c\u6211\u4eec\u73b0\u5728\u53ef\u4ee5\u904d\u5386\u6240\u6709\u7684quote\u5143\u7d20\uff0c\u5e76\u5c06\u5b83\u4eec\u653e\u5230Python\u5b57\u5178\u4e2d: for quote in response.css( div.quote ): ... text = quote.css( span.text::text ).extract_first() ... author = quote.css( small.author::text ).extract_first() ... tags = quote.css( div.tags a.tag::text ).extract() ... print(dict(text=text, author=author, tags=tags)) {'tags': ['change', 'deep-thoughts', 'thinking', 'world'], 'author': 'Albert Einstein', 'text': '\u201cThe world as we have created it is a process of our thinking. It cannot be changed without changing our thinking.\u201d'} {'tags': ['abilities', 'choices'], 'author': 'J.K. Rowling', 'text': '\u201cIt is our choices, Harry, that show what we truly are, far more than our abilities.\u201d'} ... a few more of these, omitted for brevity","title":"\u63d0\u53d6quotes\u548c\u4f5c\u8005"},{"location":"1. \u7b2c\u4e00\u6b65/04-scrapy tutorial/#_5","text":"\u8ba9\u6211\u4eec\u56de\u5230\u6211\u4eec\u7684spider\u3002\u5230\u76ee\u524d\u4e3a\u6b62\uff0c\u5b83\u5e76\u6ca1\u6709\u63d0\u53d6\u4efb\u4f55\u6570\u636e\uff0c\u53ea\u662f\u5c06\u6574\u4e2aHTML\u9875\u9762\u4fdd\u5b58\u5230\u672c\u5730\u6587\u4ef6\u4e2d\u3002\u8ba9\u6211\u4eec\u5c06\u4e0a\u9762\u7684\u63d0\u53d6\u903b\u8f91\u96c6\u6210\u5230\u6211\u4eec\u7684spider\u4e2d\u3002 Scrapy spider\u901a\u5e38\u751f\u6210\u8bb8\u591a\u5305\u542b\u4ece\u9875\u9762\u63d0\u53d6\u7684\u6570\u636e\u7684\u5b57\u5178\u3002\u4e3a\u6b64\uff0c\u6211\u4eec\u5728\u56de\u8c03\u4e2d\u4f7f\u7528 yield Python\u5173\u952e\u5b57\uff0c\u5982\u4e0b\u6240\u793a: import scrapy class QuotesSpider(scrapy.Spider): name = quotes start_urls = [ 'http://quotes.toscrape.com/page/1/', 'http://quotes.toscrape.com/page/2/', ] def parse(self, response): for quote in response.css('div.quote'): yield { 'text': quote.css('span.text::text').extract_first(), 'author': quote.css('small.author::text').extract_first(), 'tags': quote.css('div.tags a.tag::text').extract(), } \u5982\u679c\u60a8\u8fd0\u884c\u8fd9\u4e2a\u722c\u866b\uff0c\u5b83\u5c06\u8f93\u51fa\u5e26\u65e5\u5fd7\u7684\u63d0\u53d6\u6570\u636e: 2016-09-19 18:57:19 [scrapy.core.scraper] DEBUG: Scraped from 200 http://quotes.toscrape.com/page/1/ {'tags': ['life', 'love'], 'author': 'Andr\u00e9 Gide', 'text': '\u201cIt is better to be hated for what you are than to be loved for what you are not.\u201d'} 2016-09-19 18:57:19 [scrapy.core.scraper] DEBUG: Scraped from 200 http://quotes.toscrape.com/page/1/ {'tags': ['edison', 'failure', 'inspirational', 'paraphrased'], 'author': 'Thomas A. Edison', 'text': \u201cI have not failed. I've just found 10,000 ways that won't work.\u201d }","title":"\u4ece\u6211\u4eec\u7684\u722c\u866b\u91cc\u63d0\u53d6\u6570\u636e"},{"location":"1. \u7b2c\u4e00\u6b65/04-scrapy tutorial/#_6","text":"\u5b58\u50a8\u6293\u53d6\u7684\u6570\u636e\u7684\u6700\u7b80\u5355\u65b9\u6cd5\u662f\u4f7f\u7528 Feed exports \uff0c\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4: scrapy crawl quotes -o quotes.json \u8fd9\u4f1a\u4ea7\u751f\u4e00\u4e2aquotes.json\u6587\u4ef6\uff0c\u5305\u542b\u6240\u6709\u6293\u53d6\u8fc7\u7684items\u5e76 json \u5e8f\u5217\u5316\u3002 \u51fa\u4e8e\u5386\u53f2\u539f\u56e0\uff0cScrapy\u5c06\u8ffd\u52a0\u4e00\u4e2a\u7ed9\u5b9a\u7684\u6587\u4ef6\u800c\u4e0d\u662f\u8986\u76d6\u3002\u5982\u679c\u60a8\u5728\u7b2c\u4e8c\u6b21\u8fd0\u884c\u8be5\u547d\u4ee4\u4e24\u6b21\u800c\u6ca1\u6709\u5728\u7b2c\u4e8c\u6b21\u4e4b\u524d\u5220\u9664\u8be5\u6587\u4ef6\uff0c\u90a3\u4e48\u6700\u7ec8\u4f1a\u5f97\u5230\u4e00\u4e2a\u635f\u574f\u7684JSON\u6587\u4ef6\u3002 \u8fd8\u53ef\u4ee5\u4f7f\u7528\u5176\u4ed6\u683c\u5f0f\uff0c\u6bd4\u5982 JSON\u884c : scrapy crawl quotes -o quotes.jl JSON\u884c\u683c\u5f0f\u5f88\u6709\u7528\uff0c\u56e0\u4e3a\u5b83\u7c7b\u4f3c\u4e8e\u6d41\uff0c\u60a8\u53ef\u4ee5\u5f88\u5bb9\u6613\u5730\u5411\u5176\u8ffd\u52a0\u65b0\u8bb0\u5f55\u3002\u5f53\u4f60\u8fd0\u884c\u4e24\u6b21\u65f6\uff0c\u5b83\u4e0d\u4f1a\u6709JSON\u90a3\u6837\u7684\u95ee\u9898\u3002\u53e6\u5916\uff0c\u7531\u4e8e\u6bcf\u4e2a\u8bb0\u5f55\u90fd\u662f\u5355\u72ec\u7684\u4e00\u884c\uff0c\u60a8\u53ef\u4ee5\u5904\u7406\u5927\u6587\u4ef6\uff0c\u800c\u4e0d\u5fc5\u5c06\u6240\u6709\u5185\u5bb9\u90fd\u653e\u5728\u5185\u5b58\u4e2d\u3002 \u5728\u5c0f\u9879\u76ee\u4e2d(\u5982\u672c\u6559\u7a0b\u4e2d\u7684\u9879\u76ee)\uff0c\u8fd9\u5c31\u8db3\u591f\u4e86\u3002\u4f46\u662f\uff0c\u5982\u679c\u60a8\u60f3\u8981\u5bf9\u6293\u53d6\u7684\u6570\u636e\u6267\u884c\u66f4\u590d\u6742\u7684\u64cd\u4f5c\uff0c\u60a8\u53ef\u4ee5\u7f16\u5199\u4e00\u4e2a Item Pipeline \u3002\u5728 tutorial/pipelines.py \u4e2d\uff0c\u9879\u76ee\u521b\u5efa\u65f6\u4e3a\u60a8\u8bbe\u7f6e\u4e86Item Pipeline\u7684\u5360\u4f4d\u7b26\u6587\u4ef6\u3002\u4e0d\u8fc7\uff0c\u5982\u679c\u60a8\u53ea\u662f\u60f3\u8981\u5b58\u50a8\u6293\u53d6\u7684item\uff0c\u5219\u4e0d\u9700\u8981\u5b9e\u4f8b\u5316\u4efb\u4f55item pipelines\u3002","title":"\u5b58\u50a8\u6293\u53d6\u7684\u6570\u636e"},{"location":"1. \u7b2c\u4e00\u6b65/04-scrapy tutorial/#_7","text":"\u6bd4\u65b9\u8bf4\uff0c\u4e0d\u8981\u53ea\u6293\u53d6 http://quotes.toscrape.com \u524d\u4e24\u9875\uff0c\u60f3\u6293\u53d6\u6240\u6709\u9875\u9762\u7684\u5f15\u6587\u3002 \u65e2\u7136\u60a8\u5df2\u7ecf\u77e5\u9053\u4e86\u5982\u4f55\u4ece\u9875\u9762\u4e2d\u63d0\u53d6\u6570\u636e\uff0c\u90a3\u4e48\u8ba9\u6211\u4eec\u770b\u770b\u5982\u4f55\u4ece\u9875\u9762\u4e2d\u8ddf\u8e2a\u94fe\u63a5\u3002 \u7b2c\u4e00\u4ef6\u4e8b\u662f\u63d0\u53d6\u5230\u6211\u4eec\u60f3\u8981\u8ddf\u968f\u7684\u9875\u9762\u7684\u94fe\u63a5\u3002\u68c0\u67e5\u6211\u4eec\u7684\u9875\u9762\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6709\u4e00\u4e2a\u94fe\u63a5\u5230\u4e0b\u4e00\u9875\u7684\u6807\u7b7e: ul class= pager li class= next a href= /page/2/ Next span aria-hidden= true rarr; /span /a /li /ul \u6211\u4eec\u53ef\u4ee5\u8bd5\u7740\u4eceshell\u4e2d\u63d0\u53d6\u51fa\u6765: response.css('li.next a').extract_first() ' a href= /page/2/ Next span aria-hidden= true \u2192 /span /a ' \u8fd9\u5c06\u83b7\u53d6\u8d85\u94fe\u63a5\u5143\u7d20\uff0c\u4f46\u6211\u4eec\u9700\u8981 href \u5c5e\u6027\u3002\u4e3a\u6b64\uff0cScrapy\u652f\u6301\u4e00\u4e2aCSS\u6269\u5c55\uff0c\u5141\u8bb8\u60a8\u9009\u62e9\u5c5e\u6027\u5185\u5bb9\uff0c\u5982\u4e0b\u6240\u793a: response.css('li.next a::attr(href)').extract_first() '/page/2/' \u73b0\u5728\u8ba9\u6211\u4eec\u770b\u770b\u6211\u4eec\u7684\u722c\u866b\u88ab\u4fee\u6539\u6210\u9012\u5f52\u5730\u8ddf\u968f\u94fe\u63a5\u5230\u4e0b\u4e00\u9875\uff0c\u7136\u540e\u4ece\u4e2d\u63d0\u53d6\u6570\u636e: import scrapy class QuotesSpider(scrapy.Spider): name = quotes start_urls = [ 'http://quotes.toscrape.com/page/1/', ] def parse(self, response): for quote in response.css('div.quote'): yield { 'text': quote.css('span.text::text').extract_first(), 'author': quote.css('small.author::text').extract_first(), 'tags': quote.css('div.tags a.tag::text').extract(), } next_page = response.css('li.next a::attr(href)').extract_first() if next_page is not None: next_page = response.urljoin(next_page) yield scrapy.Request(next_page, callback=self.parse) \u73b0\u5728,\u7ecf\u8fc7\u63d0\u53d6\u6570\u636e, parse() \u65b9\u6cd5\u5bfb\u627e\u5230\u4e0b\u4e00\u4e2a\u9875\u9762\u7684\u94fe\u63a5,\u4f7f\u7528 urljoin() \u65b9\u6cd5\u6784\u5efa\u5b8c\u6574\u7684\u7edd\u5bf9URL(\u56e0\u4e3a\u94fe\u63a5\u53ef\u4ee5\u662f\u76f8\u5bf9\u7684),\u5e76\u5411\u4e0b\u4e00\u9875\u751f\u6210\u4e00\u4e2a\u65b0\u8bf7\u6c42\uff0c\u8bbe\u7f6e\u5176\u56de\u8c03\u51fd\u6570\uff0c\u4ee5\u5904\u7406\u4e0b\u4e00\u9875\u7684\u6570\u636e\u63d0\u53d6\u5e76\u4fdd\u6301\u6240\u6709\u9875\u9762\u7684\u722c\u884c\u3002 \u60a8\u5728\u8fd9\u91cc\u770b\u5230\u7684\u662fScrapy\u7684\u94fe\u63a5\u673a\u5236:\u5f53\u60a8\u5728\u56de\u8c03\u65b9\u6cd5\u4e2d\u751f\u6210\u8bf7\u6c42\u65f6\uff0cScrapy\u5c06\u8c03\u5ea6\u53d1\u9001\u8be5\u8bf7\u6c42\uff0c\u5e76\u8bbe\u7f6e\u4e00\u4e2a\u56de\u8c03\u65b9\u6cd5\u4ee5\u4fbf\u5728\u8be5\u8bf7\u6c42\u5b8c\u6210\u65f6\u6267\u884c\u3002 \u4f7f\u7528\u6b64\u529f\u80fd\uff0c\u60a8\u53ef\u4ee5\u6784\u5efa\u590d\u6742\u7684\u722c\u866b\u7a0b\u5e8f\uff0c\u6839\u636e\u60a8\u5b9a\u4e49\u7684\u89c4\u5219\u8ddf\u8e2a\u94fe\u63a5\uff0c\u5e76\u6839\u636e\u8bbf\u95ee\u7684\u9875\u9762\u63d0\u53d6\u4e0d\u540c\u7c7b\u578b\u7684\u6570\u636e\u3002 \u5728\u6211\u4eec\u7684\u793a\u4f8b\u4e2d\uff0c\u5b83\u521b\u5efa\u4e86\u4e00\u79cd\u5faa\u73af\uff0c\u8ddf\u8e2a\u5230\u4e0b\u4e00\u4e2a\u9875\u9762\u7684\u6240\u6709\u94fe\u63a5\uff0c\u76f4\u5230\u627e\u4e0d\u5230\u4e3a\u6b62, \u8fd9\u5bf9\u4e8e\u5728\u5e26\u6709\u5206\u9875\u7684\u535a\u5ba2\u3001\u8bba\u575b\u548c\u5176\u4ed6\u7ad9\u70b9\u4e0a\u6293\u53d6\u975e\u5e38\u65b9\u4fbf\u3002","title":"\u8ddf\u8e2a\u8fde\u63a5"},{"location":"1. \u7b2c\u4e00\u6b65/04-scrapy tutorial/#requests","text":"\u60a8\u53ef\u4ee5\u4f7f\u7528 response.follow : import scrapy class QuotesSpider(scrapy.Spider): name = quotes start_urls = [ 'http://quotes.toscrape.com/page/1/', ] def parse(self, response): for quote in response.css('div.quote'): yield { 'text': quote.css('span.text::text').extract_first(), 'author': quote.css('span small::text').extract_first(), 'tags': quote.css('div.tags a.tag::text').extract(), } next_page = response.css('li.next a::attr(href)').extract_first() if next_page is not None: yield response.follow(next_page, callback=self.parse) \u4e0d\u50cfscrapy.Request, response.follow \u652f\u6301url\u76f8\u5bf9\u8def\u5f84 -\u4e0d\u9700\u8981\u8c03\u7528urljoin\u3002 \u6ce8\u610f, response.follow \u53ea\u8fd4\u56de\u4e00\u4e2aRequest\u5b9e\u4f8b;\u60a8\u4ecd\u7136\u5fc5\u987byield\u6b64\u8bf7\u6c42\u3002 \u60a8\u8fd8\u53ef\u4ee5\u4f20\u9012\u4e00\u4e2a\u9009\u62e9\u5668\u7ed9 response.follow \u3002 \u800c\u4e0d\u662f\u5b57\u7b26\u4e32;\u8fd9\u4e2a\u9009\u62e9\u5668\u5e94\u8be5\u63d0\u53d6\u5fc5\u8981\u7684\u5c5e\u6027( PS:\u4e2a\u4eba\u7406\u89e3\u5fc5\u987b\u662f\u94fe\u63a5 ): for href in response.css('li.next a::attr(href)'): yield response.follow(href, callback=self.parse) \u5bf9\u4e8e a \u5143\u7d20\uff0c\u6709\u4e00\u4e2a\u7b80\u5355\u65b9\u5f0f: response.follow \u4f1a\u81ea\u52a8\u4f7f\u7528\u5b83\u4eec\u7684href\u5c5e\u6027\u3002\u56e0\u6b64\uff0c\u4ee3\u7801\u53ef\u4ee5\u8fdb\u4e00\u6b65\u7f29\u77ed: for a in response.css('li.next a'): yield response.follow(a, callback=self.parse) \u6ce8\u610f!!!! response.follow(response.css('li.next a')))\u662f\u65e0\u6548\u7684\uff0c \u56e0\u4e3aresponse.css\u8fd4\u56de\u4e00\u4e2a\u7c7b\u4f3c\u4e8e\u5217\u8868\u7684\u5bf9\u8c61\uff0c \u5176\u4e2d\u5305\u542b\u6240\u6709\u7ed3\u679c\u7684\u9009\u62e9\u5668\uff0c\u800c\u4e0d\u662f\u5355\u4e2a\u9009\u62e9\u5668\u3002 \u6b63\u786e\u7684\u65b9\u5f0f\u6bd4\u5982\u4e00\u4e2afor\u5faa\u73af\u5c31\u50cf\u4e0a\u9762\u7684\u4f8b\u5b50\uff0c\u6216\u8005response.follow(response.css('li.next a')[0])\u5c31\u5f88\u597d\u3002","title":"\u521b\u5efa\u4e00\u4e2a\u7b80\u5355\u7684Requests, \u5e76\u4e14\u7528\u4e0a\u8ffd\u8e2a\u8fde\u63a5"},{"location":"1. \u7b2c\u4e00\u6b65/04-scrapy tutorial/#_8","text":"\u4e0b\u9762\u662f\u53e6\u4e00\u4e2a\u722c\u866b\uff0c\u5b83\u6f14\u793a\u4e86\u56de\u8c03\u548c\u8ffd\u8e2a\u94fe\u63a5\uff0c\u8fd9\u6b21\u662f\u4e3a\u4e86\u6293\u53d6\u4f5c\u8005\u4fe1\u606f: import scrapy class AuthorSpider(scrapy.Spider): name = 'author' start_urls = ['http://quotes.toscrape.com/'] def parse(self, response): # follow links to author pages for href in response.css('.author + a::attr(href)'): yield response.follow(href, self.parse_author) # follow pagination links for href in response.css('li.next a::attr(href)'): yield response.follow(href, self.parse) def parse_author(self, response): def extract_with_css(query): return response.css(query).extract_first().strip() yield { 'name': extract_with_css('h3.author-title::text'), 'birthdate': extract_with_css('.author-born-date::text'), 'bio': extract_with_css('.author-description::text'), } \u8fd9\u4e2a\u722c\u866b\u5c06\u4ece\u4e3b\u9875\u5f00\u59cb\uff0c\u5b83\u8ffd\u8e2a\u5f53\u524d\u9875\u9762\u7684\u4fe1\u606f\u56de\u8c03\u7ed9 parse_author , \u5e76\u4e14\u89e3\u6790\u4e0b\u4e00\u9875\u7684\u94fe\u63a5\u56de\u8c03\u7ed9 parse \u8fd9\u91cc\u6211\u4eec\u4f20\u9012\u56de\u8c03\u7528 response.follow \u4f5c\u4e3a\u4f4d\u7f6e\u53c2\u6570\u4f7f\u4ee3\u7801\u66f4\u77ed;\u5b83\u4e5f\u9002\u7528\u4e8e scrapy.Request \u3002 parse_author \u56de\u8c03\u51fd\u6570\u5b9a\u4e49\u4e86\u4e00\u4e2a\u6709\u7528\u7684\u51fd\u6570\uff0c\u7528\u4e8e\u4eceCSS\u67e5\u8be2\u4e2d\u63d0\u53d6\u548c\u6e05\u7406\u6570\u636e\uff0c\u5e76\u751f\u6210\u5e26\u6709\u4f5c\u8005\u6570\u636e\u7684Python\u5b57\u5178\u3002 \u8fd9\u4e2a\u722c\u866b\u6f14\u793a\u7684\u53e6\u4e00\u4ef6\u6709\u8da3\u7684\u4e8b\u60c5\u662f\uff0c\u5373\u4f7f\u6765\u81ea\u540c\u4e00\u4f5c\u8005\u7684\u5f15\u7528\u5f88\u591a\u6b21\uff0c\u6211\u4eec\u4e5f\u4e0d\u5fc5\u62c5\u5fc3\u591a\u6b21\u8bbf\u95ee\u540c\u4e00\u4f5c\u8005\u7684\u9875\u9762\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cScrapy\u4f1a\u8fc7\u6ee4\u6389\u5df2\u7ecf\u8bbf\u95ee\u8fc7\u7684url\u7684\u91cd\u590d\u8bf7\u6c42\uff0c\u4ece\u800c\u907f\u514d\u7531\u4e8e\u7f16\u7a0b\u9519\u8bef\u800c\u8fc7\u591a\u5730\u653b\u51fb\u670d\u52a1\u5668\u7684\u95ee\u9898\u3002\u8fd9\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e DUPEFILTER_CLASS \u6765\u914d\u7f6e\u3002 \u5e0c\u671b\u73b0\u5728\u60a8\u5df2\u7ecf\u5f88\u597d\u5730\u7406\u89e3\u4e86\u5982\u4f55\u4f7f\u7528Scrapy\u8ddf\u8e2a\u94fe\u63a5\u548c\u56de\u8c03\u673a\u5236\u3002 \u4f5c\u4e3a\u5229\u7528\u8ddf\u8e2a\u94fe\u63a5\u673a\u5236\u7684\u53e6\u4e00\u4e2a\u793a\u4f8b\uff0c\u8bf7\u67e5\u770b CrawlSpider \u7c7b\uff0c\u5b83\u662f\u4e00\u4e2a\u901a\u7528\u7684spider\uff0c\u5b83\u5b9e\u73b0\u4e86\u4e00\u4e2a\u5c0f\u89c4\u5219\u5f15\u64ce\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u5b83\u5728\u4e0a\u9762\u7f16\u5199\u722c\u866b\u7a0b\u5e8f\u3002 \u53e6\u5916\uff0c\u4e00\u79cd\u5e38\u89c1\u7684\u6a21\u5f0f\u662f\u4f7f\u7528\u591a\u4e2a\u9875\u9762\u7684\u6570\u636e\u6784\u5efa\u4e00\u4e2a\u9879\u76ee\uff0c\u4f7f\u7528 \u5411\u56de\u8c03\u51fd\u6570\u4f20\u9012\u989d\u5916\u6570\u636e\u7684\u6280\u5de7 \u3002","title":"\u66f4\u591a\u7684\u4f8b\u5b50\u548c\u6a21\u5f0f"},{"location":"1. \u7b2c\u4e00\u6b65/04-scrapy tutorial/#spider_1","text":"\u5728\u8fd0\u884c\u722c\u866b\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528-a\u9009\u9879\u4e3a\u722c\u866b\u63d0\u4f9b\u547d\u4ee4\u884c\u53c2\u6570: scrapy crawl quotes -o quotes-humor.json -a tag=humor \u8fd9\u4e9b\u53c2\u6570\u88ab\u4f20\u9012\u7ed9Spider\u7684 __init__ \u65b9\u6cd5\uff0c\u5e76\u9ed8\u8ba4\u6210\u4e3aspider\u5c5e\u6027\u3002 \u5728\u672c\u4f8b\u4e2d\uff0c\u4f20\u9012\u7684 tag \u7684\u503c\u53ef\u4ee5\u901a\u8fc7 self.tag \u5c5e\u6027\u5f15\u7528\u3002\u4f60\u53ef\u4ee5\u7528\u5b83\u6765\u8ba9\u4f60\u7684\u722c\u884c\u5668\u6293\u53d6\u53ea\u5e26\u6709\u7279\u5b9a\u6807\u7b7e\u7684quotes\uff0c\u6839\u636e\u53c2\u6570\u5efa\u7acbURL: import scrapy class QuotesSpider(scrapy.Spider): name = quotes def start_requests(self): url = 'http://quotes.toscrape.com/' tag = getattr(self, 'tag', None) if tag is not None: url = url + 'tag/' + tag yield scrapy.Request(url, self.parse) def parse(self, response): for quote in response.css('div.quote'): yield { 'text': quote.css('span.text::text').extract_first(), 'author': quote.css('small.author::text').extract_first(), } next_page = response.css('li.next a::attr(href)').extract_first() if next_page is not None: yield response.follow(next_page, self.parse) \u5982\u679c\u60a8\u5c06 tag=humor \u53c2\u6570\u4f20\u9012\u7ed9\u8fd9\u4e2aspider\uff0c\u60a8\u4f1a\u6ce8\u610f\u5230\u5b83\u53ea\u4f1a\u8bbf\u95ee\u6765\u81ea humor \u6807\u8bb0\u7684url\uff0c\u6bd4\u5982 http://quotes.toscrape.com/tag/humor \u3002 \u60a8\u53ef\u4ee5 \u5728\u8fd9\u91cc\u5b66\u4e60\u66f4\u591a\u5173\u4e8e\u5904\u7406\u722c\u884c\u5668\u53c2\u6570\u7684\u77e5\u8bc6 \u3002","title":"\u4f7f\u7528Spider\u53c2\u6570"},{"location":"1. \u7b2c\u4e00\u6b65/04-scrapy tutorial/#_9","text":"\u672c\u6559\u7a0b\u53ea\u4ecb\u7ecd\u4e86Scrapy\u7684\u57fa\u7840\u77e5\u8bc6\uff0c\u4f46\u662f\u8fd9\u91cc\u6ca1\u6709\u63d0\u5230\u5176\u4ed6\u8bb8\u591a\u7279\u6027\u3002 \u8fd8\u6709\u5176\u4ed6\u7684\u4e48? \u56de\u987e\u4e00\u4e0b \u7b2c\u4e00\u6b65 \uff0c\u53ef\u4ee5\u5feb\u901f\u6d4f\u89c8\u6700\u91cd\u8981\u7684\u7ae0\u8282\u3002 \u60a8\u53ef\u4ee5\u7ee7\u7eed\u4ece\u57fa\u672c\u6982\u5ff5\u90e8\u5206\u4e86\u89e3\u66f4\u591a\u5173\u4e8e\u547d\u4ee4\u884c\u5de5\u5177\u3001spiders\u3001\u9009\u62e9\u5668\u548c\u5176\u4ed6\u672c\u6559\u7a0b\u6ca1\u6709\u6d89\u53ca\u5230\u7684\u5185\u5bb9\uff0c\u6bd4\u5982\u5bf9\u6293\u53d6\u7684\u6570\u636e\u8fdb\u884c\u5efa\u6a21\u3002\u5982\u679c\u60a8\u559c\u6b22\u4f7f\u7528\u793a\u4f8b\u9879\u76ee\uff0c\u8bf7\u68c0\u67e5\u793a\u4f8b\u90e8\u5206\u3002","title":"\u4e0b\u4e00\u6b65"},{"location":"1. \u7b2c\u4e00\u6b65/05-examples/","text":"\u4f8b\u5b50 \u6700\u597d\u7684\u5b66\u4e60\u65b9\u6cd5\u662f\u770b\u4f8b\u5b50\uff0cScrapy\u4e5f\u4e0d\u4f8b\u5916\u3002\u51fa\u4e8e\u8fd9\u4e2a\u539f\u56e0\uff0c\u6709\u4e00\u4e2a\u540d\u4e3a quotesbot \u7684Scrapy\u9879\u76ee\u793a\u4f8b\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u5b83\u6765\u5e76\u4e86\u89e3\u5173\u4e8eScrapy\u7684\u66f4\u591a\u4fe1\u606f\u3002\u5b83\u5305\u542b\u4e24\u4e2a\u7528\u4e8e http://quotes.toscrape.com \u7684\u722c\u866b\uff0c\u4e00\u4e2a\u4f7f\u7528CSS\u9009\u62e9\u5668\uff0c\u53e6\u4e00\u4e2a\u4f7f\u7528XPath\u8868\u8fbe\u5f0f\u3002 quotesbot \u9879\u76ee\u53ef\u4ee5\u901a\u8fc7 https://github.com/scrapy/quotesbot \u67e5\u8be2\u3002\u60a8\u53ef\u4ee5\u5728\u9879\u76ee\u81ea\u8ff0\u6587\u4ef6\u4e2d\u627e\u5230\u5173\u4e8e\u5b83\u7684\u66f4\u591a\u4fe1\u606f\u3002 \u5982\u679c\u60a8\u719f\u6089git\uff0c\u53ef\u4ee5checkout\u4ee3\u7801\u3002\u5426\u5219\uff0c\u60a8\u53ef\u4ee5\u5355\u51fb \u6b64\u5904 \u4ee5zip\u6587\u4ef6\u7684\u5f62\u5f0f\u4e0b\u8f7d\u9879\u76ee\u3002","title":"\u4f8b\u5b50"},{"location":"1. \u7b2c\u4e00\u6b65/05-examples/#_1","text":"\u6700\u597d\u7684\u5b66\u4e60\u65b9\u6cd5\u662f\u770b\u4f8b\u5b50\uff0cScrapy\u4e5f\u4e0d\u4f8b\u5916\u3002\u51fa\u4e8e\u8fd9\u4e2a\u539f\u56e0\uff0c\u6709\u4e00\u4e2a\u540d\u4e3a quotesbot \u7684Scrapy\u9879\u76ee\u793a\u4f8b\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u5b83\u6765\u5e76\u4e86\u89e3\u5173\u4e8eScrapy\u7684\u66f4\u591a\u4fe1\u606f\u3002\u5b83\u5305\u542b\u4e24\u4e2a\u7528\u4e8e http://quotes.toscrape.com \u7684\u722c\u866b\uff0c\u4e00\u4e2a\u4f7f\u7528CSS\u9009\u62e9\u5668\uff0c\u53e6\u4e00\u4e2a\u4f7f\u7528XPath\u8868\u8fbe\u5f0f\u3002 quotesbot \u9879\u76ee\u53ef\u4ee5\u901a\u8fc7 https://github.com/scrapy/quotesbot \u67e5\u8be2\u3002\u60a8\u53ef\u4ee5\u5728\u9879\u76ee\u81ea\u8ff0\u6587\u4ef6\u4e2d\u627e\u5230\u5173\u4e8e\u5b83\u7684\u66f4\u591a\u4fe1\u606f\u3002 \u5982\u679c\u60a8\u719f\u6089git\uff0c\u53ef\u4ee5checkout\u4ee3\u7801\u3002\u5426\u5219\uff0c\u60a8\u53ef\u4ee5\u5355\u51fb \u6b64\u5904 \u4ee5zip\u6587\u4ef6\u7684\u5f62\u5f0f\u4e0b\u8f7d\u9879\u76ee\u3002","title":"\u4f8b\u5b50"},{"location":"2. \u57fa\u672c\u6982\u5ff5/06-command_line_tool/","text":"Command line tool(\u547d\u4ee4\u884c\u5de5\u5177) \u6700\u65b0\u7684\u7248\u672c\u662f0.10 Scrapy\u662f\u901a\u8fc7 scrapy \u547d\u4ee4\u884c\u5de5\u5177\u8fdb\u884c\u63a7\u5236\u7684\uff0c\u5728\u8fd9\u91cc\u88ab\u79f0\u4e3a\u201cScrapy\u5de5\u5177\u201d\uff0c\u4ee5\u4fbf\u5c06\u5176\u4e0e\u5b50\u547d\u4ee4\u533a\u5206\u5f00\u6765\uff0c\u5b50\u547d\u4ee4\u6211\u4eec\u79f0\u4e3a\u201c\u547d\u4ee4\u201d\u6216\u201cScrapy\u547d\u4ee4\u201d\u3002 Scrapy\u5de5\u5177\u4e3a\u591a\u79cd\u76ee\u7684\u63d0\u4f9b\u4e86\u51e0\u4e2a\u547d\u4ee4\uff0c\u6bcf\u4e2a\u547d\u4ee4\u90fd\u63a5\u53d7\u4e00\u7ec4\u4e0d\u540c\u7684\u53c2\u6570\u548c\u9009\u9879\u3002 (\u57281.0\u7248\u4e2d\uff0c\u5df2\u5220\u9664\u4e86 scrapy deploy \u547d\u4ee4\uff0c\u652f\u6301\u72ec\u7acb\u7684 scrapdy -deploy \u3002\u53c2\u89c1 \u90e8\u7f72\u60a8\u7684\u9879\u76ee )\u3002 \u914d\u7f6e\u8bbe\u7f6e Scrapy\u5c06\u5728\u6807\u51c6\u7684\u4f4d\u7f6e\u5185\u91c7\u7528 scrapy.cfg \u6587\u4ef6\u4e2d\u5bfb\u627e\u5185\u7f6e\u6837\u5f0f\u5e76\u67e5\u627e\u914d\u7f6e\u53c2\u6570: linux /etc/scrapy.cfg , ~/.config/scrapy.cfg , ( $XDG_CONFIG_HOME )\u548c ~/.scrapy.cfg ( $HOME )\u7b49\u5168\u5c40\u8bbe\u7f6e\u548c scrapy.cfg \u5728scrapy\u9879\u76ee\u7684\u6839\u76ee\u5f55\u4e2d(\u53c2\u89c1\u4e0b\u4e00\u8282)\u3002 \u8fd9\u4e9b\u6587\u4ef6\u4e2d\u7684\u8bbe\u7f6e\u6309\u7167\u5217\u51fa\u7684\u4f18\u5148\u7ea7\u987a\u5e8f\u5408\u5e76:\u7528\u6237\u5b9a\u4e49\u7684\u503c\u5177\u6709\u6bd4\u7cfb\u7edf\u8303\u56f4\u5185\u7684\u9ed8\u8ba4\u503c\u66f4\u9ad8\u7684\u4f18\u5148\u7ea7\uff0c\u5e76\u4e14\u5728\u5b9a\u4e49\u65f6\u9879\u76ee\u8303\u56f4\u5185\u7684\u8bbe\u7f6e\u5c06\u8986\u76d6\u6240\u6709\u5176\u4ed6\u8bbe\u7f6e\u3002 Scrapy\u8fd8\u4e86\u89e3\u5e76\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e9b\u73af\u5883\u53d8\u91cf\u8fdb\u884c\u914d\u7f6e\u3002\u76ee\u524d,\u8fd9\u4e9b\u5305\u62ec: SCRAPY_SETTINGS_MODULE (\u53c2\u89c1 \u6307\u5b9a\u7684\u8bbe\u7f6e ) SCRAPY_PROJECT SCRAPY_PYTHON_SHELL (\u53c2\u89c1 Scrapy shell ) \u9ed8\u8ba4\u7684Scrapy\u9879\u76ee\u7ed3\u6784 \u5728\u6df1\u5165\u7814\u7a76\u547d\u4ee4\u884c\u5de5\u5177\u53ca\u5176\u5b50\u547d\u4ee4\u4e4b\u524d\uff0c\u8ba9\u6211\u4eec\u5148\u4e86\u89e3\u4e00\u4e0bScrapy\u9879\u76ee\u7684\u76ee\u5f55\u7ed3\u6784\u3002 \u867d\u7136\u53ef\u4ee5\u4fee\u6539\uff0c\u4f46\u6240\u6709\u7684Scrapy\u9879\u76ee\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5177\u6709\u76f8\u540c\u7684\u6587\u4ef6\u7ed3\u6784\uff0c\u7c7b\u4f3c\u5982\u4e0b: scrapy.cfg myproject/ __init__.py items.py middlewares.py pipelines.py settings.py spiders/ __init__.py spider1.py spider2.py ... \u6709 scrapy.cfg \u6587\u4ef6\u7684\u6587\u4ef6\u5939\u88ab\u79f0\u4e3a\u9879\u76ee\u7684\u6839\u76ee\u5f55\u3002 \u8be5\u6587\u4ef6\u5305\u542b\u5b9a\u4e49\u9879\u76ee\u8bbe\u7f6e\u7684python\u6a21\u5757\u7684\u540d\u79f0\u3002\u8fd9\u91cc\u6709\u4e00\u4e2a\u4f8b\u5b50: [settings] default = myproject.settings \u4f7f\u7528scrapy\u5de5\u5177 \u4f60\u53ef\u4ee5\u5728\u6ca1\u6709\u53c2\u6570\u7684\u60c5\u51b5\u4e0b\u8fd0\u884cScrapy\u5de5\u5177\uff0c\u5b83\u5c06\u6253\u5370\u4e00\u4e9b\u4f7f\u7528\u5e2e\u52a9\u548c\u53ef\u7528\u7684\u547d\u4ee4: Scrapy 1.5.1 - no active project Usage: scrapy command [options] [args] Available commands: bench Run quick benchmark test fetch Fetch a URL using the Scrapy downloader genspider Generate new spider using pre-defined templates runspider Run a self-contained spider (without creating a project) settings Get settings values shell Interactive scraping console startproject Create new project version Print Scrapy version view Open URL in browser, as seen by Scrapy [ more ] More commands available when run from project directory Use scrapy command -h to see more info about a command \u5982\u679c\u60a8\u5728\u4e00\u4e2aScrapy\u9879\u76ee\u4e2d, \u7b2c\u4e00\u884c\u5c06\u4f1a\u6253\u5370\u5f53\u524d\u6d3b\u52a8\u7684\u9879\u76ee\uff0c\u5728\u672c\u4f8b\u4e2d\uff0c\u5b83\u662f\u4ece\u9879\u76ee\u5916\u90e8\u8fd0\u884c\u7684\u3002\u5982\u679c\u4ece\u9879\u76ee\u5185\u90e8\u8fd0\u884c\uff0c\u5b83\u4f1a\u6253\u5370\u5982\u4e0b\u5185\u5bb9: Scrapy 1.5.1 - project: TalkingData Usage: scrapy command [options] [args] Available commands: bench Run quick benchmark test check Check spider contracts crawl Run a spider edit Edit spider fetch Fetch a URL using the Scrapy downloader genspider Generate new spider using pre-defined templates list List available spiders parse Parse URL (using its spider) and print the results runspider Run a self-contained spider (without creating a project) settings Get settings values shell Interactive scraping console startproject Create new project version Print Scrapy version view Open URL in browser, as seen by Scrapy Use scrapy command -h to see more info about a command \u521b\u5efa\u9879\u76ee \u901a\u5e38\u4f7f\u7528 scrapy \u5de5\u5177\u505a\u7684\u7b2c\u4e00\u4ef6\u4e8b\u662f\u521b\u5efa\u4e00\u4e2ascrapy\u9879\u76ee: scrapy startproject myproject [project_dir] \u8fd9\u5c06\u5728 project_dir \u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2aScrapy\u9879\u76ee\u3002\u5982\u679c\u6ca1\u6709\u6307\u5b9a project_dir , project_dir \u5c06\u4e0e myproject \u76f8\u540c\u3002 \u63a5\u4e0b\u6765\uff0c\u8fdb\u5165\u65b0\u7684\u9879\u76ee\u76ee\u5f55: cd project_dir \u73b0\u5728\u53ef\u4ee5\u4f7f\u7528 scrapy \u547d\u4ee4\u6765\u7ba1\u7406\u548c\u63a7\u5236\u9879\u76ee\u3002 \u4f8b\u5982\uff0c\u521b\u5efa\u4e00\u4e2a\u65b0\u7684Spider: scrapy genspider mydomain mydomain.com \u4e00\u4e9bScrapy\u547d\u4ee4(\u6bd4\u5982 crawl ])\u5fc5\u987b\u5728\u4e00\u4e2aScrapy\u9879\u76ee\u91cc\u8fd0\u884c\u3002\u5173\u4e8e\u54ea\u4e9b\u547d\u4ee4\u5fc5\u987b\u5728\u9879\u76ee\u5185\u90e8\u8fd0\u884c\uff0c\u54ea\u4e9b\u4e0d\u80fd\u8fd0\u884c\uff0c\u8bf7\u53c2\u9605\u4e0b\u9762\u7684 \u547d\u4ee4\u53c2\u8003 \u8d44\u6599\u3002 \u8fd8\u8981\u8bb0\u4f4f\uff0c\u5728\u4ece\u5185\u90e8\u9879\u76ee\u8fd0\u884c\u547d\u4ee4\u65f6\uff0c\u6709\u4e9b\u547d\u4ee4\u7684\u884c\u4e3a\u53ef\u80fd\u7565\u6709\u4e0d\u540c\u3002\u4f8b\u5982\uff0c\u5982\u679c\u83b7\u53d6\u7684url\u4e0e\u67d0\u4e2a\u7279\u5b9a\u7684\u722c\u866b\u76f8\u5173\u8054\uff0cfetch\u547d\u4ee4\u5c06\u4f7f\u7528spider\u8986\u76d6\u7684\u884c\u4e3a(\u4f8b\u5982 user_agent \u6765\u8986\u76d6\u7528\u6237\u4ee3\u7406)\u3002\u8fd9\u662f\u6709\u610f\u4e3a\u4e4b\u7684\uff0c\u56e0\u4e3a fetch \u547d\u4ee4\u7528\u4e8e\u68c0\u67e5\u722c\u866b\u5982\u4f55\u4e0b\u8f7d\u9875\u9762\u3002 \u53ef\u7528\u7684\u5de5\u5177\u547d\u4ee4 \u672c\u8282\u5305\u542b\u53ef\u7528\u7684\u5185\u7f6e\u547d\u4ee4\u5217\u8868\u548c\u63cf\u8ff0\u4ee5\u53ca\u4e00\u4e9b\u4f7f\u7528\u793a\u4f8b\u3002\u8bb0\u4f4f\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u83b7\u5f97\u66f4\u591a\u4fe1\u606f: scrapy command -h \u4f60\u53ef\u4ee5\u770b\u5230\u6240\u6709\u53ef\u7528\u7684\u547d\u4ee4: scrapy -h \u6709\u4e24\u79cd\u547d\u4ee4\uff0c\u4e00\u79cd\u662f\u53ea\u5728Scrapy\u9879\u76ee\u5185\u5de5\u4f5c\u7684\u547d\u4ee4(\u7279\u5b9a\u4e8e\u9879\u76ee\u7684\u547d\u4ee4)\uff0c\u53e6\u4e00\u79cd\u662f\u5728\u6ca1\u6709\u6d3b\u52a8Scrapy\u9879\u76ee\u7684\u60c5\u51b5\u4e0b\u5de5\u4f5c\u7684\u547d\u4ee4(\u5168\u5c40\u547d\u4ee4)\uff0c\u5c3d\u7ba1\u5728\u4ece\u9879\u76ee\u5185\u8fd0\u884c\u65f6\u5b83\u4eec\u7684\u884c\u4e3a\u53ef\u80fd\u7565\u6709\u4e0d\u540c(\u56e0\u4e3a\u5b83\u4eec\u4f1a\u4f7f\u7528\u9879\u76ee\u8986\u76d6\u8bbe\u7f6e)\u3002 \u5168\u5c40\u547d\u4ee4 startproject genspider settings runspider shell fetch view version \u9879\u76ee\u547d\u4ee4 crawl check list edit parse bench startproject \u8bed\u6cd5: scrapy startproject project_name [project_dir] \u9700\u8981\u9879\u76ee: no \u5728project_dir\u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a project_name \u7684\u65b0Scrapy\u9879\u76ee\u3002\u5982\u679c\u6ca1\u6709\u6307\u5b9a project_dir \uff0c\u90a3\u4e48 project_dir \u5c06\u4e0e project_name \u76f8\u540c\u3002 \u4f8b\u5b50: $ scrapy startproject myproject genspider \u8bed\u6cd5: scrapy genspider [-t template] name domain \u9700\u8981\u9879\u76ee: no \u5728\u5f53\u524d\u6587\u4ef6\u5939\u6216\u5f53\u524d\u9879\u76ee\u7684spider\u6587\u4ef6\u5939\u4e2d\u521b\u5efa\u4e00\u4e2a\u65b0\u7684spider\uff0c\u5982\u679c\u4ece\u9879\u76ee\u5185\u90e8\u8c03\u7528\u7684\u8bdd\u3002 name \u53c2\u6570\u8bbe\u7f6e\u4e3aspider\u7684 \u540d\u79f0 \uff0c\u800c domain \u7528\u4e8e\u751f\u6210 allowed_domains \u548c start_urls spider\u7684\u5c5e\u6027\u3002 \u4f8b\u5b50: $ scrapy genspider -l Available templates: basic crawl csvfeed xmlfeed $ scrapy genspider example example.com Created spider 'example' using template 'basic' $ scrapy genspider -t crawl scrapyorg scrapy.org Created spider 'scrapyorg' using template 'crawl' \u8fd9\u53ea\u662f\u4e00\u4e2a\u57fa\u4e8e\u9884\u5b9a\u4e49\u6a21\u677f\u521b\u5efa\u722c\u884c\u5668\u7684\u65b9\u4fbf\u5feb\u6377\u547d\u4ee4\uff0c\u4f46\u80af\u5b9a\u4e0d\u662f\u521b\u5efa\u722c\u884c\u5668\u7684\u552f\u4e00\u65b9\u6cd5\u3002\u60a8\u53ef\u4ee5\u81ea\u5df1\u521b\u5efaspider\u6e90\u4ee3\u7801\u6587\u4ef6\uff0c\u800c\u4e0d\u662f\u4f7f\u7528\u8fd9\u4e2a\u547d\u4ee4\u3002 crawl \u8bed\u6cd5: scrapy crawl spider \u9700\u8981\u9879\u76ee: yes \u5f00\u59cb\u7528\u722c\u866b\u6293\u53d6 \u4f8b\u5b50: $ scrapy crawl myspider [ ... myspider starts crawling ... ] check \u8bed\u6cd5: scrapy check [-l] spider \u9700\u8981\u9879\u76ee: yes \u68c0\u67e5\u9879\u76ee\u6709\u6ca1\u6709\u9519\u8bef \u4f8b\u5b50: $ scrapy check -l first_spider * parse * parse_item second_spider * parse * parse_item $ scrapy check [FAILED] first_spider:parse_item 'RetailPricex' field is missing [FAILED] first_spider:parse Returned 92 requests, expected 0..4 list \u8bed\u6cd5: scrapy list \u9700\u8981\u9879\u76ee: yes \u5217\u51fa\u5f53\u524d\u9879\u76ee\u4e2d\u6240\u6709\u53ef\u7528\u7684spider\u3002 \u4f8b\u5b50: $ scrapy list spider1 spider2 edit \u8bed\u6cd5: scrapy edit spider \u9700\u8981\u9879\u76ee: \u662f \u7528\u547d\u4ee4\u884c\u7f16\u8f91Spider, \u6ca1\u5375\u7528 fetch \u8bed\u6cd5: scrapy fetch url \u9700\u8981\u9879\u76ee: no \u4f7f\u7528Scrapy\u4e0b\u8f7dURL\u5e76\u5c06\u5185\u5bb9\u8f93\u51fa\u3002 \u8fd9\u4e2a\u547d\u4ee4\u7684\u6709\u8da3\u4e4b\u5904\u5728\u4e8e\uff0c\u5b83\u83b7\u53d6\u4e86\u722c\u884c\u5668\u5c06\u5982\u4f55\u4e0b\u8f7d\u5b83\u7684\u9875\u9762\u7684\u8fc7\u7a0b\u3002\u4f8b\u5982\uff0c\u5982\u679cSpider\u5177\u6709\u8986\u76d6\u7528\u6237\u4ee3\u7406\u7684 USER_AGENT \u5c5e\u6027\uff0c\u5b83\u5c06\u4f7f\u7528\u8be5\u5c5e\u6027\u3002 \u56e0\u6b64\uff0c\u8fd9\u4e2a\u547d\u4ee4\u53ef\u4ee5\u7528\u6765\u201c\u67e5\u770b\u201d\u60a8\u7684\u722c\u884c\u5668\u5c06\u5982\u4f55\u83b7\u53d6\u67d0\u4e2a\u9875\u9762\u3002 \u5982\u679c\u5728\u9879\u76ee\u4e4b\u5916\u4f7f\u7528\uff0c\u5219\u4e0d\u4f1a\u5e94\u7528\u6bcf\u4e2a\u722c\u884c\u5668\u7684\u7279\u5b9a\u884c\u4e3a\uff0c\u5b83\u5c06\u53ea\u4f7f\u7528\u9ed8\u8ba4\u7684Scrapy\u4e0b\u8f7d\u5668\u8bbe\u7f6e\u3002 \u652f\u6301\u9009\u9879: --spider=SPIDER : \u7ed5\u8fc7Spider\u81ea\u52a8\u68c0\u6d4b\u5e76\u4e14\u5f3a\u5236\u4f7f\u7528\u7279\u5b9a\u7684Spider --headers : \u6253\u5370Response\u7684HTTP\u8bf7\u6c42\u5934\uff0c\u800c\u4e0d\u662fResponse\u7684\u4e3b\u4f53 --no-redirect : \u4e0d\u8981\u9075\u5faaHTTP 3xx\u91cd\u5b9a\u5411(\u9ed8\u8ba4\u662f\u9075\u5faa\u5b83\u4eec) \u4f8b\u5b50: $ scrapy fetch --nolog http://www.example.com/some/page.html [ ... html content here ... ] $ scrapy fetch --nolog --headers http://www.example.com/ {'Accept-Ranges': ['bytes'], 'Age': ['1263 '], 'Connection': ['close '], 'Content-Length': ['596'], 'Content-Type': ['text/html; charset=UTF-8'], 'Date': ['Wed, 18 Aug 2010 23:59:46 GMT'], 'Etag': [' 573c1-254-48c9c87349680 '], 'Last-Modified': ['Fri, 30 Jul 2010 15:30:18 GMT'], 'Server': ['Apache/2.2.3 (CentOS)']} view \u8bed\u6cd5: scrapy view url \u9700\u8981\u9879\u76ee: no \u5728\u6d4f\u89c8\u5668\u4e2d\u6253\u5f00\u7ed9\u5b9a\u7684URL\uff0c\u56e0\u4e3aScrapy spider\u4f1a\u201c\u770b\u5230\u201d\u5b83\u3002\u6709\u65f6\u5019\u722c\u884c\u5668\u770b\u5230\u7684\u9875\u9762\u4e0e\u666e\u901a\u7528\u6237\u4e0d\u540c\uff0c\u56e0\u6b64\u8fd9\u53ef\u4ee5\u7528\u6765\u68c0\u67e5\u722c\u884c\u5668\u201c\u770b\u5230\u201d\u4ec0\u4e48\uff0c\u5e76\u786e\u8ba4\u5b83\u662f\u60a8\u6240\u671f\u671b\u7684\u3002 \u652f\u6301\u9009\u9879: --spider=SPIDER : \u7ed5\u8fc7Spider\u81ea\u52a8\u68c0\u6d4b\u5e76\u4e14\u5f3a\u5236\u4f7f\u7528\u7279\u5b9a\u7684Spider --no-redirect : \u4e0d\u8981\u9075\u5faaHTTP 3xx\u91cd\u5b9a\u5411(\u9ed8\u8ba4\u662f\u9075\u5faa\u5b83\u4eec) \u4f8b\u5b50: $ scrapy view http://www.example.com/some/page.html [ ... browser starts ... ] shell \u8bed\u6cd5: scrapy shell [url] \u9700\u8981\u9879\u76ee: no \u542f\u52a8Scrapy shell\u5982\u679c\u7ed9\u5b9aURL(\u5982\u679c\u7ed9\u5b9a\u7684\u8bdd)\uff0c\u5982\u679c\u6ca1\u6709\u63d0\u4f9bURL\u5219\u4e3a\u7a7a\u3002\u8fd8\u652f\u6301unix\u98ce\u683c\u7684\u672c\u5730\u6587\u4ef6\u8def\u5f84\uff0c\u53ef\u4ee5\u662f ./ \u6216 ../ \u524d\u7f00\u6216\u7edd\u5bf9\u6587\u4ef6\u8def\u5f84\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Scrapy shell \u3002 \u652f\u6301\u9009\u9879: --spider=SPIDER : \u7ed5\u8fc7Spider\u81ea\u52a8\u68c0\u6d4b\u5e76\u4e14\u5f3a\u5236\u4f7f\u7528\u7279\u5b9a\u7684Spider -c code : \u8ba1\u7b97shell\u4e2d\u7684\u4ee3\u7801\uff0c\u6253\u5370\u7ed3\u679c\u5e76\u9000\u51fa --no-redirect : \u4e0d\u8981\u9075\u5faaHTTP 3xx\u91cd\u5b9a\u5411(\u9ed8\u8ba4\u662f\u9075\u5faa\u5b83\u4eec);\u8fd9\u53ea\u4f1a\u5f71\u54cd\u60a8\u5728\u547d\u4ee4\u884c\u4e2d\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7684URL;\u4e00\u65e6\u8fdb\u5165shell, fetch(url) \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4ecd\u7136\u9075\u5faaHTTP\u91cd\u5b9a\u5411\u3002 \u4f8b\u5b50: $ scrapy shell http://www.example.com/some/page.html [ ... scrapy shell starts ... ] $ scrapy shell --nolog http://www.example.com/ -c '(response.status, response.url)' (200, 'http://www.example.com/') # shell follows HTTP redirects by default $ scrapy shell --nolog http://httpbin.org/redirect-to?url=http%3A%2F%2Fexample.com%2F -c '(response.status, response.url)' (200, 'http://example.com/') # you can disable this with --no-redirect # (only for the URL passed as command line argument) $ scrapy shell --no-redirect --nolog http://httpbin.org/redirect-to?url=http%3A%2F%2Fexample.com%2F -c '(response.status, response.url)' (302, 'http://httpbin.org/redirect-to?url=http%3A%2F%2Fexample.com%2F') parse \u8bed\u6cd5: scrapy parse url [options] \u9700\u8981\u9879\u76ee: yes \u4f7f\u7528\u722c\u866b\u83b7\u53d6\u7ed9\u5b9a\u7684URL\u5e76\u5904\u7406\u5b83\u89e3\u6790\u5b83\uff0c\u4f7f\u7528\u4f20\u9012\u7684\u65b9\u6cd5 --callback \u9009\u9879\uff0c\u6216\u8005 parse (\u5982\u679c\u6ca1\u6709\u7ed9\u51fa)\u3002 \u652f\u6301\u9009\u9879: --spider=SPIDER : \u7ed5\u8fc7Spider\u81ea\u52a8\u68c0\u6d4b\u5e76\u4e14\u5f3a\u5236\u4f7f\u7528\u7279\u5b9a\u7684Spider --a NAME=VALUE : \u8bbe\u7f6e\u722c\u866b\u7684\u53c2\u6570(\u53ef\u91cd\u590d) --callback \u6216 -c : \u8981\u7528\u4f5c\u89e3\u6790response\u7684\u56de\u8c03\u7684spider\u65b9\u6cd5 --meta \u6216 -m : \u5c06\u4f20\u9012\u7ed9\u56de\u8c03\u8bf7\u6c42\u7684\u9644\u52a0\u8bf7\u6c42meta\u3002\u8fd9\u5fc5\u987b\u662f\u4e00\u4e2a\u6709\u6548\u7684json\u5b57\u7b26\u4e32\u3002\u4f8b\u5982: -meta= {\u201cfoo\u201d:\u201cbar\u201d} --pipelines : \u901a\u8fc7pipelines\u5904\u7406items --rules \u6216 -r : \u4f7f\u7528 CrawlSpider \u89c4\u5219\u53d1\u73b0\u7528\u4e8e\u89e3\u6790response\u7684\u56de\u8c03(\u5373spider\u65b9\u6cd5) --noitems : \u4e0d\u663e\u793a\u6293\u53d6\u7684items --nolinks : \u4e0d\u663e\u793a\u63d0\u53d6\u94fe\u63a5 --nocolour : \u907f\u514d\u4f7f\u7528pygments\u5bf9\u8f93\u51fa\u8fdb\u884c\u7740\u8272 --depth \u6216 -d : \u9012\u5f52\u6df1\u5ea6\u7ea7\u522b(\u9ed8\u8ba4:1) --verbose \u6216 -v : \u663e\u793a\u6bcf\u4e2a\u6df1\u5ea6\u7ea7\u522b\u7684\u4fe1\u606f \u4f8b\u5b50: $ scrapy parse http://www.example.com/ -c parse_item [ ... scrapy log lines crawling example.com spider ... ] STATUS DEPTH LEVEL 1 # Scraped Items ------------------------------------------------------------ [{'name': u'Example item', 'category': u'Furniture', 'length': u'12 cm'}] # Requests ----------------------------------------------------------------- [] settings \u8bed\u6cd5: scrapy settings [options] \u9700\u8981\u9879\u76ee: no \u83b7\u53d6Scrapy\u8bbe\u7f6e\u7684\u503c\u3002 \u5982\u679c\u5728\u9879\u76ee\u4e2d\u4f7f\u7528\uff0c\u5b83\u5c06\u663e\u793a\u9879\u76ee\u8bbe\u7f6e\u503c\uff0c\u5426\u5219\u5b83\u5c06\u663e\u793a\u8be5\u8bbe\u7f6e\u7684\u9ed8\u8ba4Scrapy\u503c\u3002 \u4f8b\u5b50: $ scrapy settings --get BOT_NAME scrapybot $ scrapy settings --get DOWNLOAD_DELAY 0 runspider \u8bed\u6cd5: scrapy runspider spider_file.py \u9700\u8981\u9879\u76ee: no \u5728Python\u6587\u4ef6\u4e2d\u8fd0\u884c\u81ea\u5305\u542b\u7684\u722c\u884c\u5668\uff0c\u800c\u65e0\u9700\u521b\u5efa\u9879\u76ee\u3002 \u4f8b\u5b50: $ scrapy runspider myspider.py [ ... spider starts crawling ... ] version \u8bed\u6cd5: scrapy version [-v] \u9700\u8981\u9879\u76ee: no \u6253\u5370Scrapy\u7248\u672c\u3002\u5982\u679c\u4e0e-v\u4e00\u8d77\u4f7f\u7528\uff0c\u5b83\u8fd8\u4f1a\u6253\u5370Python\u3001Twisted\u548c\u5e73\u53f0\u4fe1\u606f\uff0c\u8fd9\u5bf9\u4e8ebug\u62a5\u544a\u5f88\u6709\u7528\u3002 bench \u6700\u65b0\u7248\u672c 0.17 \u8bed\u6cd5: scrapy bench \u9700\u8981\u9879\u76ee: no \u8fd0\u884c\u4e00\u4e2a\u5feb\u901f\u7684\u57fa\u51c6\u6d4b\u8bd5. \u57fa\u51c6\u70b9 \u81ea\u5b9a\u4e49\u9879\u76ee\u7684\u547d\u4ee4 \u8fd8\u53ef\u4ee5\u4f7f\u7528 COMMANDS_MODULE \u8bbe\u7f6e\u6dfb\u52a0\u5b9a\u5236\u9879\u76ee\u547d\u4ee4\u3002\u6709\u5173\u5982\u4f55\u5b9e\u73b0\u547d\u4ee4\u7684\u793a\u4f8b\uff0c\u8bf7\u53c2\u9605 Scrapy/commands \u4e2d\u7684Scrapy\u547d\u4ee4\u3002 \u547d\u4ee4\u6a21\u5757 \u9ed8\u8ba4\u503c:\u201d(\u7a7a\u5b57\u7b26\u4e32) \u7528\u4e8e\u67e5\u627e\u81ea\u5b9a\u4e49Scrapy\u547d\u4ee4\u7684\u6a21\u5757\u3002\u8fd9\u7528\u4e8e\u4e3a\u60a8\u7684Scrapy\u9879\u76ee\u6dfb\u52a0\u81ea\u5b9a\u4e49\u547d\u4ee4\u3002 \u4f8b\u5b50: COMMANDS_MODULE = 'mybot.commands' \u901a\u8fc7setup.py\u5165\u53e3\u70b9\u6ce8\u518c\u547d\u4ee4 \u6ce8\u610f!!!! \u8fd9\u662f\u4e00\u4e2a\u5b9e\u9a8c\u6027\u7684\u7279\u6027\uff0c\u8bf7\u8c28\u614e\u4f7f\u7528\u3002 \u8fd8\u53ef\u4ee5\u4ece\u5916\u90e8\u5e93\u6dfb\u52a0Scrapy\u547d\u4ee4, \u901a\u8fc7\u5728 setpy.py \u6587\u4ef6, \u5728\u5e93\u8bbe\u7f6e\u7684\u5165\u53e3\u70b9\u4e2d\u6dfb\u52a0\u4e00\u4e2ascrap.commands \u4e0b\u9762\u7684\u4f8b\u5b50\u6dfb\u52a0\u4e86 my_command \u547d\u4ee4: from setuptools import setup, find_packages setup(name='scrapy-mymodule', entry_points={ 'scrapy.commands': [ 'my_command=my_scrapy_module.commands:MyCommand', ], }, )","title":"Command line tool(\u547d\u4ee4\u884c\u5de5\u5177)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/06-command_line_tool/#command-line-tool","text":"\u6700\u65b0\u7684\u7248\u672c\u662f0.10 Scrapy\u662f\u901a\u8fc7 scrapy \u547d\u4ee4\u884c\u5de5\u5177\u8fdb\u884c\u63a7\u5236\u7684\uff0c\u5728\u8fd9\u91cc\u88ab\u79f0\u4e3a\u201cScrapy\u5de5\u5177\u201d\uff0c\u4ee5\u4fbf\u5c06\u5176\u4e0e\u5b50\u547d\u4ee4\u533a\u5206\u5f00\u6765\uff0c\u5b50\u547d\u4ee4\u6211\u4eec\u79f0\u4e3a\u201c\u547d\u4ee4\u201d\u6216\u201cScrapy\u547d\u4ee4\u201d\u3002 Scrapy\u5de5\u5177\u4e3a\u591a\u79cd\u76ee\u7684\u63d0\u4f9b\u4e86\u51e0\u4e2a\u547d\u4ee4\uff0c\u6bcf\u4e2a\u547d\u4ee4\u90fd\u63a5\u53d7\u4e00\u7ec4\u4e0d\u540c\u7684\u53c2\u6570\u548c\u9009\u9879\u3002 (\u57281.0\u7248\u4e2d\uff0c\u5df2\u5220\u9664\u4e86 scrapy deploy \u547d\u4ee4\uff0c\u652f\u6301\u72ec\u7acb\u7684 scrapdy -deploy \u3002\u53c2\u89c1 \u90e8\u7f72\u60a8\u7684\u9879\u76ee )\u3002","title":"Command line tool(\u547d\u4ee4\u884c\u5de5\u5177)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/06-command_line_tool/#_1","text":"Scrapy\u5c06\u5728\u6807\u51c6\u7684\u4f4d\u7f6e\u5185\u91c7\u7528 scrapy.cfg \u6587\u4ef6\u4e2d\u5bfb\u627e\u5185\u7f6e\u6837\u5f0f\u5e76\u67e5\u627e\u914d\u7f6e\u53c2\u6570: linux /etc/scrapy.cfg , ~/.config/scrapy.cfg , ( $XDG_CONFIG_HOME )\u548c ~/.scrapy.cfg ( $HOME )\u7b49\u5168\u5c40\u8bbe\u7f6e\u548c scrapy.cfg \u5728scrapy\u9879\u76ee\u7684\u6839\u76ee\u5f55\u4e2d(\u53c2\u89c1\u4e0b\u4e00\u8282)\u3002 \u8fd9\u4e9b\u6587\u4ef6\u4e2d\u7684\u8bbe\u7f6e\u6309\u7167\u5217\u51fa\u7684\u4f18\u5148\u7ea7\u987a\u5e8f\u5408\u5e76:\u7528\u6237\u5b9a\u4e49\u7684\u503c\u5177\u6709\u6bd4\u7cfb\u7edf\u8303\u56f4\u5185\u7684\u9ed8\u8ba4\u503c\u66f4\u9ad8\u7684\u4f18\u5148\u7ea7\uff0c\u5e76\u4e14\u5728\u5b9a\u4e49\u65f6\u9879\u76ee\u8303\u56f4\u5185\u7684\u8bbe\u7f6e\u5c06\u8986\u76d6\u6240\u6709\u5176\u4ed6\u8bbe\u7f6e\u3002 Scrapy\u8fd8\u4e86\u89e3\u5e76\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e9b\u73af\u5883\u53d8\u91cf\u8fdb\u884c\u914d\u7f6e\u3002\u76ee\u524d,\u8fd9\u4e9b\u5305\u62ec: SCRAPY_SETTINGS_MODULE (\u53c2\u89c1 \u6307\u5b9a\u7684\u8bbe\u7f6e ) SCRAPY_PROJECT SCRAPY_PYTHON_SHELL (\u53c2\u89c1 Scrapy shell ) \u9ed8\u8ba4\u7684Scrapy\u9879\u76ee\u7ed3\u6784 \u5728\u6df1\u5165\u7814\u7a76\u547d\u4ee4\u884c\u5de5\u5177\u53ca\u5176\u5b50\u547d\u4ee4\u4e4b\u524d\uff0c\u8ba9\u6211\u4eec\u5148\u4e86\u89e3\u4e00\u4e0bScrapy\u9879\u76ee\u7684\u76ee\u5f55\u7ed3\u6784\u3002 \u867d\u7136\u53ef\u4ee5\u4fee\u6539\uff0c\u4f46\u6240\u6709\u7684Scrapy\u9879\u76ee\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5177\u6709\u76f8\u540c\u7684\u6587\u4ef6\u7ed3\u6784\uff0c\u7c7b\u4f3c\u5982\u4e0b: scrapy.cfg myproject/ __init__.py items.py middlewares.py pipelines.py settings.py spiders/ __init__.py spider1.py spider2.py ... \u6709 scrapy.cfg \u6587\u4ef6\u7684\u6587\u4ef6\u5939\u88ab\u79f0\u4e3a\u9879\u76ee\u7684\u6839\u76ee\u5f55\u3002 \u8be5\u6587\u4ef6\u5305\u542b\u5b9a\u4e49\u9879\u76ee\u8bbe\u7f6e\u7684python\u6a21\u5757\u7684\u540d\u79f0\u3002\u8fd9\u91cc\u6709\u4e00\u4e2a\u4f8b\u5b50: [settings] default = myproject.settings","title":"\u914d\u7f6e\u8bbe\u7f6e"},{"location":"2. \u57fa\u672c\u6982\u5ff5/06-command_line_tool/#scrapy","text":"\u4f60\u53ef\u4ee5\u5728\u6ca1\u6709\u53c2\u6570\u7684\u60c5\u51b5\u4e0b\u8fd0\u884cScrapy\u5de5\u5177\uff0c\u5b83\u5c06\u6253\u5370\u4e00\u4e9b\u4f7f\u7528\u5e2e\u52a9\u548c\u53ef\u7528\u7684\u547d\u4ee4: Scrapy 1.5.1 - no active project Usage: scrapy command [options] [args] Available commands: bench Run quick benchmark test fetch Fetch a URL using the Scrapy downloader genspider Generate new spider using pre-defined templates runspider Run a self-contained spider (without creating a project) settings Get settings values shell Interactive scraping console startproject Create new project version Print Scrapy version view Open URL in browser, as seen by Scrapy [ more ] More commands available when run from project directory Use scrapy command -h to see more info about a command \u5982\u679c\u60a8\u5728\u4e00\u4e2aScrapy\u9879\u76ee\u4e2d, \u7b2c\u4e00\u884c\u5c06\u4f1a\u6253\u5370\u5f53\u524d\u6d3b\u52a8\u7684\u9879\u76ee\uff0c\u5728\u672c\u4f8b\u4e2d\uff0c\u5b83\u662f\u4ece\u9879\u76ee\u5916\u90e8\u8fd0\u884c\u7684\u3002\u5982\u679c\u4ece\u9879\u76ee\u5185\u90e8\u8fd0\u884c\uff0c\u5b83\u4f1a\u6253\u5370\u5982\u4e0b\u5185\u5bb9: Scrapy 1.5.1 - project: TalkingData Usage: scrapy command [options] [args] Available commands: bench Run quick benchmark test check Check spider contracts crawl Run a spider edit Edit spider fetch Fetch a URL using the Scrapy downloader genspider Generate new spider using pre-defined templates list List available spiders parse Parse URL (using its spider) and print the results runspider Run a self-contained spider (without creating a project) settings Get settings values shell Interactive scraping console startproject Create new project version Print Scrapy version view Open URL in browser, as seen by Scrapy Use scrapy command -h to see more info about a command","title":"\u4f7f\u7528scrapy\u5de5\u5177"},{"location":"2. \u57fa\u672c\u6982\u5ff5/06-command_line_tool/#_2","text":"\u901a\u5e38\u4f7f\u7528 scrapy \u5de5\u5177\u505a\u7684\u7b2c\u4e00\u4ef6\u4e8b\u662f\u521b\u5efa\u4e00\u4e2ascrapy\u9879\u76ee: scrapy startproject myproject [project_dir] \u8fd9\u5c06\u5728 project_dir \u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2aScrapy\u9879\u76ee\u3002\u5982\u679c\u6ca1\u6709\u6307\u5b9a project_dir , project_dir \u5c06\u4e0e myproject \u76f8\u540c\u3002 \u63a5\u4e0b\u6765\uff0c\u8fdb\u5165\u65b0\u7684\u9879\u76ee\u76ee\u5f55: cd project_dir \u73b0\u5728\u53ef\u4ee5\u4f7f\u7528 scrapy \u547d\u4ee4\u6765\u7ba1\u7406\u548c\u63a7\u5236\u9879\u76ee\u3002 \u4f8b\u5982\uff0c\u521b\u5efa\u4e00\u4e2a\u65b0\u7684Spider: scrapy genspider mydomain mydomain.com \u4e00\u4e9bScrapy\u547d\u4ee4(\u6bd4\u5982 crawl ])\u5fc5\u987b\u5728\u4e00\u4e2aScrapy\u9879\u76ee\u91cc\u8fd0\u884c\u3002\u5173\u4e8e\u54ea\u4e9b\u547d\u4ee4\u5fc5\u987b\u5728\u9879\u76ee\u5185\u90e8\u8fd0\u884c\uff0c\u54ea\u4e9b\u4e0d\u80fd\u8fd0\u884c\uff0c\u8bf7\u53c2\u9605\u4e0b\u9762\u7684 \u547d\u4ee4\u53c2\u8003 \u8d44\u6599\u3002 \u8fd8\u8981\u8bb0\u4f4f\uff0c\u5728\u4ece\u5185\u90e8\u9879\u76ee\u8fd0\u884c\u547d\u4ee4\u65f6\uff0c\u6709\u4e9b\u547d\u4ee4\u7684\u884c\u4e3a\u53ef\u80fd\u7565\u6709\u4e0d\u540c\u3002\u4f8b\u5982\uff0c\u5982\u679c\u83b7\u53d6\u7684url\u4e0e\u67d0\u4e2a\u7279\u5b9a\u7684\u722c\u866b\u76f8\u5173\u8054\uff0cfetch\u547d\u4ee4\u5c06\u4f7f\u7528spider\u8986\u76d6\u7684\u884c\u4e3a(\u4f8b\u5982 user_agent \u6765\u8986\u76d6\u7528\u6237\u4ee3\u7406)\u3002\u8fd9\u662f\u6709\u610f\u4e3a\u4e4b\u7684\uff0c\u56e0\u4e3a fetch \u547d\u4ee4\u7528\u4e8e\u68c0\u67e5\u722c\u866b\u5982\u4f55\u4e0b\u8f7d\u9875\u9762\u3002","title":"\u521b\u5efa\u9879\u76ee"},{"location":"2. \u57fa\u672c\u6982\u5ff5/06-command_line_tool/#_3","text":"\u672c\u8282\u5305\u542b\u53ef\u7528\u7684\u5185\u7f6e\u547d\u4ee4\u5217\u8868\u548c\u63cf\u8ff0\u4ee5\u53ca\u4e00\u4e9b\u4f7f\u7528\u793a\u4f8b\u3002\u8bb0\u4f4f\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u83b7\u5f97\u66f4\u591a\u4fe1\u606f: scrapy command -h \u4f60\u53ef\u4ee5\u770b\u5230\u6240\u6709\u53ef\u7528\u7684\u547d\u4ee4: scrapy -h \u6709\u4e24\u79cd\u547d\u4ee4\uff0c\u4e00\u79cd\u662f\u53ea\u5728Scrapy\u9879\u76ee\u5185\u5de5\u4f5c\u7684\u547d\u4ee4(\u7279\u5b9a\u4e8e\u9879\u76ee\u7684\u547d\u4ee4)\uff0c\u53e6\u4e00\u79cd\u662f\u5728\u6ca1\u6709\u6d3b\u52a8Scrapy\u9879\u76ee\u7684\u60c5\u51b5\u4e0b\u5de5\u4f5c\u7684\u547d\u4ee4(\u5168\u5c40\u547d\u4ee4)\uff0c\u5c3d\u7ba1\u5728\u4ece\u9879\u76ee\u5185\u8fd0\u884c\u65f6\u5b83\u4eec\u7684\u884c\u4e3a\u53ef\u80fd\u7565\u6709\u4e0d\u540c(\u56e0\u4e3a\u5b83\u4eec\u4f1a\u4f7f\u7528\u9879\u76ee\u8986\u76d6\u8bbe\u7f6e)\u3002 \u5168\u5c40\u547d\u4ee4 startproject genspider settings runspider shell fetch view version \u9879\u76ee\u547d\u4ee4 crawl check list edit parse bench","title":"\u53ef\u7528\u7684\u5de5\u5177\u547d\u4ee4"},{"location":"2. \u57fa\u672c\u6982\u5ff5/06-command_line_tool/#startproject","text":"\u8bed\u6cd5: scrapy startproject project_name [project_dir] \u9700\u8981\u9879\u76ee: no \u5728project_dir\u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a project_name \u7684\u65b0Scrapy\u9879\u76ee\u3002\u5982\u679c\u6ca1\u6709\u6307\u5b9a project_dir \uff0c\u90a3\u4e48 project_dir \u5c06\u4e0e project_name \u76f8\u540c\u3002 \u4f8b\u5b50: $ scrapy startproject myproject","title":"startproject"},{"location":"2. \u57fa\u672c\u6982\u5ff5/06-command_line_tool/#genspider","text":"\u8bed\u6cd5: scrapy genspider [-t template] name domain \u9700\u8981\u9879\u76ee: no \u5728\u5f53\u524d\u6587\u4ef6\u5939\u6216\u5f53\u524d\u9879\u76ee\u7684spider\u6587\u4ef6\u5939\u4e2d\u521b\u5efa\u4e00\u4e2a\u65b0\u7684spider\uff0c\u5982\u679c\u4ece\u9879\u76ee\u5185\u90e8\u8c03\u7528\u7684\u8bdd\u3002 name \u53c2\u6570\u8bbe\u7f6e\u4e3aspider\u7684 \u540d\u79f0 \uff0c\u800c domain \u7528\u4e8e\u751f\u6210 allowed_domains \u548c start_urls spider\u7684\u5c5e\u6027\u3002 \u4f8b\u5b50: $ scrapy genspider -l Available templates: basic crawl csvfeed xmlfeed $ scrapy genspider example example.com Created spider 'example' using template 'basic' $ scrapy genspider -t crawl scrapyorg scrapy.org Created spider 'scrapyorg' using template 'crawl' \u8fd9\u53ea\u662f\u4e00\u4e2a\u57fa\u4e8e\u9884\u5b9a\u4e49\u6a21\u677f\u521b\u5efa\u722c\u884c\u5668\u7684\u65b9\u4fbf\u5feb\u6377\u547d\u4ee4\uff0c\u4f46\u80af\u5b9a\u4e0d\u662f\u521b\u5efa\u722c\u884c\u5668\u7684\u552f\u4e00\u65b9\u6cd5\u3002\u60a8\u53ef\u4ee5\u81ea\u5df1\u521b\u5efaspider\u6e90\u4ee3\u7801\u6587\u4ef6\uff0c\u800c\u4e0d\u662f\u4f7f\u7528\u8fd9\u4e2a\u547d\u4ee4\u3002","title":"genspider"},{"location":"2. \u57fa\u672c\u6982\u5ff5/06-command_line_tool/#crawl","text":"\u8bed\u6cd5: scrapy crawl spider \u9700\u8981\u9879\u76ee: yes \u5f00\u59cb\u7528\u722c\u866b\u6293\u53d6 \u4f8b\u5b50: $ scrapy crawl myspider [ ... myspider starts crawling ... ]","title":"crawl"},{"location":"2. \u57fa\u672c\u6982\u5ff5/06-command_line_tool/#check","text":"\u8bed\u6cd5: scrapy check [-l] spider \u9700\u8981\u9879\u76ee: yes \u68c0\u67e5\u9879\u76ee\u6709\u6ca1\u6709\u9519\u8bef \u4f8b\u5b50: $ scrapy check -l first_spider * parse * parse_item second_spider * parse * parse_item $ scrapy check [FAILED] first_spider:parse_item 'RetailPricex' field is missing [FAILED] first_spider:parse Returned 92 requests, expected 0..4","title":"check"},{"location":"2. \u57fa\u672c\u6982\u5ff5/06-command_line_tool/#list","text":"\u8bed\u6cd5: scrapy list \u9700\u8981\u9879\u76ee: yes \u5217\u51fa\u5f53\u524d\u9879\u76ee\u4e2d\u6240\u6709\u53ef\u7528\u7684spider\u3002 \u4f8b\u5b50: $ scrapy list spider1 spider2","title":"list"},{"location":"2. \u57fa\u672c\u6982\u5ff5/06-command_line_tool/#edit","text":"\u8bed\u6cd5: scrapy edit spider \u9700\u8981\u9879\u76ee: \u662f \u7528\u547d\u4ee4\u884c\u7f16\u8f91Spider, \u6ca1\u5375\u7528","title":"edit"},{"location":"2. \u57fa\u672c\u6982\u5ff5/06-command_line_tool/#fetch","text":"\u8bed\u6cd5: scrapy fetch url \u9700\u8981\u9879\u76ee: no \u4f7f\u7528Scrapy\u4e0b\u8f7dURL\u5e76\u5c06\u5185\u5bb9\u8f93\u51fa\u3002 \u8fd9\u4e2a\u547d\u4ee4\u7684\u6709\u8da3\u4e4b\u5904\u5728\u4e8e\uff0c\u5b83\u83b7\u53d6\u4e86\u722c\u884c\u5668\u5c06\u5982\u4f55\u4e0b\u8f7d\u5b83\u7684\u9875\u9762\u7684\u8fc7\u7a0b\u3002\u4f8b\u5982\uff0c\u5982\u679cSpider\u5177\u6709\u8986\u76d6\u7528\u6237\u4ee3\u7406\u7684 USER_AGENT \u5c5e\u6027\uff0c\u5b83\u5c06\u4f7f\u7528\u8be5\u5c5e\u6027\u3002 \u56e0\u6b64\uff0c\u8fd9\u4e2a\u547d\u4ee4\u53ef\u4ee5\u7528\u6765\u201c\u67e5\u770b\u201d\u60a8\u7684\u722c\u884c\u5668\u5c06\u5982\u4f55\u83b7\u53d6\u67d0\u4e2a\u9875\u9762\u3002 \u5982\u679c\u5728\u9879\u76ee\u4e4b\u5916\u4f7f\u7528\uff0c\u5219\u4e0d\u4f1a\u5e94\u7528\u6bcf\u4e2a\u722c\u884c\u5668\u7684\u7279\u5b9a\u884c\u4e3a\uff0c\u5b83\u5c06\u53ea\u4f7f\u7528\u9ed8\u8ba4\u7684Scrapy\u4e0b\u8f7d\u5668\u8bbe\u7f6e\u3002 \u652f\u6301\u9009\u9879: --spider=SPIDER : \u7ed5\u8fc7Spider\u81ea\u52a8\u68c0\u6d4b\u5e76\u4e14\u5f3a\u5236\u4f7f\u7528\u7279\u5b9a\u7684Spider --headers : \u6253\u5370Response\u7684HTTP\u8bf7\u6c42\u5934\uff0c\u800c\u4e0d\u662fResponse\u7684\u4e3b\u4f53 --no-redirect : \u4e0d\u8981\u9075\u5faaHTTP 3xx\u91cd\u5b9a\u5411(\u9ed8\u8ba4\u662f\u9075\u5faa\u5b83\u4eec) \u4f8b\u5b50: $ scrapy fetch --nolog http://www.example.com/some/page.html [ ... html content here ... ] $ scrapy fetch --nolog --headers http://www.example.com/ {'Accept-Ranges': ['bytes'], 'Age': ['1263 '], 'Connection': ['close '], 'Content-Length': ['596'], 'Content-Type': ['text/html; charset=UTF-8'], 'Date': ['Wed, 18 Aug 2010 23:59:46 GMT'], 'Etag': [' 573c1-254-48c9c87349680 '], 'Last-Modified': ['Fri, 30 Jul 2010 15:30:18 GMT'], 'Server': ['Apache/2.2.3 (CentOS)']}","title":"fetch"},{"location":"2. \u57fa\u672c\u6982\u5ff5/06-command_line_tool/#view","text":"\u8bed\u6cd5: scrapy view url \u9700\u8981\u9879\u76ee: no \u5728\u6d4f\u89c8\u5668\u4e2d\u6253\u5f00\u7ed9\u5b9a\u7684URL\uff0c\u56e0\u4e3aScrapy spider\u4f1a\u201c\u770b\u5230\u201d\u5b83\u3002\u6709\u65f6\u5019\u722c\u884c\u5668\u770b\u5230\u7684\u9875\u9762\u4e0e\u666e\u901a\u7528\u6237\u4e0d\u540c\uff0c\u56e0\u6b64\u8fd9\u53ef\u4ee5\u7528\u6765\u68c0\u67e5\u722c\u884c\u5668\u201c\u770b\u5230\u201d\u4ec0\u4e48\uff0c\u5e76\u786e\u8ba4\u5b83\u662f\u60a8\u6240\u671f\u671b\u7684\u3002 \u652f\u6301\u9009\u9879: --spider=SPIDER : \u7ed5\u8fc7Spider\u81ea\u52a8\u68c0\u6d4b\u5e76\u4e14\u5f3a\u5236\u4f7f\u7528\u7279\u5b9a\u7684Spider --no-redirect : \u4e0d\u8981\u9075\u5faaHTTP 3xx\u91cd\u5b9a\u5411(\u9ed8\u8ba4\u662f\u9075\u5faa\u5b83\u4eec) \u4f8b\u5b50: $ scrapy view http://www.example.com/some/page.html [ ... browser starts ... ]","title":"view"},{"location":"2. \u57fa\u672c\u6982\u5ff5/06-command_line_tool/#shell","text":"\u8bed\u6cd5: scrapy shell [url] \u9700\u8981\u9879\u76ee: no \u542f\u52a8Scrapy shell\u5982\u679c\u7ed9\u5b9aURL(\u5982\u679c\u7ed9\u5b9a\u7684\u8bdd)\uff0c\u5982\u679c\u6ca1\u6709\u63d0\u4f9bURL\u5219\u4e3a\u7a7a\u3002\u8fd8\u652f\u6301unix\u98ce\u683c\u7684\u672c\u5730\u6587\u4ef6\u8def\u5f84\uff0c\u53ef\u4ee5\u662f ./ \u6216 ../ \u524d\u7f00\u6216\u7edd\u5bf9\u6587\u4ef6\u8def\u5f84\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Scrapy shell \u3002 \u652f\u6301\u9009\u9879: --spider=SPIDER : \u7ed5\u8fc7Spider\u81ea\u52a8\u68c0\u6d4b\u5e76\u4e14\u5f3a\u5236\u4f7f\u7528\u7279\u5b9a\u7684Spider -c code : \u8ba1\u7b97shell\u4e2d\u7684\u4ee3\u7801\uff0c\u6253\u5370\u7ed3\u679c\u5e76\u9000\u51fa --no-redirect : \u4e0d\u8981\u9075\u5faaHTTP 3xx\u91cd\u5b9a\u5411(\u9ed8\u8ba4\u662f\u9075\u5faa\u5b83\u4eec);\u8fd9\u53ea\u4f1a\u5f71\u54cd\u60a8\u5728\u547d\u4ee4\u884c\u4e2d\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7684URL;\u4e00\u65e6\u8fdb\u5165shell, fetch(url) \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4ecd\u7136\u9075\u5faaHTTP\u91cd\u5b9a\u5411\u3002 \u4f8b\u5b50: $ scrapy shell http://www.example.com/some/page.html [ ... scrapy shell starts ... ] $ scrapy shell --nolog http://www.example.com/ -c '(response.status, response.url)' (200, 'http://www.example.com/') # shell follows HTTP redirects by default $ scrapy shell --nolog http://httpbin.org/redirect-to?url=http%3A%2F%2Fexample.com%2F -c '(response.status, response.url)' (200, 'http://example.com/') # you can disable this with --no-redirect # (only for the URL passed as command line argument) $ scrapy shell --no-redirect --nolog http://httpbin.org/redirect-to?url=http%3A%2F%2Fexample.com%2F -c '(response.status, response.url)' (302, 'http://httpbin.org/redirect-to?url=http%3A%2F%2Fexample.com%2F')","title":"shell"},{"location":"2. \u57fa\u672c\u6982\u5ff5/06-command_line_tool/#parse","text":"\u8bed\u6cd5: scrapy parse url [options] \u9700\u8981\u9879\u76ee: yes \u4f7f\u7528\u722c\u866b\u83b7\u53d6\u7ed9\u5b9a\u7684URL\u5e76\u5904\u7406\u5b83\u89e3\u6790\u5b83\uff0c\u4f7f\u7528\u4f20\u9012\u7684\u65b9\u6cd5 --callback \u9009\u9879\uff0c\u6216\u8005 parse (\u5982\u679c\u6ca1\u6709\u7ed9\u51fa)\u3002 \u652f\u6301\u9009\u9879: --spider=SPIDER : \u7ed5\u8fc7Spider\u81ea\u52a8\u68c0\u6d4b\u5e76\u4e14\u5f3a\u5236\u4f7f\u7528\u7279\u5b9a\u7684Spider --a NAME=VALUE : \u8bbe\u7f6e\u722c\u866b\u7684\u53c2\u6570(\u53ef\u91cd\u590d) --callback \u6216 -c : \u8981\u7528\u4f5c\u89e3\u6790response\u7684\u56de\u8c03\u7684spider\u65b9\u6cd5 --meta \u6216 -m : \u5c06\u4f20\u9012\u7ed9\u56de\u8c03\u8bf7\u6c42\u7684\u9644\u52a0\u8bf7\u6c42meta\u3002\u8fd9\u5fc5\u987b\u662f\u4e00\u4e2a\u6709\u6548\u7684json\u5b57\u7b26\u4e32\u3002\u4f8b\u5982: -meta= {\u201cfoo\u201d:\u201cbar\u201d} --pipelines : \u901a\u8fc7pipelines\u5904\u7406items --rules \u6216 -r : \u4f7f\u7528 CrawlSpider \u89c4\u5219\u53d1\u73b0\u7528\u4e8e\u89e3\u6790response\u7684\u56de\u8c03(\u5373spider\u65b9\u6cd5) --noitems : \u4e0d\u663e\u793a\u6293\u53d6\u7684items --nolinks : \u4e0d\u663e\u793a\u63d0\u53d6\u94fe\u63a5 --nocolour : \u907f\u514d\u4f7f\u7528pygments\u5bf9\u8f93\u51fa\u8fdb\u884c\u7740\u8272 --depth \u6216 -d : \u9012\u5f52\u6df1\u5ea6\u7ea7\u522b(\u9ed8\u8ba4:1) --verbose \u6216 -v : \u663e\u793a\u6bcf\u4e2a\u6df1\u5ea6\u7ea7\u522b\u7684\u4fe1\u606f \u4f8b\u5b50: $ scrapy parse http://www.example.com/ -c parse_item [ ... scrapy log lines crawling example.com spider ... ] STATUS DEPTH LEVEL 1 # Scraped Items ------------------------------------------------------------ [{'name': u'Example item', 'category': u'Furniture', 'length': u'12 cm'}] # Requests ----------------------------------------------------------------- []","title":"parse"},{"location":"2. \u57fa\u672c\u6982\u5ff5/06-command_line_tool/#settings","text":"\u8bed\u6cd5: scrapy settings [options] \u9700\u8981\u9879\u76ee: no \u83b7\u53d6Scrapy\u8bbe\u7f6e\u7684\u503c\u3002 \u5982\u679c\u5728\u9879\u76ee\u4e2d\u4f7f\u7528\uff0c\u5b83\u5c06\u663e\u793a\u9879\u76ee\u8bbe\u7f6e\u503c\uff0c\u5426\u5219\u5b83\u5c06\u663e\u793a\u8be5\u8bbe\u7f6e\u7684\u9ed8\u8ba4Scrapy\u503c\u3002 \u4f8b\u5b50: $ scrapy settings --get BOT_NAME scrapybot $ scrapy settings --get DOWNLOAD_DELAY 0","title":"settings"},{"location":"2. \u57fa\u672c\u6982\u5ff5/06-command_line_tool/#runspider","text":"\u8bed\u6cd5: scrapy runspider spider_file.py \u9700\u8981\u9879\u76ee: no \u5728Python\u6587\u4ef6\u4e2d\u8fd0\u884c\u81ea\u5305\u542b\u7684\u722c\u884c\u5668\uff0c\u800c\u65e0\u9700\u521b\u5efa\u9879\u76ee\u3002 \u4f8b\u5b50: $ scrapy runspider myspider.py [ ... spider starts crawling ... ]","title":"runspider"},{"location":"2. \u57fa\u672c\u6982\u5ff5/06-command_line_tool/#version","text":"\u8bed\u6cd5: scrapy version [-v] \u9700\u8981\u9879\u76ee: no \u6253\u5370Scrapy\u7248\u672c\u3002\u5982\u679c\u4e0e-v\u4e00\u8d77\u4f7f\u7528\uff0c\u5b83\u8fd8\u4f1a\u6253\u5370Python\u3001Twisted\u548c\u5e73\u53f0\u4fe1\u606f\uff0c\u8fd9\u5bf9\u4e8ebug\u62a5\u544a\u5f88\u6709\u7528\u3002","title":"version"},{"location":"2. \u57fa\u672c\u6982\u5ff5/06-command_line_tool/#bench","text":"\u6700\u65b0\u7248\u672c 0.17 \u8bed\u6cd5: scrapy bench \u9700\u8981\u9879\u76ee: no \u8fd0\u884c\u4e00\u4e2a\u5feb\u901f\u7684\u57fa\u51c6\u6d4b\u8bd5. \u57fa\u51c6\u70b9","title":"bench"},{"location":"2. \u57fa\u672c\u6982\u5ff5/06-command_line_tool/#_4","text":"\u8fd8\u53ef\u4ee5\u4f7f\u7528 COMMANDS_MODULE \u8bbe\u7f6e\u6dfb\u52a0\u5b9a\u5236\u9879\u76ee\u547d\u4ee4\u3002\u6709\u5173\u5982\u4f55\u5b9e\u73b0\u547d\u4ee4\u7684\u793a\u4f8b\uff0c\u8bf7\u53c2\u9605 Scrapy/commands \u4e2d\u7684Scrapy\u547d\u4ee4\u3002","title":"\u81ea\u5b9a\u4e49\u9879\u76ee\u7684\u547d\u4ee4"},{"location":"2. \u57fa\u672c\u6982\u5ff5/06-command_line_tool/#_5","text":"\u9ed8\u8ba4\u503c:\u201d(\u7a7a\u5b57\u7b26\u4e32) \u7528\u4e8e\u67e5\u627e\u81ea\u5b9a\u4e49Scrapy\u547d\u4ee4\u7684\u6a21\u5757\u3002\u8fd9\u7528\u4e8e\u4e3a\u60a8\u7684Scrapy\u9879\u76ee\u6dfb\u52a0\u81ea\u5b9a\u4e49\u547d\u4ee4\u3002 \u4f8b\u5b50: COMMANDS_MODULE = 'mybot.commands'","title":"\u547d\u4ee4\u6a21\u5757"},{"location":"2. \u57fa\u672c\u6982\u5ff5/06-command_line_tool/#setuppy","text":"\u6ce8\u610f!!!! \u8fd9\u662f\u4e00\u4e2a\u5b9e\u9a8c\u6027\u7684\u7279\u6027\uff0c\u8bf7\u8c28\u614e\u4f7f\u7528\u3002 \u8fd8\u53ef\u4ee5\u4ece\u5916\u90e8\u5e93\u6dfb\u52a0Scrapy\u547d\u4ee4, \u901a\u8fc7\u5728 setpy.py \u6587\u4ef6, \u5728\u5e93\u8bbe\u7f6e\u7684\u5165\u53e3\u70b9\u4e2d\u6dfb\u52a0\u4e00\u4e2ascrap.commands \u4e0b\u9762\u7684\u4f8b\u5b50\u6dfb\u52a0\u4e86 my_command \u547d\u4ee4: from setuptools import setup, find_packages setup(name='scrapy-mymodule', entry_points={ 'scrapy.commands': [ 'my_command=my_scrapy_module.commands:MyCommand', ], }, )","title":"\u901a\u8fc7setup.py\u5165\u53e3\u70b9\u6ce8\u518c\u547d\u4ee4"},{"location":"2. \u57fa\u672c\u6982\u5ff5/07-spiders/","text":"Spiders(\u81ea\u5b9a\u4e49\u722c\u866b\u7c7b) spider\u662f\u5b9a\u4e49\u5982\u4f55\u6293\u53d6\u67d0\u4e2a\u7ad9\u70b9(\u6216\u4e00\u7ec4\u7ad9\u70b9)\u7684\u7c7b\uff0c\u5305\u62ec\u5982\u4f55\u6267\u884c\u6293\u53d6(\u5373\u8ddf\u8e2a\u94fe\u63a5)\u4ee5\u53ca\u5982\u4f55\u4ece\u9875\u9762\u4e2d\u63d0\u53d6\u7ed3\u6784\u5316\u6570\u636e(\u5373\u6293\u53d6items)\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u722c\u866b\u662f\u60a8\u4e3a\u67d0\u4e2a\u7279\u5b9a\u7ad9\u70b9(\u6216\u8005\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u662f\u4e00\u7ec4\u7ad9\u70b9)\u7684\u9875\u9762\u6293\u53d6\u548c\u89e3\u6790\u5b9a\u4e49\u5b9a\u5236\u884c\u4e3a\u7684\u5730\u65b9\u3002 \u5bf9\u4e8espiders\u6765\u8bf4\uff0c\u6293\u53d6\u5468\u671f\u662f\u8fd9\u6837\u7684: \u9996\u5148\u751f\u6210\u521d\u59cb\u8bf7\u6c42\u6765\u6293\u53d6\u7b2c\u4e00\u4e2aurl\uff0c\u5e76\u6307\u5b9a\u8981\u4f7f\u7528\u4ece\u8fd9\u4e9brequests\u4e0b\u8f7d\u7684response\u8c03\u7528\u7684\u56de\u8c03\u51fd\u6570\u3002 \u8981\u6267\u884c\u7684\u7b2c\u4e00\u4e2a\u8bf7\u6c42\u662f\u901a\u8fc7\u8c03\u7528 start_requests() \u65b9\u6cd5\u83b7\u5f97\u7684\uff0c\u8fd9\u4e2a\u65b9\u6cd5(\u9ed8\u8ba4\u60c5\u51b5\u4e0b)\u4e3a start_urls \u4e2d\u6307\u5b9a\u7684url\u751f\u6210 requests \uff0c\u800c parse \u65b9\u6cd5\u4f5c\u4e3arequests\u7684\u56de\u8c03\u51fd\u6570\u3002 \u5728\u56de\u8c03\u51fd\u6570\u4e2d\uff0c\u89e3\u6790response(web\u9875\u9762)\u5e76\u4f7f\u7528\u63d0\u53d6\u7684\u6570\u636e\u3001 Item \u5bf9\u8c61\u3001 Requests \u5bf9\u8c61\u6216\u8fd9\u4e9b\u5bf9\u8c61\u7684\u8fed\u4ee3\u8fd4\u56dedicts\u3002\u8fd9\u4e9bRequests\u8fd8\u5c06\u5305\u542b\u4e00\u4e2a\u56de\u8c03(\u53ef\u80fd\u76f8\u540c)\uff0c\u7136\u540e\u7531Scrapy\u4e0b\u8f7d\uff0c\u7136\u540e\u7531\u6307\u5b9a\u7684\u56de\u8c03\u5904\u7406\u5b83\u4eec\u7684response\u3002 \u5728\u56de\u8c03\u51fd\u6570\u4e2d\uff0c\u60a8\u53ef\u4ee5\u89e3\u6790\u9875\u9762\u5185\u5bb9\uff0c\u901a\u5e38\u4f7f\u7528 \u9009\u62e9\u5668 (\u4f46\u4e5f\u53ef\u4ee5\u4f7f\u7528BeautifulSoup\u3001lxml\u6216\u4efb\u4f55\u60a8\u559c\u6b22\u7684\u673a\u5236)\uff0c\u5e76\u4f7f\u7528\u89e3\u6790\u540e\u7684\u6570\u636e\u751f\u6210items\u3002 \u6700\u540e\uff0c\u4ecespider\u8fd4\u56de\u7684items\u901a\u5e38\u4f1a\u6301\u4e45\u5316\u5230\u6570\u636e\u5e93(\u5728\u67d0\u4e2aItem Pipeline\u4e2d)\uff0c\u6216\u8005\u5199\u5165\u6587\u4ef6\u4f7f\u7528 Feed exports \u5c3d\u7ba1\u8fd9\u4e2a\u5468\u671f\u9002\u7528\u4e8e(\u6216\u591a\u6216\u5c11)\u4efb\u4f55\u7c7b\u578b\u7684\u722c\u866b\uff0c\u4f46\u662f\u4e3a\u4e86\u4e0d\u540c\u7684\u76ee\u7684\u5c06\u4e0d\u540c\u7c7b\u578b\u7684\u9ed8\u8ba4spider\u6253\u5305\u5230Scrapy\u4e2d\u3002\u6211\u4eec\u5c06\u5728\u8fd9\u91cc\u8ba8\u8bba\u8fd9\u4e9b\u7c7b\u578b\u3002 scrapy.Spider scrapy.spiders.Spider \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) \u8fd9\u662f\u6700\u7b80\u5355\u7684spider\uff0c\u4e5f\u662f\u6240\u6709\u5176\u4ed6spider\u90fd\u5fc5\u987b\u7ee7\u627f\u7684spider(\u5305\u62ec\u4e0eScrapy\u6346\u7ed1\u5728\u4e00\u8d77\u7684spider\uff0c\u4ee5\u53ca\u4f60\u81ea\u5df1\u7f16\u5199\u7684spider)\u3002\u5b83\u4e0d\u63d0\u4f9b\u4efb\u4f55\u7279\u6b8a\u7684\u529f\u80fd\u3002\u5b83\u53ea\u63d0\u4f9b\u4e86\u4e00\u4e2a\u9ed8\u8ba4\u7684start_requests()\u5b9e\u73b0\u65b9\u6cd5\uff0c\u5b83\u4ecespider\u5c5e\u6027\u91cc\u7684 start_urls \u53d1\u51fa\u8bf7\u6c42\uff0c\u5e76\u4e3a\u6bcf\u4e2a\u5f97\u5230\u7684responses\u8c03\u7528spider parse \u65b9\u6cd5\u3002 name \u5b9a\u4e49\u6b64\u722c\u866b\u540d\u79f0\u7684\u5b57\u7b26\u4e32\u3002spider\u540d\u79f0\u662f\u7531Scrapy\u5b9a\u4f4d(\u5e76\u5b9e\u4f8b\u5316)\u7684\u65b9\u5f0f\uff0c\u56e0\u6b64\u5b83\u5fc5\u987b\u662f\u60df\u4e00\u7684\u3002\u4f46\u662f\uff0c\u6ca1\u6709\u4ec0\u4e48\u53ef\u4ee5\u963b\u6b62\u60a8\u5b9e\u4f8b\u5316\u540c\u4e00\u4e2a\u722c\u884c\u5668\u7684\u591a\u4e2a\u5b9e\u4f8b\u3002\u8fd9\u662f\u6700\u91cd\u8981\u7684spider\u5c5e\u6027\uff0c\u4e5f\u662f\u5fc5\u9700\u7684\u3002 \u5982\u679cspider\u6293\u53d6\u4e86\u4e00\u4e2a\u57df\u540d\uff0c\u901a\u5e38\u7684\u505a\u6cd5\u662f\u7528\u57df\u540d\u6765\u547d\u540d\u722c\u866b\uff0c\u4e0d\u7ba1\u6709\u6ca1\u6709 TLD(\u9876\u7ea7\u57df\u540d) \u3002\u4f8b\u5982\uff0c\u6293\u53d6 mywebsite.com \u7684spider\u901a\u5e38\u88ab\u79f0\u4e3a mywebsite \u3002 \u6ce8\u610f!!!!!! \u5728python2\u91cc\uff0c\u5fc5\u987b\u662fASCII\u7801\u3002 allowed_domains \u4e00\u4e2a\u53ef\u9009\u7684\u5b57\u7b26\u4e32\u5217\u8868\uff0c\u5176\u4e2d\u5305\u542b\u5141\u8bb8\u6b64spider\u6293\u53d6\u7684\u57df\u540d\u3002\u5982\u679c\u542f\u7528\u4e86 OffsiteMiddleware \uff0c\u5c06\u4e0d\u4f1a\u8ddf\u8e2a\u4e0d\u5c5e\u4e8e\u672c\u5217\u8868\u4e2d\u6307\u5b9a\u7684\u57df\u540d(\u6216\u5176\u5b50\u57df\u540d)\u7684url\u8bf7\u6c42\u3002 \u5047\u8bbe\u60a8\u7684\u76ee\u6807url\u662f https://www.example.com/1.html \uff0c\u7136\u540e\u5c06 'example.com' \u6dfb\u52a0\u5230\u5217\u8868\u4e2d\u3002 start_urls \u5f53\u6ca1\u6709\u6307\u5b9a\u7279\u5b9a\u7684url\u65f6\uff0c\u722c\u866b\u5c06\u4ece\u5176\u4e2d\u5f00\u59cb\u6293\u53d6url\u5217\u8868\u8fdb\u884c\u6293\u53d6\u3002\u6240\u4ee5\uff0c\u4e0b\u8f7d\u7684\u7b2c\u4e00\u4e2a\u9875\u9762\u5c31\u662f\u4ece\u8fd9\u91cc\u51fa\u6765\u7684\u3002\u540e\u7eed Request \u90fd\u662f\u4ecestart url\u4e2d\u5305\u542b\u7684\u6570\u636e\u8fde\u7eed\u751f\u6210\u7684\u3002 custom_settings \u8fd0\u884c\u6b64\u722c\u866b\u65f6\u5c06\u4f1a\u8986\u76d6\u9879\u76ee\u6587\u4ef6\u91cc\u7684\u8bbe\u7f6e\u3002\u5b83\u5fc5\u987b\u88ab\u5b9a\u4e49\u4e3a\u7c7b\u5c5e\u6027\uff0c\u56e0\u4e3a\u5728\u5b9e\u4f8b\u5316\u4e4b\u524d\u5df2\u7ecf\u66f4\u65b0\u4e86\u8bbe\u7f6e\u3002 \u6709\u5173\u53ef\u7528\u7684\u5185\u7f6e\u8bbe\u7f6e\u7684\u5217\u8868\uff0c\u8bf7\u53c2\u9605: \u5185\u7f6e\u7684\u8bbe\u7f6e\u53c2\u8003 crawler \u8fd9\u4e2a\u5c5e\u6027\u662f\u5728\u521d\u59cb\u5316\u7c7b\u4e4b\u540e\u7531 from_crawler \u7c7b\u65b9\u6cd5\u8bbe\u7f6e\u7684\uff0c\u5e76\u4e14\u94fe\u63a5\u5230\u8fd9\u4e2a\u722c\u866b\u5b9e\u4f8b\u7ed1\u5b9a\u5230\u7684 Crawler \u5bf9\u8c61\u3002 Crawlers\u5728\u9879\u76ee\u4e2d\u5c01\u88c5\u4e86\u8bb8\u591a\u7ec4\u4ef6\uff0c\u7528\u4e8e\u5b83\u4eec\u7684\u5355\u4e00\u5165\u53e3\u8bbf\u95ee(\u5982\u6269\u5c55\u3001\u4e2d\u95f4\u4ef6\u3001\u4fe1\u53f7\u7ba1\u7406\u5668\u7b49)\u3002\u67e5\u770b Crawler API \u4e86\u89e3\u66f4\u591a\u4fe1\u606f\u3002 settings \u8fd0\u884c\u6b64spider\u7684\u914d\u7f6e\u3002\u8fd9\u662f\u4e00\u4e2a Settings \u5b9e\u4f8b\uff0c\u6709\u5173\u8fd9\u4e2a\u4e3b\u9898\u7684\u8be6\u7ec6\u4ecb\u7ecd\uff0c\u8bf7\u53c2\u9605 \u8bbe\u7f6e \u4e3b\u9898\u3002 logger \u7528Spider\u7684 \u540d\u5b57 \u521b\u5efa\u7684Python\u65e5\u5fd7\u8bb0\u5f55\u5668\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u5b83\u6765\u901a\u8fc7\u5b83\u53d1\u9001\u65e5\u5fd7\u6d88\u606f\uff0c\u6b63\u5982\u5728 spider\u65e5\u5fd7\u8bb0\u5f55 \u4e2d\u6240\u63cf\u8ff0\u7684\u90a3\u6837\u3002 from_crawler(crawler, args, *kwargs) \u8fd9\u662fScrapy\u7528\u6765\u521b\u5efaSpider\u7684\u7c7b\u65b9\u6cd5\u3002 \u60a8\u53ef\u80fd\u4e0d\u9700\u8981\u76f4\u63a5\u8986\u76d6\u5b83\uff0c\u56e0\u4e3a\u9ed8\u8ba4\u5b9e\u73b0\u5145\u5f53 __init__() \u65b9\u6cd5\uff0c\u4f7f\u7528\u7ed9\u5b9a\u7684\u53c2\u6570arg\u548c\u547d\u540d\u7684\u53c2\u6570kwargs\u8c03\u7528\u5b83\u3002 \u5c3d\u7ba1\u5982\u6b64\uff0c\u8be5\u65b9\u6cd5\u5728\u65b0\u5b9e\u4f8b\u4e2d\u8bbe\u7f6e\u4e86 crawler \u548c settings \u5c5e\u6027\uff0c\u4ee5\u4fbf\u7a0d\u540e\u53ef\u4ee5\u5728\u722c\u866b\u4ee3\u7801\u4e2d\u8bbf\u95ee\u5b83\u4eec\u3002 \u53c2\u6570: crawler ( Crawler \u5b9e\u4f8b) \u2013 \u722c\u866b\uff0cspider\u88ab\u7ed1\u5728\u4e0a\u9762 args (\u5217\u8868) \u2013 \u4f20\u9012\u7ed9 __init__() \u65b9\u6cd5\u7684\u53c2\u6570 kwargs (\u5b57\u5178) \u2013 \u4f20\u9012\u7ed9 __init__() \u65b9\u6cd5\u7684\u5173\u952e\u5b57\u53c2\u6570 start_requests() \u5f53spider\u88ab\u6253\u5f00\u8fdb\u884c\u6293\u53d6\u7684\u65f6\u5019, \u8fd9\u4e2a\u65b9\u6cd5\u5fc5\u987b\u8fd4\u56de\u4e00\u4e2a\u53ef\u8fed\u4ee3\u7684\u5bf9\u8c61\uff0c\u5176\u4e2d\u5c31\u5305\u542b\u53d1\u51fa\u53bb\u7684\u7b2c\u4e00\u4e2aRequests\u3002\u8fd9\u6837\u5c31\u88ab\u79f0\u4e3a\u201cScrapy\u201d\u3002Scrapy\u53ea\u8c03\u7528\u4e00\u6b21\uff0c\u6240\u4ee5\u5c06 start_requests() \u4f5c\u4e3a\u751f\u6210\u5668\u5b9e\u73b0\u662f\u5b89\u5168\u7684\u3002 \u9ed8\u8ba4\u5b9e\u73b0\u4e3astart_urls\u4e2d\u7684\u6bcf\u4e2aurl\u751f\u6210 Request(url, dont_filter=True) \u3002 \u5982\u679c\u60a8\u53ea\u60f3\u53d1\u9001\u4e00\u4e2a\u8bf7\u6c42\u800c\u4e0d\u662f\u7528\u751f\u6210\u5668\u7684\u65b9\u5f0f\uff0c \u90a3\u4e48\u5c31\u7528\u8986\u76d6\u7684\u65b9\u5f0f\uff0c \u76f4\u63a5\u5728Request\u91cc\u9762\u91cd\u5199url\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u9700\u8981\u4ece\u4f7f\u7528POST\u8bf7\u6c42\u767b\u5f55\u5f00\u59cb\uff0c\u60a8\u53ef\u4ee5\u8fd9\u6837\u505a: class MySpider(scrapy.Spider): name = 'myspider' def start_requests(self): return [scrapy.FormRequest( http://www.example.com/login , formdata={'user': 'john', 'pass': 'secret'}, callback=self.logged_in)] def logged_in(self, response): # here you would extract links to follow and return Requests for # each of them, with another callback pass parse(response) \u5f53\u8fd9\u4e9b\u8bf7\u6c42\u6ca1\u6709\u6307\u5b9a\u56de\u8c03\u65f6\uff0cScrapy\u4f7f\u7528\u9ed8\u8ba4\u56de\u8c03\u6765\u5904\u7406\u4e0b\u8f7d\u7684response\u3002 parse \u65b9\u6cd5\u8d1f\u8d23\u5904\u7406response\u5e76\u8fd4\u56de\u6293\u53d6\u7684\u6570\u636e\u6216\u66f4\u591aurl\u6765\u8ffd\u8e2a\u3002\u5176\u4ed6Requests\u56de\u8c03\u5177\u6709\u4e0e Spider \u7c7b\u76f8\u540c\u7684\u9700\u6c42\u3002 \u6b64\u65b9\u6cd5\u4ee5\u53ca\u4efb\u4f55\u5176\u4ed6Request\u56de\u8c03\u90fd\u5fc5\u987b\u8fd4\u56de Request \u548c/\u6216dicts\u6216 Item \u5bf9\u8c61\u7684\u8fed\u4ee3\u3002 \u53c2\u6570: response ( Response ) \u2013 \u89e3\u6790\u4e4b\u540e\u7684response log (message[, level, component]) \u901a\u8fc7\u722c\u866b logger \u5c06\u5927\u91cf\u7684\u4fe1\u606f\u5305\u88c5\u8d77\u6765\uff0c\u7528\u4e8e\u5411\u540e\u517c\u5bb9\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1\u722c\u884c\u5668 \u65e5\u5fd7\u8bb0\u5f55 \u3002 closed (reason) \u5f53Spider\u5173\u95ed\u65f6\u4f1a\u88ab\u8c03\u7528\u3002\u8fd9\u4e2a\u65b9\u6cd5\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5feb\u6377\u65b9\u5f0f\uff0csignals.connect()\u7528\u4e8e spider_closed \u4fe1\u53f7\u3002 \u8ba9\u6211\u4eec\u770b\u4e00\u4e2a\u4f8b\u5b50: import scrapy class MySpider(scrapy.Spider): name = 'example.com' allowed_domains = ['example.com'] start_urls = [ 'http://www.example.com/1.html', 'http://www.example.com/2.html', 'http://www.example.com/3.html', ] def parse(self, response): self.logger.info('A response from %s just arrived!', response.url) \u591a\u4e2aRequests\u548citems\u53ef\u4ee5\u7528\u4e00\u4e2a\u56de\u8c03\u6765\u5b8c\u6210 import scrapy class MySpider(scrapy.Spider): name = 'example.com' allowed_domains = ['example.com'] start_urls = [ 'http://www.example.com/1.html', 'http://www.example.com/2.html', 'http://www.example.com/3.html', ] def parse(self, response): for h3 in response.xpath('//h3').extract(): yield { title : h3} for url in response.xpath('//a/@href').extract(): yield scrapy.Request(url, callback=self.parse) \u4e0e start_urls \u4e0d\u540c\uff0c\u60a8\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 startrequest() \u4e3a\u4e86\u7ed9\u6570\u636e\u63d0\u4f9b\u66f4\u591a\u7684\u7ed3\u6784\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 Items : import scrapy from myproject.items import MyItem class MySpider(scrapy.Spider): name = 'example.com' allowed_domains = ['example.com'] def start_requests(self): yield scrapy.Request('http://www.example.com/1.html', self.parse) yield scrapy.Request('http://www.example.com/2.html', self.parse) yield scrapy.Request('http://www.example.com/3.html', self.parse) def parse(self, response): for h3 in response.xpath('//h3').extract(): yield MyItem(title=h3) for url in response.xpath('//a/@href').extract(): yield scrapy.Request(url, callback=self.parse) Spider\u53c2\u6570 Spider\u53ef\u4ee5\u63a5\u53d7\u4fee\u6539\u81ea\u5df1\u884c\u4e3a\u7684\u53c2\u6570\u3002\u4e00\u4e9b\u5e38\u89c1\u7684spider\u53c2\u6570\u5927\u591a\u7528\u9014\u662f\u5b9a\u4e49\u8d77\u59cburl\uff0c\u6216\u8005\u9650\u5236\u6293\u53d6\u67d0\u4e9b\u7ad9\u70b9\u67d0\u4e9b\u90e8\u5206\uff0c\u4f46\u662f\u5b83\u4eec\u53ef\u4ee5\u7528\u6765\u914d\u7f6espider\u7684\u4efb\u4f55\u529f\u80fd\u3002 Spider\u53c2\u6570\u901a\u8fc7 crawl \u547d\u4ee4\u4f7f\u7528 -a \u9009\u9879\u6765\u63a5\u6536\u53c2\u6570\u3002\u4f8b\u5982: scrapy crawl myspider -a category=electronics Spider\u53ef\u4ee5\u5728 __init__ \u65b9\u6cd5\u4e2d\u8bbf\u95ee\u53c2\u6570\uff1a import scrapy class MySpider(scrapy.Spider): name = 'myspider' def __init__(self, category=None, *args, **kwargs): super(MySpider, self).__init__(*args, **kwargs) self.start_urls = ['http://www.example.com/categories/%s' % category] # ... \u9ed8\u8ba4\u7684 init \u65b9\u6cd5\u5c06\u63a5\u53d7\u4efb\u4f55spider\u53c2\u6570\uff0c\u5e76\u5c06\u5b83\u4eec\u590d\u5236\u5230spider\u4f5c\u4e3a\u5c5e\u6027\u3002\u4e0a\u9762\u7684\u4f8b\u5b50\u4e5f\u53ef\u4ee5\u5199\u5982\u4e0b\uff1a import scrapy class MySpider(scrapy.Spider): name = 'myspider' def start_requests(self): yield scrapy.Request('http://www.example.com/categories/%s' % self.category) \u8bf7\u8bb0\u4f4f\uff0cspider\u53c2\u6570\u53ea\u80fd\u662f\u5b57\u7b26\u4e32\u3002\u722c\u884c\u5668\u4e0d\u4f1a\u81ea\u5df1\u8fdb\u884c\u4efb\u4f55\u89e3\u6790\u3002\u5982\u679c\u60a8\u8981\u4ece\u547d\u4ee4\u884c\u8bbe\u7f6estart_urls\u5c5e\u6027\uff0c\u60a8\u5c06\u4e0d\u5f97\u4e0d\u4f7f\u7528\u8bf8\u5982 ast.literal eval \u6216 json.loads \u4e4b\u7c7b\u7684\u4e1c\u897f\u5c06\u5176\u89e3\u6790\u6210\u4e00\u4e2a\u5217\u8868\u3002\u52a0\u8f7d\u5e76\u5c06\u5176\u8bbe\u7f6e\u4e3a\u5c5e\u6027\u3002\u5426\u5219\uff0c\u60a8\u5c06\u5bfc\u81f4\u5bf9start_urls\u5b57\u7b26\u4e32\uff08\u4e00\u4e2a\u975e\u5e38\u5e38\u89c1\u7684python\u9677\u9631\uff09\u7684\u8fed\u4ee3\uff0c\u5bfc\u81f4\u6bcf\u4e2a\u5b57\u7b26\u88ab\u89c6\u4e3a\u4e00\u4e2a\u5355\u72ec\u7684url\u3002 \u4e00\u4e2a\u6709\u6548\u7684\u7528\u4f8b\u662f\u4f7f\u7528http\u8ba4\u8bc1\u51ed\u636e HttpAuthMiddleware \u6216\u4f7f\u7528\u7684\u7528\u6237\u4ee3\u7406 UserAgentMiddleware \uff1a scrapy crawl myspider -a http_user=myuser -a http_pass=mypassword -a user_agent=mybot Spider\u53c2\u6570\u4e5f\u53ef\u4ee5\u901a\u8fc7Scrapyd\u7684 schedule.json API\u6765\u4f20\u9012, \u67e5\u770b Scrapyd\u6587\u6863 \u901a\u7528\u7684Spiders Scrapy\u6709\u4e00\u4e9b\u6709\u7528\u7684\u901a\u7528spiders\uff0c\u4f60\u53ef\u4ee5\u7528\u5728\u4f60\u81ea\u5df1\u7684spiders\u4e0a\u9762\u7ee7\u627f\u5b83\u4eec\u3002\u4ed6\u4eec\u7684\u76ee\u6807\u662f\u4e3a\u4e00\u4e9b\u5e38\u89c1\u7684\u6293\u53d6\u6848\u4f8b\u63d0\u4f9b\u65b9\u4fbf\u7684\u529f\u80fd\uff0c\u6bd4\u5982\u6839\u636e\u67d0\u4e9b\u89c4\u5219\u5728\u7ad9\u70b9\u4e0a\u7684\u6240\u6709\u94fe\u63a5\uff0c\u4ece Sitemaps \u4e0a\u6293\u53d6\uff0c\u6216\u8005\u89e3\u6790\u4e00\u4e2axml/csv feed\u3002 \u5bf9\u4e8e\u4e0b\u9762\u7684spiders\u4e2d\u4f7f\u7528\u7684\u4f8b\u5b50\uff0c\u6211\u4eec\u5047\u8bbe\u60a8\u6709\u4e00\u4e2a\u9879\u76ee\uff0c\u5b83\u7684\u4e00\u4e2a\u9879\u76ee\u662f\u5728myproject\u4e2d\u58f0\u660e\u7684\u3002\u9879\u76ee\u6a21\u5757: import scrapy class TestItem(scrapy.Item): id = scrapy.Field() name = scrapy.Field() description = scrapy.Field() CrawlSpider scrapy.spiders.CrawlSpider \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) \u8fd9\u662f\u6700\u5e38\u7528\u7684\u6293\u53d6\u5e38\u89c4\u7f51\u7ad9\u7684spider\uff0c\u56e0\u4e3a\u5b83\u63d0\u4f9b\u4e86\u4e00\u79cd\u65b9\u4fbf\u7684\u673a\u5236\uff0c\u901a\u8fc7\u5b9a\u4e49\u4e00\u7ec4\u89c4\u5219\u6765\u8ddf\u8e2a\u94fe\u63a5\u3002\u5b83\u53ef\u80fd\u4e0d\u662f\u6700\u9002\u5408\u60a8\u7684\u7279\u5b9aweb\u7ad9\u70b9\u6216\u9879\u76ee\u7684\uff0c\u4f46\u662f\u5b83\u5bf9\u4e8e\u51e0\u4e2a\u6848\u4f8b\u6765\u8bf4\u662f\u901a\u7528\u7684\uff0c\u6240\u4ee5\u60a8\u53ef\u4ee5\u4ece\u5b83\u5f00\u59cb\uff0c\u6839\u636e\u9700\u8981\u91cd\u5199\u5b83\uff0c\u4ee5\u83b7\u5f97\u66f4\u591a\u7684\u81ea\u5b9a\u4e49\u529f\u80fd\uff0c\u6216\u8005\u4ec5\u4ec5\u5b9e\u73b0\u60a8\u81ea\u5df1\u7684spider\u3002 \u9664\u4e86\u4eceSpider\u7ee7\u627f\u7684\u5c5e\u6027\uff08\u60a8\u5fc5\u987b\u6307\u5b9a\uff09\u4e4b\u5916\uff0c\u8be5\u7c7b\u8fd8\u652f\u6301\u4e00\u4e2a\u65b0\u5c5e\u6027\uff1a rules \u5b83\u662f\u4e00\u4e2a\uff08\u6216\u591a\u4e2a\uff09 Rule \u5bf9\u8c61\u7684\u5217\u8868\u3002\u6bcf\u4e2a Rule \u90fd\u5b9a\u4e49\u4e86\u6293\u53d6\u7ad9\u70b9\u7684\u7279\u5b9a\u884c\u4e3a\u3002Rules\u5bf9\u8c61\u5982\u4e0b\u6240\u8ff0\u3002\u6839\u636e\u5b83\u4eec\u5728\u8be5\u5c5e\u6027\u4e2d\u5b9a\u4e49\u7684\u987a\u5e8f, \u5982\u679c\u591a\u4e2a\u89c4\u5219\u5339\u914d\u76f8\u540c\u7684\u94fe\u63a5\uff0c\u90a3\u4e48\u7b2c\u4e00\u4e2a\u89c4\u5219\u5c06\u88ab\u4f7f\u7528. \u8fd9\u4e2asppider\u8fd8\u516c\u5f00\u4e86\u4e00\u79cd\u53ef\u91cd\u5199\u7684\u65b9\u6cd5\uff1a parse_start_url(response) \u8fd9\u79cd\u65b9\u6cd5\u7528\u6765\u56de\u8c03start_urls\u7684response\u3002\u5b83\u5141\u8bb8\u89e3\u6790\u521d\u59cbresponse\uff0c\u5e76\u4e14\u5fc5\u987b\u8fd4\u56de Item \u5bf9\u8c61\u3001 Request \u5bf9\u8c61\u6216\u5305\u542b\u5176\u4e2d\u4efb\u4f55\u4e00\u4e2a\u7684\u53ef\u8fed\u4ee3\u7684\u3002 Crawling rules scrapy.spiders.Rule(link_extractor, callback=None, cb_kwargs=None, follow=None, process_links=None, process_request=None) \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) link_extractor \u662f\u4e00\u4e2a Link Extractor \u5bf9\u8c61\uff0c\u5b83\u5b9a\u4e49\u4e86\u5982\u4f55\u4ece\u6bcf\u4e2a\u6293\u53d6\u9875\u9762\u4e2d\u63d0\u53d6\u94fe\u63a5\u3002 callback \u662f\u4e00\u4e2a\u53ef\u8c03\u7528\u7684\u6216\u4e00\u4e2a\u5b57\u7b26\u4e32\uff08\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5c06\u4f7f\u7528\u5e26\u6709\u8be5\u540d\u79f0\u7684spider\u5bf9\u8c61\u7684\u65b9\u6cd5\uff09\u6765\u8c03\u7528\u4e0e\u6307\u5b9a\u7684link_extractor\u63d0\u53d6\u7684\u6bcf\u4e00\u4e2a\u94fe\u63a5\u3002\u8fd9\u4e2a\u56de\u8c03\u5c06\u7b2c\u4e00\u4e2a\u53c2\u6570\u4f5c\u4e3aresponse\uff0c\u5e76\u4e14\u5fc5\u987b\u8fd4\u56de\u5305\u542b Item \u548c/\u6216 Requests \u5bf9\u8c61\uff08\u6216\u4efb\u4f55\u5b50\u7c7b\uff09\u7684\u5217\u8868\u3002 \u8b66\u544a\u8b66\u544a\u8b66\u544a!!!!! \u5728\u7f16\u5199\u6293\u53d6\u89c4\u5219\u65f6\uff0c\u907f\u514d\u4f7f\u7528parse\u4f5c\u4e3a\u56de\u8c03\uff0c\u56e0\u4e3aCrawlSpider\u672c\u8eab\u5c31\u662f\u7528\u4e86parse\u65b9\u6cd5\u6765\u5b9e\u73b0\u5b83\u7684\u903b\u8f91\u3002\u6240\u4ee5\u5982\u679c\u4f60\u91cd\u5199\u4e86parse\u65b9\u6cd5\uff0cspider\u5c31\u4e0d\u518d\u5de5\u4f5c\u4e86\u3002 cb_kwargs \u662f\u5305\u542b\u8981\u4f20\u9012\u7ed9\u56de\u8c03\u51fd\u6570\u7684\u5173\u952e\u5b57\u53c2\u6570\u3002 follow \u662f\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u5b83\u6307\u5b9a\u662f\u5426\u5e94\u8be5\u6839\u636e\u8fd9\u4e2a\u89c4\u5219\u63d0\u53d6\u51fa\u7684\u6bcf\u4e2aresponse\u3002\u5982\u679c callbacck \u6ca1\u6709\u6307\u5b9a, \u9ed8\u8ba4 \u4e3a True , \u5426\u5219\u4e3a False \u3002 process_links \u5b83\u662f\u53ef\u8c03\u7528\u7684\uff0c\u6216\u8005\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff08\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5c06\u4f7f\u7528\u6765\u81ea\u4e8espider\u5bf9\u8c61\u7684\u65b9\u6cd5\uff09\uff0c\u6bcf\u4e2a\u54cd\u5e94\u4e2d\u63d0\u53d6\u7684\u6bcf\u4e2a\u94fe\u63a5\u5217\u8868\u90fd\u5c06\u88ab\u8c03\u7528\uff0c\u4f7f\u7528\u6307\u5b9a\u7684 link_extractor \u3002\u8fd9\u4e3b\u8981\u7528\u4e8e\u8fc7\u6ee4\u76ee\u7684\u3002 process_request \u662f\u4e00\u4e2a\u53ef\u8c03\u7528\u7684\uff0c\u6216\u8005\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff08\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5c06\u4f1a\u4f7f\u7528\u6765\u81ea\u4e8e\u8fd9\u4e2a\u540d\u79f0\u7684spider\u5bf9\u8c61\u7684\u65b9\u6cd5\uff09\uff0c\u5728\u8fd9\u4e2a\u89c4\u5219\u4e2d\u63d0\u53d6\u7684\u6bcf\u4e00\u4e2a\u8bf7\u6c42\u90fd\u5c06\u88ab\u8c03\u7528\uff0c\u5e76\u4e14\u5fc5\u987b\u8fd4\u56de\u4e00\u4e2arequest\u6216None\uff08\u4ee5\u8fc7\u6ee4\u6389\u8bf7\u6c42\uff09\u3002 CrawlSpider\u4f8b\u5b50 \u73b0\u5728\u8ba9\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u5e26\u6709\u89c4\u5219\u7684spider\u793a\u4f8b\uff1a import scrapy from scrapy.spiders import CrawlSpider, Rule from scrapy.linkextractors import LinkExtractor class MySpider(CrawlSpider): name = 'example.com' allowed_domains = ['example.com'] start_urls = ['http://www.example.com'] rules = ( # \u63d0\u53d6\u94fe\u63a5\u5339\u914d 'category.php' (\u4f46\u4e0d\u5339\u914d 'subsection.php') # \u5e76\u8ddf\u968f\u4ed6\u4eec\u7684\u94fe\u63a5 (\u56e0\u4e3a\u6ca1\u6709\u56de\u8c03\u610f\u5473\u7740\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e3aTrue). Rule(LinkExtractor(allow=('category\\.php', ), deny=('subsection\\.php', ))), # \u63d0\u53d6\u94fe\u63a5\u5339\u914d 'item.php' \u7528spider\u7684\u65b9\u6cd5parse_item\u6765\u89e3\u6790\u5b83\u4eec Rule(LinkExtractor(allow=('item\\.php', )), callback='parse_item'), ) def parse_item(self, response): self.logger.info('Hi, this is an item page! %s', response.url) item = scrapy.Item() item['id'] = response.xpath('//td[@id= item_id ]/text()').re(r'ID: (\\d+)') item['name'] = response.xpath('//td[@id= item_name ]/text()').extract() item['description'] = response.xpath('//td[@id= item_description ]/text()').extract() return item \u8fd9\u4e2aspider\u4f1a\u5728\u5f00\u59cb\u7684\u65f6\u5019\u6293\u53d6example.com\u7684\u4e3b\u9875\uff0c\u6536\u96c6category\u94fe\u63a5\u548citems\u94fe\u63a5\uff0c\u7528 parse_item \u65b9\u6cd5\u89e3\u6790\u540e\u8005\u3002\u5bf9\u4e8e\u6bcf\u4e00\u4e2aitem response\uff0c\u4e00\u4e9b\u6570\u636e\u5c06\u4f7f\u7528XPath\u4eceHTML\u4e2d\u63d0\u53d6\u51fa\u6765\uff0c\u5e76\u4e14\u4e00\u4e2a Item \u5c06\u88ab\u586b\u5145\u3002 XMLFeedSpider scrapy.spiders.XMLFeedSpider \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) XMLFeedSpider\u662f\u4e3a\u89e3\u6790XML feeds\u800c\u8bbe\u8ba1\u7684\uff0c\u65b9\u6cd5\u662f\u901a\u8fc7\u67d0\u4e2a\u8282\u70b9\u540d\u904d\u5386\u5b83\u4eec\u3002\u8fed\u4ee3\u5668\u53ef\u4ee5\u4ece\uff1a iternodes \u3001 xml \u548c html \u4e2d\u9009\u62e9\u3002\u51fa\u4e8e\u6027\u80fd\u7684\u8003\u8651\uff0c\u5efa\u8bae\u4f7f\u7528 iternodes \u8fed\u4ee3\u5668\uff0c\u56e0\u4e3a xml \u548c html \u8fed\u4ee3\u5668\u4f1a\u540c\u65f6\u751f\u6210\u6574\u4e2aDOM\uff0c\u4ee5\u4fbf\u89e3\u6790\u5b83\u3002\u7136\u800c\uff0c\u4f7f\u7528 html \u4f5c\u4e3a\u8fed\u4ee3\u5668\u5728\u4e00\u4e9b\u6807\u7b7e\u7cdf\u7cd5\u6742\u4e71\u7684XML\u65f6\u53ef\u80fd\u4f1a\u5f88\u6709\u7528\u3002 \u8981\u8bbe\u7f6e\u8fed\u4ee3\u5668\u548c\u6807\u8bb0\u540d\u79f0\uff0c\u60a8\u5fc5\u987b\u5b9a\u4e49\u4e0b\u5217\u7c7b\u5c5e\u6027\uff1a iterator \u4e00\u79cd\u5b9a\u4e49\u8981\u4f7f\u7528\u7684\u8fed\u4ee3\u5668\u7684\u5b57\u7b26\u4e32\u3002\u5b83\u53ef\u4ee5\u662f: 'iternodes' \u57fa\u4e8e\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u5feb\u901f\u8fed\u4ee3\u5668 'html' \u4e00\u4e2a\u4f7f\u7528 Selector \u7684\u8fed\u4ee3\u5668\u3002\u8bf7\u8bb0\u4f4f\uff0c\u8fd9\u4f7f\u7528\u4e86DOM\u89e3\u6790\uff0c\u5e76\u4e14\u5fc5\u987b\u5728\u5185\u5b58\u4e2d\u52a0\u8f7d\u6240\u6709DOM\uff0c\u5927\u578bxml\u5bf9\u4e8e\u5185\u5b58\u6765\u8bf4, \u7edd\u5bf9\u662f\u4e00\u4e2a\u95ee\u9898 'xml' \u5b8c\u5168\u540c\u4e0a \u8fd9\u4e2a\u5c5e\u6027\u9ed8\u8ba4\u4e3a 'iternodes' itertag \u4e00\u4e2a\u5e26\u6709\u8282\u70b9\uff08\u6216\u5143\u7d20\uff09\u540d\u79f0\u7684\u5b57\u7b26\u4e32\uff0c\u4ee5\u8fdb\u884c\u8fed\u4ee3\u3002\u4f8b\u5b50: itertag = 'product' namespaces \u4e00\u7ec4\uff08 prefix \u3001 uri \uff09\u5143\u7ec4\uff0c\u5b83\u5b9a\u4e49\u4e86\u8be5\u6587\u6863\u4e2d\u53ef\u7528\u7684\u540d\u79f0\u7a7a\u95f4\uff0c\u8be5\u540d\u79f0\u7a7a\u95f4\u5c06\u7531\u8be5spider\u5904\u7406\u3002 prefix \u548c uri \u5c06\u4f7f\u7528 registernamespace() \u65b9\u6cd5\u81ea\u52a8\u6ce8\u518c\u540d\u79f0\u7a7a\u95f4\u3002 \u7136\u540e\u60a8\u53ef\u4ee5\u5728 itertag \u5c5e\u6027\u4e2d\u6307\u5b9a\u5e26\u6709\u540d\u79f0\u7a7a\u95f4\u7684\u8282\u70b9\u3002 class YourSpider(XMLFeedSpider): namespaces = [('n', 'http://www.sitemaps.org/schemas/sitemap/0.9')] itertag = 'n:url' # ... \u9664\u4e86\u8fd9\u4e9b\u65b0\u5c5e\u6027\u4e4b\u5916\uff0c\u8fd9\u4e2aspider\u4e5f\u6709\u4ee5\u4e0b\u53ef\u91cd\u5199\u7684\u65b9\u6cd5\uff1a adapt_response(response) \u4e00\u79cd\u4ecespider middleware\u4e2d\u63a5\u6536response\u7684\u65b9\u6cd5\uff0c\uff0c\u5728spider\u5f00\u59cb\u89e3\u6790\u5b83\u4e4b\u524d\u3002\u5b83\u53ef\u4ee5\u7528\u4e8e\u5728\u89e3\u6790response body\u4e4b\u524d\u4fee\u6539\u5b83\u3002\u8fd9\u4e2a\u65b9\u6cd5\u63a5\u6536\u4e00\u4e2aresponse\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2aresponse\uff08\u5b83\u53ef\u4ee5\u662f\u76f8\u540c\u7684\uff0c\u4e5f\u53ef\u4ee5\u662f\u53e6\u4e00\u4e2a\uff09\u3002 parse_node(response, selector) \u8fd9\u79cd\u65b9\u6cd5\u88ab\u79f0\u4e3a\u5339\u914d\u6240\u63d0\u4f9b\u7684\u6807\u8bb0\u540d\u79f0\uff08 itertag \uff09\u7684\u8282\u70b9\u3002\u63a5\u6536\u6bcf\u4e2a\u8282\u70b9\u7684response\u548c Selector \u3002\u91cd\u5199\u8fd9\u4e2a\u65b9\u6cd5\u662f\u5f3a\u5236\u6027\u7684\u3002\u5426\u5219\uff0c\u4f60\u7684spider\u5c31\u4e0d\u4f1a\u5de5\u4f5c\u4e86\u3002\u6b64\u65b9\u6cd5\u5fc5\u987b\u8fd4\u56de Item \u5bf9\u8c61\u3001 Request ]\u5bf9\u8c61\u6216\u5305\u542b\u5176\u4e2d\u4efb\u4f55\u4e00\u4e2a\u7684\u53ef\u8fed\u4ee3\u7684\u3002 process_results(response, results) \u8fd9\u4e2a\u65b9\u6cd5\u662f\u4e3aspider\u8fd4\u56de\u7684\u6bcf\u4e2a\u7ed3\u679c\uff08item\u6216request\uff09\u8c03\u7528\u7684\uff0c\u5e76\u4e14\u5b83\u7684\u76ee\u7684\u662f\u5728\u5c06\u7ed3\u679c\u8fd4\u56de\u5230\u6846\u67b6\u6838\u5fc3\u4e4b\u524d\u6267\u884c\u4efb\u4f55\u6700\u540e\u4e00\u6b21\u5904\u7406\uff0c\u4f8b\u5982\u8bbe\u7f6eitem IDs\u3002\u5b83\u6536\u5230\u4e00\u4e2a\u7ed3\u679c\u5217\u8868\u548c\u4ea7\u751f\u8fd9\u4e9b\u7ed3\u679c\u7684response\u3002\u5b83\u5fc5\u987b\u8fd4\u56de\u4e00\u4e2a\u7ed3\u679c\u5217\u8868\uff08Items\u6216Requests\uff09\u3002 XMLFeedSpider example \u8fd9\u4e9bSpiders\u5f88\u5bb9\u6613\u4f7f\u7528\uff0c\u8ba9\u6211\u4eec\u770b\u4e00\u4e2a\u4f8b\u5b50\uff1a from scrapy.spiders import XMLFeedSpider from myproject.items import TestItem class MySpider(XMLFeedSpider): name = 'example.com' allowed_domains = ['example.com'] start_urls = ['http://www.example.com/feed.xml'] iterator = 'iternodes' # \u8fd9\u5b9e\u9645\u4e0a\u662f\u4e0d\u5fc5\u8981\u7684\uff0c\u56e0\u4e3a\u5b83\u662f\u9ed8\u8ba4\u503c itertag = 'item' def parse_node(self, response, node): self.logger.info('Hi, this is a %s node!: %s', self.itertag, ''.join(node.extract())) item = TestItem() item['id'] = node.xpath('@id').extract() item['name'] = node.xpath('name').extract() item['description'] = node.xpath('description').extract() return item \u57fa\u672c\u4e0a\uff0c\u6211\u4eec\u6240\u505a\u7684\u5c31\u662f\u521b\u5efa\u4e00\u4e2a\u4ece\u7ed9\u5b9a\u7684start_url\u4e2d\u4e0b\u8f7dfeed\u7684spider\uff0c\u7136\u540e\u904d\u5386\u6bcf\u4e00\u4e2a item \u6807\u7b7e\uff0c\u6253\u5370\u51fa\u6765\uff0c\u5e76\u5728\u4e00\u4e2a Item \u4e2d\u5b58\u50a8\u4e00\u4e9b\u968f\u673a\u7684\u6570\u636e\u3002 CSVFeedSpider scrapy.spiders.CSVFeedSpider \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) \u8fd9\u53easpider\u4e0eXMLFeedSpider\u975e\u5e38\u76f8\u4f3c\uff0c\u9664\u4e86\u5b83\u8fed\u4ee3\u7684\u662f\u884c\uff0c\u800c\u4e0d\u662f\u8282\u70b9\u3002\u5728\u6bcf\u6b21\u8fed\u4ee3\u4e2d\u8c03\u7528\u7684\u65b9\u6cd5\u662f parse_row() \u3002 delimiter CSV\u6587\u4ef6\u4e2d\u6bcf\u4e2a\u5b57\u6bb5\u7684\u5206\u9694\u7b26\u5b57\u7b26\u4e32\u9ed8\u8ba4\u4e3a ',' \uff08\u9017\u53f7\uff09\u3002 quotechar CSV\u6587\u4ef6\u4e2d\u6bcf\u4e2a\u5b57\u6bb5\u7684\u5916\u58f3\u5b57\u7b26\u7684\u5b57\u7b26\u4e32\u9ed8\u8ba4\u4e3a \"''\" \uff08\u5f15\u53f7\uff09\u3002 headers CSV\u6587\u4ef6\u4e2d\u5217\u540d\u7684\u5217\u8868\u3002 parse_row(response, row) \u63a5\u6536\u4e00\u4e2aresponse\u548c\u4e00\u4e2a\uff08\u4ee3\u8868\u6bcf\u4e00\u884c\uff09\u7684\u4e00\u4e2adict\uff0c\u5e76\u4e3aCSV\u6587\u4ef6\u7684\u6bcf\u4e2aheader\u63d0\u4f9b(\u6216\u68c0\u6d4b\u5230\u7684)\u4e00\u4e2akey\u3002\u8be5spider\u8fd8\u63d0\u4f9b\u4e86 adapt_response \u548c process_results \u7528\u4e8e\u9884\u5904\u7406\u548c\u540e\u5904\u7406\u7684\u65b9\u6cd5\u3002 CSVFeedSpider\u4f8b\u5b50 \u8ba9\u6211\u4eec\u770b\u4e00\u4e2a\u4e0e\u524d\u4e00\u4e2a\u7c7b\u4f3c\u7684\u4f8b\u5b50\uff0c\u4f46\u4f7f\u7528\u7684\u662f CSVFeedSpider \uff1a from scrapy.spiders import CSVFeedSpider from myproject.items import TestItem class MySpider(CSVFeedSpider): name = 'example.com' allowed_domains = ['example.com'] start_urls = ['http://www.example.com/feed.csv'] delimiter = ';' quotechar = ' headers = ['id', 'name', 'description'] def parse_row(self, response, row): self.logger.info('Hi, this is a row!: %r', row) item = TestItem() item['id'] = row['id'] item['name'] = row['name'] item['description'] = row['description'] return item SitemapSpider scrapy.spiders.SitemapSpider \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) SitemapSpider\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528 Sitemaps \u53d1\u73b0url\u6765\u6293\u53d6\u7ad9\u70b9\u3002 \u5b83\u652f\u6301\u5d4c\u5957\u7684sitemaps\u5730\u56fe\uff0c\u5e76\u4ece robots.txt \u4e2d\u53d1\u73b0sitemaps url\u3002 sitemap_urls \u6307\u5411sitemaps\u7684url\u5217\u8868\uff0c\u5b83\u7684url\u662f\u60a8\u60f3\u8981\u6293\u53d6\u7684\u3002 \u4f60\u4e5f\u53ef\u4ee5\u6307\u7740\u4e00\u4e2a robots.txt \u5e76\u4e14\u4ecesitemap urls\u63d0\u53d6\u5b83\u5e76\u89e3\u6790\u5b83 sitemap_rules \u4e00\u4e2a\u5143\u7ec4 (regex, callback) : regex \u662f\u4e00\u79cd\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u7528\u6765\u5339\u914d\u4ecesitemaps\u4e2d\u63d0\u53d6\u7684url\u3002 regex \u53ef\u4ee5\u662fstr\u6216\u7f16\u8bd1(compiled)\u8fc7\u7684regex\u5bf9\u8c61\u3002 callback\u662f\u7528\u6765\u5904\u7406\u4e0e\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\u7684url\u7684\u56de\u8c03\u3002 callback \u53ef\u4ee5\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff08\u8868\u793a\u4e00\u4e2aspider\u65b9\u6cd5\u7684\u540d\u79f0\uff09\u6216\u53ef\u8c03\u7528\u3002 \u4e3e\u4e2a\u4f8b\u5b50: sitemap_rules = [('/product/', 'parse_product')] \u89c4\u5219\u662f\u6309\u987a\u5e8f\u5e94\u7528\u7684\uff0c\u53ea\u6709\u7b2c\u4e00\u4e2a\u5339\u914d\u7684\u89c4\u5219\u624d\u4f1a\u88ab\u4f7f\u7528\u3002 \u5982\u679c\u60a8\u7701\u7565\u4e86\u8fd9\u4e2a\u5c5e\u6027\uff0c\u90a3\u4e48\u5728sitemaps\u4e2d\u627e\u5230\u7684\u6240\u6709url\u90fd\u5c06\u4f7f\u7528 parse \u56de\u8c03\u5904\u7406\u3002 sitemap_follow \u5e94\u8be5\u9075\u5faa\u7684sitemap\u7684regexes\u5217\u8868\u3002\u8fd9\u4ec5\u9002\u7528\u4e8e\u4f7f\u7528\u6307\u5411\u5176\u4ed6 \u7ad9\u70b9\u5730\u56fe\u6587\u4ef6 \u7684\u7ad9\u70b9\u5730\u56fe\u7d22\u5f15\u6587\u4ef6\u7684\u7ad9\u70b9\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6240\u6709\u7684sitemaps\u90fd\u4f1a\u88ab\u8ddf\u8e2a\u3002 sitemap_alternate_links \u6307\u5b9a\u662f\u5426\u5e94\u8be5\u9075\u5faa\u4e00\u4e2a url \u7684\u5907\u7528\u94fe\u63a5\u3002\u8fd9\u4e9b\u662f\u540c\u4e00\u7f51\u7ad9\u7684\u94fe\u63a5\uff0c\u5728\u540c\u4e00\u4e2a url \u5757\u4e2d\u4f20\u9012\u7684\u53e6\u4e00\u79cd\u8bed\u8a00\u3002 \u4e3e\u4e2a\u4f8b\u5b50: url loc http://example.com/ /loc xhtml:link rel= alternate hreflang= de href= http://example.com/de / /url \u6709\u4e86 sitemap_alternate_links \u96c6\uff0c\u8fd9\u5c06\u68c0\u7d22\u4e24\u4e2aurl\u3002 sitemap_alternate_links \u88ab\u7981\u7528\uff0c\u53ea\u6709 http://example.com/ \u5c06\u88ab\u68c0\u7d22\u3002 \u9ed8\u8ba4\u662f sitemap_alternate_links \u7981\u7528\u3002 SitemapSpider\u4f8b\u5b50 \u6700\u7b80\u5355\u7684\u4f8b\u5b50\uff1a\u4f7f\u7528 parse \u56de\u8c03\u5904\u7406sitemaps\u53d1\u73b0\u7684\u6240\u6709url\uff1a from scrapy.spiders import SitemapSpider class MySpider(SitemapSpider): sitemap_urls = ['http://www.example.com/sitemap.xml'] def parse(self, response): pass # \u6293\u53d6\u7684item\u5728\u8fd9\u91cc \u5904\u7406\u4e00\u4e9b\u5e26\u6709\u7279\u5b9a\u56de\u8c03\u7684url\u548c\u5176\u4ed6\u5177\u6709\u4e0d\u540c\u56de\u8c03\u7684url\uff1a from scrapy.spiders import SitemapSpider class MySpider(SitemapSpider): sitemap_urls = ['http://www.example.com/sitemap.xml'] sitemap_rules = [ ('/product/', 'parse_product'), ('/category/', 'parse_category'), ] def parse_product(self, response): pass # ... \u6293\u53d6product ... def parse_category(self, response): pass # ... \u6293\u53d6category ... \u8ddf\u8e2a\u5728 robots.txt \u6587\u4ef6\u4e0a\u7684sitemaps\uff0c\u5e76\u4e14\u53ea\u5173\u6ce8\u5176url\u5305\u542b /sitemap_shop \u7684sitemaps\uff1a from scrapy.spiders import SitemapSpider class MySpider(SitemapSpider): sitemap_urls = ['http://www.example.com/robots.txt'] sitemap_rules = [ ('/shop/', 'parse_shop'), ] sitemap_follow = ['/sitemap_shops'] def parse_shop(self, response): pass # ... \u6293\u53d6\u7684shop\u5728\u8fd9\u91cc ... \u5c06SitemapSpider\u4e0e\u5176\u4ed6url\u6765\u6e90\u76f8\u7ed3\u5408\uff1a from scrapy.spiders import SitemapSpider class MySpider(SitemapSpider): sitemap_urls = ['http://www.example.com/robots.txt'] sitemap_rules = [ ('/shop/', 'parse_shop'), ] other_urls = ['http://www.example.com/about'] def start_requests(self): requests = list(super(MySpider, self).start_requests()) requests += [scrapy.Request(x, self.parse_other) for x in self.other_urls] return requests def parse_shop(self, response): pass # ... \u6293\u53d6\u7684shop\u5728\u8fd9\u91cc ... def parse_other(self, response): pass # ... \u6293\u53d6\u7684other\u5728\u8fd9\u91cc ...","title":"Spiders(\u81ea\u5b9a\u4e49\u722c\u866b\u7c7b)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/07-spiders/#spiders","text":"spider\u662f\u5b9a\u4e49\u5982\u4f55\u6293\u53d6\u67d0\u4e2a\u7ad9\u70b9(\u6216\u4e00\u7ec4\u7ad9\u70b9)\u7684\u7c7b\uff0c\u5305\u62ec\u5982\u4f55\u6267\u884c\u6293\u53d6(\u5373\u8ddf\u8e2a\u94fe\u63a5)\u4ee5\u53ca\u5982\u4f55\u4ece\u9875\u9762\u4e2d\u63d0\u53d6\u7ed3\u6784\u5316\u6570\u636e(\u5373\u6293\u53d6items)\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u722c\u866b\u662f\u60a8\u4e3a\u67d0\u4e2a\u7279\u5b9a\u7ad9\u70b9(\u6216\u8005\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u662f\u4e00\u7ec4\u7ad9\u70b9)\u7684\u9875\u9762\u6293\u53d6\u548c\u89e3\u6790\u5b9a\u4e49\u5b9a\u5236\u884c\u4e3a\u7684\u5730\u65b9\u3002 \u5bf9\u4e8espiders\u6765\u8bf4\uff0c\u6293\u53d6\u5468\u671f\u662f\u8fd9\u6837\u7684: \u9996\u5148\u751f\u6210\u521d\u59cb\u8bf7\u6c42\u6765\u6293\u53d6\u7b2c\u4e00\u4e2aurl\uff0c\u5e76\u6307\u5b9a\u8981\u4f7f\u7528\u4ece\u8fd9\u4e9brequests\u4e0b\u8f7d\u7684response\u8c03\u7528\u7684\u56de\u8c03\u51fd\u6570\u3002 \u8981\u6267\u884c\u7684\u7b2c\u4e00\u4e2a\u8bf7\u6c42\u662f\u901a\u8fc7\u8c03\u7528 start_requests() \u65b9\u6cd5\u83b7\u5f97\u7684\uff0c\u8fd9\u4e2a\u65b9\u6cd5(\u9ed8\u8ba4\u60c5\u51b5\u4e0b)\u4e3a start_urls \u4e2d\u6307\u5b9a\u7684url\u751f\u6210 requests \uff0c\u800c parse \u65b9\u6cd5\u4f5c\u4e3arequests\u7684\u56de\u8c03\u51fd\u6570\u3002 \u5728\u56de\u8c03\u51fd\u6570\u4e2d\uff0c\u89e3\u6790response(web\u9875\u9762)\u5e76\u4f7f\u7528\u63d0\u53d6\u7684\u6570\u636e\u3001 Item \u5bf9\u8c61\u3001 Requests \u5bf9\u8c61\u6216\u8fd9\u4e9b\u5bf9\u8c61\u7684\u8fed\u4ee3\u8fd4\u56dedicts\u3002\u8fd9\u4e9bRequests\u8fd8\u5c06\u5305\u542b\u4e00\u4e2a\u56de\u8c03(\u53ef\u80fd\u76f8\u540c)\uff0c\u7136\u540e\u7531Scrapy\u4e0b\u8f7d\uff0c\u7136\u540e\u7531\u6307\u5b9a\u7684\u56de\u8c03\u5904\u7406\u5b83\u4eec\u7684response\u3002 \u5728\u56de\u8c03\u51fd\u6570\u4e2d\uff0c\u60a8\u53ef\u4ee5\u89e3\u6790\u9875\u9762\u5185\u5bb9\uff0c\u901a\u5e38\u4f7f\u7528 \u9009\u62e9\u5668 (\u4f46\u4e5f\u53ef\u4ee5\u4f7f\u7528BeautifulSoup\u3001lxml\u6216\u4efb\u4f55\u60a8\u559c\u6b22\u7684\u673a\u5236)\uff0c\u5e76\u4f7f\u7528\u89e3\u6790\u540e\u7684\u6570\u636e\u751f\u6210items\u3002 \u6700\u540e\uff0c\u4ecespider\u8fd4\u56de\u7684items\u901a\u5e38\u4f1a\u6301\u4e45\u5316\u5230\u6570\u636e\u5e93(\u5728\u67d0\u4e2aItem Pipeline\u4e2d)\uff0c\u6216\u8005\u5199\u5165\u6587\u4ef6\u4f7f\u7528 Feed exports \u5c3d\u7ba1\u8fd9\u4e2a\u5468\u671f\u9002\u7528\u4e8e(\u6216\u591a\u6216\u5c11)\u4efb\u4f55\u7c7b\u578b\u7684\u722c\u866b\uff0c\u4f46\u662f\u4e3a\u4e86\u4e0d\u540c\u7684\u76ee\u7684\u5c06\u4e0d\u540c\u7c7b\u578b\u7684\u9ed8\u8ba4spider\u6253\u5305\u5230Scrapy\u4e2d\u3002\u6211\u4eec\u5c06\u5728\u8fd9\u91cc\u8ba8\u8bba\u8fd9\u4e9b\u7c7b\u578b\u3002","title":"Spiders(\u81ea\u5b9a\u4e49\u722c\u866b\u7c7b)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/07-spiders/#scrapyspider","text":"","title":"scrapy.Spider"},{"location":"2. \u57fa\u672c\u6982\u5ff5/07-spiders/#scrapyspidersspider-class","text":"\u8fd9\u662f\u6700\u7b80\u5355\u7684spider\uff0c\u4e5f\u662f\u6240\u6709\u5176\u4ed6spider\u90fd\u5fc5\u987b\u7ee7\u627f\u7684spider(\u5305\u62ec\u4e0eScrapy\u6346\u7ed1\u5728\u4e00\u8d77\u7684spider\uff0c\u4ee5\u53ca\u4f60\u81ea\u5df1\u7f16\u5199\u7684spider)\u3002\u5b83\u4e0d\u63d0\u4f9b\u4efb\u4f55\u7279\u6b8a\u7684\u529f\u80fd\u3002\u5b83\u53ea\u63d0\u4f9b\u4e86\u4e00\u4e2a\u9ed8\u8ba4\u7684start_requests()\u5b9e\u73b0\u65b9\u6cd5\uff0c\u5b83\u4ecespider\u5c5e\u6027\u91cc\u7684 start_urls \u53d1\u51fa\u8bf7\u6c42\uff0c\u5e76\u4e3a\u6bcf\u4e2a\u5f97\u5230\u7684responses\u8c03\u7528spider parse \u65b9\u6cd5\u3002 name \u5b9a\u4e49\u6b64\u722c\u866b\u540d\u79f0\u7684\u5b57\u7b26\u4e32\u3002spider\u540d\u79f0\u662f\u7531Scrapy\u5b9a\u4f4d(\u5e76\u5b9e\u4f8b\u5316)\u7684\u65b9\u5f0f\uff0c\u56e0\u6b64\u5b83\u5fc5\u987b\u662f\u60df\u4e00\u7684\u3002\u4f46\u662f\uff0c\u6ca1\u6709\u4ec0\u4e48\u53ef\u4ee5\u963b\u6b62\u60a8\u5b9e\u4f8b\u5316\u540c\u4e00\u4e2a\u722c\u884c\u5668\u7684\u591a\u4e2a\u5b9e\u4f8b\u3002\u8fd9\u662f\u6700\u91cd\u8981\u7684spider\u5c5e\u6027\uff0c\u4e5f\u662f\u5fc5\u9700\u7684\u3002 \u5982\u679cspider\u6293\u53d6\u4e86\u4e00\u4e2a\u57df\u540d\uff0c\u901a\u5e38\u7684\u505a\u6cd5\u662f\u7528\u57df\u540d\u6765\u547d\u540d\u722c\u866b\uff0c\u4e0d\u7ba1\u6709\u6ca1\u6709 TLD(\u9876\u7ea7\u57df\u540d) \u3002\u4f8b\u5982\uff0c\u6293\u53d6 mywebsite.com \u7684spider\u901a\u5e38\u88ab\u79f0\u4e3a mywebsite \u3002 \u6ce8\u610f!!!!!! \u5728python2\u91cc\uff0c\u5fc5\u987b\u662fASCII\u7801\u3002 allowed_domains \u4e00\u4e2a\u53ef\u9009\u7684\u5b57\u7b26\u4e32\u5217\u8868\uff0c\u5176\u4e2d\u5305\u542b\u5141\u8bb8\u6b64spider\u6293\u53d6\u7684\u57df\u540d\u3002\u5982\u679c\u542f\u7528\u4e86 OffsiteMiddleware \uff0c\u5c06\u4e0d\u4f1a\u8ddf\u8e2a\u4e0d\u5c5e\u4e8e\u672c\u5217\u8868\u4e2d\u6307\u5b9a\u7684\u57df\u540d(\u6216\u5176\u5b50\u57df\u540d)\u7684url\u8bf7\u6c42\u3002 \u5047\u8bbe\u60a8\u7684\u76ee\u6807url\u662f https://www.example.com/1.html \uff0c\u7136\u540e\u5c06 'example.com' \u6dfb\u52a0\u5230\u5217\u8868\u4e2d\u3002 start_urls \u5f53\u6ca1\u6709\u6307\u5b9a\u7279\u5b9a\u7684url\u65f6\uff0c\u722c\u866b\u5c06\u4ece\u5176\u4e2d\u5f00\u59cb\u6293\u53d6url\u5217\u8868\u8fdb\u884c\u6293\u53d6\u3002\u6240\u4ee5\uff0c\u4e0b\u8f7d\u7684\u7b2c\u4e00\u4e2a\u9875\u9762\u5c31\u662f\u4ece\u8fd9\u91cc\u51fa\u6765\u7684\u3002\u540e\u7eed Request \u90fd\u662f\u4ecestart url\u4e2d\u5305\u542b\u7684\u6570\u636e\u8fde\u7eed\u751f\u6210\u7684\u3002 custom_settings \u8fd0\u884c\u6b64\u722c\u866b\u65f6\u5c06\u4f1a\u8986\u76d6\u9879\u76ee\u6587\u4ef6\u91cc\u7684\u8bbe\u7f6e\u3002\u5b83\u5fc5\u987b\u88ab\u5b9a\u4e49\u4e3a\u7c7b\u5c5e\u6027\uff0c\u56e0\u4e3a\u5728\u5b9e\u4f8b\u5316\u4e4b\u524d\u5df2\u7ecf\u66f4\u65b0\u4e86\u8bbe\u7f6e\u3002 \u6709\u5173\u53ef\u7528\u7684\u5185\u7f6e\u8bbe\u7f6e\u7684\u5217\u8868\uff0c\u8bf7\u53c2\u9605: \u5185\u7f6e\u7684\u8bbe\u7f6e\u53c2\u8003 crawler \u8fd9\u4e2a\u5c5e\u6027\u662f\u5728\u521d\u59cb\u5316\u7c7b\u4e4b\u540e\u7531 from_crawler \u7c7b\u65b9\u6cd5\u8bbe\u7f6e\u7684\uff0c\u5e76\u4e14\u94fe\u63a5\u5230\u8fd9\u4e2a\u722c\u866b\u5b9e\u4f8b\u7ed1\u5b9a\u5230\u7684 Crawler \u5bf9\u8c61\u3002 Crawlers\u5728\u9879\u76ee\u4e2d\u5c01\u88c5\u4e86\u8bb8\u591a\u7ec4\u4ef6\uff0c\u7528\u4e8e\u5b83\u4eec\u7684\u5355\u4e00\u5165\u53e3\u8bbf\u95ee(\u5982\u6269\u5c55\u3001\u4e2d\u95f4\u4ef6\u3001\u4fe1\u53f7\u7ba1\u7406\u5668\u7b49)\u3002\u67e5\u770b Crawler API \u4e86\u89e3\u66f4\u591a\u4fe1\u606f\u3002 settings \u8fd0\u884c\u6b64spider\u7684\u914d\u7f6e\u3002\u8fd9\u662f\u4e00\u4e2a Settings \u5b9e\u4f8b\uff0c\u6709\u5173\u8fd9\u4e2a\u4e3b\u9898\u7684\u8be6\u7ec6\u4ecb\u7ecd\uff0c\u8bf7\u53c2\u9605 \u8bbe\u7f6e \u4e3b\u9898\u3002 logger \u7528Spider\u7684 \u540d\u5b57 \u521b\u5efa\u7684Python\u65e5\u5fd7\u8bb0\u5f55\u5668\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u5b83\u6765\u901a\u8fc7\u5b83\u53d1\u9001\u65e5\u5fd7\u6d88\u606f\uff0c\u6b63\u5982\u5728 spider\u65e5\u5fd7\u8bb0\u5f55 \u4e2d\u6240\u63cf\u8ff0\u7684\u90a3\u6837\u3002 from_crawler(crawler, args, *kwargs) \u8fd9\u662fScrapy\u7528\u6765\u521b\u5efaSpider\u7684\u7c7b\u65b9\u6cd5\u3002 \u60a8\u53ef\u80fd\u4e0d\u9700\u8981\u76f4\u63a5\u8986\u76d6\u5b83\uff0c\u56e0\u4e3a\u9ed8\u8ba4\u5b9e\u73b0\u5145\u5f53 __init__() \u65b9\u6cd5\uff0c\u4f7f\u7528\u7ed9\u5b9a\u7684\u53c2\u6570arg\u548c\u547d\u540d\u7684\u53c2\u6570kwargs\u8c03\u7528\u5b83\u3002 \u5c3d\u7ba1\u5982\u6b64\uff0c\u8be5\u65b9\u6cd5\u5728\u65b0\u5b9e\u4f8b\u4e2d\u8bbe\u7f6e\u4e86 crawler \u548c settings \u5c5e\u6027\uff0c\u4ee5\u4fbf\u7a0d\u540e\u53ef\u4ee5\u5728\u722c\u866b\u4ee3\u7801\u4e2d\u8bbf\u95ee\u5b83\u4eec\u3002 \u53c2\u6570: crawler ( Crawler \u5b9e\u4f8b) \u2013 \u722c\u866b\uff0cspider\u88ab\u7ed1\u5728\u4e0a\u9762 args (\u5217\u8868) \u2013 \u4f20\u9012\u7ed9 __init__() \u65b9\u6cd5\u7684\u53c2\u6570 kwargs (\u5b57\u5178) \u2013 \u4f20\u9012\u7ed9 __init__() \u65b9\u6cd5\u7684\u5173\u952e\u5b57\u53c2\u6570 start_requests() \u5f53spider\u88ab\u6253\u5f00\u8fdb\u884c\u6293\u53d6\u7684\u65f6\u5019, \u8fd9\u4e2a\u65b9\u6cd5\u5fc5\u987b\u8fd4\u56de\u4e00\u4e2a\u53ef\u8fed\u4ee3\u7684\u5bf9\u8c61\uff0c\u5176\u4e2d\u5c31\u5305\u542b\u53d1\u51fa\u53bb\u7684\u7b2c\u4e00\u4e2aRequests\u3002\u8fd9\u6837\u5c31\u88ab\u79f0\u4e3a\u201cScrapy\u201d\u3002Scrapy\u53ea\u8c03\u7528\u4e00\u6b21\uff0c\u6240\u4ee5\u5c06 start_requests() \u4f5c\u4e3a\u751f\u6210\u5668\u5b9e\u73b0\u662f\u5b89\u5168\u7684\u3002 \u9ed8\u8ba4\u5b9e\u73b0\u4e3astart_urls\u4e2d\u7684\u6bcf\u4e2aurl\u751f\u6210 Request(url, dont_filter=True) \u3002 \u5982\u679c\u60a8\u53ea\u60f3\u53d1\u9001\u4e00\u4e2a\u8bf7\u6c42\u800c\u4e0d\u662f\u7528\u751f\u6210\u5668\u7684\u65b9\u5f0f\uff0c \u90a3\u4e48\u5c31\u7528\u8986\u76d6\u7684\u65b9\u5f0f\uff0c \u76f4\u63a5\u5728Request\u91cc\u9762\u91cd\u5199url\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u9700\u8981\u4ece\u4f7f\u7528POST\u8bf7\u6c42\u767b\u5f55\u5f00\u59cb\uff0c\u60a8\u53ef\u4ee5\u8fd9\u6837\u505a: class MySpider(scrapy.Spider): name = 'myspider' def start_requests(self): return [scrapy.FormRequest( http://www.example.com/login , formdata={'user': 'john', 'pass': 'secret'}, callback=self.logged_in)] def logged_in(self, response): # here you would extract links to follow and return Requests for # each of them, with another callback pass parse(response) \u5f53\u8fd9\u4e9b\u8bf7\u6c42\u6ca1\u6709\u6307\u5b9a\u56de\u8c03\u65f6\uff0cScrapy\u4f7f\u7528\u9ed8\u8ba4\u56de\u8c03\u6765\u5904\u7406\u4e0b\u8f7d\u7684response\u3002 parse \u65b9\u6cd5\u8d1f\u8d23\u5904\u7406response\u5e76\u8fd4\u56de\u6293\u53d6\u7684\u6570\u636e\u6216\u66f4\u591aurl\u6765\u8ffd\u8e2a\u3002\u5176\u4ed6Requests\u56de\u8c03\u5177\u6709\u4e0e Spider \u7c7b\u76f8\u540c\u7684\u9700\u6c42\u3002 \u6b64\u65b9\u6cd5\u4ee5\u53ca\u4efb\u4f55\u5176\u4ed6Request\u56de\u8c03\u90fd\u5fc5\u987b\u8fd4\u56de Request \u548c/\u6216dicts\u6216 Item \u5bf9\u8c61\u7684\u8fed\u4ee3\u3002 \u53c2\u6570: response ( Response ) \u2013 \u89e3\u6790\u4e4b\u540e\u7684response log (message[, level, component]) \u901a\u8fc7\u722c\u866b logger \u5c06\u5927\u91cf\u7684\u4fe1\u606f\u5305\u88c5\u8d77\u6765\uff0c\u7528\u4e8e\u5411\u540e\u517c\u5bb9\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1\u722c\u884c\u5668 \u65e5\u5fd7\u8bb0\u5f55 \u3002 closed (reason) \u5f53Spider\u5173\u95ed\u65f6\u4f1a\u88ab\u8c03\u7528\u3002\u8fd9\u4e2a\u65b9\u6cd5\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5feb\u6377\u65b9\u5f0f\uff0csignals.connect()\u7528\u4e8e spider_closed \u4fe1\u53f7\u3002 \u8ba9\u6211\u4eec\u770b\u4e00\u4e2a\u4f8b\u5b50: import scrapy class MySpider(scrapy.Spider): name = 'example.com' allowed_domains = ['example.com'] start_urls = [ 'http://www.example.com/1.html', 'http://www.example.com/2.html', 'http://www.example.com/3.html', ] def parse(self, response): self.logger.info('A response from %s just arrived!', response.url) \u591a\u4e2aRequests\u548citems\u53ef\u4ee5\u7528\u4e00\u4e2a\u56de\u8c03\u6765\u5b8c\u6210 import scrapy class MySpider(scrapy.Spider): name = 'example.com' allowed_domains = ['example.com'] start_urls = [ 'http://www.example.com/1.html', 'http://www.example.com/2.html', 'http://www.example.com/3.html', ] def parse(self, response): for h3 in response.xpath('//h3').extract(): yield { title : h3} for url in response.xpath('//a/@href').extract(): yield scrapy.Request(url, callback=self.parse) \u4e0e start_urls \u4e0d\u540c\uff0c\u60a8\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 startrequest() \u4e3a\u4e86\u7ed9\u6570\u636e\u63d0\u4f9b\u66f4\u591a\u7684\u7ed3\u6784\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 Items : import scrapy from myproject.items import MyItem class MySpider(scrapy.Spider): name = 'example.com' allowed_domains = ['example.com'] def start_requests(self): yield scrapy.Request('http://www.example.com/1.html', self.parse) yield scrapy.Request('http://www.example.com/2.html', self.parse) yield scrapy.Request('http://www.example.com/3.html', self.parse) def parse(self, response): for h3 in response.xpath('//h3').extract(): yield MyItem(title=h3) for url in response.xpath('//a/@href').extract(): yield scrapy.Request(url, callback=self.parse)","title":"scrapy.spiders.Spider   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/07-spiders/#spider","text":"Spider\u53ef\u4ee5\u63a5\u53d7\u4fee\u6539\u81ea\u5df1\u884c\u4e3a\u7684\u53c2\u6570\u3002\u4e00\u4e9b\u5e38\u89c1\u7684spider\u53c2\u6570\u5927\u591a\u7528\u9014\u662f\u5b9a\u4e49\u8d77\u59cburl\uff0c\u6216\u8005\u9650\u5236\u6293\u53d6\u67d0\u4e9b\u7ad9\u70b9\u67d0\u4e9b\u90e8\u5206\uff0c\u4f46\u662f\u5b83\u4eec\u53ef\u4ee5\u7528\u6765\u914d\u7f6espider\u7684\u4efb\u4f55\u529f\u80fd\u3002 Spider\u53c2\u6570\u901a\u8fc7 crawl \u547d\u4ee4\u4f7f\u7528 -a \u9009\u9879\u6765\u63a5\u6536\u53c2\u6570\u3002\u4f8b\u5982: scrapy crawl myspider -a category=electronics Spider\u53ef\u4ee5\u5728 __init__ \u65b9\u6cd5\u4e2d\u8bbf\u95ee\u53c2\u6570\uff1a import scrapy class MySpider(scrapy.Spider): name = 'myspider' def __init__(self, category=None, *args, **kwargs): super(MySpider, self).__init__(*args, **kwargs) self.start_urls = ['http://www.example.com/categories/%s' % category] # ... \u9ed8\u8ba4\u7684 init \u65b9\u6cd5\u5c06\u63a5\u53d7\u4efb\u4f55spider\u53c2\u6570\uff0c\u5e76\u5c06\u5b83\u4eec\u590d\u5236\u5230spider\u4f5c\u4e3a\u5c5e\u6027\u3002\u4e0a\u9762\u7684\u4f8b\u5b50\u4e5f\u53ef\u4ee5\u5199\u5982\u4e0b\uff1a import scrapy class MySpider(scrapy.Spider): name = 'myspider' def start_requests(self): yield scrapy.Request('http://www.example.com/categories/%s' % self.category) \u8bf7\u8bb0\u4f4f\uff0cspider\u53c2\u6570\u53ea\u80fd\u662f\u5b57\u7b26\u4e32\u3002\u722c\u884c\u5668\u4e0d\u4f1a\u81ea\u5df1\u8fdb\u884c\u4efb\u4f55\u89e3\u6790\u3002\u5982\u679c\u60a8\u8981\u4ece\u547d\u4ee4\u884c\u8bbe\u7f6estart_urls\u5c5e\u6027\uff0c\u60a8\u5c06\u4e0d\u5f97\u4e0d\u4f7f\u7528\u8bf8\u5982 ast.literal eval \u6216 json.loads \u4e4b\u7c7b\u7684\u4e1c\u897f\u5c06\u5176\u89e3\u6790\u6210\u4e00\u4e2a\u5217\u8868\u3002\u52a0\u8f7d\u5e76\u5c06\u5176\u8bbe\u7f6e\u4e3a\u5c5e\u6027\u3002\u5426\u5219\uff0c\u60a8\u5c06\u5bfc\u81f4\u5bf9start_urls\u5b57\u7b26\u4e32\uff08\u4e00\u4e2a\u975e\u5e38\u5e38\u89c1\u7684python\u9677\u9631\uff09\u7684\u8fed\u4ee3\uff0c\u5bfc\u81f4\u6bcf\u4e2a\u5b57\u7b26\u88ab\u89c6\u4e3a\u4e00\u4e2a\u5355\u72ec\u7684url\u3002 \u4e00\u4e2a\u6709\u6548\u7684\u7528\u4f8b\u662f\u4f7f\u7528http\u8ba4\u8bc1\u51ed\u636e HttpAuthMiddleware \u6216\u4f7f\u7528\u7684\u7528\u6237\u4ee3\u7406 UserAgentMiddleware \uff1a scrapy crawl myspider -a http_user=myuser -a http_pass=mypassword -a user_agent=mybot Spider\u53c2\u6570\u4e5f\u53ef\u4ee5\u901a\u8fc7Scrapyd\u7684 schedule.json API\u6765\u4f20\u9012, \u67e5\u770b Scrapyd\u6587\u6863","title":"Spider\u53c2\u6570"},{"location":"2. \u57fa\u672c\u6982\u5ff5/07-spiders/#spiders_1","text":"Scrapy\u6709\u4e00\u4e9b\u6709\u7528\u7684\u901a\u7528spiders\uff0c\u4f60\u53ef\u4ee5\u7528\u5728\u4f60\u81ea\u5df1\u7684spiders\u4e0a\u9762\u7ee7\u627f\u5b83\u4eec\u3002\u4ed6\u4eec\u7684\u76ee\u6807\u662f\u4e3a\u4e00\u4e9b\u5e38\u89c1\u7684\u6293\u53d6\u6848\u4f8b\u63d0\u4f9b\u65b9\u4fbf\u7684\u529f\u80fd\uff0c\u6bd4\u5982\u6839\u636e\u67d0\u4e9b\u89c4\u5219\u5728\u7ad9\u70b9\u4e0a\u7684\u6240\u6709\u94fe\u63a5\uff0c\u4ece Sitemaps \u4e0a\u6293\u53d6\uff0c\u6216\u8005\u89e3\u6790\u4e00\u4e2axml/csv feed\u3002 \u5bf9\u4e8e\u4e0b\u9762\u7684spiders\u4e2d\u4f7f\u7528\u7684\u4f8b\u5b50\uff0c\u6211\u4eec\u5047\u8bbe\u60a8\u6709\u4e00\u4e2a\u9879\u76ee\uff0c\u5b83\u7684\u4e00\u4e2a\u9879\u76ee\u662f\u5728myproject\u4e2d\u58f0\u660e\u7684\u3002\u9879\u76ee\u6a21\u5757: import scrapy class TestItem(scrapy.Item): id = scrapy.Field() name = scrapy.Field() description = scrapy.Field()","title":"\u901a\u7528\u7684Spiders"},{"location":"2. \u57fa\u672c\u6982\u5ff5/07-spiders/#crawlspider","text":"","title":"CrawlSpider"},{"location":"2. \u57fa\u672c\u6982\u5ff5/07-spiders/#scrapyspiderscrawlspider-class","text":"\u8fd9\u662f\u6700\u5e38\u7528\u7684\u6293\u53d6\u5e38\u89c4\u7f51\u7ad9\u7684spider\uff0c\u56e0\u4e3a\u5b83\u63d0\u4f9b\u4e86\u4e00\u79cd\u65b9\u4fbf\u7684\u673a\u5236\uff0c\u901a\u8fc7\u5b9a\u4e49\u4e00\u7ec4\u89c4\u5219\u6765\u8ddf\u8e2a\u94fe\u63a5\u3002\u5b83\u53ef\u80fd\u4e0d\u662f\u6700\u9002\u5408\u60a8\u7684\u7279\u5b9aweb\u7ad9\u70b9\u6216\u9879\u76ee\u7684\uff0c\u4f46\u662f\u5b83\u5bf9\u4e8e\u51e0\u4e2a\u6848\u4f8b\u6765\u8bf4\u662f\u901a\u7528\u7684\uff0c\u6240\u4ee5\u60a8\u53ef\u4ee5\u4ece\u5b83\u5f00\u59cb\uff0c\u6839\u636e\u9700\u8981\u91cd\u5199\u5b83\uff0c\u4ee5\u83b7\u5f97\u66f4\u591a\u7684\u81ea\u5b9a\u4e49\u529f\u80fd\uff0c\u6216\u8005\u4ec5\u4ec5\u5b9e\u73b0\u60a8\u81ea\u5df1\u7684spider\u3002 \u9664\u4e86\u4eceSpider\u7ee7\u627f\u7684\u5c5e\u6027\uff08\u60a8\u5fc5\u987b\u6307\u5b9a\uff09\u4e4b\u5916\uff0c\u8be5\u7c7b\u8fd8\u652f\u6301\u4e00\u4e2a\u65b0\u5c5e\u6027\uff1a rules \u5b83\u662f\u4e00\u4e2a\uff08\u6216\u591a\u4e2a\uff09 Rule \u5bf9\u8c61\u7684\u5217\u8868\u3002\u6bcf\u4e2a Rule \u90fd\u5b9a\u4e49\u4e86\u6293\u53d6\u7ad9\u70b9\u7684\u7279\u5b9a\u884c\u4e3a\u3002Rules\u5bf9\u8c61\u5982\u4e0b\u6240\u8ff0\u3002\u6839\u636e\u5b83\u4eec\u5728\u8be5\u5c5e\u6027\u4e2d\u5b9a\u4e49\u7684\u987a\u5e8f, \u5982\u679c\u591a\u4e2a\u89c4\u5219\u5339\u914d\u76f8\u540c\u7684\u94fe\u63a5\uff0c\u90a3\u4e48\u7b2c\u4e00\u4e2a\u89c4\u5219\u5c06\u88ab\u4f7f\u7528. \u8fd9\u4e2asppider\u8fd8\u516c\u5f00\u4e86\u4e00\u79cd\u53ef\u91cd\u5199\u7684\u65b9\u6cd5\uff1a parse_start_url(response) \u8fd9\u79cd\u65b9\u6cd5\u7528\u6765\u56de\u8c03start_urls\u7684response\u3002\u5b83\u5141\u8bb8\u89e3\u6790\u521d\u59cbresponse\uff0c\u5e76\u4e14\u5fc5\u987b\u8fd4\u56de Item \u5bf9\u8c61\u3001 Request \u5bf9\u8c61\u6216\u5305\u542b\u5176\u4e2d\u4efb\u4f55\u4e00\u4e2a\u7684\u53ef\u8fed\u4ee3\u7684\u3002","title":"scrapy.spiders.CrawlSpider   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/07-spiders/#crawling-rules","text":"","title":"Crawling rules"},{"location":"2. \u57fa\u672c\u6982\u5ff5/07-spiders/#scrapyspidersrulelink_extractor-callbacknone-cb_kwargsnone-follownone-process_linksnone-process_requestnone-class","text":"link_extractor \u662f\u4e00\u4e2a Link Extractor \u5bf9\u8c61\uff0c\u5b83\u5b9a\u4e49\u4e86\u5982\u4f55\u4ece\u6bcf\u4e2a\u6293\u53d6\u9875\u9762\u4e2d\u63d0\u53d6\u94fe\u63a5\u3002 callback \u662f\u4e00\u4e2a\u53ef\u8c03\u7528\u7684\u6216\u4e00\u4e2a\u5b57\u7b26\u4e32\uff08\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5c06\u4f7f\u7528\u5e26\u6709\u8be5\u540d\u79f0\u7684spider\u5bf9\u8c61\u7684\u65b9\u6cd5\uff09\u6765\u8c03\u7528\u4e0e\u6307\u5b9a\u7684link_extractor\u63d0\u53d6\u7684\u6bcf\u4e00\u4e2a\u94fe\u63a5\u3002\u8fd9\u4e2a\u56de\u8c03\u5c06\u7b2c\u4e00\u4e2a\u53c2\u6570\u4f5c\u4e3aresponse\uff0c\u5e76\u4e14\u5fc5\u987b\u8fd4\u56de\u5305\u542b Item \u548c/\u6216 Requests \u5bf9\u8c61\uff08\u6216\u4efb\u4f55\u5b50\u7c7b\uff09\u7684\u5217\u8868\u3002 \u8b66\u544a\u8b66\u544a\u8b66\u544a!!!!! \u5728\u7f16\u5199\u6293\u53d6\u89c4\u5219\u65f6\uff0c\u907f\u514d\u4f7f\u7528parse\u4f5c\u4e3a\u56de\u8c03\uff0c\u56e0\u4e3aCrawlSpider\u672c\u8eab\u5c31\u662f\u7528\u4e86parse\u65b9\u6cd5\u6765\u5b9e\u73b0\u5b83\u7684\u903b\u8f91\u3002\u6240\u4ee5\u5982\u679c\u4f60\u91cd\u5199\u4e86parse\u65b9\u6cd5\uff0cspider\u5c31\u4e0d\u518d\u5de5\u4f5c\u4e86\u3002 cb_kwargs \u662f\u5305\u542b\u8981\u4f20\u9012\u7ed9\u56de\u8c03\u51fd\u6570\u7684\u5173\u952e\u5b57\u53c2\u6570\u3002 follow \u662f\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u5b83\u6307\u5b9a\u662f\u5426\u5e94\u8be5\u6839\u636e\u8fd9\u4e2a\u89c4\u5219\u63d0\u53d6\u51fa\u7684\u6bcf\u4e2aresponse\u3002\u5982\u679c callbacck \u6ca1\u6709\u6307\u5b9a, \u9ed8\u8ba4 \u4e3a True , \u5426\u5219\u4e3a False \u3002 process_links \u5b83\u662f\u53ef\u8c03\u7528\u7684\uff0c\u6216\u8005\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff08\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5c06\u4f7f\u7528\u6765\u81ea\u4e8espider\u5bf9\u8c61\u7684\u65b9\u6cd5\uff09\uff0c\u6bcf\u4e2a\u54cd\u5e94\u4e2d\u63d0\u53d6\u7684\u6bcf\u4e2a\u94fe\u63a5\u5217\u8868\u90fd\u5c06\u88ab\u8c03\u7528\uff0c\u4f7f\u7528\u6307\u5b9a\u7684 link_extractor \u3002\u8fd9\u4e3b\u8981\u7528\u4e8e\u8fc7\u6ee4\u76ee\u7684\u3002 process_request \u662f\u4e00\u4e2a\u53ef\u8c03\u7528\u7684\uff0c\u6216\u8005\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff08\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5c06\u4f1a\u4f7f\u7528\u6765\u81ea\u4e8e\u8fd9\u4e2a\u540d\u79f0\u7684spider\u5bf9\u8c61\u7684\u65b9\u6cd5\uff09\uff0c\u5728\u8fd9\u4e2a\u89c4\u5219\u4e2d\u63d0\u53d6\u7684\u6bcf\u4e00\u4e2a\u8bf7\u6c42\u90fd\u5c06\u88ab\u8c03\u7528\uff0c\u5e76\u4e14\u5fc5\u987b\u8fd4\u56de\u4e00\u4e2arequest\u6216None\uff08\u4ee5\u8fc7\u6ee4\u6389\u8bf7\u6c42\uff09\u3002","title":"scrapy.spiders.Rule(link_extractor, callback=None, cb_kwargs=None, follow=None, process_links=None, process_request=None)   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/07-spiders/#crawlspider_1","text":"\u73b0\u5728\u8ba9\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u5e26\u6709\u89c4\u5219\u7684spider\u793a\u4f8b\uff1a import scrapy from scrapy.spiders import CrawlSpider, Rule from scrapy.linkextractors import LinkExtractor class MySpider(CrawlSpider): name = 'example.com' allowed_domains = ['example.com'] start_urls = ['http://www.example.com'] rules = ( # \u63d0\u53d6\u94fe\u63a5\u5339\u914d 'category.php' (\u4f46\u4e0d\u5339\u914d 'subsection.php') # \u5e76\u8ddf\u968f\u4ed6\u4eec\u7684\u94fe\u63a5 (\u56e0\u4e3a\u6ca1\u6709\u56de\u8c03\u610f\u5473\u7740\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e3aTrue). Rule(LinkExtractor(allow=('category\\.php', ), deny=('subsection\\.php', ))), # \u63d0\u53d6\u94fe\u63a5\u5339\u914d 'item.php' \u7528spider\u7684\u65b9\u6cd5parse_item\u6765\u89e3\u6790\u5b83\u4eec Rule(LinkExtractor(allow=('item\\.php', )), callback='parse_item'), ) def parse_item(self, response): self.logger.info('Hi, this is an item page! %s', response.url) item = scrapy.Item() item['id'] = response.xpath('//td[@id= item_id ]/text()').re(r'ID: (\\d+)') item['name'] = response.xpath('//td[@id= item_name ]/text()').extract() item['description'] = response.xpath('//td[@id= item_description ]/text()').extract() return item \u8fd9\u4e2aspider\u4f1a\u5728\u5f00\u59cb\u7684\u65f6\u5019\u6293\u53d6example.com\u7684\u4e3b\u9875\uff0c\u6536\u96c6category\u94fe\u63a5\u548citems\u94fe\u63a5\uff0c\u7528 parse_item \u65b9\u6cd5\u89e3\u6790\u540e\u8005\u3002\u5bf9\u4e8e\u6bcf\u4e00\u4e2aitem response\uff0c\u4e00\u4e9b\u6570\u636e\u5c06\u4f7f\u7528XPath\u4eceHTML\u4e2d\u63d0\u53d6\u51fa\u6765\uff0c\u5e76\u4e14\u4e00\u4e2a Item \u5c06\u88ab\u586b\u5145\u3002","title":"CrawlSpider\u4f8b\u5b50"},{"location":"2. \u57fa\u672c\u6982\u5ff5/07-spiders/#xmlfeedspider","text":"","title":"XMLFeedSpider"},{"location":"2. \u57fa\u672c\u6982\u5ff5/07-spiders/#scrapyspidersxmlfeedspider-class","text":"XMLFeedSpider\u662f\u4e3a\u89e3\u6790XML feeds\u800c\u8bbe\u8ba1\u7684\uff0c\u65b9\u6cd5\u662f\u901a\u8fc7\u67d0\u4e2a\u8282\u70b9\u540d\u904d\u5386\u5b83\u4eec\u3002\u8fed\u4ee3\u5668\u53ef\u4ee5\u4ece\uff1a iternodes \u3001 xml \u548c html \u4e2d\u9009\u62e9\u3002\u51fa\u4e8e\u6027\u80fd\u7684\u8003\u8651\uff0c\u5efa\u8bae\u4f7f\u7528 iternodes \u8fed\u4ee3\u5668\uff0c\u56e0\u4e3a xml \u548c html \u8fed\u4ee3\u5668\u4f1a\u540c\u65f6\u751f\u6210\u6574\u4e2aDOM\uff0c\u4ee5\u4fbf\u89e3\u6790\u5b83\u3002\u7136\u800c\uff0c\u4f7f\u7528 html \u4f5c\u4e3a\u8fed\u4ee3\u5668\u5728\u4e00\u4e9b\u6807\u7b7e\u7cdf\u7cd5\u6742\u4e71\u7684XML\u65f6\u53ef\u80fd\u4f1a\u5f88\u6709\u7528\u3002 \u8981\u8bbe\u7f6e\u8fed\u4ee3\u5668\u548c\u6807\u8bb0\u540d\u79f0\uff0c\u60a8\u5fc5\u987b\u5b9a\u4e49\u4e0b\u5217\u7c7b\u5c5e\u6027\uff1a iterator \u4e00\u79cd\u5b9a\u4e49\u8981\u4f7f\u7528\u7684\u8fed\u4ee3\u5668\u7684\u5b57\u7b26\u4e32\u3002\u5b83\u53ef\u4ee5\u662f: 'iternodes' \u57fa\u4e8e\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u5feb\u901f\u8fed\u4ee3\u5668 'html' \u4e00\u4e2a\u4f7f\u7528 Selector \u7684\u8fed\u4ee3\u5668\u3002\u8bf7\u8bb0\u4f4f\uff0c\u8fd9\u4f7f\u7528\u4e86DOM\u89e3\u6790\uff0c\u5e76\u4e14\u5fc5\u987b\u5728\u5185\u5b58\u4e2d\u52a0\u8f7d\u6240\u6709DOM\uff0c\u5927\u578bxml\u5bf9\u4e8e\u5185\u5b58\u6765\u8bf4, \u7edd\u5bf9\u662f\u4e00\u4e2a\u95ee\u9898 'xml' \u5b8c\u5168\u540c\u4e0a \u8fd9\u4e2a\u5c5e\u6027\u9ed8\u8ba4\u4e3a 'iternodes' itertag \u4e00\u4e2a\u5e26\u6709\u8282\u70b9\uff08\u6216\u5143\u7d20\uff09\u540d\u79f0\u7684\u5b57\u7b26\u4e32\uff0c\u4ee5\u8fdb\u884c\u8fed\u4ee3\u3002\u4f8b\u5b50: itertag = 'product' namespaces \u4e00\u7ec4\uff08 prefix \u3001 uri \uff09\u5143\u7ec4\uff0c\u5b83\u5b9a\u4e49\u4e86\u8be5\u6587\u6863\u4e2d\u53ef\u7528\u7684\u540d\u79f0\u7a7a\u95f4\uff0c\u8be5\u540d\u79f0\u7a7a\u95f4\u5c06\u7531\u8be5spider\u5904\u7406\u3002 prefix \u548c uri \u5c06\u4f7f\u7528 registernamespace() \u65b9\u6cd5\u81ea\u52a8\u6ce8\u518c\u540d\u79f0\u7a7a\u95f4\u3002 \u7136\u540e\u60a8\u53ef\u4ee5\u5728 itertag \u5c5e\u6027\u4e2d\u6307\u5b9a\u5e26\u6709\u540d\u79f0\u7a7a\u95f4\u7684\u8282\u70b9\u3002 class YourSpider(XMLFeedSpider): namespaces = [('n', 'http://www.sitemaps.org/schemas/sitemap/0.9')] itertag = 'n:url' # ... \u9664\u4e86\u8fd9\u4e9b\u65b0\u5c5e\u6027\u4e4b\u5916\uff0c\u8fd9\u4e2aspider\u4e5f\u6709\u4ee5\u4e0b\u53ef\u91cd\u5199\u7684\u65b9\u6cd5\uff1a adapt_response(response) \u4e00\u79cd\u4ecespider middleware\u4e2d\u63a5\u6536response\u7684\u65b9\u6cd5\uff0c\uff0c\u5728spider\u5f00\u59cb\u89e3\u6790\u5b83\u4e4b\u524d\u3002\u5b83\u53ef\u4ee5\u7528\u4e8e\u5728\u89e3\u6790response body\u4e4b\u524d\u4fee\u6539\u5b83\u3002\u8fd9\u4e2a\u65b9\u6cd5\u63a5\u6536\u4e00\u4e2aresponse\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2aresponse\uff08\u5b83\u53ef\u4ee5\u662f\u76f8\u540c\u7684\uff0c\u4e5f\u53ef\u4ee5\u662f\u53e6\u4e00\u4e2a\uff09\u3002 parse_node(response, selector) \u8fd9\u79cd\u65b9\u6cd5\u88ab\u79f0\u4e3a\u5339\u914d\u6240\u63d0\u4f9b\u7684\u6807\u8bb0\u540d\u79f0\uff08 itertag \uff09\u7684\u8282\u70b9\u3002\u63a5\u6536\u6bcf\u4e2a\u8282\u70b9\u7684response\u548c Selector \u3002\u91cd\u5199\u8fd9\u4e2a\u65b9\u6cd5\u662f\u5f3a\u5236\u6027\u7684\u3002\u5426\u5219\uff0c\u4f60\u7684spider\u5c31\u4e0d\u4f1a\u5de5\u4f5c\u4e86\u3002\u6b64\u65b9\u6cd5\u5fc5\u987b\u8fd4\u56de Item \u5bf9\u8c61\u3001 Request ]\u5bf9\u8c61\u6216\u5305\u542b\u5176\u4e2d\u4efb\u4f55\u4e00\u4e2a\u7684\u53ef\u8fed\u4ee3\u7684\u3002 process_results(response, results) \u8fd9\u4e2a\u65b9\u6cd5\u662f\u4e3aspider\u8fd4\u56de\u7684\u6bcf\u4e2a\u7ed3\u679c\uff08item\u6216request\uff09\u8c03\u7528\u7684\uff0c\u5e76\u4e14\u5b83\u7684\u76ee\u7684\u662f\u5728\u5c06\u7ed3\u679c\u8fd4\u56de\u5230\u6846\u67b6\u6838\u5fc3\u4e4b\u524d\u6267\u884c\u4efb\u4f55\u6700\u540e\u4e00\u6b21\u5904\u7406\uff0c\u4f8b\u5982\u8bbe\u7f6eitem IDs\u3002\u5b83\u6536\u5230\u4e00\u4e2a\u7ed3\u679c\u5217\u8868\u548c\u4ea7\u751f\u8fd9\u4e9b\u7ed3\u679c\u7684response\u3002\u5b83\u5fc5\u987b\u8fd4\u56de\u4e00\u4e2a\u7ed3\u679c\u5217\u8868\uff08Items\u6216Requests\uff09\u3002","title":"scrapy.spiders.XMLFeedSpider   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/07-spiders/#xmlfeedspider-example","text":"\u8fd9\u4e9bSpiders\u5f88\u5bb9\u6613\u4f7f\u7528\uff0c\u8ba9\u6211\u4eec\u770b\u4e00\u4e2a\u4f8b\u5b50\uff1a from scrapy.spiders import XMLFeedSpider from myproject.items import TestItem class MySpider(XMLFeedSpider): name = 'example.com' allowed_domains = ['example.com'] start_urls = ['http://www.example.com/feed.xml'] iterator = 'iternodes' # \u8fd9\u5b9e\u9645\u4e0a\u662f\u4e0d\u5fc5\u8981\u7684\uff0c\u56e0\u4e3a\u5b83\u662f\u9ed8\u8ba4\u503c itertag = 'item' def parse_node(self, response, node): self.logger.info('Hi, this is a %s node!: %s', self.itertag, ''.join(node.extract())) item = TestItem() item['id'] = node.xpath('@id').extract() item['name'] = node.xpath('name').extract() item['description'] = node.xpath('description').extract() return item \u57fa\u672c\u4e0a\uff0c\u6211\u4eec\u6240\u505a\u7684\u5c31\u662f\u521b\u5efa\u4e00\u4e2a\u4ece\u7ed9\u5b9a\u7684start_url\u4e2d\u4e0b\u8f7dfeed\u7684spider\uff0c\u7136\u540e\u904d\u5386\u6bcf\u4e00\u4e2a item \u6807\u7b7e\uff0c\u6253\u5370\u51fa\u6765\uff0c\u5e76\u5728\u4e00\u4e2a Item \u4e2d\u5b58\u50a8\u4e00\u4e9b\u968f\u673a\u7684\u6570\u636e\u3002","title":"XMLFeedSpider example"},{"location":"2. \u57fa\u672c\u6982\u5ff5/07-spiders/#csvfeedspider","text":"","title":"CSVFeedSpider"},{"location":"2. \u57fa\u672c\u6982\u5ff5/07-spiders/#scrapyspiderscsvfeedspider-class","text":"\u8fd9\u53easpider\u4e0eXMLFeedSpider\u975e\u5e38\u76f8\u4f3c\uff0c\u9664\u4e86\u5b83\u8fed\u4ee3\u7684\u662f\u884c\uff0c\u800c\u4e0d\u662f\u8282\u70b9\u3002\u5728\u6bcf\u6b21\u8fed\u4ee3\u4e2d\u8c03\u7528\u7684\u65b9\u6cd5\u662f parse_row() \u3002 delimiter CSV\u6587\u4ef6\u4e2d\u6bcf\u4e2a\u5b57\u6bb5\u7684\u5206\u9694\u7b26\u5b57\u7b26\u4e32\u9ed8\u8ba4\u4e3a ',' \uff08\u9017\u53f7\uff09\u3002 quotechar CSV\u6587\u4ef6\u4e2d\u6bcf\u4e2a\u5b57\u6bb5\u7684\u5916\u58f3\u5b57\u7b26\u7684\u5b57\u7b26\u4e32\u9ed8\u8ba4\u4e3a \"''\" \uff08\u5f15\u53f7\uff09\u3002 headers CSV\u6587\u4ef6\u4e2d\u5217\u540d\u7684\u5217\u8868\u3002 parse_row(response, row) \u63a5\u6536\u4e00\u4e2aresponse\u548c\u4e00\u4e2a\uff08\u4ee3\u8868\u6bcf\u4e00\u884c\uff09\u7684\u4e00\u4e2adict\uff0c\u5e76\u4e3aCSV\u6587\u4ef6\u7684\u6bcf\u4e2aheader\u63d0\u4f9b(\u6216\u68c0\u6d4b\u5230\u7684)\u4e00\u4e2akey\u3002\u8be5spider\u8fd8\u63d0\u4f9b\u4e86 adapt_response \u548c process_results \u7528\u4e8e\u9884\u5904\u7406\u548c\u540e\u5904\u7406\u7684\u65b9\u6cd5\u3002","title":"scrapy.spiders.CSVFeedSpider   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/07-spiders/#csvfeedspider_1","text":"\u8ba9\u6211\u4eec\u770b\u4e00\u4e2a\u4e0e\u524d\u4e00\u4e2a\u7c7b\u4f3c\u7684\u4f8b\u5b50\uff0c\u4f46\u4f7f\u7528\u7684\u662f CSVFeedSpider \uff1a from scrapy.spiders import CSVFeedSpider from myproject.items import TestItem class MySpider(CSVFeedSpider): name = 'example.com' allowed_domains = ['example.com'] start_urls = ['http://www.example.com/feed.csv'] delimiter = ';' quotechar = ' headers = ['id', 'name', 'description'] def parse_row(self, response, row): self.logger.info('Hi, this is a row!: %r', row) item = TestItem() item['id'] = row['id'] item['name'] = row['name'] item['description'] = row['description'] return item","title":"CSVFeedSpider\u4f8b\u5b50"},{"location":"2. \u57fa\u672c\u6982\u5ff5/07-spiders/#sitemapspider","text":"","title":"SitemapSpider"},{"location":"2. \u57fa\u672c\u6982\u5ff5/07-spiders/#scrapyspiderssitemapspider-class","text":"SitemapSpider\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528 Sitemaps \u53d1\u73b0url\u6765\u6293\u53d6\u7ad9\u70b9\u3002 \u5b83\u652f\u6301\u5d4c\u5957\u7684sitemaps\u5730\u56fe\uff0c\u5e76\u4ece robots.txt \u4e2d\u53d1\u73b0sitemaps url\u3002 sitemap_urls \u6307\u5411sitemaps\u7684url\u5217\u8868\uff0c\u5b83\u7684url\u662f\u60a8\u60f3\u8981\u6293\u53d6\u7684\u3002 \u4f60\u4e5f\u53ef\u4ee5\u6307\u7740\u4e00\u4e2a robots.txt \u5e76\u4e14\u4ecesitemap urls\u63d0\u53d6\u5b83\u5e76\u89e3\u6790\u5b83 sitemap_rules \u4e00\u4e2a\u5143\u7ec4 (regex, callback) : regex \u662f\u4e00\u79cd\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u7528\u6765\u5339\u914d\u4ecesitemaps\u4e2d\u63d0\u53d6\u7684url\u3002 regex \u53ef\u4ee5\u662fstr\u6216\u7f16\u8bd1(compiled)\u8fc7\u7684regex\u5bf9\u8c61\u3002 callback\u662f\u7528\u6765\u5904\u7406\u4e0e\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\u7684url\u7684\u56de\u8c03\u3002 callback \u53ef\u4ee5\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff08\u8868\u793a\u4e00\u4e2aspider\u65b9\u6cd5\u7684\u540d\u79f0\uff09\u6216\u53ef\u8c03\u7528\u3002 \u4e3e\u4e2a\u4f8b\u5b50: sitemap_rules = [('/product/', 'parse_product')] \u89c4\u5219\u662f\u6309\u987a\u5e8f\u5e94\u7528\u7684\uff0c\u53ea\u6709\u7b2c\u4e00\u4e2a\u5339\u914d\u7684\u89c4\u5219\u624d\u4f1a\u88ab\u4f7f\u7528\u3002 \u5982\u679c\u60a8\u7701\u7565\u4e86\u8fd9\u4e2a\u5c5e\u6027\uff0c\u90a3\u4e48\u5728sitemaps\u4e2d\u627e\u5230\u7684\u6240\u6709url\u90fd\u5c06\u4f7f\u7528 parse \u56de\u8c03\u5904\u7406\u3002 sitemap_follow \u5e94\u8be5\u9075\u5faa\u7684sitemap\u7684regexes\u5217\u8868\u3002\u8fd9\u4ec5\u9002\u7528\u4e8e\u4f7f\u7528\u6307\u5411\u5176\u4ed6 \u7ad9\u70b9\u5730\u56fe\u6587\u4ef6 \u7684\u7ad9\u70b9\u5730\u56fe\u7d22\u5f15\u6587\u4ef6\u7684\u7ad9\u70b9\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6240\u6709\u7684sitemaps\u90fd\u4f1a\u88ab\u8ddf\u8e2a\u3002 sitemap_alternate_links \u6307\u5b9a\u662f\u5426\u5e94\u8be5\u9075\u5faa\u4e00\u4e2a url \u7684\u5907\u7528\u94fe\u63a5\u3002\u8fd9\u4e9b\u662f\u540c\u4e00\u7f51\u7ad9\u7684\u94fe\u63a5\uff0c\u5728\u540c\u4e00\u4e2a url \u5757\u4e2d\u4f20\u9012\u7684\u53e6\u4e00\u79cd\u8bed\u8a00\u3002 \u4e3e\u4e2a\u4f8b\u5b50: url loc http://example.com/ /loc xhtml:link rel= alternate hreflang= de href= http://example.com/de / /url \u6709\u4e86 sitemap_alternate_links \u96c6\uff0c\u8fd9\u5c06\u68c0\u7d22\u4e24\u4e2aurl\u3002 sitemap_alternate_links \u88ab\u7981\u7528\uff0c\u53ea\u6709 http://example.com/ \u5c06\u88ab\u68c0\u7d22\u3002 \u9ed8\u8ba4\u662f sitemap_alternate_links \u7981\u7528\u3002","title":"scrapy.spiders.SitemapSpider   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/07-spiders/#sitemapspider_1","text":"\u6700\u7b80\u5355\u7684\u4f8b\u5b50\uff1a\u4f7f\u7528 parse \u56de\u8c03\u5904\u7406sitemaps\u53d1\u73b0\u7684\u6240\u6709url\uff1a from scrapy.spiders import SitemapSpider class MySpider(SitemapSpider): sitemap_urls = ['http://www.example.com/sitemap.xml'] def parse(self, response): pass # \u6293\u53d6\u7684item\u5728\u8fd9\u91cc \u5904\u7406\u4e00\u4e9b\u5e26\u6709\u7279\u5b9a\u56de\u8c03\u7684url\u548c\u5176\u4ed6\u5177\u6709\u4e0d\u540c\u56de\u8c03\u7684url\uff1a from scrapy.spiders import SitemapSpider class MySpider(SitemapSpider): sitemap_urls = ['http://www.example.com/sitemap.xml'] sitemap_rules = [ ('/product/', 'parse_product'), ('/category/', 'parse_category'), ] def parse_product(self, response): pass # ... \u6293\u53d6product ... def parse_category(self, response): pass # ... \u6293\u53d6category ... \u8ddf\u8e2a\u5728 robots.txt \u6587\u4ef6\u4e0a\u7684sitemaps\uff0c\u5e76\u4e14\u53ea\u5173\u6ce8\u5176url\u5305\u542b /sitemap_shop \u7684sitemaps\uff1a from scrapy.spiders import SitemapSpider class MySpider(SitemapSpider): sitemap_urls = ['http://www.example.com/robots.txt'] sitemap_rules = [ ('/shop/', 'parse_shop'), ] sitemap_follow = ['/sitemap_shops'] def parse_shop(self, response): pass # ... \u6293\u53d6\u7684shop\u5728\u8fd9\u91cc ... \u5c06SitemapSpider\u4e0e\u5176\u4ed6url\u6765\u6e90\u76f8\u7ed3\u5408\uff1a from scrapy.spiders import SitemapSpider class MySpider(SitemapSpider): sitemap_urls = ['http://www.example.com/robots.txt'] sitemap_rules = [ ('/shop/', 'parse_shop'), ] other_urls = ['http://www.example.com/about'] def start_requests(self): requests = list(super(MySpider, self).start_requests()) requests += [scrapy.Request(x, self.parse_other) for x in self.other_urls] return requests def parse_shop(self, response): pass # ... \u6293\u53d6\u7684shop\u5728\u8fd9\u91cc ... def parse_other(self, response): pass # ... \u6293\u53d6\u7684other\u5728\u8fd9\u91cc ...","title":"SitemapSpider\u4f8b\u5b50"},{"location":"2. \u57fa\u672c\u6982\u5ff5/08-selctor/","text":"Selector(\u9009\u62e9\u5668) \u5f53\u60a8\u5728\u6293\u53d6web\u9875\u9762\u65f6\uff0c\u60a8\u9700\u8981\u6267\u884c\u7684\u6700\u5e38\u89c1\u7684\u4efb\u52a1\u662f\u4eceHTML\u6e90\u4ee3\u7801\u4e2d\u63d0\u53d6\u6570\u636e\u3002\u6709\u51e0\u4e2a\u5e93\u53ef\u4ee5\u5b9e\u73b0\u8fd9\u4e00\u70b9: \u8bd1\u8005: \u6211\u53ea\u4ecb\u7ecdlxml, \u4e0d\u4ecb\u7ecdBeautifulSoup, \u6211\u53ea\u7528xpath lxml \u662f\u4e00\u4e2aXML\u89e3\u6790\u5e93\uff08\u5b83\u4e5f\u89e3\u6790HTML\uff09\u548c\u57fa\u4e8e ElementTree \u7684python API\u3002\uff08lxml\u4e0d\u662fPython\u6807\u51c6\u5e93\u7684\u4e00\u90e8\u5206\u3002\uff09 Scrapy\u6709\u5b83\u81ea\u5df1\u7684\u63d0\u53d6\u6570\u636e\u7684\u673a\u5236\u3002\u5b83\u4eec\u88ab\u79f0\u4e3aselectors\uff0c\"select\"\u901a\u8fc7 XPath \u6216 CSS \u8868\u8fbe\u5f0f\u6307\u5b9a\u83b7\u53d6HTML\u6587\u6863\u7684\u67d0\u4e9b\u90e8\u5206\u3002 XPath \u662f\u4e00\u95e8\u5728XML\u6587\u6863\u4e2d\u9009\u62e9\u8282\u70b9\u7684\u8bed\u8a00\uff0c\u5b83\u4e5f\u53ef\u4ee5\u4e0eHTML\u4e00\u8d77\u4f7f\u7528\u3002 CSS \u662f\u4e00\u79cd\u5c06\u6837\u5f0f\u5e94\u7528\u4e8eHTML\u6587\u6863\u7684\u8bed\u8a00\u3002\u5b83\u5b9a\u4e49\u9009\u62e9\u5668\u5c06\u8fd9\u4e9b\u6837\u5f0f\u4e0e\u7279\u5b9a\u7684HTML\u5143\u7d20\u5173\u8054\u8d77\u6765\u3002 Scrapy selectors\u662f\u5728 lxml \u5e93\u4e4b\u4e0a\u6784\u5efa\u7684\uff0c\u8fd9\u610f\u5473\u7740\u5b83\u4eec\u5728\u901f\u5ea6\u548c\u89e3\u6790\u7cbe\u5ea6\u65b9\u9762\u975e\u5e38\u76f8\u4f3c\u3002 \u8fd9\u4e2a\u9875\u9762\u89e3\u91ca\u4e86selectors\u5982\u4f55\u5de5\u4f5c\u548c\u600e\u6837\u53bb\u63cf\u8ff0\u5b83\u4eec\u7684API\uff0c\u5b83\u975e\u5e38\u5c0f\u548c\u7b80\u5355\uff0c\u4e0elxml API\u4e0d\u540c\uff0clxml API\u66f4\u5927\uff0c\u56e0\u4e3alxml\u5e93\u53ef\u4ee5\u7528\u4e8e\u8bb8\u591a\u5176\u4ed6\u4efb\u52a1\uff0c\u800c\u4e0d\u662f\u4e13\u95e8\u9009\u62e9\u6807\u8bb0\u6587\u6863\u3002 \u8981\u83b7\u5f97\u9009\u62e9\u5668API\u7684\u5b8c\u6574\u5f15\u7528\uff0c\u8bf7\u53c2\u9605 Selector\u5f15\u7528 \u4f7f\u7528\u9009\u62e9\u5668 \u6784\u5efa\u9009\u62e9\u5668 Scrapy selectors\u662f\u901a\u8fc7\u4f20\u9012 \u6587\u672c \u6216 TextResponse \u5bf9\u8c61\u6784\u9020\u7684 Selector \u7c7b\u7684\u5b9e\u4f8b\u3002\u5b83\u6839\u636e\u8f93\u5165\u7c7b\u578b\u81ea\u52a8\u9009\u62e9\u6700\u4f73\u7684\u89e3\u6790\u89c4\u5219\uff08XML vs HTML\uff09\uff1a from scrapy.selector import Selector from scrapy.http import HtmlResponse \u4ece\u6587\u672c\u4e2d\u6784\u5efa body = ' html body span good /span /body /html ' Selector(text=body).xpath('//span/text()').extract() [u'good'] \u4eceresponse\u4e2d\u6784\u5efa response = HtmlResponse(url='http://example.com', body=body) Selector(response=response).xpath('//span/text()').extract() [u'good'] \u4e3a\u4e86\u65b9\u4fbf\u8d77\u89c1\uff0cresponse\u5bf9\u8c61\u5728 .selector \u5c5e\u6027\u4e2d\u516c\u5f00\u9009\u62e9\u5668\uff0c\u5728\u53ef\u80fd\u7684\u60c5\u51b5\u4e0b\u4f7f\u7528\u8fd9\u4e2a\u5feb\u6377\u65b9\u5f0f\u662f\u5b8c\u5168\u53ef\u4ee5\u7684\uff1a response.selector.xpath('//span/text()').extract() [u'good'] \u4f7f\u7528\u9009\u62e9\u5668 \u4e3a\u4e86\u89e3\u91ca\u5982\u4f55\u4f7f\u7528\u9009\u62e9\u5668\uff0c\u6211\u4eec\u5c06\u4f7f\u7528 Scrapy shell \uff08\u63d0\u4f9b\u4ea4\u4e92\u5f0f\u6d4b\u8bd5\uff09\u548c\u4f4d\u4e8eScrapy\u6587\u6863\u670d\u52a1\u5668\u4e2d\u7684\u793a\u4f8b\u9875\u9762\uff1a https://doc.scrapy.org/en/latest/_static/selectors-sample1.html \u8fd9\u662f\u5b83\u7684HTML\u4ee3\u7801: html head base href='http://example.com/' / title Example website /title /head body div id='images' a href='image1.html' Name: My image 1 br / img src='image1_thumb.jpg' / /a a href='image2.html' Name: My image 2 br / img src='image2_thumb.jpg' / /a a href='image3.html' Name: My image 3 br / img src='image3_thumb.jpg' / /a a href='image4.html' Name: My image 4 br / img src='image4_thumb.jpg' / /a a href='image5.html' Name: My image 5 br / img src='image5_thumb.jpg' / /a /div /body /html \u9996\u5148\uff0c\u8ba9\u6211\u4eec\u6253\u5f00shell\uff1a scrapy shell https://doc.scrapy.org/en/latest/_static/selectors-sample1.html \u7136\u540e\uff0c\u5728shell\u52a0\u8f7d\u4e4b\u540e\uff0c\u60a8\u5c06\u4f1a\u5f97\u5230\u4e00\u4e2a\u53ef\u7528\u7684response\u4f5c\u4e3ashell\u7684response\u53d8\u91cf\uff0c\u5e76\u5c06\u5176\u9644\u52a0\u7684\u9009\u62e9\u5668\u4f5c\u4e3a response.selector \u5c5e\u6027\u3002 \u56e0\u4e3a\u6211\u4eec\u5904\u7406\u7684\u662fHTML\uff0c\u6240\u4ee5\u9009\u62e9\u5668\u4f1a\u81ea\u52a8\u4f7f\u7528\u4e00\u4e2aHTML\u89e3\u6790\u5668\u3002 \u56e0\u6b64\uff0c\u901a\u8fc7\u67e5\u770b\u8be5\u9875\u9762\u7684 HTML\u4ee3\u7801 \uff0c\u8ba9\u6211\u4eec\u6784\u5efa\u4e00\u4e2aXPath\u6765\u9009\u62e9\u6807\u9898\u6807\u7b7e\u4e2d\u7684\u6587\u672c\uff1a response.selector.xpath('//title/text()') [ Selector (text) xpath=//title/text() ] \u4f7f\u7528XPath\u548cCSS\u67e5\u8be2responses\u662f\u975e\u5e38\u5e38\u89c1\u7684\uff0cresponse\u5305\u62ec\u4e24\u4e2a\u4fbf\u5229\u7684\u65b9\u6cd5\uff1a response.xpath() \u548c response.css() \uff1a response.xpath('//title/text()') [ Selector (text) xpath=//title/text() ] response.css('title::text') [ Selector (text) xpath=//title/text() ] \u5982\u60a8\u6240\u89c1\uff0c .xpath() \u548c .css() \u65b9\u6cd5\u8fd4\u56deSelectorList\u5b9e\u4f8b\uff0c\u5b83\u662f\u4e00\u4e2a\u65b0\u7684selectors\u5217\u8868\u3002\u8fd9\u4e2aAPI\u53ef\u7528\u4e8e\u5feb\u901f\u9009\u62e9\u5d4c\u5957\u6570\u636e\uff1a response.css('img').xpath('@src').extract() [u'image1_thumb.jpg', u'image2_thumb.jpg', u'image3_thumb.jpg', u'image4_thumb.jpg', u'image5_thumb.jpg'] \u8981\u63d0\u53d6\u6587\u672c\u5b9e\u9645\u6570\u636e\uff0c\u60a8\u5fc5\u987b\u8c03\u7528selector .extract() \u65b9\u6cd5\uff0c\u5982\u4e0b\u6240\u5217\uff1a response.xpath('//title/text()').extract() [u'Example website'] \u5982\u679c\u60a8\u53ea\u60f3\u63d0\u53d6\u7b2c\u4e00\u4e2a\u5339\u914d\u7684\u5143\u7d20\uff0c\u60a8\u53ef\u4ee5\u8c03\u7528 .extract_first() \u3002 response.xpath('//div[@id= images ]/a/text()').extract_first() u'Name: My image 1 ' \u5982\u679c\u6ca1\u6709\u627e\u5230\u4efb\u4f55\u5143\u7d20\uff0c\u5b83\u5c06\u8fd4\u56de None \uff1a response.xpath('//div[@id= not-exists ]/text()').extract_first() is None True \u9ed8\u8ba4\u7684\u8fd4\u56de\u503c\u53ef\u4ee5\u63d0\u4f9b\u4e00\u4e2a\u53c2\u6570\uff0c\u800c\u4e0d\u662f None \uff1a response.xpath('//div[@id= not-exists ]/text()').extract_first(default='not-found') 'not-found' \u6ce8\u610f\uff0cCSS\u9009\u62e9\u5668\u53ef\u4ee5\u4f7f\u7528CSS3\u4f2a\u5143\u7d20\u9009\u62e9\u6587\u672c\u6216\u5c5e\u6027\u8282\u70b9\uff1a response.css('title::text').extract() [u'Example website'] \u73b0\u5728\u6211\u4eec\u5c06\u5f97\u5230\u57fa\u672cURL\u548c\u4e00\u4e9b\u56fe\u50cf\u94fe\u63a5\uff1a response.xpath('//base/@href').extract() [u'http://example.com/'] response.css('base::attr(href)').extract() [u'http://example.com/'] response.xpath('//a[contains(@href, image )]/@href').extract() [u'image1.html', u'image2.html', u'image3.html', u'image4.html', u'image5.html'] response.css('a[href*=image]::attr(href)').extract() [u'image1.html', u'image2.html', u'image3.html', u'image4.html', u'image5.html'] response.xpath('//a[contains(@href, image )]/img/@src').extract() [u'image1_thumb.jpg', u'image2_thumb.jpg', u'image3_thumb.jpg', u'image4_thumb.jpg', u'image5_thumb.jpg'] response.css('a[href*=image] img::attr(src)').extract() [u'image1_thumb.jpg', u'image2_thumb.jpg', u'image3_thumb.jpg', u'image4_thumb.jpg', u'image5_thumb.jpg'] \u5d4c\u5957\u9009\u62e9\u5668 \u9009\u62e9\u65b9\u6cd5( .xpath() \u6216 .css() )\u8fd4\u56de\u540c\u4e00\u7c7b\u578b\u7684selectors\u7684\u5217\u8868\uff0c\u56e0\u6b64\u60a8\u4e5f\u53ef\u4ee5\u4e3a\u8fd9\u4e9b\u9009\u62e9\u5668\u8c03\u7528\u9009\u62e9\u65b9\u6cd5\u3002\u8fd9\u91cc\u6709\u4e00\u4e2a\u4f8b\u5b50: links = response.xpath('//a[contains(@href, image )]') links.extract() [u' a href= image1.html Name: My image 1 br img src= image1_thumb.jpg /a ', u' a href= image2.html Name: My image 2 br img src= image2_thumb.jpg /a ', u' a href= image3.html Name: My image 3 br img src= image3_thumb.jpg /a ', u' a href= image4.html Name: My image 4 br img src= image4_thumb.jpg /a ', u' a href= image5.html Name: My image 5 br img src= image5_thumb.jpg /a '] for index, link in enumerate(links): ... args = (index, link.xpath('@href').extract(), link.xpath('img/@src').extract()) ... print 'Link number %d points to url %s and image %s' % args Link number 0 points to url [u'image1.html'] and image [u'image1_thumb.jpg'] Link number 1 points to url [u'image2.html'] and image [u'image2_thumb.jpg'] Link number 2 points to url [u'image3.html'] and image [u'image3_thumb.jpg'] Link number 3 points to url [u'image4.html'] and image [u'image4_thumb.jpg'] Link number 4 points to url [u'image5.html'] and image [u'image5_thumb.jpg'] \u4f7f\u7528\u5e26\u6709\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u9009\u62e9\u5668 Selecotr \u8fd8\u6709\u4e00\u4e2a .re() \u65b9\u6cd5\uff0c\u7528\u4e8e\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u63d0\u53d6\u6570\u636e\u3002\u7136\u800c\uff0c\u4e0e\u4f7f\u7528 .xpath() \u6216 .css() \u65b9\u6cd5\u4e0d\u540c\uff0c .re() \u8fd4\u56deunicode\u5b57\u7b26\u4e32\u5217\u8868\u3002\u6240\u4ee5\u4f60\u4e0d\u80fd\u6784\u9020\u5d4c\u5957\u7684 re() \u8c03\u7528\u3002 \u4e0b\u9762\u662f\u4e00\u4e2a\u4ece\u4e0a\u9762\u7684HTML\u4ee3\u7801\u4e2d\u63d0\u53d6\u56fe\u50cf\u540d\u79f0\u7684\u4f8b\u5b50\uff1a response.xpath('//a[contains(@href, image )]/text()').re(r'Name:\\s*(.*)') [u'My image 1', u'My image 2', u'My image 3', u'My image 4', u'My image 5'] \u8fd8\u6709\u4e00\u4e2a\u989d\u5916\u7684\u65b9\u6cd5\u3002\u4f7f\u7528 .re_first() \u6765\u63d0\u53d6\u7b2c\u4e00\u4e2a\u5339\u914d\u7684\u5b57\u7b26\u4e32\uff1a response.xpath('//a[contains(@href, image )]/text()').re_first(r'Name:\\s*(.*)') u'My image 1' \u4f7f\u7528\u76f8\u5bf9xpath \u8bf7\u8bb0\u4f4f\uff0c\u5982\u679c\u60a8\u6b63\u5728\u5d4c\u5957\u9009\u62e9\u5668\uff0c\u5e76\u4f7f\u7528\u4ee5 / \u5f00\u5934\u7684XPath\uff0c\u90a3\u4e48XPath\u5c06\u662f\u7edd\u5bf9\u7684\uff0c\u800c\u4e0d\u662f\u76f8\u5bf9\u4e8e\u60a8\u8c03\u7528\u7684 Selector \u3002 \u4f8b\u5982\uff0c\u5047\u8bbe\u4f60\u60f3\u8981\u63d0\u53d6 p \u5143\u7d20\u4e2d\u7684\u6240\u6709 div \u5143\u7d20\u3002\u9996\u5148\uff0c\u4f60\u4f1a\u5f97\u5230\u6240\u6709\u7684 div \u5143\u7d20\uff1a divs = response.xpath('//div') \u4e00\u5f00\u59cb\uff0c\u60a8\u53ef\u80fd\u4f1a\u5c1d\u8bd5\u4f7f\u7528\u4ee5\u4e0b\u65b9\u6cd5\uff0c\u8fd9\u662f\u9519\u8bef\u7684\uff0c\u56e0\u4e3a\u5b83\u5b9e\u9645\u4e0a\u4ece\u6587\u6863\u4e2d\u63d0\u53d6\u4e86\u6240\u6709\u7684 p \u5143\u7d20\uff0c\u800c\u4e0d\u4ec5\u4ec5\u662f\u90a3\u4e9b\u5185\u90e8\u7684 div \u5143\u7d20\uff1a for p in divs.xpath('//p'): # \u8fd9\u662f\u9519\u8bef\u7684 \u2014\u2014 \u8fd9\u4f1a\u4ece\u6574\u4e2a\u6587\u6863\u4e2d\u5f97\u5230\u6240\u6709\u7684 p \u4fe1\u606f ... print p.extract() \u8fd9\u662f\u6b63\u786e\u7684\u65b9\u6cd5\uff08\u6ce8\u610f\u5728XPath\u8def\u5f84 //p \u524d\u52a0\u524d\u7f00\u70b9\uff09\uff1a for p in divs.xpath('.//p'): # \u63d0\u53d6\u6240\u6709 p \u5185\u90e8 ... print p.extract() \u53e6\u4e00\u4e2a\u5e38\u89c1\u7684\u4f8b\u5b50\u662f\uff0c\u76f4\u63a5\u63d0\u53d6\u5f53\u524d\u8282\u70b9\u6240\u6709\u7684 p children\uff1a for p in divs.xpath('p'): ... print p.extract() \u6709\u5173XPath\u76f8\u5bf9\u8def\u5f84\u7684\u66f4\u591a\u7ec6\u8282\uff0c\u8bf7\u53c2\u9605XPath\u89c4\u8303\u4e2d\u7684 \u4f4d\u7f6e\u8def\u5f84 \u90e8\u5206\u3002 XPath\u8868\u8fbe\u5f0f\u4e2d\u7684\u53d8\u91cf XPath\u5141\u8bb8\u60a8\u4f7f\u7528 $somevariable \u8bed\u6cd5\u5f15\u7528XPath\u8868\u8fbe\u5f0f\u4e2d\u7684\u53d8\u91cf\u3002\u8fd9\u6709\u70b9\u7c7b\u4f3c\u4e8eSQL\u4e16\u754c\u4e2d\u7684\u53c2\u6570\u5316\u67e5\u8be2\u6216\u9884\u5904\u7406\u8bed\u53e5\uff0c\u60a8\u53ef\u4ee5\u5728\u67e5\u8be2\u4e2d\u4f7f\u7528\u8bf8\u5982\u6b64\u7c7b\u7684\u5360\u4f4d\u7b26\u66ff\u6362\u4e00\u4e9b\u53c2\u6570\uff0c\u7136\u540e\u7528\u67e5\u8be2\u4f20\u9012\u7684\u503c\u4ee3\u66ff\u3002 \u8fd9\u91cc\u6709\u4e00\u4e2a\u4f8b\u5b50\uff0c\u6839\u636e\u5b83\u7684\u201cid\u201d\u5c5e\u6027\u503c\u6765\u5339\u914d\u4e00\u4e2a\u5143\u7d20\uff0c\u800c\u4e0d\u9700\u8981\u786c\u7f16\u7801\u5b83\uff08\u4e4b\u524d\u663e\u793a\u7684\uff09\uff1a # \u5728\u8868\u8fbe\u5f0f\u4e2d\u4f7f\u7528\u201c$val\u201d\uff0c\u9700\u8981\u4f20\u9012\u4e00\u4e2a\u201cval\u201d\u53c2\u6570 response.xpath('//div[@id=$val]/a/text()', val='images').extract_first() u'Name: My image 1 ' \u8fd9\u662f\u53e6\u4e00\u4e2a\u4f8b\u5b50\uff0c\u4e3a\u4e86\u63d0\u53d6\u7b2c5\u4e2adiv\u6807\u7b7e\u4e0b\u7684id\u6807\u7b7e\u4e0b\u7684\u503c, \u8fd9\u91cc\u6211\u4eec\u5c06\u503c5\u4f5c\u4e3a\u6574\u6570\uff09\uff1a response.xpath('//div[count(a)=$cnt]/@id', cnt=5).extract_first() u'images' \u5f53\u8c03\u7528 .xpath() \u65f6\uff0c\u6240\u6709\u5f15\u7528\u53d8\u91cf\u90fd\u5fc5\u987b\u6709\u503c\uff08\u5426\u5219\u5c31\u4f1a\u5f97\u5230 ValueError: XPath error: \uff09\u3002\u5728\u5fc5\u8981\u65f6\u4f20\u9012\u5c3d\u53ef\u80fd\u591a\u7684\u547d\u540d\u53c2\u6570\u3002 parsel \u662f\u4e00\u4e2a\u4e3a Scrapy selectors\u63d0\u4f9b\u52a8\u529b\u7684\u5e93\uff0c\u5b83\u6709\u66f4\u591a\u5173\u4e8e XPath\u53d8\u91cf \u7684\u7ec6\u8282\u548c\u793a\u4f8b\u3002 \u4f7f\u7528EXSLT\u6269\u5c55 \u5728 lxml \u4e4b\u4e0a\u6784\u5efa\u7684Scrapy selectors\u8fd8\u652f\u6301\u4e00\u4e9b EXSLT \u6269\u5c55\uff0c\u5e76\u4f7f\u7528\u8fd9\u4e9b\u9884\u5148\u6ce8\u518c\u7684\u540d\u79f0\u7a7a\u95f4\u6765\u4f7f\u7528XPath\u8868\u8fbe\u5f0f\uff1a \u9884\u5b9a\u4e49 \u547d\u540d\u7a7a\u95f4 \u7528\u6cd5 re http://exslt.org/regular-expressions regular expressions set http://exslt.org/sets set manipulation \u6b63\u5219\u8868\u8fbe\u5f0f \u4f8b\u5982\uff0c\u5f53XPath\u7684 starts-with() \u6216 contains() \u4e0d\u80fd\u6ee1\u8db3\u65f6\uff0c test() \u51fd\u6570\u4f1a\u88ab\u8bc1\u660e\u662f\u975e\u5e38\u6709\u7528\u7684\u3002 \u4f8b\u5982\uff0c\u5728\u5217\u8868item\u4e2d\u9009\u62e9\u5e26\u6709\u4e00\u4e2a\u201cclass\u201d\u5c5e\u6027\u7684\u94fe\u63a5\uff0c\u4ee5\u4e00\u4e2a\u6570\u5b57\u7ed3\u5c3e\uff1a from scrapy import Selector doc = ... div ... ul ... li class= item-0 a href= link1.html first item /a /li ... li class= item-1 a href= link2.html second item /a /li ... li class= item-inactive a href= link3.html third item /a /li ... li class= item-1 a href= link4.html fourth item /a /li ... li class= item-0 a href= link5.html fifth item /a /li ... /ul ... /div ... sel = Selector(text=doc, type= html ) sel.xpath('//li//@href').extract() [u'link1.html', u'link2.html', u'link3.html', u'link4.html', u'link5.html'] sel.xpath('//li[re:test(@class, item-\\d$ )]//@href').extract() [u'link1.html', u'link2.html', u'link4.html', u'link5.html'] \u8b66\u544a~~~~\u8b66\u544a~~~~~~ C \u5e93 libxslt \u672c\u8eab\u5e76\u4e0d\u652f\u6301EXSLT\u6b63\u5219\u8868\u8fbe\u5f0f \u56e0\u6b64lxml\u7684\u5b9e\u73b0\u4f7f\u7528\u7684\u662fPython\u7684re\u6a21\u5757\u3002 \u56e0\u6b64\uff0c\u5728XPath\u8868\u8fbe\u5f0f\u4e2d\u4f7f\u7528regexp\u51fd\u6570\u53ef\u80fd\u4f1a\u589e\u52a0\u4e00\u4e2a\u5c0f\u7684\u6027\u80fd\u635f\u5931\u3002 \u96c6\u5408\u8fd0\u7b97 \u5728\u63d0\u53d6\u6587\u672c\u5143\u7d20\u4e4b\u524d\uff0c\u8fd9\u4e9b\u53ef\u4ee5\u65b9\u4fbf\u5730\u6392\u9664\u6587\u6863\u6811\u7684\u67d0\u4e9b\u90e8\u5206\u3002 \u4f8b\u5982\uff0c\u63d0\u53d6\u5fae\u6570\u636e\uff08\u4ece http://schema.org/Product \u83b7\u53d6\u7684\u6837\u4f8b\u5185\u5bb9\uff09\u4e0e\u9879\u76ee\u8303\u56f4\u548c\u76f8\u5e94\u7684\u9879\u76ee\u652f\u6301\uff1a doc = ... div itemscope itemtype= http://schema.org/Product ... span itemprop= name Kenmore White 17 Microwave /span ... img src= kenmore-microwave-17in.jpg alt='Kenmore 17 Microwave' / ... div itemprop= aggregateRating ... itemscope itemtype= http://schema.org/AggregateRating ... Rated span itemprop= ratingValue 3.5 /span /5 ... based on span itemprop= reviewCount 11 /span customer reviews ... /div ... ... div itemprop= offers itemscope itemtype= http://schema.org/Offer ... span itemprop= price $55.00 /span ... link itemprop= availability href= http://schema.org/InStock / In stock ... /div ... ... Product description: ... span itemprop= description 0.7 cubic feet countertop microwave. ... Has six preset cooking categories and convenience features like ... Add-A-Minute and Child Lock. /span ... ... Customer reviews: ... ... div itemprop= review itemscope itemtype= http://schema.org/Review ... span itemprop= name Not a happy camper /span - ... by span itemprop= author Ellie /span , ... meta itemprop= datePublished content= 2011-04-01 April 1, 2011 ... div itemprop= reviewRating itemscope itemtype= http://schema.org/Rating ... meta itemprop= worstRating content = 1 ... span itemprop= ratingValue 1 /span / ... span itemprop= bestRating 5 /span stars ... /div ... span itemprop= description The lamp burned out and now I have to replace ... it. /span ... /div ... ... div itemprop= review itemscope itemtype= http://schema.org/Review ... span itemprop= name Value purchase /span - ... by span itemprop= author Lucas /span , ... meta itemprop= datePublished content= 2011-03-25 March 25, 2011 ... div itemprop= reviewRating itemscope itemtype= http://schema.org/Rating ... meta itemprop= worstRating content = 1 / ... span itemprop= ratingValue 4 /span / ... span itemprop= bestRating 5 /span stars ... /div ... span itemprop= description Great microwave for the price. It is small and ... fits in my apartment. /span ... /div ... ... ... /div ... sel = Selector(text=doc, type= html ) for scope in sel.xpath('//div[@itemscope]'): ... print current scope: , scope.xpath('@itemtype').extract() ... props = scope.xpath(''' ... set:difference(./descendant::*/@itemprop, ... .//*[@itemscope]/*/@itemprop)''') ... print properties: , props.extract() ... print current scope: [u'http://schema.org/Product'] properties: [u'name', u'aggregateRating', u'offers', u'description', u'review', u'review'] current scope: [u'http://schema.org/AggregateRating'] properties: [u'ratingValue', u'reviewCount'] current scope: [u'http://schema.org/Offer'] properties: [u'price', u'availability'] current scope: [u'http://schema.org/Review'] properties: [u'name', u'author', u'datePublished', u'reviewRating', u'description'] current scope: [u'http://schema.org/Rating'] properties: [u'worstRating', u'ratingValue', u'bestRating'] current scope: [u'http://schema.org/Review'] properties: [u'name', u'author', u'datePublished', u'reviewRating', u'description'] current scope: [u'http://schema.org/Rating'] properties: [u'worstRating', u'ratingValue', u'bestRating'] \u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u9996\u5148\u8fed\u4ee3\u5305\u542b itemscope \u5143\u7d20\uff0c\u5bf9\u4e8e\u5b83\u4e0b\u9762\u6bcf\u4e00\u4e2a\u5143\u7d20\uff0c\u6211\u4eec\u5bfb\u627e\u6240\u6709\u5305\u542b itemprops \u5143\u7d20\uff0c\u5e76\u5c06\u5b83\u4eec\u672c\u8eab\u6392\u9664\u5728\u53e6\u4e00\u4e2a itemscope \u4e2d\u3002 \u4e00\u4e9bXPath\u6280\u5de7 \u4e0b\u9762\u662f\u4e00\u4e9b\u6280\u5de7\uff0c\u60a8\u53ef\u80fd\u4f1a\u5728\u4f7f\u7528XPath\u9009\u62e9\u5668\u65f6\u53d1\u73b0\u6709\u7528\u7684\u6280\u5de7\uff0c\u8fd9\u662f\u57fa\u4e8e Scrapy\u7684\u535a\u5ba2\u4e0a\u7684\u8fd9\u7bc7\u6587\u7ae0 \u3002\u5982\u679c\u60a8\u8fd8\u4e0d\u592a\u719f\u6089XPath\uff0c\u90a3\u4e48\u60a8\u53ef\u80fd\u60f3\u5148\u770b\u4e00\u4e0b\u8fd9\u4e2a XPath\u6559\u7a0b \u3002 \u6709\u6761\u4ef6\u4e0b\u662f\u7528\u6587\u672c\u8282\u70b9 \u5f53\u60a8\u9700\u8981\u5c06\u6587\u672c\u5185\u5bb9\u7528\u4f5c XPath\u5b57\u7b26\u4e32\u51fd\u6570 \u7684\u53c2\u6570\u65f6\uff0c\u8bf7\u907f\u514d\u4f7f\u7528 //text() \u5e76\u4f7f\u7528 . \u4ee3\u66ff\u3002 \u8fd9\u662f\u56e0\u4e3a\u8868\u8fbe\u5f0f .//text() \u4ea7\u751f\u4e86\u4e00\u6279\u6587\u672c\u5143\u7d20\u2014\u2014\u4e00\u4e2a\u8282\u70b9\u96c6\u3002\u5f53\u4e00\u4e2a\u8282\u70b9\u96c6\u88ab\u8f6c\u6362\u6210\u4e00\u4e2a\u5b57\u7b26\u4e32\u65f6\uff0c\u5f53\u5b83\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7ed9\u5b57\u7b26\u4e32\u51fd\u6570\u65f6\uff0c\u6bd4\u5982 contains() \u6216 starts-with() \uff0c\u5b83\u53ea\u4f1a\u4ea7\u751f\u7b2c\u4e00\u4e2a\u5143\u7d20\u7684\u6587\u672c\u3002 \u4f8b\u5b50 from scrapy import Selector sel = Selector(text=' a href= # Click here to go to the strong Next Page /strong /a ') \u5c06\u8282\u70b9\u96c6\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\uff1a sel.xpath('//a//text()').extract() # \u770b\u4e00\u770b\u8282\u70b9\u96c6 [u'Click here to go to the ', u'Next Page'] sel.xpath( string(//a[1]//text()) ).extract() # \u628a\u5b83\u8f6c\u6362\u6210\u5b57\u7b26\u4e32 [u'Click here to go to the '] \u7136\u800c\uff0c\u4e00\u4e2a\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\u7684\u8282\u70b9\u5c06\u5176\u81ea\u8eab\u7684\u6587\u672c\u548c\u5b83\u7684\u6240\u6709\u540e\u4ee3\u653e\u5728\u4e00\u8d77\uff1a sel.xpath( //a[1] ).extract() # \u9009\u62e9\u7b2c\u4e00\u4e2a\u8282\u70b9 [u' a href= # Click here to go to the strong Next Page /strong /a '] sel.xpath( string(//a[1]) ).extract() # \u628a\u5b83\u8f6c\u6362\u6210\u5b57\u7b26\u4e32 [u'Click here to go to the Next Page'] \u56e0\u6b64\uff0c\u4f7f\u7528 .//text() node-set\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u4e0d\u4f1a\u9009\u62e9\u4efb\u4f55\u4e1c\u897f\uff1a sel.xpath( //a[contains(.//text(), 'Next Page')] ).extract() [] \u4f46\u4f7f\u7528 . \u4e3a\u4e86\u8868\u793a\u8282\u70b9\uff0c\u5de5\u4f5c\uff1a sel.xpath( //a[contains(., 'Next Page')] ).extract() [u' a href= # Click here to go to the strong Next Page /strong /a '] \u6ce8\u610f//node[1]\u548c(//node)[1]\u4e4b\u95f4\u7684\u533a\u522b //node[1] \u9009\u62e9\u5728\u4ed6\u4eec\u5404\u81ea\u7684\u7236\u6bcd\u4e0b\u9996\u5148\u53d1\u751f\u7684\u6240\u6709\u8282\u70b9\u3002 (//node)[1] \u9009\u62e9\u6587\u6863\u4e2d\u7684\u6240\u6709\u8282\u70b9\uff0c\u7136\u540e\u53ea\u83b7\u53d6\u5176\u4e2d\u7684\u7b2c\u4e00\u4e2a\u8282\u70b9\u3002 \u4f8b\u5b50: from scrapy import Selector sel = Selector(text= ....: ul class= list ....: li 1 /li ....: li 2 /li ....: li 3 /li ....: /ul ....: ul class= list ....: li 4 /li ....: li 5 /li ....: li 6 /li ....: /ul ) xp = lambda x: sel.xpath(x).extract() \u8fd9\u5c31\u5f97\u5230\u4e86\u5728\u5b83\u7684\u7236\u5143\u7d20\u4e0b\u6240\u6709\u7684 li \u5143\u7d20 xp( //li[1] ) [u' li 1 /li ', u' li 4 /li '] \u8fd9\u5c31\u5f97\u5230\u4e86\u6574\u4e2a\u6587\u6863\u7684\u7b2c\u4e00\u4e2a li \u5143\u7d20\uff1a xp( (//li)[1] ) [u' li 1 /li '] \u8fd9\u5c31\u5f97\u5230\u4e86\u7236\u6bcd\u7684\u7b2c\u4e00\u4e2a li \u5143\u7d20\uff1a xp( //ul/li[1] ) [u' li 1 /li ', u' li 4 /li '] \u8fd9\u5c31\u5f97\u5230\u4e86\u6574\u4e2a\u6587\u6863\u4e2d ul \u7236\u5143\u7d20\u4e0b\u7684\u7b2c\u4e00\u4e2a li \u5143\u7d20\uff1a xp( (//ul/li)[1] ) [u' li 1 /li '] \u5728\u8fdb\u884c\u7c7b(class)\u67e5\u8be2\u65f6\uff0c\u8003\u8651\u4f7f\u7528CSS\u9009\u62e9\u5668 \u56e0\u4e3a\u4e00\u4e2a\u5143\u7d20\u53ef\u4ee5\u5305\u542b\u591a\u4e2aCSS\u7c7b\uff0c\u6240\u4ee5\u901a\u8fc7class\u6765\u9009\u62e9\u5143\u7d20\u7684XPath\u65b9\u6cd5\u662f\u76f8\u5f53\u5197\u957f\u7684\uff1a *[contains(concat(' ', normalize-space(@class), ' '), ' someclass ')] \u5982\u679c\u4f60\u4f7f\u7528 @class='someclass' \uff0c\u4f60\u53ef\u80fd\u4f1a\u9519\u8fc7\u5176\u4ed6\u7c7b\u7684\u5143\u7d20\uff0c\u5982\u679c\u4f60\u53ea\u662f\u4f7f\u7528 contains(@class, 'someclass') \u6765\u5f25\u8865\uff0c\u4f60\u53ef\u80fd\u4f1a\u5f97\u5230\u66f4\u591a\u4f60\u60f3\u8981\u7684\u5143\u7d20\uff0c\u5982\u679c\u5b83\u4eec\u6709\u4e00\u4e2a\u4e0d\u540c\u7684\u7c7b\u540d\uff0c\u5b83\u5171\u4eab\u5b57\u7b26\u4e32 someclass \u3002 \u4e8b\u5b9e\u8bc1\u660e\uff0cScrapy selectors\u5141\u8bb8\u4f60\u9009\u62e9\u94fe\u9009\u62e9\u5668\uff0c\u6240\u4ee5\u5927\u591a\u6570\u65f6\u5019\u4f60\u53ef\u4ee5\u5728\u7c7b\u4e2d\u9009\u62e9\u4f7f\u7528CSS\uff0c\u7136\u540e\u5728\u9700\u8981\u65f6\u5207\u6362\u5230XPath\uff1a from scrapy import Selector sel = Selector(text=' div class= hero shout time datetime= 2014-07-23 19:00 Special date /time /div ') sel.css('.shout').xpath('./time/@datetime').extract() [u'2014-07-23 19:00'] \u8fd9\u6bd4\u4f7f\u7528\u4e0a\u9762\u663e\u793a\u7684\u5197\u957f\u7684XPath\u6280\u5de7\u66f4\u5e72\u51c0\u3002\u53ea\u8981\u8bb0\u4f4f\u5728\u63a5\u4e0b\u6765\u7684XPath\u8868\u8fbe\u5f0f\u4e2d\u4f7f\u7528 . \u3002 \u5185\u7f6e\u7684\u9009\u62e9\u5668\u53c2\u8003 Selector(\u9009\u62e9\u5668) \u5bf9\u8c61 scrapy.selector.Selector(response=None, text=None, type=None) \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) Selector \u7684\u4e00\u4e2a\u5b9e\u4f8b\u662f\u4e00\u4e2a\u5305\u88c5\u5668\uff0c\u7528\u4e8e\u9009\u62e9\u5176\u5185\u5bb9\u7684\u67d0\u4e9b\u90e8\u5206\u3002 response \u662f\u4e00\u4e2a HtmlResponse \u6216 XmlResponse \u5bf9\u8c61\uff0c\u5b83\u5c06\u88ab\u7528\u4e8e\u9009\u62e9\u548c\u63d0\u53d6\u6570\u636e\u3002 text \u662f\u4e00\u79cdunicode\u5b57\u7b26\u4e32\u6216utf-8\u7f16\u7801\u7684\u6587\u672c\uff0c\u5f53\u65e0\u6cd5\u83b7\u5f97 response \u65f6\u3002\u4f7f\u7528 text \u548c response \u662f\u672a\u5b9a\u4e49\u7684\u884c\u4e3a\u3002 type \u5b9a\u4e49selector\u7c7b\u578b\uff0c\u5b83\u53ef\u4ee5\u662f \u201chtml\u201d \u3001 \u201cxml\u201d \u6216 None \uff08\u9ed8\u8ba4\uff09\u3002 \u5982\u679c type \u4e3a None \uff0c\u5219selector\u4f1a\u6839\u636e response \u7c7b\u578b\u81ea\u52a8\u9009\u62e9\u6700\u4f73\u7c7b\u578b\uff08\u89c1\u4e0b\u6587\uff09\uff0c\u6216\u8005\u9ed8\u8ba4\u4e3a\u201chtml\u201d\uff0c\u4ee5\u9632\u5b83\u4e0e text \u4e00\u8d77\u4f7f\u7528\u3002 \u5982\u679c type \u4e3a None \uff0c\u5e76\u4e14 response \u88ab\u4f20\u9012\uff0c\u90a3\u4e48selector\u7c7b\u578b\u662f\u4eceresponse\u7c7b\u578b\u63a8\u65ad\u51fa\u6765\u7684\uff1a \"html\" HtmlResponse \u7c7b\u578b \"xml\" XmlResponse \u7c7b\u578b \"html\" \u505a\u522b\u7684\u4e8b\u60c5 \u5426\u5219\uff0c\u5982\u679c type \u88ab\u8bbe\u7f6e\uff0cselector\u7c7b\u578b\u5c31\u662f\u56fa\u5b9a\u7684\uff0c\u4e0d\u4f1a\u53d1\u751f\u81ea\u52a8\u68c0\u6d4b\u7c7b\u578b\u3002 xpath(query) \u627e\u5230\u5339\u914d query \u7684\u8282\u70b9\u7684xpath\uff0c\u5e76\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9 SelectorList \u5b9e\u4f8b\uff0c\u6240\u6709\u5143\u7d20\u90fd\u88ab\u5c55\u5f00\u3002\u5217\u8868\u5143\u7d20\u4e5f\u5b9e\u73b0\u4e86 SelectorList \u63a5\u53e3\u3002 query \u662f\u4e00\u4e2a\u5305\u542bXPATH\u67e5\u8be2\u7684\u5b57\u7b26\u4e32\u3002 \u6ce8\u610f!!!!!!!!!!! \u4e3a\u4e86\u65b9\u4fbf\u8d77\u89c1\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u79f0\u4e3aresponse.xpath() css(query) \u5e94\u7528\u7ed9\u5b9a\u7684CSS\u9009\u62e9\u5668\u5e76\u8fd4\u56de SelectorList \u5b9e\u4f8b\u3002 query \u662f\u5305\u542b\u8981\u5e94\u7528\u7684CSS\u9009\u62e9\u5668\u7684\u5b57\u7b26\u4e32\u3002 \u5728\u5e95\u5c42\uff0cCSS\u67e5\u8be2\u88ab\u7ffb\u8bd1\u6210XPath\u67e5\u8be2\uff0c\u4f7f\u7528 cssselect \u5e93\u548c .xpath() \u65b9\u6cd5\u3002 \u6ce8\u610f!!!!!!!!!!!! \u4e3a\u4e86\u65b9\u4fbf\u8d77\u89c1\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u79f0\u4e3aresponse.css() extract() \u5e8f\u5217\u5316\u5e76\u8fd4\u56de\u5339\u914d\u7684\u8282\u70b9\u4f5c\u4e3aunicode\u5b57\u7b26\u4e32\u7684\u5217\u8868\u3002\u767e\u5206\u6bd4\u7f16\u7801\u7684\u5185\u5bb9\u662f\u672a\u88ab\u5f15\u7528\u7684\u3002 re(regex) \u5e94\u7528\u7ed9\u5b9a\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5e76\u8fd4\u56de\u5339\u914d\u7684unicode\u5b57\u7b26\u4e32\u5217\u8868\u3002 regex \u53ef\u4ee5\u662f\u4e00\u4e2a\u5df2\u7f16\u8bd1(compiled)\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u5b83\u5c06\u4f7f\u7528 re.compile(regex) \u7f16\u8bd1\u6210\u6b63\u5219\u8868\u8fbe\u5f0f\u3002 \u6ce8\u610f!!!!!!!!! \u6ce8\u610fre()\u548cre_first()\u90fddecode HTML\u5b9e\u4f53\uff08\u9664\u4e86 lt;\u548c amp;)\u3002 register_namespace(prefix, uri) \u5728\u8fd9\u4e2a Selector \u4e2d\u6ce8\u518c\u6307\u5b9a\u7684\u540d\u79f0\u7a7a\u95f4\u3002\u5982\u679c\u4e0d\u6ce8\u518c\u540d\u79f0\u7a7a\u95f4\uff0c\u5c31\u4e0d\u80fd\u4ece\u975e\u6807\u51c6\u540d\u79f0\u7a7a\u95f4\u4e2d\u9009\u62e9\u6216\u63d0\u53d6\u6570\u636e\u3002\u8bf7\u53c2\u89c1\u4e0b\u9762\u7684\u4f8b\u5b50\u3002 remove_namespaces() \u5220\u9664\u6240\u6709\u540d\u79f0\u7a7a\u95f4\uff0c\u5141\u8bb8\u4f7f\u7528\u540d\u79f0\u7a7a\u95f4\u8f83\u5c11\u7684xpath\u904d\u5386\u6587\u6863\u3002\u8bf7\u53c2\u89c1\u4e0b\u9762\u7684\u4f8b\u5b50\u3002 __nonzero__() \u5982\u679c\u6709\u4efb\u4f55\u771f\u5b9e\u7684\u5185\u5bb9\u88ab\u9009\u62e9\u8fd4\u56de True \u3002\u5426\u5219 False \u6362\u53e5\u8bdd\u8bf4\uff0c Selector \u7684\u5e03\u5c14\u503c\u662f\u7531\u5b83\u6240\u9009\u62e9\u7684\u5185\u5bb9\u7ed9\u51fa\u7684\u3002 SelectorList(\u9009\u62e9\u5668\u5217\u8868) \u5bf9\u8c61 scrapy.selector.SelectorList \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) SelectorList \u7c7b\u662f\u5185\u5efalist\u7c7b\u7684\u5b50\u7c7b\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e9b\u989d\u5916\u7684\u65b9\u6cd5\u3002 xpath(query) \u4e3a\u8fd9\u4e2a\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u8c03\u7528 .xpath() \u65b9\u6cd5\uff0c\u5e76\u5c06\u5b83\u4eec\u7684\u7ed3\u679c\u4f5c\u4e3a\u53e6\u4e00\u4e2a SelectorList \u5c55\u5f00\u3002 query \u4e0e Selector.xpath() \u4e2d\u7684\u53c2\u6570\u662f\u76f8\u540c\u7684\u3002 css(query) \u4e3a\u8fd9\u4e2a\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u8c03\u7528 .css() \u65b9\u6cd5\uff0c\u5e76\u5c06\u5b83\u4eec\u7684\u7ed3\u679c\u4f5c\u4e3a\u53e6\u4e00\u4e2a SelectorList \u5c55\u5f00\u3002 query \u4e0e Selector.css() \u4e2d\u7684\u53c2\u6570\u662f\u76f8\u540c\u7684\u3002 extract() \u4e3a\u8fd9\u4e2a\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u8c03\u7528 .extract() \u65b9\u6cd5\uff0c\u5e76\u5c06\u5b83\u4eec\u7684\u7ed3\u679c\u5c55\u5f00\u8fd4\u56de\uff0c\u4f5c\u4e3aunicode\u5b57\u7b26\u4e32\u7684\u5217\u8868\u3002 re() \u4e3a\u8fd9\u4e2a\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u8c03\u7528 .re() \u65b9\u6cd5\uff0c\u5e76\u5c06\u5b83\u4eec\u7684\u7ed3\u679c\u5c55\u5f00\u8fd4\u56de\uff0c\u4f5c\u4e3aunicode\u5b57\u7b26\u4e32\u7684\u5217\u8868\u3002 HTML response\u7684\u9009\u62e9\u5668\u793a\u4f8b \u8fd9\u91cc\u6709\u51e0\u4e2a Selector \u793a\u4f8b\u6765\u8bf4\u660e\u51e0\u4e2a\u6982\u5ff5\u3002\u5728\u6240\u6709\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u5047\u8bbe\u5df2\u7ecf\u6709\u4e00\u4e2a Selector \u5b9e\u4f8b\u5316\u4e86\u4e00\u4e2a HtmlResponse \u5bf9\u8c61\uff0c\u5982\u4e0b\u6240\u793a\uff1a sel = Selector(html_response) \u4ece\u4e00\u4e2aHTML response\u4f53\u4e2d\u9009\u62e9\u6240\u6709 h1 \u5143\u7d20\uff0c\u8fd4\u56de\u4e00\u4e2a Selector \u5bf9\u8c61\u7684\u5217\u8868\uff08\u4f8b\u5982\u3002 SelectorList \u5bf9\u8c61): sel.xpath( //h1 ) \u4ece\u4e00\u4e2aHTML response\u4f53\u4e2d\u63d0\u53d6\u6240\u6709 h1 \u5143\u7d20\u7684\u6587\u672c\uff0c\u8fd4\u56de\u4e00\u4e2aunicode\u5b57\u7b26\u4e32\u5217\u8868\uff1a sel.xpath( //h1 ).extract() # \u8fd9\u5305\u62ech1\u6807\u7b7e sel.xpath( //h1/text() ).extract() # \u8fd9\u5c31\u6392\u9664\u4e86h1\u6807\u7b7e \u904d\u5386\u6240\u6709\u7684 p \u6807\u7b7e\u5e76\u6253\u5370\u5b83\u4eec\u7684class\u5c5e\u6027\uff1a for node in sel.xpath( //p ): print node.xpath( @class ).extract() XML\u54cd\u5e94\u7684\u9009\u62e9\u5668\u793a\u4f8b \u8fd9\u91cc\u6709\u51e0\u4e2a\u4f8b\u5b50\u6765\u8bf4\u660e\u51e0\u4e2a\u6982\u5ff5\u3002\u5728\u8fd9\u4e24\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u5047\u8bbe\u5df2\u7ecf\u6709\u4e00\u4e2a Selector \u5b9e\u4f8b\u5316\u4e86\u4e00\u4e2a XmlResponse \u5bf9\u8c61\uff0c\u5982\u4e0b\u6240\u793a\uff1a sel = Selector(xml_response) \u4ece\u4e00\u4e2aXML response\u4f53\u4e2d\u9009\u62e9\u6240\u6709\u7684 product \u5143\u7d20\uff0c\u8fd4\u56de\u4e00\u4e2a Selector \u5bf9\u8c61\u7684\u5217\u8868\uff08\u4f8b\u5982\u3002 SelectorList \u5bf9\u8c61): sel.xpath( //product ) \u4ece Google Base XML feed\u4e2d\u63d0\u53d6\u6240\u6709\u4ef7\u683c\uff0c\u8fd9\u9700\u8981\u6ce8\u518c\u4e00\u4e2a\u540d\u79f0\u7a7a\u95f4\uff1a sel.register_namespace( g , http://base.google.com/ns/1.0 ) sel.xpath( //g:price ).extract() \u5220\u9664\u540d\u79f0\u7a7a\u95f4 \u5728\u5904\u7406\u6293\u53d6\u9879\u76ee\u65f6\uff0c\u5b8c\u5168\u6d88\u9664\u540d\u79f0\u7a7a\u95f4\u901a\u5e38\u662f\u975e\u5e38\u65b9\u4fbf\u7684\uff0c\u53ea\u9700\u4f7f\u7528\u5143\u7d20\u540d\u79f0\u5373\u53ef\uff0c\u7f16\u5199\u66f4\u7b80\u5355/\u65b9\u4fbf\u7684xpath\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 Selector.remove_namespaces() \u65b9\u6cd5\u3002 \u8ba9\u6211\u4eec\u5c55\u793a\u4e00\u4e2a\u7528GitHub\u535a\u5ba2atom feed\u6f14\u793a\u7684\u4f8b\u5b50\u3002 \u9996\u5148\uff0c\u6211\u4eec\u6253\u5f00shell\u5e26\u4e0a\u60f3\u8981\u6293\u53d6\u7684url\uff1a $ scrapy shell https://github.com/blog.atom \u4e00\u65e6\u8fdb\u5165shell\uff0c\u6211\u4eec\u53ef\u4ee5\u5c1d\u8bd5\u9009\u62e9\u6240\u6709\u7684 link \u5bf9\u8c61\uff0c\u5e76\u770b\u5230\u5b83\u4e0d\u8d77\u4f5c\u7528\uff08\u56e0\u4e3aAtom XML\u540d\u79f0\u7a7a\u95f4\u6df7\u6dc6\u4e86\u8fd9\u4e9b\u8282\u70b9\uff09\uff1a response.xpath( //link ) [] \u4f46\u662f\u4e00\u65e6\u6211\u4eec\u8c03\u7528 Selector.remove_namespaces() \u65b9\u6cd5\uff0c\u6240\u6709\u8282\u70b9\u90fd\u53ef\u4ee5\u901a\u8fc7\u5b83\u4eec\u7684\u540d\u79f0\u76f4\u63a5\u8bbf\u95ee\uff1a response.selector.remove_namespaces() response.xpath( //link ) [ Selector xpath='//link' data=u' link xmlns= http://www.w3.org/2005/Atom' , Selector xpath='//link' data=u' link xmlns= http://www.w3.org/2005/Atom' , ... \u5982\u679c\u60a8\u60f3\u77e5\u9053\u4e3a\u4ec0\u4e48\u540d\u79f0\u7a7a\u95f4\u5220\u9664\u8fc7\u7a0b\u4e0d\u603b\u662f\u88ab\u9ed8\u8ba4\u8c03\u7528\uff0c\u800c\u662f\u624b\u52a8\u8c03\u7528\u5b83\uff0c\u8fd9\u662f\u56e0\u4e3a\u6709\u4e24\u4e2a\u539f\u56e0\uff0c\u6839\u636e\u76f8\u5173\u6027\uff0c\u5b83\u4eec\u662f\uff1a Scrapy\u6293\u53d6\u7684\u6240\u6709\u6587\u6863, \u60f3\u8981\u5220\u9664\u540d\u79f0\u7a7a\u95f4\u9700\u8981\u8fed\u4ee3\u548c\u4fee\u6539\u6587\u6863\u4e2d\u7684\u6240\u6709\u8282\u70b9\uff0c\u8fd9\u662f\u4e00\u79cd\u76f8\u5f53\u6602\u8d35\u7684\u64cd\u4f5c\u3002 \u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u5b9e\u9645\u4e0a\u9700\u8981\u4f7f\u7528\u540d\u79f0\u7a7a\u95f4\uff0c\u4ee5\u9632\u67d0\u4e9b\u5143\u7d20\u540d\u79f0\u5728\u540d\u79f0\u7a7a\u95f4\u4e4b\u95f4\u53d1\u751f\u51b2\u7a81\u3002\u4e0d\u8fc7\uff0c\u8fd9\u4e9b\u7279\u4f8b\u975e\u5e38\u7f55\u89c1\u3002","title":"Selector(\u9009\u62e9\u5668)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/08-selctor/#selector","text":"\u5f53\u60a8\u5728\u6293\u53d6web\u9875\u9762\u65f6\uff0c\u60a8\u9700\u8981\u6267\u884c\u7684\u6700\u5e38\u89c1\u7684\u4efb\u52a1\u662f\u4eceHTML\u6e90\u4ee3\u7801\u4e2d\u63d0\u53d6\u6570\u636e\u3002\u6709\u51e0\u4e2a\u5e93\u53ef\u4ee5\u5b9e\u73b0\u8fd9\u4e00\u70b9: \u8bd1\u8005: \u6211\u53ea\u4ecb\u7ecdlxml, \u4e0d\u4ecb\u7ecdBeautifulSoup, \u6211\u53ea\u7528xpath lxml \u662f\u4e00\u4e2aXML\u89e3\u6790\u5e93\uff08\u5b83\u4e5f\u89e3\u6790HTML\uff09\u548c\u57fa\u4e8e ElementTree \u7684python API\u3002\uff08lxml\u4e0d\u662fPython\u6807\u51c6\u5e93\u7684\u4e00\u90e8\u5206\u3002\uff09 Scrapy\u6709\u5b83\u81ea\u5df1\u7684\u63d0\u53d6\u6570\u636e\u7684\u673a\u5236\u3002\u5b83\u4eec\u88ab\u79f0\u4e3aselectors\uff0c\"select\"\u901a\u8fc7 XPath \u6216 CSS \u8868\u8fbe\u5f0f\u6307\u5b9a\u83b7\u53d6HTML\u6587\u6863\u7684\u67d0\u4e9b\u90e8\u5206\u3002 XPath \u662f\u4e00\u95e8\u5728XML\u6587\u6863\u4e2d\u9009\u62e9\u8282\u70b9\u7684\u8bed\u8a00\uff0c\u5b83\u4e5f\u53ef\u4ee5\u4e0eHTML\u4e00\u8d77\u4f7f\u7528\u3002 CSS \u662f\u4e00\u79cd\u5c06\u6837\u5f0f\u5e94\u7528\u4e8eHTML\u6587\u6863\u7684\u8bed\u8a00\u3002\u5b83\u5b9a\u4e49\u9009\u62e9\u5668\u5c06\u8fd9\u4e9b\u6837\u5f0f\u4e0e\u7279\u5b9a\u7684HTML\u5143\u7d20\u5173\u8054\u8d77\u6765\u3002 Scrapy selectors\u662f\u5728 lxml \u5e93\u4e4b\u4e0a\u6784\u5efa\u7684\uff0c\u8fd9\u610f\u5473\u7740\u5b83\u4eec\u5728\u901f\u5ea6\u548c\u89e3\u6790\u7cbe\u5ea6\u65b9\u9762\u975e\u5e38\u76f8\u4f3c\u3002 \u8fd9\u4e2a\u9875\u9762\u89e3\u91ca\u4e86selectors\u5982\u4f55\u5de5\u4f5c\u548c\u600e\u6837\u53bb\u63cf\u8ff0\u5b83\u4eec\u7684API\uff0c\u5b83\u975e\u5e38\u5c0f\u548c\u7b80\u5355\uff0c\u4e0elxml API\u4e0d\u540c\uff0clxml API\u66f4\u5927\uff0c\u56e0\u4e3alxml\u5e93\u53ef\u4ee5\u7528\u4e8e\u8bb8\u591a\u5176\u4ed6\u4efb\u52a1\uff0c\u800c\u4e0d\u662f\u4e13\u95e8\u9009\u62e9\u6807\u8bb0\u6587\u6863\u3002 \u8981\u83b7\u5f97\u9009\u62e9\u5668API\u7684\u5b8c\u6574\u5f15\u7528\uff0c\u8bf7\u53c2\u9605 Selector\u5f15\u7528","title":"Selector(\u9009\u62e9\u5668)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/08-selctor/#_1","text":"","title":"\u4f7f\u7528\u9009\u62e9\u5668"},{"location":"2. \u57fa\u672c\u6982\u5ff5/08-selctor/#_2","text":"Scrapy selectors\u662f\u901a\u8fc7\u4f20\u9012 \u6587\u672c \u6216 TextResponse \u5bf9\u8c61\u6784\u9020\u7684 Selector \u7c7b\u7684\u5b9e\u4f8b\u3002\u5b83\u6839\u636e\u8f93\u5165\u7c7b\u578b\u81ea\u52a8\u9009\u62e9\u6700\u4f73\u7684\u89e3\u6790\u89c4\u5219\uff08XML vs HTML\uff09\uff1a from scrapy.selector import Selector from scrapy.http import HtmlResponse \u4ece\u6587\u672c\u4e2d\u6784\u5efa body = ' html body span good /span /body /html ' Selector(text=body).xpath('//span/text()').extract() [u'good'] \u4eceresponse\u4e2d\u6784\u5efa response = HtmlResponse(url='http://example.com', body=body) Selector(response=response).xpath('//span/text()').extract() [u'good'] \u4e3a\u4e86\u65b9\u4fbf\u8d77\u89c1\uff0cresponse\u5bf9\u8c61\u5728 .selector \u5c5e\u6027\u4e2d\u516c\u5f00\u9009\u62e9\u5668\uff0c\u5728\u53ef\u80fd\u7684\u60c5\u51b5\u4e0b\u4f7f\u7528\u8fd9\u4e2a\u5feb\u6377\u65b9\u5f0f\u662f\u5b8c\u5168\u53ef\u4ee5\u7684\uff1a response.selector.xpath('//span/text()').extract() [u'good']","title":"\u6784\u5efa\u9009\u62e9\u5668"},{"location":"2. \u57fa\u672c\u6982\u5ff5/08-selctor/#_3","text":"\u4e3a\u4e86\u89e3\u91ca\u5982\u4f55\u4f7f\u7528\u9009\u62e9\u5668\uff0c\u6211\u4eec\u5c06\u4f7f\u7528 Scrapy shell \uff08\u63d0\u4f9b\u4ea4\u4e92\u5f0f\u6d4b\u8bd5\uff09\u548c\u4f4d\u4e8eScrapy\u6587\u6863\u670d\u52a1\u5668\u4e2d\u7684\u793a\u4f8b\u9875\u9762\uff1a https://doc.scrapy.org/en/latest/_static/selectors-sample1.html \u8fd9\u662f\u5b83\u7684HTML\u4ee3\u7801: html head base href='http://example.com/' / title Example website /title /head body div id='images' a href='image1.html' Name: My image 1 br / img src='image1_thumb.jpg' / /a a href='image2.html' Name: My image 2 br / img src='image2_thumb.jpg' / /a a href='image3.html' Name: My image 3 br / img src='image3_thumb.jpg' / /a a href='image4.html' Name: My image 4 br / img src='image4_thumb.jpg' / /a a href='image5.html' Name: My image 5 br / img src='image5_thumb.jpg' / /a /div /body /html \u9996\u5148\uff0c\u8ba9\u6211\u4eec\u6253\u5f00shell\uff1a scrapy shell https://doc.scrapy.org/en/latest/_static/selectors-sample1.html \u7136\u540e\uff0c\u5728shell\u52a0\u8f7d\u4e4b\u540e\uff0c\u60a8\u5c06\u4f1a\u5f97\u5230\u4e00\u4e2a\u53ef\u7528\u7684response\u4f5c\u4e3ashell\u7684response\u53d8\u91cf\uff0c\u5e76\u5c06\u5176\u9644\u52a0\u7684\u9009\u62e9\u5668\u4f5c\u4e3a response.selector \u5c5e\u6027\u3002 \u56e0\u4e3a\u6211\u4eec\u5904\u7406\u7684\u662fHTML\uff0c\u6240\u4ee5\u9009\u62e9\u5668\u4f1a\u81ea\u52a8\u4f7f\u7528\u4e00\u4e2aHTML\u89e3\u6790\u5668\u3002 \u56e0\u6b64\uff0c\u901a\u8fc7\u67e5\u770b\u8be5\u9875\u9762\u7684 HTML\u4ee3\u7801 \uff0c\u8ba9\u6211\u4eec\u6784\u5efa\u4e00\u4e2aXPath\u6765\u9009\u62e9\u6807\u9898\u6807\u7b7e\u4e2d\u7684\u6587\u672c\uff1a response.selector.xpath('//title/text()') [ Selector (text) xpath=//title/text() ] \u4f7f\u7528XPath\u548cCSS\u67e5\u8be2responses\u662f\u975e\u5e38\u5e38\u89c1\u7684\uff0cresponse\u5305\u62ec\u4e24\u4e2a\u4fbf\u5229\u7684\u65b9\u6cd5\uff1a response.xpath() \u548c response.css() \uff1a response.xpath('//title/text()') [ Selector (text) xpath=//title/text() ] response.css('title::text') [ Selector (text) xpath=//title/text() ] \u5982\u60a8\u6240\u89c1\uff0c .xpath() \u548c .css() \u65b9\u6cd5\u8fd4\u56deSelectorList\u5b9e\u4f8b\uff0c\u5b83\u662f\u4e00\u4e2a\u65b0\u7684selectors\u5217\u8868\u3002\u8fd9\u4e2aAPI\u53ef\u7528\u4e8e\u5feb\u901f\u9009\u62e9\u5d4c\u5957\u6570\u636e\uff1a response.css('img').xpath('@src').extract() [u'image1_thumb.jpg', u'image2_thumb.jpg', u'image3_thumb.jpg', u'image4_thumb.jpg', u'image5_thumb.jpg'] \u8981\u63d0\u53d6\u6587\u672c\u5b9e\u9645\u6570\u636e\uff0c\u60a8\u5fc5\u987b\u8c03\u7528selector .extract() \u65b9\u6cd5\uff0c\u5982\u4e0b\u6240\u5217\uff1a response.xpath('//title/text()').extract() [u'Example website'] \u5982\u679c\u60a8\u53ea\u60f3\u63d0\u53d6\u7b2c\u4e00\u4e2a\u5339\u914d\u7684\u5143\u7d20\uff0c\u60a8\u53ef\u4ee5\u8c03\u7528 .extract_first() \u3002 response.xpath('//div[@id= images ]/a/text()').extract_first() u'Name: My image 1 ' \u5982\u679c\u6ca1\u6709\u627e\u5230\u4efb\u4f55\u5143\u7d20\uff0c\u5b83\u5c06\u8fd4\u56de None \uff1a response.xpath('//div[@id= not-exists ]/text()').extract_first() is None True \u9ed8\u8ba4\u7684\u8fd4\u56de\u503c\u53ef\u4ee5\u63d0\u4f9b\u4e00\u4e2a\u53c2\u6570\uff0c\u800c\u4e0d\u662f None \uff1a response.xpath('//div[@id= not-exists ]/text()').extract_first(default='not-found') 'not-found' \u6ce8\u610f\uff0cCSS\u9009\u62e9\u5668\u53ef\u4ee5\u4f7f\u7528CSS3\u4f2a\u5143\u7d20\u9009\u62e9\u6587\u672c\u6216\u5c5e\u6027\u8282\u70b9\uff1a response.css('title::text').extract() [u'Example website'] \u73b0\u5728\u6211\u4eec\u5c06\u5f97\u5230\u57fa\u672cURL\u548c\u4e00\u4e9b\u56fe\u50cf\u94fe\u63a5\uff1a response.xpath('//base/@href').extract() [u'http://example.com/'] response.css('base::attr(href)').extract() [u'http://example.com/'] response.xpath('//a[contains(@href, image )]/@href').extract() [u'image1.html', u'image2.html', u'image3.html', u'image4.html', u'image5.html'] response.css('a[href*=image]::attr(href)').extract() [u'image1.html', u'image2.html', u'image3.html', u'image4.html', u'image5.html'] response.xpath('//a[contains(@href, image )]/img/@src').extract() [u'image1_thumb.jpg', u'image2_thumb.jpg', u'image3_thumb.jpg', u'image4_thumb.jpg', u'image5_thumb.jpg'] response.css('a[href*=image] img::attr(src)').extract() [u'image1_thumb.jpg', u'image2_thumb.jpg', u'image3_thumb.jpg', u'image4_thumb.jpg', u'image5_thumb.jpg']","title":"\u4f7f\u7528\u9009\u62e9\u5668"},{"location":"2. \u57fa\u672c\u6982\u5ff5/08-selctor/#_4","text":"\u9009\u62e9\u65b9\u6cd5( .xpath() \u6216 .css() )\u8fd4\u56de\u540c\u4e00\u7c7b\u578b\u7684selectors\u7684\u5217\u8868\uff0c\u56e0\u6b64\u60a8\u4e5f\u53ef\u4ee5\u4e3a\u8fd9\u4e9b\u9009\u62e9\u5668\u8c03\u7528\u9009\u62e9\u65b9\u6cd5\u3002\u8fd9\u91cc\u6709\u4e00\u4e2a\u4f8b\u5b50: links = response.xpath('//a[contains(@href, image )]') links.extract() [u' a href= image1.html Name: My image 1 br img src= image1_thumb.jpg /a ', u' a href= image2.html Name: My image 2 br img src= image2_thumb.jpg /a ', u' a href= image3.html Name: My image 3 br img src= image3_thumb.jpg /a ', u' a href= image4.html Name: My image 4 br img src= image4_thumb.jpg /a ', u' a href= image5.html Name: My image 5 br img src= image5_thumb.jpg /a '] for index, link in enumerate(links): ... args = (index, link.xpath('@href').extract(), link.xpath('img/@src').extract()) ... print 'Link number %d points to url %s and image %s' % args Link number 0 points to url [u'image1.html'] and image [u'image1_thumb.jpg'] Link number 1 points to url [u'image2.html'] and image [u'image2_thumb.jpg'] Link number 2 points to url [u'image3.html'] and image [u'image3_thumb.jpg'] Link number 3 points to url [u'image4.html'] and image [u'image4_thumb.jpg'] Link number 4 points to url [u'image5.html'] and image [u'image5_thumb.jpg']","title":"\u5d4c\u5957\u9009\u62e9\u5668"},{"location":"2. \u57fa\u672c\u6982\u5ff5/08-selctor/#_5","text":"Selecotr \u8fd8\u6709\u4e00\u4e2a .re() \u65b9\u6cd5\uff0c\u7528\u4e8e\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u63d0\u53d6\u6570\u636e\u3002\u7136\u800c\uff0c\u4e0e\u4f7f\u7528 .xpath() \u6216 .css() \u65b9\u6cd5\u4e0d\u540c\uff0c .re() \u8fd4\u56deunicode\u5b57\u7b26\u4e32\u5217\u8868\u3002\u6240\u4ee5\u4f60\u4e0d\u80fd\u6784\u9020\u5d4c\u5957\u7684 re() \u8c03\u7528\u3002 \u4e0b\u9762\u662f\u4e00\u4e2a\u4ece\u4e0a\u9762\u7684HTML\u4ee3\u7801\u4e2d\u63d0\u53d6\u56fe\u50cf\u540d\u79f0\u7684\u4f8b\u5b50\uff1a response.xpath('//a[contains(@href, image )]/text()').re(r'Name:\\s*(.*)') [u'My image 1', u'My image 2', u'My image 3', u'My image 4', u'My image 5'] \u8fd8\u6709\u4e00\u4e2a\u989d\u5916\u7684\u65b9\u6cd5\u3002\u4f7f\u7528 .re_first() \u6765\u63d0\u53d6\u7b2c\u4e00\u4e2a\u5339\u914d\u7684\u5b57\u7b26\u4e32\uff1a response.xpath('//a[contains(@href, image )]/text()').re_first(r'Name:\\s*(.*)') u'My image 1' \u4f7f\u7528\u76f8\u5bf9xpath \u8bf7\u8bb0\u4f4f\uff0c\u5982\u679c\u60a8\u6b63\u5728\u5d4c\u5957\u9009\u62e9\u5668\uff0c\u5e76\u4f7f\u7528\u4ee5 / \u5f00\u5934\u7684XPath\uff0c\u90a3\u4e48XPath\u5c06\u662f\u7edd\u5bf9\u7684\uff0c\u800c\u4e0d\u662f\u76f8\u5bf9\u4e8e\u60a8\u8c03\u7528\u7684 Selector \u3002 \u4f8b\u5982\uff0c\u5047\u8bbe\u4f60\u60f3\u8981\u63d0\u53d6 p \u5143\u7d20\u4e2d\u7684\u6240\u6709 div \u5143\u7d20\u3002\u9996\u5148\uff0c\u4f60\u4f1a\u5f97\u5230\u6240\u6709\u7684 div \u5143\u7d20\uff1a divs = response.xpath('//div') \u4e00\u5f00\u59cb\uff0c\u60a8\u53ef\u80fd\u4f1a\u5c1d\u8bd5\u4f7f\u7528\u4ee5\u4e0b\u65b9\u6cd5\uff0c\u8fd9\u662f\u9519\u8bef\u7684\uff0c\u56e0\u4e3a\u5b83\u5b9e\u9645\u4e0a\u4ece\u6587\u6863\u4e2d\u63d0\u53d6\u4e86\u6240\u6709\u7684 p \u5143\u7d20\uff0c\u800c\u4e0d\u4ec5\u4ec5\u662f\u90a3\u4e9b\u5185\u90e8\u7684 div \u5143\u7d20\uff1a for p in divs.xpath('//p'): # \u8fd9\u662f\u9519\u8bef\u7684 \u2014\u2014 \u8fd9\u4f1a\u4ece\u6574\u4e2a\u6587\u6863\u4e2d\u5f97\u5230\u6240\u6709\u7684 p \u4fe1\u606f ... print p.extract() \u8fd9\u662f\u6b63\u786e\u7684\u65b9\u6cd5\uff08\u6ce8\u610f\u5728XPath\u8def\u5f84 //p \u524d\u52a0\u524d\u7f00\u70b9\uff09\uff1a for p in divs.xpath('.//p'): # \u63d0\u53d6\u6240\u6709 p \u5185\u90e8 ... print p.extract() \u53e6\u4e00\u4e2a\u5e38\u89c1\u7684\u4f8b\u5b50\u662f\uff0c\u76f4\u63a5\u63d0\u53d6\u5f53\u524d\u8282\u70b9\u6240\u6709\u7684 p children\uff1a for p in divs.xpath('p'): ... print p.extract() \u6709\u5173XPath\u76f8\u5bf9\u8def\u5f84\u7684\u66f4\u591a\u7ec6\u8282\uff0c\u8bf7\u53c2\u9605XPath\u89c4\u8303\u4e2d\u7684 \u4f4d\u7f6e\u8def\u5f84 \u90e8\u5206\u3002","title":"\u4f7f\u7528\u5e26\u6709\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u9009\u62e9\u5668"},{"location":"2. \u57fa\u672c\u6982\u5ff5/08-selctor/#xpath","text":"XPath\u5141\u8bb8\u60a8\u4f7f\u7528 $somevariable \u8bed\u6cd5\u5f15\u7528XPath\u8868\u8fbe\u5f0f\u4e2d\u7684\u53d8\u91cf\u3002\u8fd9\u6709\u70b9\u7c7b\u4f3c\u4e8eSQL\u4e16\u754c\u4e2d\u7684\u53c2\u6570\u5316\u67e5\u8be2\u6216\u9884\u5904\u7406\u8bed\u53e5\uff0c\u60a8\u53ef\u4ee5\u5728\u67e5\u8be2\u4e2d\u4f7f\u7528\u8bf8\u5982\u6b64\u7c7b\u7684\u5360\u4f4d\u7b26\u66ff\u6362\u4e00\u4e9b\u53c2\u6570\uff0c\u7136\u540e\u7528\u67e5\u8be2\u4f20\u9012\u7684\u503c\u4ee3\u66ff\u3002 \u8fd9\u91cc\u6709\u4e00\u4e2a\u4f8b\u5b50\uff0c\u6839\u636e\u5b83\u7684\u201cid\u201d\u5c5e\u6027\u503c\u6765\u5339\u914d\u4e00\u4e2a\u5143\u7d20\uff0c\u800c\u4e0d\u9700\u8981\u786c\u7f16\u7801\u5b83\uff08\u4e4b\u524d\u663e\u793a\u7684\uff09\uff1a # \u5728\u8868\u8fbe\u5f0f\u4e2d\u4f7f\u7528\u201c$val\u201d\uff0c\u9700\u8981\u4f20\u9012\u4e00\u4e2a\u201cval\u201d\u53c2\u6570 response.xpath('//div[@id=$val]/a/text()', val='images').extract_first() u'Name: My image 1 ' \u8fd9\u662f\u53e6\u4e00\u4e2a\u4f8b\u5b50\uff0c\u4e3a\u4e86\u63d0\u53d6\u7b2c5\u4e2adiv\u6807\u7b7e\u4e0b\u7684id\u6807\u7b7e\u4e0b\u7684\u503c, \u8fd9\u91cc\u6211\u4eec\u5c06\u503c5\u4f5c\u4e3a\u6574\u6570\uff09\uff1a response.xpath('//div[count(a)=$cnt]/@id', cnt=5).extract_first() u'images' \u5f53\u8c03\u7528 .xpath() \u65f6\uff0c\u6240\u6709\u5f15\u7528\u53d8\u91cf\u90fd\u5fc5\u987b\u6709\u503c\uff08\u5426\u5219\u5c31\u4f1a\u5f97\u5230 ValueError: XPath error: \uff09\u3002\u5728\u5fc5\u8981\u65f6\u4f20\u9012\u5c3d\u53ef\u80fd\u591a\u7684\u547d\u540d\u53c2\u6570\u3002 parsel \u662f\u4e00\u4e2a\u4e3a Scrapy selectors\u63d0\u4f9b\u52a8\u529b\u7684\u5e93\uff0c\u5b83\u6709\u66f4\u591a\u5173\u4e8e XPath\u53d8\u91cf \u7684\u7ec6\u8282\u548c\u793a\u4f8b\u3002","title":"XPath\u8868\u8fbe\u5f0f\u4e2d\u7684\u53d8\u91cf"},{"location":"2. \u57fa\u672c\u6982\u5ff5/08-selctor/#exslt","text":"\u5728 lxml \u4e4b\u4e0a\u6784\u5efa\u7684Scrapy selectors\u8fd8\u652f\u6301\u4e00\u4e9b EXSLT \u6269\u5c55\uff0c\u5e76\u4f7f\u7528\u8fd9\u4e9b\u9884\u5148\u6ce8\u518c\u7684\u540d\u79f0\u7a7a\u95f4\u6765\u4f7f\u7528XPath\u8868\u8fbe\u5f0f\uff1a \u9884\u5b9a\u4e49 \u547d\u540d\u7a7a\u95f4 \u7528\u6cd5 re http://exslt.org/regular-expressions regular expressions set http://exslt.org/sets set manipulation","title":"\u4f7f\u7528EXSLT\u6269\u5c55"},{"location":"2. \u57fa\u672c\u6982\u5ff5/08-selctor/#_6","text":"\u4f8b\u5982\uff0c\u5f53XPath\u7684 starts-with() \u6216 contains() \u4e0d\u80fd\u6ee1\u8db3\u65f6\uff0c test() \u51fd\u6570\u4f1a\u88ab\u8bc1\u660e\u662f\u975e\u5e38\u6709\u7528\u7684\u3002 \u4f8b\u5982\uff0c\u5728\u5217\u8868item\u4e2d\u9009\u62e9\u5e26\u6709\u4e00\u4e2a\u201cclass\u201d\u5c5e\u6027\u7684\u94fe\u63a5\uff0c\u4ee5\u4e00\u4e2a\u6570\u5b57\u7ed3\u5c3e\uff1a from scrapy import Selector doc = ... div ... ul ... li class= item-0 a href= link1.html first item /a /li ... li class= item-1 a href= link2.html second item /a /li ... li class= item-inactive a href= link3.html third item /a /li ... li class= item-1 a href= link4.html fourth item /a /li ... li class= item-0 a href= link5.html fifth item /a /li ... /ul ... /div ... sel = Selector(text=doc, type= html ) sel.xpath('//li//@href').extract() [u'link1.html', u'link2.html', u'link3.html', u'link4.html', u'link5.html'] sel.xpath('//li[re:test(@class, item-\\d$ )]//@href').extract() [u'link1.html', u'link2.html', u'link4.html', u'link5.html'] \u8b66\u544a~~~~\u8b66\u544a~~~~~~ C \u5e93 libxslt \u672c\u8eab\u5e76\u4e0d\u652f\u6301EXSLT\u6b63\u5219\u8868\u8fbe\u5f0f \u56e0\u6b64lxml\u7684\u5b9e\u73b0\u4f7f\u7528\u7684\u662fPython\u7684re\u6a21\u5757\u3002 \u56e0\u6b64\uff0c\u5728XPath\u8868\u8fbe\u5f0f\u4e2d\u4f7f\u7528regexp\u51fd\u6570\u53ef\u80fd\u4f1a\u589e\u52a0\u4e00\u4e2a\u5c0f\u7684\u6027\u80fd\u635f\u5931\u3002","title":"\u6b63\u5219\u8868\u8fbe\u5f0f"},{"location":"2. \u57fa\u672c\u6982\u5ff5/08-selctor/#_7","text":"\u5728\u63d0\u53d6\u6587\u672c\u5143\u7d20\u4e4b\u524d\uff0c\u8fd9\u4e9b\u53ef\u4ee5\u65b9\u4fbf\u5730\u6392\u9664\u6587\u6863\u6811\u7684\u67d0\u4e9b\u90e8\u5206\u3002 \u4f8b\u5982\uff0c\u63d0\u53d6\u5fae\u6570\u636e\uff08\u4ece http://schema.org/Product \u83b7\u53d6\u7684\u6837\u4f8b\u5185\u5bb9\uff09\u4e0e\u9879\u76ee\u8303\u56f4\u548c\u76f8\u5e94\u7684\u9879\u76ee\u652f\u6301\uff1a doc = ... div itemscope itemtype= http://schema.org/Product ... span itemprop= name Kenmore White 17 Microwave /span ... img src= kenmore-microwave-17in.jpg alt='Kenmore 17 Microwave' / ... div itemprop= aggregateRating ... itemscope itemtype= http://schema.org/AggregateRating ... Rated span itemprop= ratingValue 3.5 /span /5 ... based on span itemprop= reviewCount 11 /span customer reviews ... /div ... ... div itemprop= offers itemscope itemtype= http://schema.org/Offer ... span itemprop= price $55.00 /span ... link itemprop= availability href= http://schema.org/InStock / In stock ... /div ... ... Product description: ... span itemprop= description 0.7 cubic feet countertop microwave. ... Has six preset cooking categories and convenience features like ... Add-A-Minute and Child Lock. /span ... ... Customer reviews: ... ... div itemprop= review itemscope itemtype= http://schema.org/Review ... span itemprop= name Not a happy camper /span - ... by span itemprop= author Ellie /span , ... meta itemprop= datePublished content= 2011-04-01 April 1, 2011 ... div itemprop= reviewRating itemscope itemtype= http://schema.org/Rating ... meta itemprop= worstRating content = 1 ... span itemprop= ratingValue 1 /span / ... span itemprop= bestRating 5 /span stars ... /div ... span itemprop= description The lamp burned out and now I have to replace ... it. /span ... /div ... ... div itemprop= review itemscope itemtype= http://schema.org/Review ... span itemprop= name Value purchase /span - ... by span itemprop= author Lucas /span , ... meta itemprop= datePublished content= 2011-03-25 March 25, 2011 ... div itemprop= reviewRating itemscope itemtype= http://schema.org/Rating ... meta itemprop= worstRating content = 1 / ... span itemprop= ratingValue 4 /span / ... span itemprop= bestRating 5 /span stars ... /div ... span itemprop= description Great microwave for the price. It is small and ... fits in my apartment. /span ... /div ... ... ... /div ... sel = Selector(text=doc, type= html ) for scope in sel.xpath('//div[@itemscope]'): ... print current scope: , scope.xpath('@itemtype').extract() ... props = scope.xpath(''' ... set:difference(./descendant::*/@itemprop, ... .//*[@itemscope]/*/@itemprop)''') ... print properties: , props.extract() ... print current scope: [u'http://schema.org/Product'] properties: [u'name', u'aggregateRating', u'offers', u'description', u'review', u'review'] current scope: [u'http://schema.org/AggregateRating'] properties: [u'ratingValue', u'reviewCount'] current scope: [u'http://schema.org/Offer'] properties: [u'price', u'availability'] current scope: [u'http://schema.org/Review'] properties: [u'name', u'author', u'datePublished', u'reviewRating', u'description'] current scope: [u'http://schema.org/Rating'] properties: [u'worstRating', u'ratingValue', u'bestRating'] current scope: [u'http://schema.org/Review'] properties: [u'name', u'author', u'datePublished', u'reviewRating', u'description'] current scope: [u'http://schema.org/Rating'] properties: [u'worstRating', u'ratingValue', u'bestRating'] \u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u9996\u5148\u8fed\u4ee3\u5305\u542b itemscope \u5143\u7d20\uff0c\u5bf9\u4e8e\u5b83\u4e0b\u9762\u6bcf\u4e00\u4e2a\u5143\u7d20\uff0c\u6211\u4eec\u5bfb\u627e\u6240\u6709\u5305\u542b itemprops \u5143\u7d20\uff0c\u5e76\u5c06\u5b83\u4eec\u672c\u8eab\u6392\u9664\u5728\u53e6\u4e00\u4e2a itemscope \u4e2d\u3002","title":"\u96c6\u5408\u8fd0\u7b97"},{"location":"2. \u57fa\u672c\u6982\u5ff5/08-selctor/#xpath_1","text":"\u4e0b\u9762\u662f\u4e00\u4e9b\u6280\u5de7\uff0c\u60a8\u53ef\u80fd\u4f1a\u5728\u4f7f\u7528XPath\u9009\u62e9\u5668\u65f6\u53d1\u73b0\u6709\u7528\u7684\u6280\u5de7\uff0c\u8fd9\u662f\u57fa\u4e8e Scrapy\u7684\u535a\u5ba2\u4e0a\u7684\u8fd9\u7bc7\u6587\u7ae0 \u3002\u5982\u679c\u60a8\u8fd8\u4e0d\u592a\u719f\u6089XPath\uff0c\u90a3\u4e48\u60a8\u53ef\u80fd\u60f3\u5148\u770b\u4e00\u4e0b\u8fd9\u4e2a XPath\u6559\u7a0b \u3002","title":"\u4e00\u4e9bXPath\u6280\u5de7"},{"location":"2. \u57fa\u672c\u6982\u5ff5/08-selctor/#_8","text":"\u5f53\u60a8\u9700\u8981\u5c06\u6587\u672c\u5185\u5bb9\u7528\u4f5c XPath\u5b57\u7b26\u4e32\u51fd\u6570 \u7684\u53c2\u6570\u65f6\uff0c\u8bf7\u907f\u514d\u4f7f\u7528 //text() \u5e76\u4f7f\u7528 . \u4ee3\u66ff\u3002 \u8fd9\u662f\u56e0\u4e3a\u8868\u8fbe\u5f0f .//text() \u4ea7\u751f\u4e86\u4e00\u6279\u6587\u672c\u5143\u7d20\u2014\u2014\u4e00\u4e2a\u8282\u70b9\u96c6\u3002\u5f53\u4e00\u4e2a\u8282\u70b9\u96c6\u88ab\u8f6c\u6362\u6210\u4e00\u4e2a\u5b57\u7b26\u4e32\u65f6\uff0c\u5f53\u5b83\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7ed9\u5b57\u7b26\u4e32\u51fd\u6570\u65f6\uff0c\u6bd4\u5982 contains() \u6216 starts-with() \uff0c\u5b83\u53ea\u4f1a\u4ea7\u751f\u7b2c\u4e00\u4e2a\u5143\u7d20\u7684\u6587\u672c\u3002 \u4f8b\u5b50 from scrapy import Selector sel = Selector(text=' a href= # Click here to go to the strong Next Page /strong /a ') \u5c06\u8282\u70b9\u96c6\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\uff1a sel.xpath('//a//text()').extract() # \u770b\u4e00\u770b\u8282\u70b9\u96c6 [u'Click here to go to the ', u'Next Page'] sel.xpath( string(//a[1]//text()) ).extract() # \u628a\u5b83\u8f6c\u6362\u6210\u5b57\u7b26\u4e32 [u'Click here to go to the '] \u7136\u800c\uff0c\u4e00\u4e2a\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\u7684\u8282\u70b9\u5c06\u5176\u81ea\u8eab\u7684\u6587\u672c\u548c\u5b83\u7684\u6240\u6709\u540e\u4ee3\u653e\u5728\u4e00\u8d77\uff1a sel.xpath( //a[1] ).extract() # \u9009\u62e9\u7b2c\u4e00\u4e2a\u8282\u70b9 [u' a href= # Click here to go to the strong Next Page /strong /a '] sel.xpath( string(//a[1]) ).extract() # \u628a\u5b83\u8f6c\u6362\u6210\u5b57\u7b26\u4e32 [u'Click here to go to the Next Page'] \u56e0\u6b64\uff0c\u4f7f\u7528 .//text() node-set\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u4e0d\u4f1a\u9009\u62e9\u4efb\u4f55\u4e1c\u897f\uff1a sel.xpath( //a[contains(.//text(), 'Next Page')] ).extract() [] \u4f46\u4f7f\u7528 . \u4e3a\u4e86\u8868\u793a\u8282\u70b9\uff0c\u5de5\u4f5c\uff1a sel.xpath( //a[contains(., 'Next Page')] ).extract() [u' a href= # Click here to go to the strong Next Page /strong /a ']","title":"\u6709\u6761\u4ef6\u4e0b\u662f\u7528\u6587\u672c\u8282\u70b9"},{"location":"2. \u57fa\u672c\u6982\u5ff5/08-selctor/#node1node1","text":"//node[1] \u9009\u62e9\u5728\u4ed6\u4eec\u5404\u81ea\u7684\u7236\u6bcd\u4e0b\u9996\u5148\u53d1\u751f\u7684\u6240\u6709\u8282\u70b9\u3002 (//node)[1] \u9009\u62e9\u6587\u6863\u4e2d\u7684\u6240\u6709\u8282\u70b9\uff0c\u7136\u540e\u53ea\u83b7\u53d6\u5176\u4e2d\u7684\u7b2c\u4e00\u4e2a\u8282\u70b9\u3002 \u4f8b\u5b50: from scrapy import Selector sel = Selector(text= ....: ul class= list ....: li 1 /li ....: li 2 /li ....: li 3 /li ....: /ul ....: ul class= list ....: li 4 /li ....: li 5 /li ....: li 6 /li ....: /ul ) xp = lambda x: sel.xpath(x).extract() \u8fd9\u5c31\u5f97\u5230\u4e86\u5728\u5b83\u7684\u7236\u5143\u7d20\u4e0b\u6240\u6709\u7684 li \u5143\u7d20 xp( //li[1] ) [u' li 1 /li ', u' li 4 /li '] \u8fd9\u5c31\u5f97\u5230\u4e86\u6574\u4e2a\u6587\u6863\u7684\u7b2c\u4e00\u4e2a li \u5143\u7d20\uff1a xp( (//li)[1] ) [u' li 1 /li '] \u8fd9\u5c31\u5f97\u5230\u4e86\u7236\u6bcd\u7684\u7b2c\u4e00\u4e2a li \u5143\u7d20\uff1a xp( //ul/li[1] ) [u' li 1 /li ', u' li 4 /li '] \u8fd9\u5c31\u5f97\u5230\u4e86\u6574\u4e2a\u6587\u6863\u4e2d ul \u7236\u5143\u7d20\u4e0b\u7684\u7b2c\u4e00\u4e2a li \u5143\u7d20\uff1a xp( (//ul/li)[1] ) [u' li 1 /li ']","title":"\u6ce8\u610f//node[1]\u548c(//node)[1]\u4e4b\u95f4\u7684\u533a\u522b"},{"location":"2. \u57fa\u672c\u6982\u5ff5/08-selctor/#classcss","text":"\u56e0\u4e3a\u4e00\u4e2a\u5143\u7d20\u53ef\u4ee5\u5305\u542b\u591a\u4e2aCSS\u7c7b\uff0c\u6240\u4ee5\u901a\u8fc7class\u6765\u9009\u62e9\u5143\u7d20\u7684XPath\u65b9\u6cd5\u662f\u76f8\u5f53\u5197\u957f\u7684\uff1a *[contains(concat(' ', normalize-space(@class), ' '), ' someclass ')] \u5982\u679c\u4f60\u4f7f\u7528 @class='someclass' \uff0c\u4f60\u53ef\u80fd\u4f1a\u9519\u8fc7\u5176\u4ed6\u7c7b\u7684\u5143\u7d20\uff0c\u5982\u679c\u4f60\u53ea\u662f\u4f7f\u7528 contains(@class, 'someclass') \u6765\u5f25\u8865\uff0c\u4f60\u53ef\u80fd\u4f1a\u5f97\u5230\u66f4\u591a\u4f60\u60f3\u8981\u7684\u5143\u7d20\uff0c\u5982\u679c\u5b83\u4eec\u6709\u4e00\u4e2a\u4e0d\u540c\u7684\u7c7b\u540d\uff0c\u5b83\u5171\u4eab\u5b57\u7b26\u4e32 someclass \u3002 \u4e8b\u5b9e\u8bc1\u660e\uff0cScrapy selectors\u5141\u8bb8\u4f60\u9009\u62e9\u94fe\u9009\u62e9\u5668\uff0c\u6240\u4ee5\u5927\u591a\u6570\u65f6\u5019\u4f60\u53ef\u4ee5\u5728\u7c7b\u4e2d\u9009\u62e9\u4f7f\u7528CSS\uff0c\u7136\u540e\u5728\u9700\u8981\u65f6\u5207\u6362\u5230XPath\uff1a from scrapy import Selector sel = Selector(text=' div class= hero shout time datetime= 2014-07-23 19:00 Special date /time /div ') sel.css('.shout').xpath('./time/@datetime').extract() [u'2014-07-23 19:00'] \u8fd9\u6bd4\u4f7f\u7528\u4e0a\u9762\u663e\u793a\u7684\u5197\u957f\u7684XPath\u6280\u5de7\u66f4\u5e72\u51c0\u3002\u53ea\u8981\u8bb0\u4f4f\u5728\u63a5\u4e0b\u6765\u7684XPath\u8868\u8fbe\u5f0f\u4e2d\u4f7f\u7528 . \u3002","title":"\u5728\u8fdb\u884c\u7c7b(class)\u67e5\u8be2\u65f6\uff0c\u8003\u8651\u4f7f\u7528CSS\u9009\u62e9\u5668"},{"location":"2. \u57fa\u672c\u6982\u5ff5/08-selctor/#_9","text":"","title":"\u5185\u7f6e\u7684\u9009\u62e9\u5668\u53c2\u8003"},{"location":"2. \u57fa\u672c\u6982\u5ff5/08-selctor/#selector_1","text":"","title":"Selector(\u9009\u62e9\u5668) \u5bf9\u8c61"},{"location":"2. \u57fa\u672c\u6982\u5ff5/08-selctor/#scrapyselectorselectorresponsenone-textnone-typenone-class","text":"Selector \u7684\u4e00\u4e2a\u5b9e\u4f8b\u662f\u4e00\u4e2a\u5305\u88c5\u5668\uff0c\u7528\u4e8e\u9009\u62e9\u5176\u5185\u5bb9\u7684\u67d0\u4e9b\u90e8\u5206\u3002 response \u662f\u4e00\u4e2a HtmlResponse \u6216 XmlResponse \u5bf9\u8c61\uff0c\u5b83\u5c06\u88ab\u7528\u4e8e\u9009\u62e9\u548c\u63d0\u53d6\u6570\u636e\u3002 text \u662f\u4e00\u79cdunicode\u5b57\u7b26\u4e32\u6216utf-8\u7f16\u7801\u7684\u6587\u672c\uff0c\u5f53\u65e0\u6cd5\u83b7\u5f97 response \u65f6\u3002\u4f7f\u7528 text \u548c response \u662f\u672a\u5b9a\u4e49\u7684\u884c\u4e3a\u3002 type \u5b9a\u4e49selector\u7c7b\u578b\uff0c\u5b83\u53ef\u4ee5\u662f \u201chtml\u201d \u3001 \u201cxml\u201d \u6216 None \uff08\u9ed8\u8ba4\uff09\u3002 \u5982\u679c type \u4e3a None \uff0c\u5219selector\u4f1a\u6839\u636e response \u7c7b\u578b\u81ea\u52a8\u9009\u62e9\u6700\u4f73\u7c7b\u578b\uff08\u89c1\u4e0b\u6587\uff09\uff0c\u6216\u8005\u9ed8\u8ba4\u4e3a\u201chtml\u201d\uff0c\u4ee5\u9632\u5b83\u4e0e text \u4e00\u8d77\u4f7f\u7528\u3002 \u5982\u679c type \u4e3a None \uff0c\u5e76\u4e14 response \u88ab\u4f20\u9012\uff0c\u90a3\u4e48selector\u7c7b\u578b\u662f\u4eceresponse\u7c7b\u578b\u63a8\u65ad\u51fa\u6765\u7684\uff1a \"html\" HtmlResponse \u7c7b\u578b \"xml\" XmlResponse \u7c7b\u578b \"html\" \u505a\u522b\u7684\u4e8b\u60c5 \u5426\u5219\uff0c\u5982\u679c type \u88ab\u8bbe\u7f6e\uff0cselector\u7c7b\u578b\u5c31\u662f\u56fa\u5b9a\u7684\uff0c\u4e0d\u4f1a\u53d1\u751f\u81ea\u52a8\u68c0\u6d4b\u7c7b\u578b\u3002 xpath(query) \u627e\u5230\u5339\u914d query \u7684\u8282\u70b9\u7684xpath\uff0c\u5e76\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9 SelectorList \u5b9e\u4f8b\uff0c\u6240\u6709\u5143\u7d20\u90fd\u88ab\u5c55\u5f00\u3002\u5217\u8868\u5143\u7d20\u4e5f\u5b9e\u73b0\u4e86 SelectorList \u63a5\u53e3\u3002 query \u662f\u4e00\u4e2a\u5305\u542bXPATH\u67e5\u8be2\u7684\u5b57\u7b26\u4e32\u3002 \u6ce8\u610f!!!!!!!!!!! \u4e3a\u4e86\u65b9\u4fbf\u8d77\u89c1\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u79f0\u4e3aresponse.xpath() css(query) \u5e94\u7528\u7ed9\u5b9a\u7684CSS\u9009\u62e9\u5668\u5e76\u8fd4\u56de SelectorList \u5b9e\u4f8b\u3002 query \u662f\u5305\u542b\u8981\u5e94\u7528\u7684CSS\u9009\u62e9\u5668\u7684\u5b57\u7b26\u4e32\u3002 \u5728\u5e95\u5c42\uff0cCSS\u67e5\u8be2\u88ab\u7ffb\u8bd1\u6210XPath\u67e5\u8be2\uff0c\u4f7f\u7528 cssselect \u5e93\u548c .xpath() \u65b9\u6cd5\u3002 \u6ce8\u610f!!!!!!!!!!!! \u4e3a\u4e86\u65b9\u4fbf\u8d77\u89c1\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u79f0\u4e3aresponse.css() extract() \u5e8f\u5217\u5316\u5e76\u8fd4\u56de\u5339\u914d\u7684\u8282\u70b9\u4f5c\u4e3aunicode\u5b57\u7b26\u4e32\u7684\u5217\u8868\u3002\u767e\u5206\u6bd4\u7f16\u7801\u7684\u5185\u5bb9\u662f\u672a\u88ab\u5f15\u7528\u7684\u3002 re(regex) \u5e94\u7528\u7ed9\u5b9a\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5e76\u8fd4\u56de\u5339\u914d\u7684unicode\u5b57\u7b26\u4e32\u5217\u8868\u3002 regex \u53ef\u4ee5\u662f\u4e00\u4e2a\u5df2\u7f16\u8bd1(compiled)\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u5b83\u5c06\u4f7f\u7528 re.compile(regex) \u7f16\u8bd1\u6210\u6b63\u5219\u8868\u8fbe\u5f0f\u3002 \u6ce8\u610f!!!!!!!!! \u6ce8\u610fre()\u548cre_first()\u90fddecode HTML\u5b9e\u4f53\uff08\u9664\u4e86 lt;\u548c amp;)\u3002 register_namespace(prefix, uri) \u5728\u8fd9\u4e2a Selector \u4e2d\u6ce8\u518c\u6307\u5b9a\u7684\u540d\u79f0\u7a7a\u95f4\u3002\u5982\u679c\u4e0d\u6ce8\u518c\u540d\u79f0\u7a7a\u95f4\uff0c\u5c31\u4e0d\u80fd\u4ece\u975e\u6807\u51c6\u540d\u79f0\u7a7a\u95f4\u4e2d\u9009\u62e9\u6216\u63d0\u53d6\u6570\u636e\u3002\u8bf7\u53c2\u89c1\u4e0b\u9762\u7684\u4f8b\u5b50\u3002 remove_namespaces() \u5220\u9664\u6240\u6709\u540d\u79f0\u7a7a\u95f4\uff0c\u5141\u8bb8\u4f7f\u7528\u540d\u79f0\u7a7a\u95f4\u8f83\u5c11\u7684xpath\u904d\u5386\u6587\u6863\u3002\u8bf7\u53c2\u89c1\u4e0b\u9762\u7684\u4f8b\u5b50\u3002 __nonzero__() \u5982\u679c\u6709\u4efb\u4f55\u771f\u5b9e\u7684\u5185\u5bb9\u88ab\u9009\u62e9\u8fd4\u56de True \u3002\u5426\u5219 False \u6362\u53e5\u8bdd\u8bf4\uff0c Selector \u7684\u5e03\u5c14\u503c\u662f\u7531\u5b83\u6240\u9009\u62e9\u7684\u5185\u5bb9\u7ed9\u51fa\u7684\u3002","title":"scrapy.selector.Selector(response=None, text=None, type=None)   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/08-selctor/#selectorlist","text":"","title":"SelectorList(\u9009\u62e9\u5668\u5217\u8868) \u5bf9\u8c61"},{"location":"2. \u57fa\u672c\u6982\u5ff5/08-selctor/#scrapyselectorselectorlist-class","text":"SelectorList \u7c7b\u662f\u5185\u5efalist\u7c7b\u7684\u5b50\u7c7b\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e9b\u989d\u5916\u7684\u65b9\u6cd5\u3002 xpath(query) \u4e3a\u8fd9\u4e2a\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u8c03\u7528 .xpath() \u65b9\u6cd5\uff0c\u5e76\u5c06\u5b83\u4eec\u7684\u7ed3\u679c\u4f5c\u4e3a\u53e6\u4e00\u4e2a SelectorList \u5c55\u5f00\u3002 query \u4e0e Selector.xpath() \u4e2d\u7684\u53c2\u6570\u662f\u76f8\u540c\u7684\u3002 css(query) \u4e3a\u8fd9\u4e2a\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u8c03\u7528 .css() \u65b9\u6cd5\uff0c\u5e76\u5c06\u5b83\u4eec\u7684\u7ed3\u679c\u4f5c\u4e3a\u53e6\u4e00\u4e2a SelectorList \u5c55\u5f00\u3002 query \u4e0e Selector.css() \u4e2d\u7684\u53c2\u6570\u662f\u76f8\u540c\u7684\u3002 extract() \u4e3a\u8fd9\u4e2a\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u8c03\u7528 .extract() \u65b9\u6cd5\uff0c\u5e76\u5c06\u5b83\u4eec\u7684\u7ed3\u679c\u5c55\u5f00\u8fd4\u56de\uff0c\u4f5c\u4e3aunicode\u5b57\u7b26\u4e32\u7684\u5217\u8868\u3002 re() \u4e3a\u8fd9\u4e2a\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u8c03\u7528 .re() \u65b9\u6cd5\uff0c\u5e76\u5c06\u5b83\u4eec\u7684\u7ed3\u679c\u5c55\u5f00\u8fd4\u56de\uff0c\u4f5c\u4e3aunicode\u5b57\u7b26\u4e32\u7684\u5217\u8868\u3002","title":"scrapy.selector.SelectorList   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/08-selctor/#html-response","text":"\u8fd9\u91cc\u6709\u51e0\u4e2a Selector \u793a\u4f8b\u6765\u8bf4\u660e\u51e0\u4e2a\u6982\u5ff5\u3002\u5728\u6240\u6709\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u5047\u8bbe\u5df2\u7ecf\u6709\u4e00\u4e2a Selector \u5b9e\u4f8b\u5316\u4e86\u4e00\u4e2a HtmlResponse \u5bf9\u8c61\uff0c\u5982\u4e0b\u6240\u793a\uff1a sel = Selector(html_response) \u4ece\u4e00\u4e2aHTML response\u4f53\u4e2d\u9009\u62e9\u6240\u6709 h1 \u5143\u7d20\uff0c\u8fd4\u56de\u4e00\u4e2a Selector \u5bf9\u8c61\u7684\u5217\u8868\uff08\u4f8b\u5982\u3002 SelectorList \u5bf9\u8c61): sel.xpath( //h1 ) \u4ece\u4e00\u4e2aHTML response\u4f53\u4e2d\u63d0\u53d6\u6240\u6709 h1 \u5143\u7d20\u7684\u6587\u672c\uff0c\u8fd4\u56de\u4e00\u4e2aunicode\u5b57\u7b26\u4e32\u5217\u8868\uff1a sel.xpath( //h1 ).extract() # \u8fd9\u5305\u62ech1\u6807\u7b7e sel.xpath( //h1/text() ).extract() # \u8fd9\u5c31\u6392\u9664\u4e86h1\u6807\u7b7e \u904d\u5386\u6240\u6709\u7684 p \u6807\u7b7e\u5e76\u6253\u5370\u5b83\u4eec\u7684class\u5c5e\u6027\uff1a for node in sel.xpath( //p ): print node.xpath( @class ).extract()","title":"HTML response\u7684\u9009\u62e9\u5668\u793a\u4f8b"},{"location":"2. \u57fa\u672c\u6982\u5ff5/08-selctor/#xml","text":"\u8fd9\u91cc\u6709\u51e0\u4e2a\u4f8b\u5b50\u6765\u8bf4\u660e\u51e0\u4e2a\u6982\u5ff5\u3002\u5728\u8fd9\u4e24\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u5047\u8bbe\u5df2\u7ecf\u6709\u4e00\u4e2a Selector \u5b9e\u4f8b\u5316\u4e86\u4e00\u4e2a XmlResponse \u5bf9\u8c61\uff0c\u5982\u4e0b\u6240\u793a\uff1a sel = Selector(xml_response) \u4ece\u4e00\u4e2aXML response\u4f53\u4e2d\u9009\u62e9\u6240\u6709\u7684 product \u5143\u7d20\uff0c\u8fd4\u56de\u4e00\u4e2a Selector \u5bf9\u8c61\u7684\u5217\u8868\uff08\u4f8b\u5982\u3002 SelectorList \u5bf9\u8c61): sel.xpath( //product ) \u4ece Google Base XML feed\u4e2d\u63d0\u53d6\u6240\u6709\u4ef7\u683c\uff0c\u8fd9\u9700\u8981\u6ce8\u518c\u4e00\u4e2a\u540d\u79f0\u7a7a\u95f4\uff1a sel.register_namespace( g , http://base.google.com/ns/1.0 ) sel.xpath( //g:price ).extract()","title":"XML\u54cd\u5e94\u7684\u9009\u62e9\u5668\u793a\u4f8b"},{"location":"2. \u57fa\u672c\u6982\u5ff5/08-selctor/#_10","text":"\u5728\u5904\u7406\u6293\u53d6\u9879\u76ee\u65f6\uff0c\u5b8c\u5168\u6d88\u9664\u540d\u79f0\u7a7a\u95f4\u901a\u5e38\u662f\u975e\u5e38\u65b9\u4fbf\u7684\uff0c\u53ea\u9700\u4f7f\u7528\u5143\u7d20\u540d\u79f0\u5373\u53ef\uff0c\u7f16\u5199\u66f4\u7b80\u5355/\u65b9\u4fbf\u7684xpath\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 Selector.remove_namespaces() \u65b9\u6cd5\u3002 \u8ba9\u6211\u4eec\u5c55\u793a\u4e00\u4e2a\u7528GitHub\u535a\u5ba2atom feed\u6f14\u793a\u7684\u4f8b\u5b50\u3002 \u9996\u5148\uff0c\u6211\u4eec\u6253\u5f00shell\u5e26\u4e0a\u60f3\u8981\u6293\u53d6\u7684url\uff1a $ scrapy shell https://github.com/blog.atom \u4e00\u65e6\u8fdb\u5165shell\uff0c\u6211\u4eec\u53ef\u4ee5\u5c1d\u8bd5\u9009\u62e9\u6240\u6709\u7684 link \u5bf9\u8c61\uff0c\u5e76\u770b\u5230\u5b83\u4e0d\u8d77\u4f5c\u7528\uff08\u56e0\u4e3aAtom XML\u540d\u79f0\u7a7a\u95f4\u6df7\u6dc6\u4e86\u8fd9\u4e9b\u8282\u70b9\uff09\uff1a response.xpath( //link ) [] \u4f46\u662f\u4e00\u65e6\u6211\u4eec\u8c03\u7528 Selector.remove_namespaces() \u65b9\u6cd5\uff0c\u6240\u6709\u8282\u70b9\u90fd\u53ef\u4ee5\u901a\u8fc7\u5b83\u4eec\u7684\u540d\u79f0\u76f4\u63a5\u8bbf\u95ee\uff1a response.selector.remove_namespaces() response.xpath( //link ) [ Selector xpath='//link' data=u' link xmlns= http://www.w3.org/2005/Atom' , Selector xpath='//link' data=u' link xmlns= http://www.w3.org/2005/Atom' , ... \u5982\u679c\u60a8\u60f3\u77e5\u9053\u4e3a\u4ec0\u4e48\u540d\u79f0\u7a7a\u95f4\u5220\u9664\u8fc7\u7a0b\u4e0d\u603b\u662f\u88ab\u9ed8\u8ba4\u8c03\u7528\uff0c\u800c\u662f\u624b\u52a8\u8c03\u7528\u5b83\uff0c\u8fd9\u662f\u56e0\u4e3a\u6709\u4e24\u4e2a\u539f\u56e0\uff0c\u6839\u636e\u76f8\u5173\u6027\uff0c\u5b83\u4eec\u662f\uff1a Scrapy\u6293\u53d6\u7684\u6240\u6709\u6587\u6863, \u60f3\u8981\u5220\u9664\u540d\u79f0\u7a7a\u95f4\u9700\u8981\u8fed\u4ee3\u548c\u4fee\u6539\u6587\u6863\u4e2d\u7684\u6240\u6709\u8282\u70b9\uff0c\u8fd9\u662f\u4e00\u79cd\u76f8\u5f53\u6602\u8d35\u7684\u64cd\u4f5c\u3002 \u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u5b9e\u9645\u4e0a\u9700\u8981\u4f7f\u7528\u540d\u79f0\u7a7a\u95f4\uff0c\u4ee5\u9632\u67d0\u4e9b\u5143\u7d20\u540d\u79f0\u5728\u540d\u79f0\u7a7a\u95f4\u4e4b\u95f4\u53d1\u751f\u51b2\u7a81\u3002\u4e0d\u8fc7\uff0c\u8fd9\u4e9b\u7279\u4f8b\u975e\u5e38\u7f55\u89c1\u3002","title":"\u5220\u9664\u540d\u79f0\u7a7a\u95f4"},{"location":"2. \u57fa\u672c\u6982\u5ff5/09-items/","text":"Items(\u6a21\u578b) \u6293\u53d6\u7684\u4e3b\u8981\u76ee\u6807\u662f\u4ece\u975e\u7ed3\u6784\u5316\u6570\u636e\u6e90(\u901a\u5e38\u662fweb\u9875\u9762)\u4e2d\u63d0\u53d6\u7ed3\u6784\u5316\u6570\u636e\u3002Scrapy spider\u53ef\u4ee5\u4ee5Python\u5b57\u5178\u7684\u5f62\u5f0f\u8fd4\u56de\u63d0\u53d6\u7684\u6570\u636e\u3002\u867d\u7136Python\u5b57\u5178\u5f88\u65b9\u4fbf\u4e5f\u5f88\u719f\u6089\uff0c\u4f46\u5b83\u7f3a\u4e4f\u7ed3\u6784:\u5728\u5b57\u6bb5\u540d\u4e2d\u5f88\u5bb9\u6613\u51fa\u73b0\u62fc\u5199\u9519\u8bef\u6216\u8fd4\u56de\u4e0d\u4e00\u81f4\u7684\u6570\u636e\uff0c\u7279\u522b\u662f\u5728\u5177\u6709\u8bb8\u591aspiders\u7684\u5927\u578b\u9879\u76ee\u4e2d\u3002 \u8981\u5b9a\u4e49\u901a\u7528\u7684\u8f93\u51fa\u6570\u636e\u683c\u5f0f\uff0cScrapy\u63d0\u4f9b\u4e86 Item \u7c7b\u3002 Item \u5bf9\u8c61\u662f\u7528\u4e8e\u6536\u96c6Scrapy\u6293\u53d6\u6570\u636e\u7684\u7b80\u5355\u5bb9\u5668\u3002\u5b83\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2a \u7c7b\u4f3c\u4e8e\u5b57\u5178 \u7684API\uff0c\u5177\u6709\u65b9\u4fbf\u7684\u8bed\u6cd5\u6765\u58f0\u660e\u5b83\u4eec\u7684\u53ef\u7528\u5b57\u6bb5\u3002 \u5404\u79cd\u5404\u6837\u7684Scrapy\u7ec4\u4ef6\u4f7f\u7528items\u63d0\u4f9b\u989d\u5916\u7684\u4fe1\u606f, exporters\u67e5\u770b\u58f0\u660e\u7684\u5b57\u6bb5\u4ee5\u786e\u5b9a\u8981\u5bfc\u51fa\u7684\u5217\uff0c\u53ef\u4ee5\u4f7f\u7528item\u5b57\u6bb5metadata\u5b9a\u5236\u5e8f\u5217\u5316\uff0c trackref \u8ddf\u8e2aitem\u5b9e\u4f8b\u4ee5\u5e2e\u52a9\u67e5\u627e\u5185\u5b58\u6cc4\u6f0f(\u8bf7\u53c2\u9605 \u4f7f\u7528trackref\u8c03\u8bd5\u5185\u5b58\u6cc4\u6f0f )\uff0c\u7b49\u7b49\u3002 \u5b9a\u4e49Items \u8fd9\u662f\u4e00\u4e2a\u4f8b\u5b50, \u4f7f\u7528\u7b80\u5355\u7684\u7c7b\u5b9a\u4e49\u8bed\u6cd5\u548c Field \u5bf9\u8c61\u5b9a\u4e49Items: import scrapy class Product(scrapy.Item): name = scrapy.Field() price = scrapy.Field() stock = scrapy.Field() last_updated = scrapy.Field(serializer=str) \u6ce8\u610f! \u719f\u6089 Django \u7684\u4eba\u4f1a\u6ce8\u610f\u5230\uff0cScrapy Items\u4e0e Django\u6a21\u578b \u7c7b\u4f3c\uff0c\u4f46\u7531\u4e8e\u6ca1\u6709\u4e0d\u540c\u5b57\u6bb5\u7c7b\u578b\u7684\u6982\u5ff5\uff0cScrapy Items\u8981\u7b80\u5355\u5f97\u591a\u3002 Item Fields Field \u5bf9\u8c61\u7528\u4e8e\u4e3a\u6bcf\u4e2a\u5b57\u6bb5\u6307\u5b9ametadata\u3002\u4f8b\u5982\uff0c\u4e0a\u9762\u793a\u4f8b\u4e2d\u6f14\u793a\u4e86 last_updates \u5b57\u6bb5\u7684\u5e8f\u5217\u5316\u3002 \u60a8\u53ef\u4ee5\u4e3a\u6bcf\u4e2a\u5b57\u6bb5\u6307\u5b9a\u4efb\u4f55\u7c7b\u578b\u7684metadata\u3002 Field \u5bf9\u8c61\u63a5\u53d7\u7684\u503c\u6ca1\u6709\u9650\u5236\u3002\u51fa\u4e8e\u540c\u6837\u7684\u539f\u56e0\uff0c\u6ca1\u6709\u6240\u6709\u53ef\u7528\u7684metadata\u952e\u7684\u5f15\u7528\u5217\u8868\u3002 Field \u5bf9\u8c61\u4e2d\u5b9a\u4e49\u7684\u6bcf\u4e2a\u952e\u90fd\u53ef\u4ee5\u7531\u4e0d\u540c\u7684\u7ec4\u4ef6\u4f7f\u7528\uff0c\u5e76\u4e14\u53ea\u6709\u90a3\u4e9b\u7ec4\u4ef6\u77e5\u9053\u5b83\u3002\u60a8\u8fd8\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u9700\u8981\u5728\u9879\u76ee\u4e2d\u5b9a\u4e49\u548c\u4f7f\u7528\u4efb\u4f55\u5176\u4ed6 Field \u952e\u3002 Field \u5bf9\u8c61\u7684\u4e3b\u8981\u76ee\u6807\u662f\u63d0\u4f9b\u4e00\u79cd\u65b9\u6cd5\u6765\u5728\u4e00\u4e2a\u4f4d\u7f6e\u5b9a\u4e49\u6240\u6709\u5b57\u6bb5\u7684metadata \u3002\u901a\u5e38\uff0c\u90a3\u4e9b\u884c\u4e3a\u4f9d\u8d56\u4e8e\u6bcf\u4e2a\u5b57\u6bb5\u7684\u7ec4\u4ef6\u4f7f\u7528\u67d0\u4e9b\u5b57\u6bb5\u952e\u6765\u914d\u7f6e\u8be5\u884c\u4e3a\u3002\u60a8\u5fc5\u987b\u53c2\u8003\u5b83\u4eec\u7684\u6587\u6863\uff0c\u4ee5\u67e5\u770b\u6bcf\u4e2a\u7ec4\u4ef6\u4f7f\u7528\u54ea\u4e9bmetadata\u952e\u3002 \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u7528\u4e8e\u5b9a\u4e49 Field \u5bf9\u8c61\u4e0d\u4fdd\u7559\u4e3a\u7c7b\u5c5e\u6027\u3002\u76f8\u53cd\uff0c\u53ef\u4ee5\u901a\u8fc7 Item.fields \u8bbf\u95ee\u5b83\u4eec\u5c5e\u6027\u3002 \u5904\u7406Items \u4e0b\u9762\u662f\u4f7f\u7528 \u4e0a\u9762\u5b9a\u4e49 \u7684 Product item\u6267\u884c\u7684\u5e38\u89c1\u4efb\u52a1\u7684\u4e00\u4e9b\u793a\u4f8b\u3002\u60a8\u4f1a\u6ce8\u610f\u5230\u8fd9\u4e2aAPI\u4e0epyton\u7684 \u5b57\u5178API \u975e\u5e38\u76f8\u4f3c\u3002 \u521b\u5efaitems product = Product(name='Desktop PC', price=1000) print product Product(name='Desktop PC', price=1000) \u83b7\u53d6field(\u5b57\u6bb5)\u7684\u503c product['name'] Desktop PC product.get('name') Desktop PC product['price'] 1000 product['last_updated'] Traceback (most recent call last): ... KeyError: 'last_updated' product.get('last_updated', 'not set') not set product['lala'] # \u83b7\u53d6\u4f4d\u7f6e\u7684\u5b57\u6bb5 Traceback (most recent call last): ... KeyError: 'lala' product.get('lala', 'unknown field') 'unknown field' 'name' in product # name\u5728\u8fd9\u4e2a\u7c7b\u4e2d\u662f\u5426\u88ab\u586b\u5145\u8fc7? True 'last_updated' in product # last_updated\u5728\u8fd9\u4e2a\u7c7b\u4e2d\u662f\u5426\u88ab\u586b\u5145\u8fc7? False 'last_updated' in product.fields # last_updated\u662f\u5426\u662f\u4e00\u4e2a\u5b9a\u4e49\u8fc7\u7684\u5b57\u6bb5? True 'lala' in product.fields # lala\u662f\u5426\u662f\u4e00\u4e2a\u5b9a\u4e49\u8fc7\u7684\u5b57\u6bb5? False \u8bbe\u7f6efield(\u5b57\u6bb5)\u503c product['last_updated'] = 'today' product['last_updated'] today product['lala'] = 'test' # \u8bbe\u7f6e\u672a\u77e5\u7684\u5b57\u6bb5 Traceback (most recent call last): ... KeyError: 'Product does not support field: lala' \u8bbf\u95ee\u6240\u6709\u586b\u5145\u7684\u503c \u8981\u8bbf\u95ee\u6240\u6709\u586b\u5145\u7684\u503c\uff0c\u53ea\u9700\u4f7f\u7528\u5178\u578b\u7684python \u5b57\u5178API : product.keys() ['price', 'name'] product.items() [('price', 1000), ('name', 'Desktop PC')] \u5176\u4ed6\u5e38\u89c1\u7684\u4efb\u52a1 \u4eceitems\u4e2d\u521b\u5efa\u5b57\u5178 dict(product) # \u7528\u586b\u5145\u7684\u503c\u521b\u5efa\u4e00\u4e2a\u5b57\u5178 {'price': 1000, 'name': 'Desktop PC'} \u6269\u5c55Items \u53ef\u4ee5\u901a\u8fc7\u5b9a\u4e49\u539f\u59cbItem\u7684\u5b50\u7c7b\u6765\u6269\u5c55Items(\u6dfb\u52a0\u66f4\u591a\u5b57\u6bb5\u6216\u66f4\u6539\u67d0\u4e9b\u5b57\u6bb5\u7684metadata)\u3002 \u4f8b\u5982: class DiscountedProduct(Product): discount_percent = scrapy.Field(serializer=str) discount_expiration_date = scrapy.Field() \u60a8\u8fd8\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u4ee5\u524d\u7684metadata\u5b57\u6bb5\u6765\u6269\u5c55\u5b57\u6bb5metadata\uff0c\u5e76\u8ffd\u52a0\u66f4\u591a\u7684\u503c\uff0c\u6216\u8005\u66f4\u6539\u73b0\u6709\u7684\u503c\uff0c\u5982\u4e0b\u6240\u793a: class SpecificProduct(Product): name = scrapy.Field(Product.fields['name'], serializer=my_serializer) \u8fd9\u5c06\u4e3a name \u5b57\u6bb5\u6dfb\u52a0(\u6216\u66ff\u6362) serializer \u7684metadata\u952e\uff0c\u4fdd\u7559\u6240\u6709\u4ee5\u524d\u5b58\u5728\u7684metadata\u503c\u3002 Item\u5bf9\u8c61 scrapy.item.Item([arg]) \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) \u901a\u8fc7\u7ed9\u5b9a\u53c2\u6570\u8fd4\u56de\u521d\u59cb\u5316\u7684\u65b0Item\u3002 Items\u590d\u5236\u6807\u51c6\u7684python \u5b57\u5178API \uff0c\u5305\u62ec\u5176\u6784\u9020\u51fd\u6570\u3002Items\u63d0\u4f9b\u7684\u552f\u4e00\u9644\u52a0\u5c5e\u6027\u662f: fields \u5305\u542b\u6b64Item\u6240\u6709\u5b9a\u4e49\u8fc7fields\u7684\u5b57\u5178\uff0c\u800c\u4e0d\u4ec5\u4ec5\u662f\u5df2\u586b\u5145\u7684\u5b57\u6bb5\u3002\u952e\u662f\u5b57\u6bb5\u540d\uff0c\u503c\u662f Item\u5b9a\u4e49 \u4e2d\u4f7f\u7528\u7684 Field \u5bf9\u8c61\u3002 Field\u5bf9\u8c61 scrapy.item.Field([arg]) \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) Field \u7c7b\u53ea\u662f\u5185\u7f6epython dict \u7c7b\u7684\u522b\u540d\uff0c\u4e0d\u63d0\u4f9b\u4efb\u4f55\u989d\u5916\u7684\u529f\u80fd\u6216\u5c5e\u6027\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c Field \u5bf9\u8c61\u666e\u904d\u662fpython\u7684\u5b57\u5178\u3002\u7528\u4e8e\u652f\u6301\u57fa\u4e8e\u7c7b\u5c5e\u6027\u7684item\u5b9a\u4e49\u8bed\u6cd5\u7684\u5355\u72ec\u7684\u4e00\u4e2a\u7c7b\u3002","title":"Items(\u6a21\u578b)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/09-items/#items","text":"\u6293\u53d6\u7684\u4e3b\u8981\u76ee\u6807\u662f\u4ece\u975e\u7ed3\u6784\u5316\u6570\u636e\u6e90(\u901a\u5e38\u662fweb\u9875\u9762)\u4e2d\u63d0\u53d6\u7ed3\u6784\u5316\u6570\u636e\u3002Scrapy spider\u53ef\u4ee5\u4ee5Python\u5b57\u5178\u7684\u5f62\u5f0f\u8fd4\u56de\u63d0\u53d6\u7684\u6570\u636e\u3002\u867d\u7136Python\u5b57\u5178\u5f88\u65b9\u4fbf\u4e5f\u5f88\u719f\u6089\uff0c\u4f46\u5b83\u7f3a\u4e4f\u7ed3\u6784:\u5728\u5b57\u6bb5\u540d\u4e2d\u5f88\u5bb9\u6613\u51fa\u73b0\u62fc\u5199\u9519\u8bef\u6216\u8fd4\u56de\u4e0d\u4e00\u81f4\u7684\u6570\u636e\uff0c\u7279\u522b\u662f\u5728\u5177\u6709\u8bb8\u591aspiders\u7684\u5927\u578b\u9879\u76ee\u4e2d\u3002 \u8981\u5b9a\u4e49\u901a\u7528\u7684\u8f93\u51fa\u6570\u636e\u683c\u5f0f\uff0cScrapy\u63d0\u4f9b\u4e86 Item \u7c7b\u3002 Item \u5bf9\u8c61\u662f\u7528\u4e8e\u6536\u96c6Scrapy\u6293\u53d6\u6570\u636e\u7684\u7b80\u5355\u5bb9\u5668\u3002\u5b83\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2a \u7c7b\u4f3c\u4e8e\u5b57\u5178 \u7684API\uff0c\u5177\u6709\u65b9\u4fbf\u7684\u8bed\u6cd5\u6765\u58f0\u660e\u5b83\u4eec\u7684\u53ef\u7528\u5b57\u6bb5\u3002 \u5404\u79cd\u5404\u6837\u7684Scrapy\u7ec4\u4ef6\u4f7f\u7528items\u63d0\u4f9b\u989d\u5916\u7684\u4fe1\u606f, exporters\u67e5\u770b\u58f0\u660e\u7684\u5b57\u6bb5\u4ee5\u786e\u5b9a\u8981\u5bfc\u51fa\u7684\u5217\uff0c\u53ef\u4ee5\u4f7f\u7528item\u5b57\u6bb5metadata\u5b9a\u5236\u5e8f\u5217\u5316\uff0c trackref \u8ddf\u8e2aitem\u5b9e\u4f8b\u4ee5\u5e2e\u52a9\u67e5\u627e\u5185\u5b58\u6cc4\u6f0f(\u8bf7\u53c2\u9605 \u4f7f\u7528trackref\u8c03\u8bd5\u5185\u5b58\u6cc4\u6f0f )\uff0c\u7b49\u7b49\u3002","title":"Items(\u6a21\u578b)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/09-items/#items_1","text":"\u8fd9\u662f\u4e00\u4e2a\u4f8b\u5b50, \u4f7f\u7528\u7b80\u5355\u7684\u7c7b\u5b9a\u4e49\u8bed\u6cd5\u548c Field \u5bf9\u8c61\u5b9a\u4e49Items: import scrapy class Product(scrapy.Item): name = scrapy.Field() price = scrapy.Field() stock = scrapy.Field() last_updated = scrapy.Field(serializer=str) \u6ce8\u610f! \u719f\u6089 Django \u7684\u4eba\u4f1a\u6ce8\u610f\u5230\uff0cScrapy Items\u4e0e Django\u6a21\u578b \u7c7b\u4f3c\uff0c\u4f46\u7531\u4e8e\u6ca1\u6709\u4e0d\u540c\u5b57\u6bb5\u7c7b\u578b\u7684\u6982\u5ff5\uff0cScrapy Items\u8981\u7b80\u5355\u5f97\u591a\u3002","title":"\u5b9a\u4e49Items"},{"location":"2. \u57fa\u672c\u6982\u5ff5/09-items/#item-fields","text":"Field \u5bf9\u8c61\u7528\u4e8e\u4e3a\u6bcf\u4e2a\u5b57\u6bb5\u6307\u5b9ametadata\u3002\u4f8b\u5982\uff0c\u4e0a\u9762\u793a\u4f8b\u4e2d\u6f14\u793a\u4e86 last_updates \u5b57\u6bb5\u7684\u5e8f\u5217\u5316\u3002 \u60a8\u53ef\u4ee5\u4e3a\u6bcf\u4e2a\u5b57\u6bb5\u6307\u5b9a\u4efb\u4f55\u7c7b\u578b\u7684metadata\u3002 Field \u5bf9\u8c61\u63a5\u53d7\u7684\u503c\u6ca1\u6709\u9650\u5236\u3002\u51fa\u4e8e\u540c\u6837\u7684\u539f\u56e0\uff0c\u6ca1\u6709\u6240\u6709\u53ef\u7528\u7684metadata\u952e\u7684\u5f15\u7528\u5217\u8868\u3002 Field \u5bf9\u8c61\u4e2d\u5b9a\u4e49\u7684\u6bcf\u4e2a\u952e\u90fd\u53ef\u4ee5\u7531\u4e0d\u540c\u7684\u7ec4\u4ef6\u4f7f\u7528\uff0c\u5e76\u4e14\u53ea\u6709\u90a3\u4e9b\u7ec4\u4ef6\u77e5\u9053\u5b83\u3002\u60a8\u8fd8\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u9700\u8981\u5728\u9879\u76ee\u4e2d\u5b9a\u4e49\u548c\u4f7f\u7528\u4efb\u4f55\u5176\u4ed6 Field \u952e\u3002 Field \u5bf9\u8c61\u7684\u4e3b\u8981\u76ee\u6807\u662f\u63d0\u4f9b\u4e00\u79cd\u65b9\u6cd5\u6765\u5728\u4e00\u4e2a\u4f4d\u7f6e\u5b9a\u4e49\u6240\u6709\u5b57\u6bb5\u7684metadata \u3002\u901a\u5e38\uff0c\u90a3\u4e9b\u884c\u4e3a\u4f9d\u8d56\u4e8e\u6bcf\u4e2a\u5b57\u6bb5\u7684\u7ec4\u4ef6\u4f7f\u7528\u67d0\u4e9b\u5b57\u6bb5\u952e\u6765\u914d\u7f6e\u8be5\u884c\u4e3a\u3002\u60a8\u5fc5\u987b\u53c2\u8003\u5b83\u4eec\u7684\u6587\u6863\uff0c\u4ee5\u67e5\u770b\u6bcf\u4e2a\u7ec4\u4ef6\u4f7f\u7528\u54ea\u4e9bmetadata\u952e\u3002 \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u7528\u4e8e\u5b9a\u4e49 Field \u5bf9\u8c61\u4e0d\u4fdd\u7559\u4e3a\u7c7b\u5c5e\u6027\u3002\u76f8\u53cd\uff0c\u53ef\u4ee5\u901a\u8fc7 Item.fields \u8bbf\u95ee\u5b83\u4eec\u5c5e\u6027\u3002","title":"Item Fields"},{"location":"2. \u57fa\u672c\u6982\u5ff5/09-items/#items_2","text":"\u4e0b\u9762\u662f\u4f7f\u7528 \u4e0a\u9762\u5b9a\u4e49 \u7684 Product item\u6267\u884c\u7684\u5e38\u89c1\u4efb\u52a1\u7684\u4e00\u4e9b\u793a\u4f8b\u3002\u60a8\u4f1a\u6ce8\u610f\u5230\u8fd9\u4e2aAPI\u4e0epyton\u7684 \u5b57\u5178API \u975e\u5e38\u76f8\u4f3c\u3002","title":"\u5904\u7406Items"},{"location":"2. \u57fa\u672c\u6982\u5ff5/09-items/#items_3","text":"product = Product(name='Desktop PC', price=1000) print product Product(name='Desktop PC', price=1000)","title":"\u521b\u5efaitems"},{"location":"2. \u57fa\u672c\u6982\u5ff5/09-items/#field","text":"product['name'] Desktop PC product.get('name') Desktop PC product['price'] 1000 product['last_updated'] Traceback (most recent call last): ... KeyError: 'last_updated' product.get('last_updated', 'not set') not set product['lala'] # \u83b7\u53d6\u4f4d\u7f6e\u7684\u5b57\u6bb5 Traceback (most recent call last): ... KeyError: 'lala' product.get('lala', 'unknown field') 'unknown field' 'name' in product # name\u5728\u8fd9\u4e2a\u7c7b\u4e2d\u662f\u5426\u88ab\u586b\u5145\u8fc7? True 'last_updated' in product # last_updated\u5728\u8fd9\u4e2a\u7c7b\u4e2d\u662f\u5426\u88ab\u586b\u5145\u8fc7? False 'last_updated' in product.fields # last_updated\u662f\u5426\u662f\u4e00\u4e2a\u5b9a\u4e49\u8fc7\u7684\u5b57\u6bb5? True 'lala' in product.fields # lala\u662f\u5426\u662f\u4e00\u4e2a\u5b9a\u4e49\u8fc7\u7684\u5b57\u6bb5? False","title":"\u83b7\u53d6field(\u5b57\u6bb5)\u7684\u503c"},{"location":"2. \u57fa\u672c\u6982\u5ff5/09-items/#field_1","text":"product['last_updated'] = 'today' product['last_updated'] today product['lala'] = 'test' # \u8bbe\u7f6e\u672a\u77e5\u7684\u5b57\u6bb5 Traceback (most recent call last): ... KeyError: 'Product does not support field: lala'","title":"\u8bbe\u7f6efield(\u5b57\u6bb5)\u503c"},{"location":"2. \u57fa\u672c\u6982\u5ff5/09-items/#_1","text":"\u8981\u8bbf\u95ee\u6240\u6709\u586b\u5145\u7684\u503c\uff0c\u53ea\u9700\u4f7f\u7528\u5178\u578b\u7684python \u5b57\u5178API : product.keys() ['price', 'name'] product.items() [('price', 1000), ('name', 'Desktop PC')]","title":"\u8bbf\u95ee\u6240\u6709\u586b\u5145\u7684\u503c"},{"location":"2. \u57fa\u672c\u6982\u5ff5/09-items/#_2","text":"\u4eceitems\u4e2d\u521b\u5efa\u5b57\u5178 dict(product) # \u7528\u586b\u5145\u7684\u503c\u521b\u5efa\u4e00\u4e2a\u5b57\u5178 {'price': 1000, 'name': 'Desktop PC'}","title":"\u5176\u4ed6\u5e38\u89c1\u7684\u4efb\u52a1"},{"location":"2. \u57fa\u672c\u6982\u5ff5/09-items/#items_4","text":"\u53ef\u4ee5\u901a\u8fc7\u5b9a\u4e49\u539f\u59cbItem\u7684\u5b50\u7c7b\u6765\u6269\u5c55Items(\u6dfb\u52a0\u66f4\u591a\u5b57\u6bb5\u6216\u66f4\u6539\u67d0\u4e9b\u5b57\u6bb5\u7684metadata)\u3002 \u4f8b\u5982: class DiscountedProduct(Product): discount_percent = scrapy.Field(serializer=str) discount_expiration_date = scrapy.Field() \u60a8\u8fd8\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u4ee5\u524d\u7684metadata\u5b57\u6bb5\u6765\u6269\u5c55\u5b57\u6bb5metadata\uff0c\u5e76\u8ffd\u52a0\u66f4\u591a\u7684\u503c\uff0c\u6216\u8005\u66f4\u6539\u73b0\u6709\u7684\u503c\uff0c\u5982\u4e0b\u6240\u793a: class SpecificProduct(Product): name = scrapy.Field(Product.fields['name'], serializer=my_serializer) \u8fd9\u5c06\u4e3a name \u5b57\u6bb5\u6dfb\u52a0(\u6216\u66ff\u6362) serializer \u7684metadata\u952e\uff0c\u4fdd\u7559\u6240\u6709\u4ee5\u524d\u5b58\u5728\u7684metadata\u503c\u3002","title":"\u6269\u5c55Items"},{"location":"2. \u57fa\u672c\u6982\u5ff5/09-items/#item","text":"","title":"Item\u5bf9\u8c61"},{"location":"2. \u57fa\u672c\u6982\u5ff5/09-items/#scrapyitemitemarg-class","text":"\u901a\u8fc7\u7ed9\u5b9a\u53c2\u6570\u8fd4\u56de\u521d\u59cb\u5316\u7684\u65b0Item\u3002 Items\u590d\u5236\u6807\u51c6\u7684python \u5b57\u5178API \uff0c\u5305\u62ec\u5176\u6784\u9020\u51fd\u6570\u3002Items\u63d0\u4f9b\u7684\u552f\u4e00\u9644\u52a0\u5c5e\u6027\u662f: fields \u5305\u542b\u6b64Item\u6240\u6709\u5b9a\u4e49\u8fc7fields\u7684\u5b57\u5178\uff0c\u800c\u4e0d\u4ec5\u4ec5\u662f\u5df2\u586b\u5145\u7684\u5b57\u6bb5\u3002\u952e\u662f\u5b57\u6bb5\u540d\uff0c\u503c\u662f Item\u5b9a\u4e49 \u4e2d\u4f7f\u7528\u7684 Field \u5bf9\u8c61\u3002","title":"scrapy.item.Item([arg])   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/09-items/#field_2","text":"","title":"Field\u5bf9\u8c61"},{"location":"2. \u57fa\u672c\u6982\u5ff5/09-items/#scrapyitemfieldarg-class","text":"Field \u7c7b\u53ea\u662f\u5185\u7f6epython dict \u7c7b\u7684\u522b\u540d\uff0c\u4e0d\u63d0\u4f9b\u4efb\u4f55\u989d\u5916\u7684\u529f\u80fd\u6216\u5c5e\u6027\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c Field \u5bf9\u8c61\u666e\u904d\u662fpython\u7684\u5b57\u5178\u3002\u7528\u4e8e\u652f\u6301\u57fa\u4e8e\u7c7b\u5c5e\u6027\u7684item\u5b9a\u4e49\u8bed\u6cd5\u7684\u5355\u72ec\u7684\u4e00\u4e2a\u7c7b\u3002","title":"scrapy.item.Field([arg])   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/10-itemloaders/","text":"Item Loaders(Item\u52a0\u8f7d\u5668) Item Loaders\u63d0\u4f9b\u4e86\u4e00\u79cd\u65b9\u4fbf\u7684\u673a\u5236\u6765\u586b\u5145\u6293\u53d6\u7684 Items \u3002\u5c3d\u7ba1items\u53ef\u4ee5\u4f7f\u7528\u5b83\u4eec\u672c\u8eab\u7684\u5b57\u5178API\u8fdb\u884c\u586b\u5145\uff0c\u4f46Item Loaders\u901a\u8fc7\u81ea\u52a8\u5316\u4e00\u4e9b\u5e38\u89c1\u4efb\u52a1(\u6bd4\u5982\u5728\u5206\u914d\u539f\u59cb\u63d0\u53d6\u7684\u6570\u636e\u4e4b\u524d\u5bf9\u5176\u8fdb\u884c\u89e3\u6790)\uff0c\u4ece\u6293\u53d6\u8fc7\u7a0b\u4e2d\u586b\u5145\u5b83\u4eecItem Loaders\u63d0\u4f9b\u4e86\u66f4\u65b9\u4fbf\u7684API\u3002 \u6362\u53e5\u8bdd\u8bf4\uff0c Items \u63d0\u4f9b\u4e86Scrapy\u6293\u53d6\u6570\u636e\u7684\u5bb9\u5668\uff0c\u800cItem Loaders\u63d0\u4f9b\u4e86\u586b\u5145\u8be5\u5bb9\u5668\u7684\u673a\u5236\u3002 Item Loaders\u65e8\u5728\u63d0\u4f9b\u4e00\u79cd\u7075\u6d3b\u3001\u9ad8\u6548\u548c\u7b80\u5355\u7684\u673a\u5236\uff0c\u7528\u4e8e\u6269\u5c55\u548c\u8986\u76d6\u4e0d\u540c\u7684\u5b57\u6bb5\u7684\u4e00\u79cd\u89e3\u6790\u89c4\u5219\uff0c\u65e0\u8bba\u662f\u901a\u8fc7spider\u6216\u6e90\u683c\u5f0f(HTML\u3001XML\u7b49)\u8fdb\u884c\u6269\u5c55\uff0c\u800c\u4e0d\u4f1a\u6210\u4e3a\u5f00\u53d1\u8005\u7ef4\u62a4\u7684\u5669\u68a6\u3002 \u4f7f\u7528Item Loaders\u586b\u5145items \u8981\u4f7f\u7528Item Loaders\uff0c\u5fc5\u987b\u9996\u5148\u5b9e\u4f8b\u5316\u5b83\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u7c7b\u4f3c\u4e8edict\u7684\u5bf9\u8c61(\u4f8b\u5982Item\u6216dict)\u6765\u5b9e\u4f8b\u5316\u5b83\uff0c\u4e5f\u53ef\u4ee5\u4e0d\u4f7f\u7528\u5b83\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cItem\u4f1a\u4f7f\u7528 ItemLoader.default_item_class \u5c5e\u6027\u4e2d\u6307\u5b9a\u7684Item\u7c7b\u5728ItemLoader\u6784\u9020\u51fd\u6570\u4e2d\u81ea\u52a8\u5b9e\u4f8b\u5316\u3002 \u7136\u540e\uff0c\u5f00\u59cb\u5c06\u503c\u6536\u96c6\u5230Item Loader\u4e2d\uff0c\u901a\u5e38\u4f7f\u7528 Selectors \u3002\u53ef\u4ee5\u5411\u540c\u4e00item\u5b57\u6bb5\u6dfb\u52a0\u591a\u4e2a\u503c;Item Loader\u5c06\u77e5\u9053\u5728\u4ee5\u540e\u5982\u4f55\u4f7f\u7528\u9002\u5f53\u7684\u5904\u7406\u51fd\u6570\u201c\u8fde\u63a5\u201d\u8fd9\u4e9b\u503c\u3002 \u4e0b\u9762\u662f\u5728 Spider \u4e2d\u4e00\u4e2a\u5178\u578b\u7684Item Loaders\u7684\u7528\u6cd5\uff0c\u5728 Item\u7ae0\u8282 \u4e2d\u5b9a\u4e49\u7684 Product item : from scrapy.loader import ItemLoader from myproject.items import Product def parse(self, response): l = ItemLoader(item=Product(), response=response) l.add_xpath('name', '//div[@class= product_name ]') l.add_xpath('name', '//div[@class= product_title ]') l.add_xpath('price', '//p[@id= price ]') l.add_css('stock', 'p#stock]') l.add_value('last_updated', 'today') # \u8fd8\u53ef\u4ee5\u4f7f\u7528\u6587\u5b57\u503c return l.load_item() \u5feb\u901f\u67e5\u770b\u8fd9\u6bb5\u4ee3\u7801\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230name\u5b57\u6bb5\u662f\u4ece\u9875\u9762\u4e2d\u7684\u4e24\u4e2a\u4e0d\u540cXPath\u4f4d\u7f6e\u63d0\u53d6\u7684: //div[@class=\"product_name\"] //div[@class=\"product_title\"] \u6362\u53e5\u8bdd\u8bf4\uff0c\u901a\u8fc7\u4f7f\u7528 add_xpath() \u65b9\u6cd5\u4ece\u4e24\u4e2aXPath\u4f4d\u7f6e\u63d0\u53d6\u6570\u636e\u6765\u6536\u96c6\u6570\u636e\u3002\u7a0d\u540e\u5c06\u6570\u636e\u5206\u914d\u7ed9 name \u5b57\u6bb5\u3002 \u7136\u540e\uff0c\u5bf9 price \u548c stock \u5b57\u6bb5\u4f7f\u7528\u7c7b\u4f3c\u7684\u8c03\u7528(\u540e\u8005\u4f7f\u7528\u5e26\u6709 add_css() \u65b9\u6cd5\u7684CSS\u9009\u62e9\u5668)\uff0c\u6700\u540e\u4f7f\u7528\u53e6\u4e00\u4e2a\u65b9\u6cd5 add_value() \u4f7f\u7528\u6587\u5b57\u503c( today )\u586b\u5145 last_update \u5b57\u6bb5\u3002 \u6700\u540e\uff0c\u5f53\u6240\u6709\u6570\u636e\u6536\u96c6\u5b8c\u6bd5\u65f6\uff0c\u8c03\u7528 ItemLoader.load_item() \u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u5b9e\u9645\u8fd4\u56de \u88ab\u586b\u5145\u8fc7\u7684item(\u5c31\u662f\u4e4b\u524d\u63d0\u53d6\u548c\u6536\u96c6\u7684\u6570\u636e\u586b\u5145\u8fc7\u7684item), \u53ea\u4e0d\u8fc7\u662f\u5728\u4f7f\u7528 add_xpath() \u3001 add_css() \u548c add_value() \u4e4b\u524d\u3002 \u8f93\u5165/\u8f93\u51fa \u5904\u7406\u5668 Item Loaders\u5305\u542b\u4e00\u4e2a\u8f93\u5165\u5904\u7406\u5668\u548c\u4e00\u4e2a\u8f93\u51fa\u5904\u7406\u5668\uff0c\u7528\u4e8e\u6bcf\u4e2a(item)\u5b57\u6bb5\u3002\u8f93\u5165\u5904\u7406\u5668\u5728\u63a5\u6536\u5230\u63d0\u53d6\u7684\u6570\u636e(\u901a\u8fc7 add_xpath() \u3001 add_css() \u6216 add_value() \u65b9\u6cd5)\u65f6\u7acb\u5373\u5904\u7406\u6570\u636e\uff0c\u5e76\u6536\u96c6\u8f93\u5165\u5904\u7406\u5668\u7684\u7ed3\u679c\u5e76\u4fdd\u5b58\u5728ItemLoader\u4e2d\u3002\u5728\u6536\u96c6\u6240\u6709\u6570\u636e\u4e4b\u540e\uff0c\u8c03\u7528 ItemLoader.load_item() \u65b9\u6cd5\u6765\u586b\u5145\u548c\u83b7\u53d6\u586b\u5145\u7684 Item \u5bf9\u8c61\u3002\u8fd9\u65f6\uff0c\u4f7f\u7528\u5148\u524d\u6536\u96c6\u7684\u6570\u636e(\u88ab\u8f93\u5165\u5904\u7406\u5668\u5904\u7406\u8fc7\u7684)\u8c03\u7528\u8f93\u51fa\u5904\u7406\u5668\u3002\u8f93\u51fa\u5904\u7406\u5668\u7684\u7ed3\u679c\u662f\u6700\u7ec8\u7684\u503c \u8ba9\u6211\u4eec\u770b\u4e00\u4e2a\u4f8b\u5b50\u6765\u8bf4\u660e\u8f93\u5165\u548c\u8f93\u51fa\u5904\u7406\u5668\u662f\u5982\u4f55\u88ab\u4e00\u4e2a\u7279\u5b9a\u7684\u5b57\u6bb5(\u540c\u6837\u9002\u7528\u4e8e\u4efb\u4f55\u5176\u4ed6\u5b57\u6bb5)\u8c03\u7528\u7684: l = ItemLoader(Product(), some_selector) l.add_xpath('name', xpath1) # (1) l.add_xpath('name', xpath2) # (2) l.add_css('name', css) # (3) l.add_value('name', 'test') # (4) return l.load_item() # (5) \u63d0\u53d6 xpath1 \u4e2d\u7684\u6570\u636e\uff0c\u5e76\u901a\u8fc7 name \u5b57\u6bb5\u7684\u8f93\u5165\u5904\u7406\u5668\u5904\u7406\u3002\u8f93\u5165\u5904\u7406\u5668\u7684\u7ed3\u679c\u88ab\u6536\u96c6\u5e76\u4fdd\u5b58\u5728Item Loaders\u4e2d(\u4f46\u5c1a\u672a\u5206\u914d\u7ed9Item)\u3002 \u63d0\u53d6 xpath2 \u4e2d\u7684\u6570\u636e\uff0c\u5e76\u901a\u8fc7(1)\u4e2d\u4f7f\u7528\u7684\u76f8\u540c\u7684\u8f93\u5165\u5904\u7406\u5668\u5904\u7406\uff0c\u8f93\u5165\u5904\u7406\u5668\u7684\u7ed3\u679c\u9644\u52a0\u5230(1)\u4e2d\u6536\u96c6\u7684\u6570\u636e(\u5982\u679c\u6709\u7684\u8bdd)\u3002 \u8fd9\u79cd\u60c5\u51b5\u4e0e\u524d\u9762\u7684\u60c5\u51b5\u7c7b\u4f3c\uff0c\u53ea\u662f\u6570\u636e\u662f\u4ececss css\u9009\u62e9\u5668\u4e2d\u63d0\u53d6\u7684\uff0c\u5e76\u901a\u8fc7(1)\u548c(2)\u4e2d\u4f7f\u7528\u7684\u76f8\u540c\u7684\u8f93\u5165\u5904\u7406\u5668\u5904\u7406\u3002 \u8fd9\u79cd\u60c5\u51b5\u4e0e\u524d\u9762\u7684\u60c5\u51b5\u7c7b\u4f3c\uff0c\u53ea\u662f\u8981\u6536\u96c6\u7684\u503c\u662f\u76f4\u63a5\u5206\u914d\u7684\uff0c\u800c\u4e0d\u662f\u4eceXPath\u8868\u8fbe\u5f0f\u6216CSS\u9009\u62e9\u5668\u4e2d\u63d0\u53d6\u7684\u3002\u4f46\u662f\uff0c\u503c\u4ecd\u7136\u901a\u8fc7\u8f93\u5165\u5904\u7406\u5668\u4f20\u9012\u3002\u5728\u672c\u4f8b\u4e2d\uff0c\u7531\u4e8e\u8be5\u503c\u4e0d\u53ef\u8fed\u4ee3\uff0c\u56e0\u6b64\u5728\u5c06\u5176\u4f20\u9012\u7ed9\u8f93\u5165\u5904\u7406\u5668\u4e4b\u524d\uff0c\u5c06\u5176\u8f6c\u6362\u4e3a\u5355\u4e2a\u5143\u7d20\u7684\u53ef\u8fed\u4ee3\u503c\uff0c\u56e0\u4e3a\u8f93\u5165\u5904\u7406\u5668\u603b\u662f\u63a5\u6536\u8fed\u4ee3\u503c\u3002 \u6b65\u9aa4(1)\u3001(2)\u3001(3)\u548c(4)\u4e2d\u6536\u96c6\u7684\u6570\u636e\u901a\u8fc7 name \u5b57\u6bb5\u7684\u8f93\u51fa\u5904\u7406\u5668\u5904\u7406\u3002\u5206\u914d\u7ed9item\u4e2d\u7684 name \u5b57\u6bb5\u7684\u503c\u662f\u8f93\u51fa\u5904\u7406\u5668\u7684\u7ed3\u679c\u3002 \u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u5904\u7406\u5668\u53ea\u662f\u53ef\u8c03\u7528\u7684\u5bf9\u8c61\uff0c\u5b83\u4e0e\u8981\u89e3\u6790\u7684\u6570\u636e\u4e00\u8d77\u88ab\u8c03\u7528\uff0c\u5e76\u8fd4\u56de\u88ab\u89e3\u6790\u7684\u503c\u3002\u56e0\u6b64\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u4efb\u4f55\u51fd\u6570\u4f5c\u4e3a\u8f93\u5165\u6216\u8f93\u51fa\u5904\u7406\u5668\u3002\u552f\u4e00\u7684\u8981\u6c42\u662f\u4ed6\u4eec\u5fc5\u987b\u63a5\u53d7\u4e00\u4e2a(\u800c\u4e14\u53ea\u6709\u4e00\u4e2a)\u4f4d\u7f6e\u53c2\u6570\uff0c\u5b83\u5c06\u4f1a\u662f\u4e00\u4e2a\u8fed\u4ee3\u5668\u3002 \u6ce8\u610f!!!!!! \u8f93\u5165\u548c\u8f93\u51fa\u5904\u7406\u5668\u90fd\u5fc5\u987b\u63a5\u6536\u4e00\u4e2a\u8fed\u4ee3\u5668\u4f5c\u4e3a\u5b83\u4eec\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u3002 \u8fd9\u4e9b\u51fd\u6570\u7684\u8f93\u51fa\u53ef\u4ee5\u662f\u4efb\u4f55\u503c\u3002 \u8f93\u5165\u5904\u7406\u5668\u7684\u7ed3\u679c\u5c06\u9644\u52a0\u5230\u4e00\u4e2a\u5185\u90e8\u5217\u8868(\u5728Loader\u4e2d)\uff0c \u5176\u4e2d\u5305\u542b\u6536\u96c6\u7684\u503c(\u7528\u4e8e\u8be5\u5b57\u6bb5)\u3002 \u6700\u7ec8\u5206\u914d\u7ed9\u8be5item\u7684\u503c\u662f\u8f93\u51fa\u5904\u7406\u5668\u7684\u7ed3\u679c\u3002 \u5982\u679c\u4f60\u60f3\u4f7f\u7528\u4e00\u4e2a\u666e\u901a\u51fd\u6570\u4f5c\u4e3a\u5904\u7406\u5668\uff0c\u786e\u4fdd\u5b83\u63a5\u6536 self \u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u53c2\u6570: def lowercase_processor(self, values): for v in values: yield v.lower() class MyItemLoader(ItemLoader): name_in = lowercase_processor \u8fd9\u662f\u56e0\u4e3a\u6bcf\u5f53\u4e00\u4e2a\u51fd\u6570\u88ab\u8d4b\u503c\u4e3a\u7c7b\u53d8\u91cf\u65f6\uff0c\u5b83\u5c31\u4f1a\u53d8\u6210\u4e00\u4e2a\u65b9\u6cd5\uff0c\u5e76\u5728\u88ab\u8c03\u7528\u65f6\u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u53c2\u6570\u4f20\u9012\u5b9e\u4f8b\u3002\u6709\u5173\u66f4\u591a\u7ec6\u8282\uff0c\u8bf7\u53c2\u9605 stackoverflow\u4e0a\u7684\u56de\u7b54 \u3002 \u60a8\u9700\u8981\u8bb0\u4f4f\u7684\u53e6\u4e00\u4ef6\u4e8b\u662f\uff0c\u8f93\u5165\u5904\u7406\u5668\u8fd4\u56de\u7684\u503c\u662f\u5728\u5185\u90e8(\u5728\u5217\u8868\u4e2d)\u6536\u96c6\u7684\uff0c\u7136\u540e\u4f20\u9012\u7ed9\u8f93\u51fa\u5904\u7406\u5668\u6765\u586b\u5145\u5b57\u6bb5\u7684\u3002 \u6700\u540e\uff0c\u4f46\u4e0d\u662f\u6700\u7ec8\uff0cScrapy\u5185\u7f6e\u4e86\u4e00\u4e9b \u5e38\u7528\u7684\u5904\u7406\u5668 \uff0c\u4ee5\u63d0\u4f9b\u65b9\u4fbf\u3002 \u5b9a\u4e49Item Loaders \u901a\u8fc7\u4f7f\u7528\u7c7b\u5b9a\u4e49\u8bed\u6cd5\uff0c\u53ef\u4ee5\u50cfItem\u4e00\u6837\u58f0\u660eItem Loaders\u3002\u8fd9\u662f\u4e00\u4e2a\u4f8b\u5b50: from scrapy.loader import ItemLoader from scrapy.loader.processors import TakeFirst, MapCompose, Join class ProductLoader(ItemLoader): default_output_processor = TakeFirst() name_in = MapCompose(unicode.title) name_out = Join() price_in = MapCompose(unicode.strip) # ... \u53ef\u4ee5\u770b\u5230\uff0c\u8f93\u5165\u5904\u7406\u5668\u4f7f\u7528 _in \u540e\u7f00\u5b9a\u4e49\uff0c\u800c\u8f93\u51fa\u5904\u7406\u5668\u4f7f\u7528 _out \u540e\u7f00\u5b9a\u4e49\u3002\u8fd8\u53ef\u4ee5\u4f7f\u7528 ItemLoader.default_input_processor \u548c ItemLoader.default_output_processor \u5c5e\u6027\u5b9a\u4e49\u9ed8\u8ba4\u7684\u8f93\u5165/\u8f93\u51fa\u5904\u7406\u5668\u3002 \u5b9a\u4e49\u8f93\u5165/\u8f93\u51fa\u5904\u7406\u5668 \u5982\u524d\u4e00\u8282\u6240\u793a\uff0c\u53ef\u4ee5\u5728Item Loader\u4e2d\u5b9a\u4e49\u8f93\u5165\u548c\u8f93\u51fa\u5904\u7406\u5668\uff0c\u8fd9\u6837\u5b9a\u4e49\u8f93\u5165\u5904\u7406\u5668\u662f\u5f88\u5e38\u89c1\u7684\u3002\u4f46\u662f\uff0c\u8fd8\u6709\u4e00\u4e2a\u5730\u65b9\u53ef\u4ee5\u6307\u5b9a\u8981\u4f7f\u7528\u7684\u8f93\u5165\u548c\u8f93\u51fa\u5904\u7406\u5668:\u5728 Item Field metadata\u4e2d\u3002\u8fd9\u662f\u4e00\u4e2a\u4f8b\u5b50: import scrapy from scrapy.loader.processors import Join, MapCompose, TakeFirst from w3lib.html import remove_tags def filter_price(value): if value.isdigit(): return value class Product(scrapy.Item): name = scrapy.Field( input_processor=MapCompose(remove_tags), output_processor=Join(), ) price = scrapy.Field( input_processor=MapCompose(remove_tags, filter_price), output_processor=TakeFirst(), ) from scrapy.loader import ItemLoader il = ItemLoader(item=Product()) il.add_value('name', [u'Welcome to my', u' strong website /strong ']) il.add_value('price', [u' euro;', u' span 1000 /span ']) il.load_item() {'name': u'Welcome to my website', 'price': u'1000'} \u8f93\u5165\u548c\u8f93\u51fa\u5904\u7406\u5668\u7684\u4f18\u5148\u987a\u5e8f\u5982\u4e0b: Item Loader\u5b57\u6bb5\u7279\u5b9a\u7684\u5c5e\u6027: field_in \u548c field_out (\u5927\u591a\u6570\u4f18\u5148\u7ea7) \u5b57\u6bb5metadata(input_processor\u548coutput_processor\u952e) \u9ed8\u8ba4ItemLoader: ItemLoader.default_input_processor() \u548c ItemLoader.default_output_processor() (\u6700\u4f4e\u4f18\u5148\u7ea7) \u53c2\u89c1: \u590d\u7528\u548c\u6269\u5c55Item Loaders \u3002 Item Loaders Context Item Loaders Context\u662fItem Loaders\u4e2d\u6240\u6709\u8f93\u5165\u548c\u8f93\u51fa\u5904\u7406\u5668\u5171\u4eab\u7684\u4efb\u610f\u952e/\u503c\u7684\u5b57\u5178\u3002\u5b83\u53ef\u4ee5\u5728\u5b9a\u4e49\u3001\u5b9e\u4f8b\u5316\u6216\u4f7f\u7528Item Loaders\u65f6\u4f20\u9012\u3002\u5b83\u4eec\u7528\u4e8e\u4fee\u6539\u8f93\u5165/\u8f93\u51fa\u5904\u7406\u5668\u7684\u884c\u4e3a\u3002 \u4f8b\u5982\uff0c\u5047\u8bbe\u60a8\u6709\u4e00\u4e2a\u51fd\u6570 parse_length \uff0c\u5b83\u63a5\u6536\u4e00\u4e2a\u6587\u672c\u503c\u5e76\u4ece\u4e2d\u63d0\u53d6\u4e00\u4e2a\u957f\u5ea6: def parse_length(text, loader_context): unit = loader_context.get('unit', 'm') # ... \u89e3\u6790\u957f\u5ea6\u7684\u4ee3\u7801\u5728\u8fd9\u91cc ... return parsed_length \u901a\u8fc7\u63a5\u53d7 loader_context \u53c2\u6570\uff0c\u51fd\u6570\u663e\u5f0f\u5730\u544a\u8bc9Item Loaders\u5b83\u53ef\u4ee5\u63a5\u6536\u4e00\u4e2aItem Loaders Context\uff0c\u56e0\u6b64Item Loaders\u5728\u8c03\u7528\u5b83\u65f6\u4f20\u9012\u5f53\u524d\u6d3b\u52a8\u7684context\uff0c\u56e0\u6b64\u5904\u7406\u5668\u51fd\u6570(\u5728\u672c\u4f8b\u4e2d\u662f parse_length )\u53ef\u4ee5\u4f7f\u7528\u5b83\u4eec\u3002 \u6709\u51e0\u79cd\u65b9\u6cd5\u53ef\u4ee5\u4fee\u6539\u9879\u76eeItem Loader context\u503c: 1.\u901a\u8fc7\u4fee\u6539\u5f53\u524d\u6d3b\u52a8Item Loader context( context \u5c5e\u6027): loader = ItemLoader(product) loader.context['unit'] = 'cm' 2.\u5b9e\u4f8b\u5316Item Loader(Item Loader\u6784\u9020\u51fd\u6570\u7684\u5173\u952e\u5b57\u53c2\u6570\u5b58\u50a8\u5728Item Loader context\u4e2d): loader = ItemLoader(product, unit='cm') 3.\u5b9a\u4e49Item Loader\uff0c\u5bf9\u4e8e\u90a3\u4e9b\u652f\u6301\u7528Item Loader context\u5b9e\u4f8b\u5316\u5b83\u4eec\u7684\u8f93\u5165/\u8f93\u51fa\u5904\u7406\u5668\u3002MapCompose\u5c31\u662f\u5176\u4e2d\u4e4b\u4e00: class ProductLoader(ItemLoader): length_out = MapCompose(parse_length, unit='cm') ItemLoader\u5bf9\u8c61 scrapy.loader.ItemLoader([item, selector, response, ]**kwargs) \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) \u8fd4\u56de\u4e00\u4e2a\u65b0\u7684Item Loader\u6765\u586b\u5145\u7ed9\u5b9a\u7684Item\u3002\u5982\u679c\u6ca1\u6709\u63d0\u4f9b\u4efb\u4f55Item\uff0c\u5219\u4f7f\u7528 default_item_class \u4e2d\u7684\u7c7b\u81ea\u52a8\u5b9e\u4f8b\u5316\u3002 \u5f53\u4f7f\u7528\u9009\u62e9\u5668\u6216response\u53c2\u6570\u5b9e\u4f8b\u5316\u65f6\uff0c ItemLoader \u7c7b\u63d0\u4f9b\u4e86\u4f7f\u7528 \u9009\u62e9\u5668 \u4eceweb\u9875\u9762\u63d0\u53d6\u6570\u636e\u7684\u65b9\u4fbf\u673a\u5236\u3002 \u53c2\u6570: item( Item \u5bf9\u8c61): \u4f7f\u7528 add_xpath() \u3001 add_css() \u6216 add_value() \u7684\u540e\u7eed\u8c03\u7528\u586b\u5145item\u5b9e\u4f8b\u3002 selector( \u9009\u62e9\u5668 \u5bf9\u8c61): \u4f7f\u7528 add_xpath() (resp. add_css() )\u6216 replace_xpath() (resp. replace_css() )\u65b9\u6cd5\u65f6\u8981\u4ece\u4e2d\u63d0\u53d6\u6570\u636e\u7684selector\u3002 response( Response \u5bf9\u8c61): \u4f7f\u7528 default_selector_class \u6784\u9020selector\u7684response\uff0c\u9664\u975eselector\u53c2\u6570\u662f\u7ed9\u5b9a\u7684\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u8be5\u53c2\u6570\u88ab\u5ffd\u7565\u3002 item\u3001selector\u3001response\u548c\u5176\u4f59\u5173\u952e\u5b57\u53c2\u6570\u88ab\u5206\u914d\u7ed9Loader context(\u901a\u8fc7 context \u5c5e\u6027\u53ef\u8bbf\u95ee)\u3002 ItemLoader \u5b9e\u4f8b\u6709\u4ee5\u4e0b\u65b9\u6cd5: get_value(value, *processors, **kwargs) \u901a\u8fc7\u7ed9\u5b9a\u7684 processors \u548c\u5173\u952e\u5b57\u53c2\u6570\u5904\u7406\u7ed9\u5b9a\u7684 value \u3002 \u53ef\u7528\u5173\u952e\u5b57\u53c2\u6570: \u53c2\u6570: re(\u5b57\u7b26\u4e32\u6216compiled regex): \u7528\u4e8e\u4f7f\u7528 extract_regex() \u65b9\u6cd5\u4ece\u7ed9\u5b9a\u503c\u4e2d\u63d0\u53d6\u6570\u636e\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5728\u5904\u7406\u5668\u4e4b\u524d\u5e94\u7528 \u4f8b\u5b50: from scrapy.loader.processors import TakeFirst loader.get_value(u'name: foo', TakeFirst(), unicode.upper, re='name: (.+)') 'FOO` add_value(field_name, value, *processors, **kwargs) \u5904\u7406\u7ed9\u5b9a\u7684\u5b57\u6bb5\u7ed9\u5b9a\u7684\u503c\u3002 \u8be5\u503c\u9996\u5148\u901a\u8fc7 get_value() \u4f20\u9012\u7ed9 processors \u548c kwargs \uff0c\u7136\u540e\u901a\u8fc7 \u5b57\u6bb5\u8f93\u5165\u5904\u7406\u5668 , \u5c06\u5176\u7ed3\u679c\u9644\u52a0\u5230\u4e3a\u8be5\u5b57\u6bb5\u6536\u96c6\u7684\u6570\u636e\u3002\u5982\u679c\u5b57\u6bb5\u5df2\u7ecf\u5305\u542b\u5df2\u6536\u96c6\u7684\u6570\u636e\uff0c\u5219\u6dfb\u52a0\u65b0\u6570\u636e\u3002 \u7ed9\u5b9a\u7684 field_name \u53ef\u4ee5\u662f None \uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u53ef\u80fd\u4f1a\u6dfb\u52a0\u591a\u4e2a\u5b57\u6bb5\u7684\u503c\u3002\u5904\u7406\u540e\u7684\u503c\u5e94\u8be5\u662f\u4e00\u4e2a\u5b57\u5178\uff0c\u5176\u4e2dfield_name\u88ab\u6620\u5c04\u5230\u503c\u3002 \u4f8b\u5b50: loader.add_value('name', u'Color TV') loader.add_value('colours', [u'white', u'blue']) loader.add_value('length', u'100') loader.add_value('name', u'name: foo', TakeFirst(), re='name: (.+)') loader.add_value(None, {'name': u'foo', 'sex': u'male'}) replace_value(field_name, value, *processors, **kwargs) \u4e0e add_value() \u7c7b\u4f3c\uff0c\u4f46\u662f\u4f7f\u7528\u65b0\u503c\u66ff\u6362\u6536\u96c6\u7684\u6570\u636e\uff0c\u800c\u4e0d\u662f\u6dfb\u52a0\u5b83\u3002 get_xpath(xpath, *processors, **kwargs) \u4e0e ItemLoader.get_value() \u7c7b\u4f3c\uff0c\u4f46\u662f\u63a5\u6536\u7684\u662fXPath\u800c\u4e0d\u662f\u503c\uff0c\u8be5\u503c\u7528\u4e8e\u4ece\u4e0e\u8fd9\u4e2a ItemLoader \u5173\u8054\u7684\u9009\u62e9\u5668\u4e2d\u63d0\u53d6unicode\u5b57\u7b26\u4e32\u5217\u8868\u3002 \u53c2\u6570: xpath (str): \u63d0\u53d6\u6570\u636e\u7684Xpath\u8def\u5f84 re (\u5b57\u7b26\u4e32\u6216compiled regex): \u7528\u4e8e\u4ece\u9009\u5b9aXPath\u533a\u57df\u63d0\u53d6\u6570\u636e\u7684\u6b63\u5219\u8868\u8fbe\u5f0f \u4f8b\u5b50: # HTML\u7247\u6bb5: p class= product-name Color TV /p loader.get_xpath('//p[@class= product-name ]') # HTML\u7247\u6bb5: p id= price the price is $1200 /p loader.get_xpath('//p[@id= price ]', TakeFirst(), re='the price is (.*)') add_xpath(field_name, xpath, *processors, **kwargs) \u4e0e ItemLoader.add_value() \u7c7b\u4f3c\uff0c\u4f46\u662f\u63a5\u6536\u7684\u662fXPath\u800c\u4e0d\u662f\u503c\uff0c\u8fd9\u4e2a\u503c\u7528\u4e8e\u4ece\u4e0e\u8fd9\u4e2a ItemLoader \u5173\u8054\u7684\u9009\u62e9\u5668\u4e2d\u63d0\u53d6unicode\u5b57\u7b26\u4e32\u5217\u8868\u3002 \u770b\u4e00\u4e0b get_value() \u7684 kwargs \u53c2\u6570: xpath(str): \u7528\u4e8e\u63d0\u53d6\u6570\u636e\u7684XPath \u4f8b\u5b50: # HTML\u7247\u6bb5: p class= product-name Color TV /p loader.add_xpath('name', '//p[@class= product-name ]') # HTML\u7247\u6bb5: p id= price the price is $1200 /p loader.add_xpath('price', '//p[@id= price ]', re='the price is (.*)') replace_xpath(field_name, xpath, *processors, **kwargs) \u7c7b\u4f3c\u4e8e add_xpath() \uff0c\u4f46\u662f\u66ff\u6362\u6536\u96c6\u7684\u6570\u636e\u800c\u4e0d\u662f\u6dfb\u52a0\u6570\u636e\u3002 get_css(css, *processors, **kwargs) \u4e0e ItemLoader.get_value() \u7c7b\u4f3c\uff0c\u4f46\u662f\u63a5\u6536\u7684\u662fCSS\u9009\u62e9\u5668\u800c\u4e0d\u662f\u503c\uff0c\u8be5\u9009\u62e9\u5668\u7528\u4e8e\u4ece\u4e0e\u8fd9\u4e2a ItemLoader \u5173\u8054\u7684\u9009\u62e9\u5668\u4e2d\u63d0\u53d6unicode\u5b57\u7b26\u4e32\u5217\u8868\u3002 \u53c2\u6570: css (\u5b57\u7b26\u4e32) \u2013 \u8981\u4ece\u4e2d\u63d0\u53d6\u6570\u636e\u7684CSS\u9009\u62e9\u5668 re (\u5b57\u7b26\u4e32\u6216compiled regex) \u2013 \u7528\u4e8e\u4ece\u9009\u5b9a\u7684CSS\u533a\u57df\u4e2d\u63d0\u53d6\u6570\u636e\u7684\u6b63\u5219\u8868\u8fbe\u5f0f \u4f8b\u5b50: # HTML\u7247\u6bb5: p class= product-name Color TV /p loader.get_css('p.product-name') # HTML\u7247\u6bb5: p id= price the price is $1200 /p loader.get_css('p#price', TakeFirst(), re='the price is (.*)') add_css(field_name, css, *processors, **kwargs) \u4e0e ItemLoader.add_value() \u7c7b\u4f3c\uff0c\u4f46\u662f\u63a5\u6536\u7684\u662fCSS\u9009\u62e9\u5668\u800c\u4e0d\u662f\u503c\uff0c\u8be5\u9009\u62e9\u5668\u7528\u4e8e\u4ece\u4e0e\u8fd9\u4e2a ItemLoader \u5173\u8054\u7684\u9009\u62e9\u5668\u4e2d\u63d0\u53d6unicode\u5b57\u7b26\u4e32\u5217\u8868\u3002 \u6709\u5173 kwargs \uff0c\u8bf7\u53c2\u9605 get_css() \u3002 \u53c2\u6570: css (\u5b57\u7b26\u4e32) -\u7528\u6765\u63d0\u53d6\u6570\u636e\u7684css\u9009\u62e9\u5668 \u4f8b\u5b50: # HTML\u7247\u6bb5: p class= product-name Color TV /p loader.add_css('name', 'p.product-name') # HTML\u7247\u6bb5: p id= price the price is $1200 /p loader.add_css('price', 'p#price', re='the price is (.*)') replace_css(field_name, css, *processors, **kwargs) \u7c7b\u4f3c\u4e8e add_css() \uff0c\u4f46\u662f\u66ff\u6362\u6536\u96c6\u7684\u6570\u636e\u800c\u4e0d\u662f\u6dfb\u52a0\u6570\u636e\u3002 load_item() \u7528\u5230\u76ee\u524d\u4e3a\u6b62\u6536\u96c6\u7684\u6570\u636e\u586b\u5145item\uff0c\u5e76\u8fd4\u56de\u5b83\u3002\u9996\u5148\u901a\u8fc7 \u8f93\u51fa\u5904\u7406\u5668 \u83b7\u5f97\u6536\u96c6\u5230\u7684\u6570\u636e\uff0c\u7136\u540e\u5206\u914d\u7ed9item\u91cc\u6bcf\u4e2a\u5b57\u6bb5\u7684\u6700\u7ec8\u503c\u3002 nested_xpath(xpath) \u4f7f\u7528xpath\u9009\u62e9\u5668\u521b\u5efa\u5d4c\u5957\u52a0\u8f7d\u5668( nested loader )\u3002\u6240\u63d0\u4f9b\u7684\u9009\u62e9\u5668\u76f8\u5bf9\u4e8e\u4e0e\u6b64 ItemLoader \u5173\u8054\u7684\u9009\u62e9\u5668\u3002\u5d4c\u5957\u52a0\u8f7d\u5668\u4e0e\u7236\u9879\u76ee\u52a0\u8f7d\u5668\u5171\u4eab Item \uff0c\u56e0\u6b64\u5bf9 add_xpath() \u3001 dd_value() \u3001 replace_value() \u7b49\u7684\u8c03\u7528\u5c06\u6309\u7167\u9884\u671f\u6267\u884c\u3002 nested_css(css) \u7528css\u9009\u62e9\u5668\u521b\u5efa\u5d4c\u5957\u52a0\u8f7d\u5668( nested loader )\u3002\u6240\u63d0\u4f9b\u7684\u9009\u62e9\u5668\u76f8\u5bf9\u4e8e\u4e0e\u6b64 ItemLoader \u5173\u8054\u7684\u9009\u62e9\u5668\u3002\u5d4c\u5957\u52a0\u8f7d\u5668\u4e0e\u7236\u9879\u76ee\u52a0\u8f7d\u5668\u5171\u4eab Item \uff0c\u56e0\u6b64\u5bf9 add_xpath() \u3001 dd_value() \u3001 replace_value() \u7b49\u7684\u8c03\u7528\u5c06\u6309\u7167\u9884\u671f\u6267\u884c\u3002 get_collected_values(field_name) \u8fd4\u56de\u7ed9\u5b9a\u5b57\u6bb5\u6536\u96c6\u5230\u7684\u503c\u3002 get_output_value(field_name) \u8fd4\u56de\u4f7f\u7528\u8f93\u51fa\u5904\u7406\u5668\u5bf9\u7ed9\u5b9a\u5b57\u6bb5\u89e3\u6790\u8fc7\u540e\u7684\u6536\u96c6\u5230\u7684\u503c\u3002\u6b64\u65b9\u6cd5\u6839\u672c\u4e0d\u586b\u5145\u6216\u4fee\u6539item\u3002 get_input_processor(field_name) \u8fd4\u56de\u7ed9\u5b9a\u5b57\u6bb5\u7684\u8f93\u5165\u5904\u7406\u5668\u3002 get_output_processor(field_name) \u8fd4\u56de\u7ed9\u5b9a\u5b57\u6bb5\u7684\u8f93\u51fa\u5904\u7406\u5668\u3002 ItemLoader \u5b9e\u4f8b\u5177\u6709\u4ee5\u4e0b\u5c5e\u6027: item \u7531Item Loader\u89e3\u6790\u7684 Item \u5bf9\u8c61\u3002 context \u6b64Item Loader\u7684\u5f53\u524d\u6d3b\u52a8 \u4e0a\u4e0b\u6587 \u3002 default_item_class \u4e00\u4e2aItem\u7c7b(\u6216\u5de5\u5382)\uff0c\u7528\u4e8e\u5728\u6784\u9020\u51fd\u6570\u4e2d\u672a\u7ed9\u51faitems\u65f6\u5b9e\u4f8b\u5316items\u3002 default_input_processor \u672a\u6307\u5b9a\u5b57\u6bb5\u7684\u9ed8\u8ba4\u8f93\u5165\u5904\u7406\u5668\u3002 default_output_processor \u672a\u6307\u5b9a\u5b57\u6bb5\u7684\u9ed8\u8ba4\u8f93\u51fa\u5904\u7406\u5668\u3002 default_selector_class \u5982\u679c\u6784\u9020\u51fd\u6570\u4e2d\u53ea\u7ed9\u51faresponse\uff0c\u5219\u7528\u4e8e\u6784\u9020\u8fd9\u4e2a ItemLoader \u7684 selector \u7684\u7c7b\u3002\u5982\u679c\u6784\u9020\u51fd\u6570\u4e2d\u63d0\u4f9b\u4e86\u9009\u62e9\u5668\uff0c\u5219\u5ffd\u7565\u6b64\u5c5e\u6027\u3002\u8fd9\u4e2a\u5c5e\u6027\u6709\u65f6\u5728\u5b50\u7c7b\u4e2d\u88ab\u91cd\u5199\u3002 selector \u63d0\u53d6\u6570\u636e\u7684 selector \u5bf9\u8c61\u3002\u5b83\u8981\u4e48\u662f\u6784\u9020\u51fd\u6570\u4e2d\u7ed9\u51fa\u7684selector\uff0c\u8981\u4e48\u662f\u4f7f\u7528 default_selector_class \u4ece\u6784\u9020\u51fd\u6570\u4e2d\u7ed9\u51fa\u7684response\u521b\u5efa\u7684selector\u3002\u8fd9\u4e2a\u5c5e\u6027\u662f\u53ea\u8bfb\u7684\u3002 Nested Loaders(\u5d4c\u5957\u52a0\u8f7d\u5668) \u5f53\u4ece\u6587\u6863\u7684\u4e00\u4e2a\u5c0f\u8282\u89e3\u6790\u76f8\u5173\u503c\u65f6\uff0c\u521b\u5efa\u5d4c\u5957\u52a0\u8f7d\u5668\u662f\u5f88\u6709\u7528\u7684\u3002\u5047\u8bbe\u60a8\u6b63\u5728\u4ece\u9875\u9762\u7684\u9875\u811a\u4e2d\u63d0\u53d6\u7ec6\u8282\uff0c\u8fd9\u4e9b\u9875\u811a\u770b\u8d77\u6765\u5982\u4e0b: \u4f8b\u5b50: footer a class= social href= https://facebook.com/whatever Like Us /a a class= social href= https://twitter.com/whatever Follow Us /a a class= email href= mailto:whatever@example.com Email Us /a /footer \u6ca1\u6709\u5d4c\u5957\u52a0\u8f7d\u5668\uff0c\u60a8\u9700\u8981\u4e3a\u60a8\u5e0c\u671b\u63d0\u53d6\u7684\u6bcf\u4e2a\u503c\u6307\u5b9a\u5b8c\u6574\u7684xpath(\u6216css)\u3002 \u4f8b\u5b50: loader = ItemLoader(item=Item()) # \u52a0\u8f7d\u7684\u4e1c\u897f\u4e0d\u5728\u9875\u811a loader.add_xpath('social', '//footer/a[@class = social ]/@href') loader.add_xpath('email', '//footer/a[@class = email ]/@href') loader.load_item() \u76f8\u53cd\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528footer\u9009\u62e9\u5668\u521b\u5efa\u4e00\u4e2a\u5d4c\u5957\u7684\u52a0\u8f7d\u5668\uff0c\u5e76\u6dfb\u52a0\u76f8\u5bf9\u4e8efooter\u7684\u503c\u3002\u529f\u80fd\u662f\u76f8\u540c\u7684\uff0c\u4f46\u60a8\u53ef\u4ee5\u907f\u514d\u91cd\u590dfooter\u9009\u62e9\u5668\u3002 \u4f8b\u5b50: loader = ItemLoader(item=Item()) # \u52a0\u8f7d\u7684\u4e1c\u897f\u4e0d\u5728\u9875\u811a footer_loader = loader.nested_xpath('//footer') footer_loader.add_xpath('social', 'a[@class = social ]/@href') footer_loader.add_xpath('email', 'a[@class = email ]/@href') # \u4e0d\u9700\u8981\u8c03\u7528footer_loader.load_item() loader.load_item() \u53ef\u4ee5\u4efb\u610f\u5d4c\u5957\u52a0\u8f7d\u5668\uff0c\u5b83\u4eec\u53ef\u4ee5\u4f7f\u7528xpath\u6216css\u9009\u62e9\u5668\u3002\u4f5c\u4e3a\u4e00\u4e2a\u901a\u7528\u65b9\u6cd5\uff0c\u5d4c\u5957\u52a0\u8f7d\u5668\u4f7f\u4ee3\u7801\u66f4\u7b80\u5355\uff0c\u4f46\u53c8\u4e0d\u8fc7\u5206\u5d4c\u5957\uff0c\u6216\u8005\u89e3\u6790\u5668\u53ef\u80fd\u53d8\u5f97\u96be\u4ee5\u9605\u8bfb\u65f6\uff0c\u4f7f\u7528\u5d4c\u5957\u52a0\u8f7d\u5668\u3002 \u590d\u7528\u548c\u6269\u5c55Item Loaders \u968f\u7740\u9879\u76ee\u8d8a\u6765\u8d8a\u5927\uff0c\u6709\u8d8a\u6765\u8d8a\u591a\u7684spider\uff0c\u7ef4\u62a4\u5c31\u6210\u4e3a\u4e00\u4e2a\u57fa\u672c\u95ee\u9898\uff0c\u7279\u522b\u662f\u5f53\u60a8\u5fc5\u987b\u4e3a\u6bcf\u4e2a\u722c\u884c\u5668\u5904\u7406\u8bb8\u591a\u4e0d\u540c\u7684\u89e3\u6790\u89c4\u5219\u65f6\uff0c\u6709\u8bb8\u591a\u5f02\u5e38\uff0c\u4f46\u8fd8\u9700\u8981\u590d\u7528\u516c\u5171\u8f93\u5165\u8f93\u51fa\u5904\u7406\u5668\u65f6\u3002 Item Loaders\u65e8\u5728\u51cf\u8f7b\u89e3\u6790\u89c4\u5219\u7684\u7ef4\u62a4\u8d1f\u62c5\uff0c\u540c\u65f6\u4e0d\u4e27\u5931\u7075\u6d3b\u6027\uff0c\u5e76\u4e3a\u6269\u5c55\u548c\u8986\u76d6\u89c4\u5219\u63d0\u4f9b\u65b9\u4fbf\u7684\u673a\u5236\u3002\u56e0\u6b64\uff0cItem Loaders\u652f\u6301\u4f20\u7edf\u7684Python\u7c7b\u7ee7\u627f\uff0c\u4ee5\u5904\u7406\u7279\u5b9aspider(\u6216spider\u7ec4)\u7684\u5dee\u5f02\u3002 \u4f8b\u5982\uff0c\u5047\u8bbe\u67d0\u4e2a\u7279\u5b9a\u7ad9\u70b9\u5c06\u5b83\u4eec\u7684\u4ea7\u54c1\u540d\u79f0\u7528\u4e09\u4e2a\u6a2a\u6760\u62ec\u8d77\u6765(\u4f8b\u5982 --- plasma TV--- )\uff0c\u5e76\u4e14\u60a8\u4e0d\u5e0c\u671b\u5728\u6700\u7ec8\u4ea7\u54c1\u540d\u79f0\u4e2d\u4f7f\u7528\u8fd9\u4e9b\u6a2a\u6760\u3002 \u4e0b\u9762\u4ecb\u7ecd\u5982\u4f55\u901a\u8fc7\u590d\u7528\u548c\u6269\u5c55\u9ed8\u8ba4Product\u7684Item Loaders( ProductLoader )\u6765\u5220\u9664\u8fd9\u4e9b\u6a2a\u6760: from scrapy.loader.processors import MapCompose from myproject.ItemLoaders import ProductLoader def strip_dashes(x): return x.strip('-') class SiteSpecificLoader(ProductLoader): name_in = MapCompose(strip_dashes, ProductLoader.name_in) \u6269\u5c55Item Loaders\u975e\u5e38\u6709\u7528\u7684\u53e6\u4e00\u79cd\u60c5\u51b5\u662f\uff0c\u5f53\u60a8\u6709\u591a\u79cd\u6e90\u683c\u5f0f\u65f6\uff0c\u4f8b\u5982XML\u548cHTML\u3002\u5728XML\u7248\u672c\u4e2d\uff0c\u60a8\u53ef\u80fd\u5e0c\u671b\u5220\u9664\u51fa\u73b0\u7684 CDATA \u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u5982\u4f55\u505a\u5230\u8fd9\u4e00\u70b9\u7684\u4f8b\u5b50: from scrapy.loader.processors import MapCompose from myproject.ItemLoaders import ProductLoader from myproject.utils.xml import remove_cdata class XmlProductLoader(ProductLoader): name_in = MapCompose(remove_cdata, ProductLoader.name_in) \u8fd9\u5c31\u662f\u901a\u5e38\u6269\u5c55\u8f93\u5165\u5904\u7406\u5668\u7684\u65b9\u5f0f\u3002 \u5bf9\u4e8e\u8f93\u51fa\u5904\u7406\u5668\uff0c\u66f4\u5e38\u89c1\u7684\u505a\u6cd5\u662f\u5728\u5b57\u6bb5metadata\u4e2d\u5b9a\u4e49\u5b83\u4eec\uff0c\u56e0\u4e3a\u5b83\u4eec\u901a\u5e38\u53ea\u4f9d\u8d56\u4e8e\u5b57\u6bb5\uff0c\u800c\u4e0d\u4f9d\u8d56\u4e8e\u6bcf\u4e2a\u7279\u5b9a\u7684\u7ad9\u70b9\u89e3\u6790\u89c4\u5219(\u5982\u8f93\u5165\u5904\u7406\u5668)\u3002\u53c2\u89c1: \u8f93\u5165\u548c\u8f93\u51fa\u5904\u7406\u5668\u7684\u5b9a\u4e49 \u3002 \u6709\u8bb8\u591a\u5176\u4ed6\u53ef\u80fd\u7684\u65b9\u6cd5\u53ef\u4ee5\u6269\u5c55\u3001\u7ee7\u627f\u548c\u8986\u76d6Item Loaders\uff0c\u4e0d\u540c\u7684Item Loaders\u5c42\u6b21\u7ed3\u6784\u53ef\u80fd\u66f4\u9002\u5408\u4e0d\u540c\u7684\u9879\u76ee\u3002Scrapy\u53ea\u63d0\u4f9b\u673a\u5236;\u5b83\u4e0d\u4f1a\u5f3a\u5236\u60a8\u7684\u88c5\u8f7d\u5668\u96c6\u5408\u7684\u4efb\u4f55\u7279\u5b9a\u7ec4\u7ec7\u2014\u2014\u8fd9\u53d6\u51b3\u4e8e\u60a8\u548c\u60a8\u7684\u9879\u76ee\u7684\u9700\u6c42\u3002 \u53ef\u7528\u7684\u5185\u7f6e\u5904\u7406\u5668 \u5c3d\u7ba1\u60a8\u53ef\u4ee5\u4f7f\u7528\u4efb\u4f55\u53ef\u8c03\u7528\u51fd\u6570\u4f5c\u4e3a\u8f93\u5165\u548c\u8f93\u51fa\u5904\u7406\u5668\uff0c\u4f46Scrapy\u63d0\u4f9b\u4e86\u4e00\u4e9b\u5e38\u7528\u7684\u5904\u7406\u5668\uff0c\u5982\u4e0b\u6240\u8ff0\u3002\u5176\u4e2d\u4e00\u4e9b\u51fd\u6570\uff0c\u5982 MapCompose (\u901a\u5e38\u7528\u4f5c\u8f93\u5165\u5904\u7406\u5668)\uff0c\u8d1f\u8d23\u7ec4\u5408\u6309\u987a\u5e8f\u6267\u884c\u7684\u51e0\u4e2a\u51fd\u6570\u7684\u8f93\u51fa\uff0c\u4ee5\u751f\u6210\u6700\u7ec8\u89e3\u6790\u540e\u7684\u503c\u3002 \u4e0b\u9762\u662f\u6240\u6709\u5185\u7f6e\u5904\u7406\u5668\u7684\u5217\u8868: scrapy.loader.processors.Identity \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) \u6700\u7b80\u5355\u7684\u5904\u7406\u5668\uff0c\u4ec0\u4e48\u90fd\u4e0d\u505a\u3002\u5b83\u8fd4\u56de\u539f\u503c\u4e0d\u53d8\u3002\u5b83\u4e0d\u63a5\u6536\u4efb\u4f55\u6784\u9020\u51fd\u6570\u53c2\u6570\uff0c\u4e5f\u4e0d\u63a5\u53d7\u52a0\u8f7d\u5668\u4e0a\u4e0b\u6587\u3002 \u4f8b\u5b50: from scrapy.loader.processors import Identity proc = Identity() proc(['one', 'two', 'three']) ['one', 'two', 'three'] scrapy.loader.processors.TakeFirst \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) \u4ece\u63a5\u6536\u5230\u7684\u503c\u8fd4\u56de\u7b2c\u4e00\u4e2a\u975e\u7a7a/\u975e\u7a7a\u503c\uff0c\u56e0\u6b64\u5b83\u901a\u5e38\u4f5c\u4e3a\u8f93\u51fa\u5904\u7406\u5668\u7528\u4e8e\u5355\u503c\u5b57\u6bb5\u3002\u5b83\u4e0d\u63a5\u6536\u4efb\u4f55\u6784\u9020\u51fd\u6570\u53c2\u6570\uff0c\u4e5f\u4e0d\u63a5\u53d7\u52a0\u8f7d\u5668\u4e0a\u4e0b\u6587\u3002 \u4f8b\u5b50: from scrapy.loader.processors import TakeFirst proc = TakeFirst() proc(['', 'one', 'two', 'three']) 'one' scrapy.loader.processors.Join(separator=u' ') \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) \u8fd4\u56de\u4e0e\u6784\u9020\u51fd\u6570\u4e2d\u7ed9\u51fa\u7684\u5206\u9694\u7b26\u8fde\u63a5\u7684\u503c\uff0c\u8be5\u5206\u9694\u7b26\u9ed8\u8ba4\u4e3au' '\u3002\u5b83\u4e0d\u63a5\u53d7\u52a0\u8f7d\u5668\u4e0a\u4e0b\u6587\u3002 \u5f53\u4f7f\u7528\u9ed8\u8ba4\u5206\u9694\u7b26\u65f6\uff0c\u8fd9\u4e2a\u5904\u7406\u5668\u76f8\u5f53\u4e8e\u51fd\u6570: u' '.join \u4f8b\u5b50: from scrapy.loader.processors import Join proc = Join() proc(['one', 'two', 'three']) u'one two three' proc = Join(' br ') proc(['one', 'two', 'three']) u'one br two br three' scrapy.loader.processors.Compose(*functions, **default_loader_context) \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) \u7531\u7ed9\u5b9a\u51fd\u6570\u7684\u7ec4\u5408\u6784\u6210\u7684\u5904\u7406\u5668\u3002\u8fd9\u610f\u5473\u7740\u8fd9\u4e2a\u5904\u7406\u5668\u7684\u6bcf\u4e2a\u8f93\u5165\u503c\u90fd\u88ab\u4f20\u9012\u7ed9\u7b2c\u4e00\u4e2a\u51fd\u6570\uff0c\u8fd9\u4e2a\u51fd\u6570\u7684\u7ed3\u679c\u88ab\u4f20\u9012\u7ed9\u7b2c\u4e8c\u4e2a\u51fd\u6570\uff0c\u4ee5\u6b64\u7c7b\u63a8\uff0c\u76f4\u5230\u6700\u540e\u4e00\u4e2a\u51fd\u6570\u8fd4\u56de\u8fd9\u4e2a\u5904\u7406\u5668\u7684\u8f93\u51fa\u503c\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5728 None \u503c\u4e0a\u505c\u6b62\u5904\u7406\u3002\u901a\u8fc7\u4f20\u9012\u5173\u952e\u5b57\u53c2\u6570 stop_on_none=False \u53ef\u4ee5\u6539\u53d8\u8fd9\u79cd\u884c\u4e3a\u3002 \u4f8b\u5b50 from scrapy.loader.processors import Compose proc = Compose(lambda v: v[0], str.upper) proc(['hello', 'world']) 'HELLO' \u6bcf\u4e2a\u51fd\u6570\u90fd\u53ef\u4ee5\u9009\u62e9\u63a5\u6536 loader_context \u53c2\u6570\u3002\u5bf9\u4e8e\u8fd9\u6837\u505a\u7684\uff0c\u8fd9\u4e2a\u5904\u7406\u5668\u5c06\u901a\u8fc7\u8be5\u53c2\u6570\u4f20\u9012\u5f53\u524d\u6d3b\u52a8 \u52a0\u8f7d\u5668\u4e0a\u4e0b\u6587 \u3002 \u5728\u6784\u9020\u51fd\u6570\u4e2d\u4f20\u9012\u7684\u5173\u952e\u5b57\u53c2\u6570\u7528\u4f5c\u4f20\u9012\u7ed9\u6bcf\u4e2a\u51fd\u6570\u8c03\u7528\u7684\u9ed8\u8ba4\u662f\u52a0\u8f7d\u5668\u4e0a\u4e0b\u6587\u503c\u3002\u4f46\u662f\uff0c\u4f20\u9012\u7ed9\u51fd\u6570\u7684\u6700\u7ec8\u52a0\u8f7d\u5668\u4e0a\u4e0b\u6587\u503c\u88ab\u901a\u8fc7 ItemLoader.context() \u5c5e\u6027\u8bbf\u95ee\u7684\u5f53\u524d\u6d3b\u52a8\u52a0\u8f7d\u5668\u4e0a\u4e0b\u6587\u8986\u76d6\u3002 scrapy.loader.processors.MapCompose(*functions, **default_loader_context) \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) \u7531\u7ed9\u5b9a\u51fd\u6570\u7684\u7ec4\u5408\u6784\u6210\u7684\u5904\u7406\u5668\uff0c\u7c7b\u4f3c\u4e8e\u6784\u6210 Compose \u5904\u7406\u5668\u3002\u8fd9\u4e2a\u5904\u7406\u5668\u7684\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\u5185\u90e8\u7ed3\u679c\u5728\u51fd\u6570\u4e4b\u95f4\u4f20\u9012\u7684\u65b9\u5f0f\uff0c\u5982\u4e0b\u6240\u793a: \u8fed\u4ee3\u8be5\u5904\u7406\u5668\u7684\u8f93\u5165\u503c\uff0c\u5e76\u5bf9\u6bcf\u4e2a\u5143\u7d20\u5e94\u7528\u7b2c\u4e00\u4e2a\u51fd\u6570\u3002\u8fd9\u4e9b\u51fd\u6570\u8c03\u7528\u7684\u7ed3\u679c(\u6bcf\u4e2a\u5143\u7d20\u4e00\u4e2a)\u88ab\u8fde\u63a5\u8d77\u6765\uff0c\u4ee5\u6784\u9020\u4e00\u4e2a\u65b0\u7684iterable\uff0c\u7136\u540e\u4f7f\u7528\u5b83\u5e94\u7528\u7b2c\u4e8c\u4e2a\u51fd\u6570\uff0c\u4f9d\u6b64\u7c7b\u63a8\uff0c\u76f4\u5230\u6700\u540e\u4e00\u4e2a\u51fd\u6570\u5e94\u7528\u5230\u5230\u76ee\u524d\u4e3a\u6b62\u6536\u96c6\u7684\u503c\u5217\u8868\u7684\u6bcf\u4e2a\u503c\u4e3a\u6b62\u3002\u6700\u540e\u4e00\u4e2a\u51fd\u6570\u7684\u8f93\u51fa\u503c\u88ab\u8fde\u63a5\u5728\u4e00\u8d77\u4ee5\u4ea7\u751f\u8fd9\u4e2a\u5904\u7406\u5668\u7684\u8f93\u51fa\u3002 \u6bcf\u4e2a\u7279\u5b9a\u7684\u51fd\u6570\u90fd\u53ef\u4ee5\u8fd4\u56de\u4e00\u4e2a\u503c\u6216\u4e00\u4e2a\u503c\u5217\u8868\uff0c\u8fd9\u4e2a\u503c\u5217\u8868\u4e0e\u5e94\u7528\u4e8e\u5176\u4ed6\u8f93\u5165\u503c\u7684\u76f8\u540c\u51fd\u6570\u8fd4\u56de\u7684\u503c\u5217\u8868\u662f\u76f8\u540c\u7684\u3002\u51fd\u6570\u8fd8\u53ef\u4ee5\u8fd4\u56de None \uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u8be5\u51fd\u6570\u7684\u8f93\u51fa\u5c06\u88ab\u5ffd\u7565\uff0c\u4ee5\u4fbf\u5728\u94fe\u4e0a\u8fdb\u884c\u8fdb\u4e00\u6b65\u5904\u7406\u3002 \u8fd9\u4e2a\u5904\u7406\u5668\u63d0\u4f9b\u4e86\u4e00\u79cd\u65b9\u4fbf\u7684\u65b9\u6cd5\u6765\u7ec4\u5408\u53ea\u4f7f\u7528\u5355\u4e2a\u503c(\u800c\u4e0d\u662f\u8fed\u4ee3)\u7684\u51fd\u6570\u3002\u7531\u4e8e\u8fd9\u4e2a\u539f\u56e0\uff0cMapCompose\u5904\u7406\u5668\u901a\u5e38\u7528\u4f5c\u8f93\u5165\u5904\u7406\u5668\uff0c\u56e0\u4e3a\u6570\u636e\u901a\u5e38\u662f\u4f7f\u7528\u9009\u62e9\u5668\u7684extract()\u65b9\u6cd5\u63d0\u53d6\u7684\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2aunicode\u5b57\u7b26\u4e32\u5217\u8868\u3002 \u4e0b\u9762\u7684\u4f8b\u5b50\u5e94\u8be5\u8bf4\u660e\u5b83\u662f\u5982\u4f55\u5de5\u4f5c\u7684:: def filter_world(x): ... return None if x == 'world' else x ... from scrapy.loader.processors import MapCompose proc = MapCompose(filter_world, unicode.upper) proc([u'hello', u'world', u'this', u'is', u'scrapy']) [u'HELLO, u'THIS', u'IS', u'SCRAPY'] \u4e0eCompose\u5904\u7406\u5668\u4e00\u6837\uff0c\u51fd\u6570\u53ef\u4ee5\u63a5\u6536\u88c5\u8f7d\u5668\u4e0a\u4e0b\u6587\uff0c\u800c\u6784\u9020\u51fd\u6570\u5173\u952e\u5b57\u53c2\u6570\u88ab\u7528\u4f5c\u9ed8\u8ba4\u4e0a\u4e0b\u6587\u503c\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Compose \u5904\u7406\u5668\u3002 scrapy.loader.processors.SelectJmes(json_path) \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) \u4f7f\u7528\u63d0\u4f9b\u7ed9\u6784\u9020\u51fd\u6570\u7684json\u8def\u5f84\u67e5\u8be2\u503c\u5e76\u8fd4\u56de\u8f93\u51fa\u3002\u9700\u8981\u8fd0\u884cjmespath ( https://github.com/jmespath/jmespath.py )\u3002\u8fd9\u4e2a\u5904\u7406\u5668\u4e00\u6b21\u53ea\u63a5\u53d7\u4e00\u4e2a\u8f93\u5165\u3002 \u4f8b\u5b50: from scrapy.loader.processors import SelectJmes, Compose, MapCompose proc = SelectJmes( foo ) # \u76f4\u63a5\u7528\u4e8e\u5217\u8868\u548c\u5b57\u5178 proc({'foo': 'bar'}) 'bar' proc({'foo': {'bar': 'baz'}}) {'bar': 'baz'} \u4e0eJSON\u4e00\u8d77\u5de5\u4f5c: import json proc_single_json_str = Compose(json.loads, SelectJmes( foo )) proc_single_json_str('{ foo : bar }') u'bar' proc_json_list = Compose(json.loads, MapCompose(SelectJmes('foo'))) proc_json_list('[{ foo : bar }, { baz : tar }]') [u'bar']","title":"Item Loaders(Item\u52a0\u8f7d\u5668)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/10-itemloaders/#item-loadersitem","text":"Item Loaders\u63d0\u4f9b\u4e86\u4e00\u79cd\u65b9\u4fbf\u7684\u673a\u5236\u6765\u586b\u5145\u6293\u53d6\u7684 Items \u3002\u5c3d\u7ba1items\u53ef\u4ee5\u4f7f\u7528\u5b83\u4eec\u672c\u8eab\u7684\u5b57\u5178API\u8fdb\u884c\u586b\u5145\uff0c\u4f46Item Loaders\u901a\u8fc7\u81ea\u52a8\u5316\u4e00\u4e9b\u5e38\u89c1\u4efb\u52a1(\u6bd4\u5982\u5728\u5206\u914d\u539f\u59cb\u63d0\u53d6\u7684\u6570\u636e\u4e4b\u524d\u5bf9\u5176\u8fdb\u884c\u89e3\u6790)\uff0c\u4ece\u6293\u53d6\u8fc7\u7a0b\u4e2d\u586b\u5145\u5b83\u4eecItem Loaders\u63d0\u4f9b\u4e86\u66f4\u65b9\u4fbf\u7684API\u3002 \u6362\u53e5\u8bdd\u8bf4\uff0c Items \u63d0\u4f9b\u4e86Scrapy\u6293\u53d6\u6570\u636e\u7684\u5bb9\u5668\uff0c\u800cItem Loaders\u63d0\u4f9b\u4e86\u586b\u5145\u8be5\u5bb9\u5668\u7684\u673a\u5236\u3002 Item Loaders\u65e8\u5728\u63d0\u4f9b\u4e00\u79cd\u7075\u6d3b\u3001\u9ad8\u6548\u548c\u7b80\u5355\u7684\u673a\u5236\uff0c\u7528\u4e8e\u6269\u5c55\u548c\u8986\u76d6\u4e0d\u540c\u7684\u5b57\u6bb5\u7684\u4e00\u79cd\u89e3\u6790\u89c4\u5219\uff0c\u65e0\u8bba\u662f\u901a\u8fc7spider\u6216\u6e90\u683c\u5f0f(HTML\u3001XML\u7b49)\u8fdb\u884c\u6269\u5c55\uff0c\u800c\u4e0d\u4f1a\u6210\u4e3a\u5f00\u53d1\u8005\u7ef4\u62a4\u7684\u5669\u68a6\u3002","title":"Item Loaders(Item\u52a0\u8f7d\u5668)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/10-itemloaders/#item-loadersitems","text":"\u8981\u4f7f\u7528Item Loaders\uff0c\u5fc5\u987b\u9996\u5148\u5b9e\u4f8b\u5316\u5b83\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u7c7b\u4f3c\u4e8edict\u7684\u5bf9\u8c61(\u4f8b\u5982Item\u6216dict)\u6765\u5b9e\u4f8b\u5316\u5b83\uff0c\u4e5f\u53ef\u4ee5\u4e0d\u4f7f\u7528\u5b83\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cItem\u4f1a\u4f7f\u7528 ItemLoader.default_item_class \u5c5e\u6027\u4e2d\u6307\u5b9a\u7684Item\u7c7b\u5728ItemLoader\u6784\u9020\u51fd\u6570\u4e2d\u81ea\u52a8\u5b9e\u4f8b\u5316\u3002 \u7136\u540e\uff0c\u5f00\u59cb\u5c06\u503c\u6536\u96c6\u5230Item Loader\u4e2d\uff0c\u901a\u5e38\u4f7f\u7528 Selectors \u3002\u53ef\u4ee5\u5411\u540c\u4e00item\u5b57\u6bb5\u6dfb\u52a0\u591a\u4e2a\u503c;Item Loader\u5c06\u77e5\u9053\u5728\u4ee5\u540e\u5982\u4f55\u4f7f\u7528\u9002\u5f53\u7684\u5904\u7406\u51fd\u6570\u201c\u8fde\u63a5\u201d\u8fd9\u4e9b\u503c\u3002 \u4e0b\u9762\u662f\u5728 Spider \u4e2d\u4e00\u4e2a\u5178\u578b\u7684Item Loaders\u7684\u7528\u6cd5\uff0c\u5728 Item\u7ae0\u8282 \u4e2d\u5b9a\u4e49\u7684 Product item : from scrapy.loader import ItemLoader from myproject.items import Product def parse(self, response): l = ItemLoader(item=Product(), response=response) l.add_xpath('name', '//div[@class= product_name ]') l.add_xpath('name', '//div[@class= product_title ]') l.add_xpath('price', '//p[@id= price ]') l.add_css('stock', 'p#stock]') l.add_value('last_updated', 'today') # \u8fd8\u53ef\u4ee5\u4f7f\u7528\u6587\u5b57\u503c return l.load_item() \u5feb\u901f\u67e5\u770b\u8fd9\u6bb5\u4ee3\u7801\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230name\u5b57\u6bb5\u662f\u4ece\u9875\u9762\u4e2d\u7684\u4e24\u4e2a\u4e0d\u540cXPath\u4f4d\u7f6e\u63d0\u53d6\u7684: //div[@class=\"product_name\"] //div[@class=\"product_title\"] \u6362\u53e5\u8bdd\u8bf4\uff0c\u901a\u8fc7\u4f7f\u7528 add_xpath() \u65b9\u6cd5\u4ece\u4e24\u4e2aXPath\u4f4d\u7f6e\u63d0\u53d6\u6570\u636e\u6765\u6536\u96c6\u6570\u636e\u3002\u7a0d\u540e\u5c06\u6570\u636e\u5206\u914d\u7ed9 name \u5b57\u6bb5\u3002 \u7136\u540e\uff0c\u5bf9 price \u548c stock \u5b57\u6bb5\u4f7f\u7528\u7c7b\u4f3c\u7684\u8c03\u7528(\u540e\u8005\u4f7f\u7528\u5e26\u6709 add_css() \u65b9\u6cd5\u7684CSS\u9009\u62e9\u5668)\uff0c\u6700\u540e\u4f7f\u7528\u53e6\u4e00\u4e2a\u65b9\u6cd5 add_value() \u4f7f\u7528\u6587\u5b57\u503c( today )\u586b\u5145 last_update \u5b57\u6bb5\u3002 \u6700\u540e\uff0c\u5f53\u6240\u6709\u6570\u636e\u6536\u96c6\u5b8c\u6bd5\u65f6\uff0c\u8c03\u7528 ItemLoader.load_item() \u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u5b9e\u9645\u8fd4\u56de \u88ab\u586b\u5145\u8fc7\u7684item(\u5c31\u662f\u4e4b\u524d\u63d0\u53d6\u548c\u6536\u96c6\u7684\u6570\u636e\u586b\u5145\u8fc7\u7684item), \u53ea\u4e0d\u8fc7\u662f\u5728\u4f7f\u7528 add_xpath() \u3001 add_css() \u548c add_value() \u4e4b\u524d\u3002","title":"\u4f7f\u7528Item Loaders\u586b\u5145items"},{"location":"2. \u57fa\u672c\u6982\u5ff5/10-itemloaders/#_1","text":"Item Loaders\u5305\u542b\u4e00\u4e2a\u8f93\u5165\u5904\u7406\u5668\u548c\u4e00\u4e2a\u8f93\u51fa\u5904\u7406\u5668\uff0c\u7528\u4e8e\u6bcf\u4e2a(item)\u5b57\u6bb5\u3002\u8f93\u5165\u5904\u7406\u5668\u5728\u63a5\u6536\u5230\u63d0\u53d6\u7684\u6570\u636e(\u901a\u8fc7 add_xpath() \u3001 add_css() \u6216 add_value() \u65b9\u6cd5)\u65f6\u7acb\u5373\u5904\u7406\u6570\u636e\uff0c\u5e76\u6536\u96c6\u8f93\u5165\u5904\u7406\u5668\u7684\u7ed3\u679c\u5e76\u4fdd\u5b58\u5728ItemLoader\u4e2d\u3002\u5728\u6536\u96c6\u6240\u6709\u6570\u636e\u4e4b\u540e\uff0c\u8c03\u7528 ItemLoader.load_item() \u65b9\u6cd5\u6765\u586b\u5145\u548c\u83b7\u53d6\u586b\u5145\u7684 Item \u5bf9\u8c61\u3002\u8fd9\u65f6\uff0c\u4f7f\u7528\u5148\u524d\u6536\u96c6\u7684\u6570\u636e(\u88ab\u8f93\u5165\u5904\u7406\u5668\u5904\u7406\u8fc7\u7684)\u8c03\u7528\u8f93\u51fa\u5904\u7406\u5668\u3002\u8f93\u51fa\u5904\u7406\u5668\u7684\u7ed3\u679c\u662f\u6700\u7ec8\u7684\u503c \u8ba9\u6211\u4eec\u770b\u4e00\u4e2a\u4f8b\u5b50\u6765\u8bf4\u660e\u8f93\u5165\u548c\u8f93\u51fa\u5904\u7406\u5668\u662f\u5982\u4f55\u88ab\u4e00\u4e2a\u7279\u5b9a\u7684\u5b57\u6bb5(\u540c\u6837\u9002\u7528\u4e8e\u4efb\u4f55\u5176\u4ed6\u5b57\u6bb5)\u8c03\u7528\u7684: l = ItemLoader(Product(), some_selector) l.add_xpath('name', xpath1) # (1) l.add_xpath('name', xpath2) # (2) l.add_css('name', css) # (3) l.add_value('name', 'test') # (4) return l.load_item() # (5) \u63d0\u53d6 xpath1 \u4e2d\u7684\u6570\u636e\uff0c\u5e76\u901a\u8fc7 name \u5b57\u6bb5\u7684\u8f93\u5165\u5904\u7406\u5668\u5904\u7406\u3002\u8f93\u5165\u5904\u7406\u5668\u7684\u7ed3\u679c\u88ab\u6536\u96c6\u5e76\u4fdd\u5b58\u5728Item Loaders\u4e2d(\u4f46\u5c1a\u672a\u5206\u914d\u7ed9Item)\u3002 \u63d0\u53d6 xpath2 \u4e2d\u7684\u6570\u636e\uff0c\u5e76\u901a\u8fc7(1)\u4e2d\u4f7f\u7528\u7684\u76f8\u540c\u7684\u8f93\u5165\u5904\u7406\u5668\u5904\u7406\uff0c\u8f93\u5165\u5904\u7406\u5668\u7684\u7ed3\u679c\u9644\u52a0\u5230(1)\u4e2d\u6536\u96c6\u7684\u6570\u636e(\u5982\u679c\u6709\u7684\u8bdd)\u3002 \u8fd9\u79cd\u60c5\u51b5\u4e0e\u524d\u9762\u7684\u60c5\u51b5\u7c7b\u4f3c\uff0c\u53ea\u662f\u6570\u636e\u662f\u4ececss css\u9009\u62e9\u5668\u4e2d\u63d0\u53d6\u7684\uff0c\u5e76\u901a\u8fc7(1)\u548c(2)\u4e2d\u4f7f\u7528\u7684\u76f8\u540c\u7684\u8f93\u5165\u5904\u7406\u5668\u5904\u7406\u3002 \u8fd9\u79cd\u60c5\u51b5\u4e0e\u524d\u9762\u7684\u60c5\u51b5\u7c7b\u4f3c\uff0c\u53ea\u662f\u8981\u6536\u96c6\u7684\u503c\u662f\u76f4\u63a5\u5206\u914d\u7684\uff0c\u800c\u4e0d\u662f\u4eceXPath\u8868\u8fbe\u5f0f\u6216CSS\u9009\u62e9\u5668\u4e2d\u63d0\u53d6\u7684\u3002\u4f46\u662f\uff0c\u503c\u4ecd\u7136\u901a\u8fc7\u8f93\u5165\u5904\u7406\u5668\u4f20\u9012\u3002\u5728\u672c\u4f8b\u4e2d\uff0c\u7531\u4e8e\u8be5\u503c\u4e0d\u53ef\u8fed\u4ee3\uff0c\u56e0\u6b64\u5728\u5c06\u5176\u4f20\u9012\u7ed9\u8f93\u5165\u5904\u7406\u5668\u4e4b\u524d\uff0c\u5c06\u5176\u8f6c\u6362\u4e3a\u5355\u4e2a\u5143\u7d20\u7684\u53ef\u8fed\u4ee3\u503c\uff0c\u56e0\u4e3a\u8f93\u5165\u5904\u7406\u5668\u603b\u662f\u63a5\u6536\u8fed\u4ee3\u503c\u3002 \u6b65\u9aa4(1)\u3001(2)\u3001(3)\u548c(4)\u4e2d\u6536\u96c6\u7684\u6570\u636e\u901a\u8fc7 name \u5b57\u6bb5\u7684\u8f93\u51fa\u5904\u7406\u5668\u5904\u7406\u3002\u5206\u914d\u7ed9item\u4e2d\u7684 name \u5b57\u6bb5\u7684\u503c\u662f\u8f93\u51fa\u5904\u7406\u5668\u7684\u7ed3\u679c\u3002 \u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u5904\u7406\u5668\u53ea\u662f\u53ef\u8c03\u7528\u7684\u5bf9\u8c61\uff0c\u5b83\u4e0e\u8981\u89e3\u6790\u7684\u6570\u636e\u4e00\u8d77\u88ab\u8c03\u7528\uff0c\u5e76\u8fd4\u56de\u88ab\u89e3\u6790\u7684\u503c\u3002\u56e0\u6b64\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u4efb\u4f55\u51fd\u6570\u4f5c\u4e3a\u8f93\u5165\u6216\u8f93\u51fa\u5904\u7406\u5668\u3002\u552f\u4e00\u7684\u8981\u6c42\u662f\u4ed6\u4eec\u5fc5\u987b\u63a5\u53d7\u4e00\u4e2a(\u800c\u4e14\u53ea\u6709\u4e00\u4e2a)\u4f4d\u7f6e\u53c2\u6570\uff0c\u5b83\u5c06\u4f1a\u662f\u4e00\u4e2a\u8fed\u4ee3\u5668\u3002 \u6ce8\u610f!!!!!! \u8f93\u5165\u548c\u8f93\u51fa\u5904\u7406\u5668\u90fd\u5fc5\u987b\u63a5\u6536\u4e00\u4e2a\u8fed\u4ee3\u5668\u4f5c\u4e3a\u5b83\u4eec\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u3002 \u8fd9\u4e9b\u51fd\u6570\u7684\u8f93\u51fa\u53ef\u4ee5\u662f\u4efb\u4f55\u503c\u3002 \u8f93\u5165\u5904\u7406\u5668\u7684\u7ed3\u679c\u5c06\u9644\u52a0\u5230\u4e00\u4e2a\u5185\u90e8\u5217\u8868(\u5728Loader\u4e2d)\uff0c \u5176\u4e2d\u5305\u542b\u6536\u96c6\u7684\u503c(\u7528\u4e8e\u8be5\u5b57\u6bb5)\u3002 \u6700\u7ec8\u5206\u914d\u7ed9\u8be5item\u7684\u503c\u662f\u8f93\u51fa\u5904\u7406\u5668\u7684\u7ed3\u679c\u3002 \u5982\u679c\u4f60\u60f3\u4f7f\u7528\u4e00\u4e2a\u666e\u901a\u51fd\u6570\u4f5c\u4e3a\u5904\u7406\u5668\uff0c\u786e\u4fdd\u5b83\u63a5\u6536 self \u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u53c2\u6570: def lowercase_processor(self, values): for v in values: yield v.lower() class MyItemLoader(ItemLoader): name_in = lowercase_processor \u8fd9\u662f\u56e0\u4e3a\u6bcf\u5f53\u4e00\u4e2a\u51fd\u6570\u88ab\u8d4b\u503c\u4e3a\u7c7b\u53d8\u91cf\u65f6\uff0c\u5b83\u5c31\u4f1a\u53d8\u6210\u4e00\u4e2a\u65b9\u6cd5\uff0c\u5e76\u5728\u88ab\u8c03\u7528\u65f6\u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u53c2\u6570\u4f20\u9012\u5b9e\u4f8b\u3002\u6709\u5173\u66f4\u591a\u7ec6\u8282\uff0c\u8bf7\u53c2\u9605 stackoverflow\u4e0a\u7684\u56de\u7b54 \u3002 \u60a8\u9700\u8981\u8bb0\u4f4f\u7684\u53e6\u4e00\u4ef6\u4e8b\u662f\uff0c\u8f93\u5165\u5904\u7406\u5668\u8fd4\u56de\u7684\u503c\u662f\u5728\u5185\u90e8(\u5728\u5217\u8868\u4e2d)\u6536\u96c6\u7684\uff0c\u7136\u540e\u4f20\u9012\u7ed9\u8f93\u51fa\u5904\u7406\u5668\u6765\u586b\u5145\u5b57\u6bb5\u7684\u3002 \u6700\u540e\uff0c\u4f46\u4e0d\u662f\u6700\u7ec8\uff0cScrapy\u5185\u7f6e\u4e86\u4e00\u4e9b \u5e38\u7528\u7684\u5904\u7406\u5668 \uff0c\u4ee5\u63d0\u4f9b\u65b9\u4fbf\u3002","title":"\u8f93\u5165/\u8f93\u51fa \u5904\u7406\u5668"},{"location":"2. \u57fa\u672c\u6982\u5ff5/10-itemloaders/#item-loaders","text":"\u901a\u8fc7\u4f7f\u7528\u7c7b\u5b9a\u4e49\u8bed\u6cd5\uff0c\u53ef\u4ee5\u50cfItem\u4e00\u6837\u58f0\u660eItem Loaders\u3002\u8fd9\u662f\u4e00\u4e2a\u4f8b\u5b50: from scrapy.loader import ItemLoader from scrapy.loader.processors import TakeFirst, MapCompose, Join class ProductLoader(ItemLoader): default_output_processor = TakeFirst() name_in = MapCompose(unicode.title) name_out = Join() price_in = MapCompose(unicode.strip) # ... \u53ef\u4ee5\u770b\u5230\uff0c\u8f93\u5165\u5904\u7406\u5668\u4f7f\u7528 _in \u540e\u7f00\u5b9a\u4e49\uff0c\u800c\u8f93\u51fa\u5904\u7406\u5668\u4f7f\u7528 _out \u540e\u7f00\u5b9a\u4e49\u3002\u8fd8\u53ef\u4ee5\u4f7f\u7528 ItemLoader.default_input_processor \u548c ItemLoader.default_output_processor \u5c5e\u6027\u5b9a\u4e49\u9ed8\u8ba4\u7684\u8f93\u5165/\u8f93\u51fa\u5904\u7406\u5668\u3002","title":"\u5b9a\u4e49Item Loaders"},{"location":"2. \u57fa\u672c\u6982\u5ff5/10-itemloaders/#_2","text":"\u5982\u524d\u4e00\u8282\u6240\u793a\uff0c\u53ef\u4ee5\u5728Item Loader\u4e2d\u5b9a\u4e49\u8f93\u5165\u548c\u8f93\u51fa\u5904\u7406\u5668\uff0c\u8fd9\u6837\u5b9a\u4e49\u8f93\u5165\u5904\u7406\u5668\u662f\u5f88\u5e38\u89c1\u7684\u3002\u4f46\u662f\uff0c\u8fd8\u6709\u4e00\u4e2a\u5730\u65b9\u53ef\u4ee5\u6307\u5b9a\u8981\u4f7f\u7528\u7684\u8f93\u5165\u548c\u8f93\u51fa\u5904\u7406\u5668:\u5728 Item Field metadata\u4e2d\u3002\u8fd9\u662f\u4e00\u4e2a\u4f8b\u5b50: import scrapy from scrapy.loader.processors import Join, MapCompose, TakeFirst from w3lib.html import remove_tags def filter_price(value): if value.isdigit(): return value class Product(scrapy.Item): name = scrapy.Field( input_processor=MapCompose(remove_tags), output_processor=Join(), ) price = scrapy.Field( input_processor=MapCompose(remove_tags, filter_price), output_processor=TakeFirst(), ) from scrapy.loader import ItemLoader il = ItemLoader(item=Product()) il.add_value('name', [u'Welcome to my', u' strong website /strong ']) il.add_value('price', [u' euro;', u' span 1000 /span ']) il.load_item() {'name': u'Welcome to my website', 'price': u'1000'} \u8f93\u5165\u548c\u8f93\u51fa\u5904\u7406\u5668\u7684\u4f18\u5148\u987a\u5e8f\u5982\u4e0b: Item Loader\u5b57\u6bb5\u7279\u5b9a\u7684\u5c5e\u6027: field_in \u548c field_out (\u5927\u591a\u6570\u4f18\u5148\u7ea7) \u5b57\u6bb5metadata(input_processor\u548coutput_processor\u952e) \u9ed8\u8ba4ItemLoader: ItemLoader.default_input_processor() \u548c ItemLoader.default_output_processor() (\u6700\u4f4e\u4f18\u5148\u7ea7) \u53c2\u89c1: \u590d\u7528\u548c\u6269\u5c55Item Loaders \u3002","title":"\u5b9a\u4e49\u8f93\u5165/\u8f93\u51fa\u5904\u7406\u5668"},{"location":"2. \u57fa\u672c\u6982\u5ff5/10-itemloaders/#item-loaders-context","text":"Item Loaders Context\u662fItem Loaders\u4e2d\u6240\u6709\u8f93\u5165\u548c\u8f93\u51fa\u5904\u7406\u5668\u5171\u4eab\u7684\u4efb\u610f\u952e/\u503c\u7684\u5b57\u5178\u3002\u5b83\u53ef\u4ee5\u5728\u5b9a\u4e49\u3001\u5b9e\u4f8b\u5316\u6216\u4f7f\u7528Item Loaders\u65f6\u4f20\u9012\u3002\u5b83\u4eec\u7528\u4e8e\u4fee\u6539\u8f93\u5165/\u8f93\u51fa\u5904\u7406\u5668\u7684\u884c\u4e3a\u3002 \u4f8b\u5982\uff0c\u5047\u8bbe\u60a8\u6709\u4e00\u4e2a\u51fd\u6570 parse_length \uff0c\u5b83\u63a5\u6536\u4e00\u4e2a\u6587\u672c\u503c\u5e76\u4ece\u4e2d\u63d0\u53d6\u4e00\u4e2a\u957f\u5ea6: def parse_length(text, loader_context): unit = loader_context.get('unit', 'm') # ... \u89e3\u6790\u957f\u5ea6\u7684\u4ee3\u7801\u5728\u8fd9\u91cc ... return parsed_length \u901a\u8fc7\u63a5\u53d7 loader_context \u53c2\u6570\uff0c\u51fd\u6570\u663e\u5f0f\u5730\u544a\u8bc9Item Loaders\u5b83\u53ef\u4ee5\u63a5\u6536\u4e00\u4e2aItem Loaders Context\uff0c\u56e0\u6b64Item Loaders\u5728\u8c03\u7528\u5b83\u65f6\u4f20\u9012\u5f53\u524d\u6d3b\u52a8\u7684context\uff0c\u56e0\u6b64\u5904\u7406\u5668\u51fd\u6570(\u5728\u672c\u4f8b\u4e2d\u662f parse_length )\u53ef\u4ee5\u4f7f\u7528\u5b83\u4eec\u3002 \u6709\u51e0\u79cd\u65b9\u6cd5\u53ef\u4ee5\u4fee\u6539\u9879\u76eeItem Loader context\u503c: 1.\u901a\u8fc7\u4fee\u6539\u5f53\u524d\u6d3b\u52a8Item Loader context( context \u5c5e\u6027): loader = ItemLoader(product) loader.context['unit'] = 'cm' 2.\u5b9e\u4f8b\u5316Item Loader(Item Loader\u6784\u9020\u51fd\u6570\u7684\u5173\u952e\u5b57\u53c2\u6570\u5b58\u50a8\u5728Item Loader context\u4e2d): loader = ItemLoader(product, unit='cm') 3.\u5b9a\u4e49Item Loader\uff0c\u5bf9\u4e8e\u90a3\u4e9b\u652f\u6301\u7528Item Loader context\u5b9e\u4f8b\u5316\u5b83\u4eec\u7684\u8f93\u5165/\u8f93\u51fa\u5904\u7406\u5668\u3002MapCompose\u5c31\u662f\u5176\u4e2d\u4e4b\u4e00: class ProductLoader(ItemLoader): length_out = MapCompose(parse_length, unit='cm')","title":"Item Loaders Context"},{"location":"2. \u57fa\u672c\u6982\u5ff5/10-itemloaders/#itemloader","text":"","title":"ItemLoader\u5bf9\u8c61"},{"location":"2. \u57fa\u672c\u6982\u5ff5/10-itemloaders/#scrapyloaderitemloaderitem-selector-response-kwargs-class","text":"\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684Item Loader\u6765\u586b\u5145\u7ed9\u5b9a\u7684Item\u3002\u5982\u679c\u6ca1\u6709\u63d0\u4f9b\u4efb\u4f55Item\uff0c\u5219\u4f7f\u7528 default_item_class \u4e2d\u7684\u7c7b\u81ea\u52a8\u5b9e\u4f8b\u5316\u3002 \u5f53\u4f7f\u7528\u9009\u62e9\u5668\u6216response\u53c2\u6570\u5b9e\u4f8b\u5316\u65f6\uff0c ItemLoader \u7c7b\u63d0\u4f9b\u4e86\u4f7f\u7528 \u9009\u62e9\u5668 \u4eceweb\u9875\u9762\u63d0\u53d6\u6570\u636e\u7684\u65b9\u4fbf\u673a\u5236\u3002 \u53c2\u6570: item( Item \u5bf9\u8c61): \u4f7f\u7528 add_xpath() \u3001 add_css() \u6216 add_value() \u7684\u540e\u7eed\u8c03\u7528\u586b\u5145item\u5b9e\u4f8b\u3002 selector( \u9009\u62e9\u5668 \u5bf9\u8c61): \u4f7f\u7528 add_xpath() (resp. add_css() )\u6216 replace_xpath() (resp. replace_css() )\u65b9\u6cd5\u65f6\u8981\u4ece\u4e2d\u63d0\u53d6\u6570\u636e\u7684selector\u3002 response( Response \u5bf9\u8c61): \u4f7f\u7528 default_selector_class \u6784\u9020selector\u7684response\uff0c\u9664\u975eselector\u53c2\u6570\u662f\u7ed9\u5b9a\u7684\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u8be5\u53c2\u6570\u88ab\u5ffd\u7565\u3002 item\u3001selector\u3001response\u548c\u5176\u4f59\u5173\u952e\u5b57\u53c2\u6570\u88ab\u5206\u914d\u7ed9Loader context(\u901a\u8fc7 context \u5c5e\u6027\u53ef\u8bbf\u95ee)\u3002 ItemLoader \u5b9e\u4f8b\u6709\u4ee5\u4e0b\u65b9\u6cd5: get_value(value, *processors, **kwargs) \u901a\u8fc7\u7ed9\u5b9a\u7684 processors \u548c\u5173\u952e\u5b57\u53c2\u6570\u5904\u7406\u7ed9\u5b9a\u7684 value \u3002 \u53ef\u7528\u5173\u952e\u5b57\u53c2\u6570: \u53c2\u6570: re(\u5b57\u7b26\u4e32\u6216compiled regex): \u7528\u4e8e\u4f7f\u7528 extract_regex() \u65b9\u6cd5\u4ece\u7ed9\u5b9a\u503c\u4e2d\u63d0\u53d6\u6570\u636e\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5728\u5904\u7406\u5668\u4e4b\u524d\u5e94\u7528 \u4f8b\u5b50: from scrapy.loader.processors import TakeFirst loader.get_value(u'name: foo', TakeFirst(), unicode.upper, re='name: (.+)') 'FOO` add_value(field_name, value, *processors, **kwargs) \u5904\u7406\u7ed9\u5b9a\u7684\u5b57\u6bb5\u7ed9\u5b9a\u7684\u503c\u3002 \u8be5\u503c\u9996\u5148\u901a\u8fc7 get_value() \u4f20\u9012\u7ed9 processors \u548c kwargs \uff0c\u7136\u540e\u901a\u8fc7 \u5b57\u6bb5\u8f93\u5165\u5904\u7406\u5668 , \u5c06\u5176\u7ed3\u679c\u9644\u52a0\u5230\u4e3a\u8be5\u5b57\u6bb5\u6536\u96c6\u7684\u6570\u636e\u3002\u5982\u679c\u5b57\u6bb5\u5df2\u7ecf\u5305\u542b\u5df2\u6536\u96c6\u7684\u6570\u636e\uff0c\u5219\u6dfb\u52a0\u65b0\u6570\u636e\u3002 \u7ed9\u5b9a\u7684 field_name \u53ef\u4ee5\u662f None \uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u53ef\u80fd\u4f1a\u6dfb\u52a0\u591a\u4e2a\u5b57\u6bb5\u7684\u503c\u3002\u5904\u7406\u540e\u7684\u503c\u5e94\u8be5\u662f\u4e00\u4e2a\u5b57\u5178\uff0c\u5176\u4e2dfield_name\u88ab\u6620\u5c04\u5230\u503c\u3002 \u4f8b\u5b50: loader.add_value('name', u'Color TV') loader.add_value('colours', [u'white', u'blue']) loader.add_value('length', u'100') loader.add_value('name', u'name: foo', TakeFirst(), re='name: (.+)') loader.add_value(None, {'name': u'foo', 'sex': u'male'}) replace_value(field_name, value, *processors, **kwargs) \u4e0e add_value() \u7c7b\u4f3c\uff0c\u4f46\u662f\u4f7f\u7528\u65b0\u503c\u66ff\u6362\u6536\u96c6\u7684\u6570\u636e\uff0c\u800c\u4e0d\u662f\u6dfb\u52a0\u5b83\u3002 get_xpath(xpath, *processors, **kwargs) \u4e0e ItemLoader.get_value() \u7c7b\u4f3c\uff0c\u4f46\u662f\u63a5\u6536\u7684\u662fXPath\u800c\u4e0d\u662f\u503c\uff0c\u8be5\u503c\u7528\u4e8e\u4ece\u4e0e\u8fd9\u4e2a ItemLoader \u5173\u8054\u7684\u9009\u62e9\u5668\u4e2d\u63d0\u53d6unicode\u5b57\u7b26\u4e32\u5217\u8868\u3002 \u53c2\u6570: xpath (str): \u63d0\u53d6\u6570\u636e\u7684Xpath\u8def\u5f84 re (\u5b57\u7b26\u4e32\u6216compiled regex): \u7528\u4e8e\u4ece\u9009\u5b9aXPath\u533a\u57df\u63d0\u53d6\u6570\u636e\u7684\u6b63\u5219\u8868\u8fbe\u5f0f \u4f8b\u5b50: # HTML\u7247\u6bb5: p class= product-name Color TV /p loader.get_xpath('//p[@class= product-name ]') # HTML\u7247\u6bb5: p id= price the price is $1200 /p loader.get_xpath('//p[@id= price ]', TakeFirst(), re='the price is (.*)') add_xpath(field_name, xpath, *processors, **kwargs) \u4e0e ItemLoader.add_value() \u7c7b\u4f3c\uff0c\u4f46\u662f\u63a5\u6536\u7684\u662fXPath\u800c\u4e0d\u662f\u503c\uff0c\u8fd9\u4e2a\u503c\u7528\u4e8e\u4ece\u4e0e\u8fd9\u4e2a ItemLoader \u5173\u8054\u7684\u9009\u62e9\u5668\u4e2d\u63d0\u53d6unicode\u5b57\u7b26\u4e32\u5217\u8868\u3002 \u770b\u4e00\u4e0b get_value() \u7684 kwargs \u53c2\u6570: xpath(str): \u7528\u4e8e\u63d0\u53d6\u6570\u636e\u7684XPath \u4f8b\u5b50: # HTML\u7247\u6bb5: p class= product-name Color TV /p loader.add_xpath('name', '//p[@class= product-name ]') # HTML\u7247\u6bb5: p id= price the price is $1200 /p loader.add_xpath('price', '//p[@id= price ]', re='the price is (.*)') replace_xpath(field_name, xpath, *processors, **kwargs) \u7c7b\u4f3c\u4e8e add_xpath() \uff0c\u4f46\u662f\u66ff\u6362\u6536\u96c6\u7684\u6570\u636e\u800c\u4e0d\u662f\u6dfb\u52a0\u6570\u636e\u3002 get_css(css, *processors, **kwargs) \u4e0e ItemLoader.get_value() \u7c7b\u4f3c\uff0c\u4f46\u662f\u63a5\u6536\u7684\u662fCSS\u9009\u62e9\u5668\u800c\u4e0d\u662f\u503c\uff0c\u8be5\u9009\u62e9\u5668\u7528\u4e8e\u4ece\u4e0e\u8fd9\u4e2a ItemLoader \u5173\u8054\u7684\u9009\u62e9\u5668\u4e2d\u63d0\u53d6unicode\u5b57\u7b26\u4e32\u5217\u8868\u3002 \u53c2\u6570: css (\u5b57\u7b26\u4e32) \u2013 \u8981\u4ece\u4e2d\u63d0\u53d6\u6570\u636e\u7684CSS\u9009\u62e9\u5668 re (\u5b57\u7b26\u4e32\u6216compiled regex) \u2013 \u7528\u4e8e\u4ece\u9009\u5b9a\u7684CSS\u533a\u57df\u4e2d\u63d0\u53d6\u6570\u636e\u7684\u6b63\u5219\u8868\u8fbe\u5f0f \u4f8b\u5b50: # HTML\u7247\u6bb5: p class= product-name Color TV /p loader.get_css('p.product-name') # HTML\u7247\u6bb5: p id= price the price is $1200 /p loader.get_css('p#price', TakeFirst(), re='the price is (.*)') add_css(field_name, css, *processors, **kwargs) \u4e0e ItemLoader.add_value() \u7c7b\u4f3c\uff0c\u4f46\u662f\u63a5\u6536\u7684\u662fCSS\u9009\u62e9\u5668\u800c\u4e0d\u662f\u503c\uff0c\u8be5\u9009\u62e9\u5668\u7528\u4e8e\u4ece\u4e0e\u8fd9\u4e2a ItemLoader \u5173\u8054\u7684\u9009\u62e9\u5668\u4e2d\u63d0\u53d6unicode\u5b57\u7b26\u4e32\u5217\u8868\u3002 \u6709\u5173 kwargs \uff0c\u8bf7\u53c2\u9605 get_css() \u3002 \u53c2\u6570: css (\u5b57\u7b26\u4e32) -\u7528\u6765\u63d0\u53d6\u6570\u636e\u7684css\u9009\u62e9\u5668 \u4f8b\u5b50: # HTML\u7247\u6bb5: p class= product-name Color TV /p loader.add_css('name', 'p.product-name') # HTML\u7247\u6bb5: p id= price the price is $1200 /p loader.add_css('price', 'p#price', re='the price is (.*)') replace_css(field_name, css, *processors, **kwargs) \u7c7b\u4f3c\u4e8e add_css() \uff0c\u4f46\u662f\u66ff\u6362\u6536\u96c6\u7684\u6570\u636e\u800c\u4e0d\u662f\u6dfb\u52a0\u6570\u636e\u3002 load_item() \u7528\u5230\u76ee\u524d\u4e3a\u6b62\u6536\u96c6\u7684\u6570\u636e\u586b\u5145item\uff0c\u5e76\u8fd4\u56de\u5b83\u3002\u9996\u5148\u901a\u8fc7 \u8f93\u51fa\u5904\u7406\u5668 \u83b7\u5f97\u6536\u96c6\u5230\u7684\u6570\u636e\uff0c\u7136\u540e\u5206\u914d\u7ed9item\u91cc\u6bcf\u4e2a\u5b57\u6bb5\u7684\u6700\u7ec8\u503c\u3002 nested_xpath(xpath) \u4f7f\u7528xpath\u9009\u62e9\u5668\u521b\u5efa\u5d4c\u5957\u52a0\u8f7d\u5668( nested loader )\u3002\u6240\u63d0\u4f9b\u7684\u9009\u62e9\u5668\u76f8\u5bf9\u4e8e\u4e0e\u6b64 ItemLoader \u5173\u8054\u7684\u9009\u62e9\u5668\u3002\u5d4c\u5957\u52a0\u8f7d\u5668\u4e0e\u7236\u9879\u76ee\u52a0\u8f7d\u5668\u5171\u4eab Item \uff0c\u56e0\u6b64\u5bf9 add_xpath() \u3001 dd_value() \u3001 replace_value() \u7b49\u7684\u8c03\u7528\u5c06\u6309\u7167\u9884\u671f\u6267\u884c\u3002 nested_css(css) \u7528css\u9009\u62e9\u5668\u521b\u5efa\u5d4c\u5957\u52a0\u8f7d\u5668( nested loader )\u3002\u6240\u63d0\u4f9b\u7684\u9009\u62e9\u5668\u76f8\u5bf9\u4e8e\u4e0e\u6b64 ItemLoader \u5173\u8054\u7684\u9009\u62e9\u5668\u3002\u5d4c\u5957\u52a0\u8f7d\u5668\u4e0e\u7236\u9879\u76ee\u52a0\u8f7d\u5668\u5171\u4eab Item \uff0c\u56e0\u6b64\u5bf9 add_xpath() \u3001 dd_value() \u3001 replace_value() \u7b49\u7684\u8c03\u7528\u5c06\u6309\u7167\u9884\u671f\u6267\u884c\u3002 get_collected_values(field_name) \u8fd4\u56de\u7ed9\u5b9a\u5b57\u6bb5\u6536\u96c6\u5230\u7684\u503c\u3002 get_output_value(field_name) \u8fd4\u56de\u4f7f\u7528\u8f93\u51fa\u5904\u7406\u5668\u5bf9\u7ed9\u5b9a\u5b57\u6bb5\u89e3\u6790\u8fc7\u540e\u7684\u6536\u96c6\u5230\u7684\u503c\u3002\u6b64\u65b9\u6cd5\u6839\u672c\u4e0d\u586b\u5145\u6216\u4fee\u6539item\u3002 get_input_processor(field_name) \u8fd4\u56de\u7ed9\u5b9a\u5b57\u6bb5\u7684\u8f93\u5165\u5904\u7406\u5668\u3002 get_output_processor(field_name) \u8fd4\u56de\u7ed9\u5b9a\u5b57\u6bb5\u7684\u8f93\u51fa\u5904\u7406\u5668\u3002 ItemLoader \u5b9e\u4f8b\u5177\u6709\u4ee5\u4e0b\u5c5e\u6027: item \u7531Item Loader\u89e3\u6790\u7684 Item \u5bf9\u8c61\u3002 context \u6b64Item Loader\u7684\u5f53\u524d\u6d3b\u52a8 \u4e0a\u4e0b\u6587 \u3002 default_item_class \u4e00\u4e2aItem\u7c7b(\u6216\u5de5\u5382)\uff0c\u7528\u4e8e\u5728\u6784\u9020\u51fd\u6570\u4e2d\u672a\u7ed9\u51faitems\u65f6\u5b9e\u4f8b\u5316items\u3002 default_input_processor \u672a\u6307\u5b9a\u5b57\u6bb5\u7684\u9ed8\u8ba4\u8f93\u5165\u5904\u7406\u5668\u3002 default_output_processor \u672a\u6307\u5b9a\u5b57\u6bb5\u7684\u9ed8\u8ba4\u8f93\u51fa\u5904\u7406\u5668\u3002 default_selector_class \u5982\u679c\u6784\u9020\u51fd\u6570\u4e2d\u53ea\u7ed9\u51faresponse\uff0c\u5219\u7528\u4e8e\u6784\u9020\u8fd9\u4e2a ItemLoader \u7684 selector \u7684\u7c7b\u3002\u5982\u679c\u6784\u9020\u51fd\u6570\u4e2d\u63d0\u4f9b\u4e86\u9009\u62e9\u5668\uff0c\u5219\u5ffd\u7565\u6b64\u5c5e\u6027\u3002\u8fd9\u4e2a\u5c5e\u6027\u6709\u65f6\u5728\u5b50\u7c7b\u4e2d\u88ab\u91cd\u5199\u3002 selector \u63d0\u53d6\u6570\u636e\u7684 selector \u5bf9\u8c61\u3002\u5b83\u8981\u4e48\u662f\u6784\u9020\u51fd\u6570\u4e2d\u7ed9\u51fa\u7684selector\uff0c\u8981\u4e48\u662f\u4f7f\u7528 default_selector_class \u4ece\u6784\u9020\u51fd\u6570\u4e2d\u7ed9\u51fa\u7684response\u521b\u5efa\u7684selector\u3002\u8fd9\u4e2a\u5c5e\u6027\u662f\u53ea\u8bfb\u7684\u3002","title":"scrapy.loader.ItemLoader([item, selector, response, ]**kwargs)   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/10-itemloaders/#nested-loaders","text":"\u5f53\u4ece\u6587\u6863\u7684\u4e00\u4e2a\u5c0f\u8282\u89e3\u6790\u76f8\u5173\u503c\u65f6\uff0c\u521b\u5efa\u5d4c\u5957\u52a0\u8f7d\u5668\u662f\u5f88\u6709\u7528\u7684\u3002\u5047\u8bbe\u60a8\u6b63\u5728\u4ece\u9875\u9762\u7684\u9875\u811a\u4e2d\u63d0\u53d6\u7ec6\u8282\uff0c\u8fd9\u4e9b\u9875\u811a\u770b\u8d77\u6765\u5982\u4e0b: \u4f8b\u5b50: footer a class= social href= https://facebook.com/whatever Like Us /a a class= social href= https://twitter.com/whatever Follow Us /a a class= email href= mailto:whatever@example.com Email Us /a /footer \u6ca1\u6709\u5d4c\u5957\u52a0\u8f7d\u5668\uff0c\u60a8\u9700\u8981\u4e3a\u60a8\u5e0c\u671b\u63d0\u53d6\u7684\u6bcf\u4e2a\u503c\u6307\u5b9a\u5b8c\u6574\u7684xpath(\u6216css)\u3002 \u4f8b\u5b50: loader = ItemLoader(item=Item()) # \u52a0\u8f7d\u7684\u4e1c\u897f\u4e0d\u5728\u9875\u811a loader.add_xpath('social', '//footer/a[@class = social ]/@href') loader.add_xpath('email', '//footer/a[@class = email ]/@href') loader.load_item() \u76f8\u53cd\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528footer\u9009\u62e9\u5668\u521b\u5efa\u4e00\u4e2a\u5d4c\u5957\u7684\u52a0\u8f7d\u5668\uff0c\u5e76\u6dfb\u52a0\u76f8\u5bf9\u4e8efooter\u7684\u503c\u3002\u529f\u80fd\u662f\u76f8\u540c\u7684\uff0c\u4f46\u60a8\u53ef\u4ee5\u907f\u514d\u91cd\u590dfooter\u9009\u62e9\u5668\u3002 \u4f8b\u5b50: loader = ItemLoader(item=Item()) # \u52a0\u8f7d\u7684\u4e1c\u897f\u4e0d\u5728\u9875\u811a footer_loader = loader.nested_xpath('//footer') footer_loader.add_xpath('social', 'a[@class = social ]/@href') footer_loader.add_xpath('email', 'a[@class = email ]/@href') # \u4e0d\u9700\u8981\u8c03\u7528footer_loader.load_item() loader.load_item() \u53ef\u4ee5\u4efb\u610f\u5d4c\u5957\u52a0\u8f7d\u5668\uff0c\u5b83\u4eec\u53ef\u4ee5\u4f7f\u7528xpath\u6216css\u9009\u62e9\u5668\u3002\u4f5c\u4e3a\u4e00\u4e2a\u901a\u7528\u65b9\u6cd5\uff0c\u5d4c\u5957\u52a0\u8f7d\u5668\u4f7f\u4ee3\u7801\u66f4\u7b80\u5355\uff0c\u4f46\u53c8\u4e0d\u8fc7\u5206\u5d4c\u5957\uff0c\u6216\u8005\u89e3\u6790\u5668\u53ef\u80fd\u53d8\u5f97\u96be\u4ee5\u9605\u8bfb\u65f6\uff0c\u4f7f\u7528\u5d4c\u5957\u52a0\u8f7d\u5668\u3002","title":"Nested Loaders(\u5d4c\u5957\u52a0\u8f7d\u5668)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/10-itemloaders/#item-loaders_1","text":"\u968f\u7740\u9879\u76ee\u8d8a\u6765\u8d8a\u5927\uff0c\u6709\u8d8a\u6765\u8d8a\u591a\u7684spider\uff0c\u7ef4\u62a4\u5c31\u6210\u4e3a\u4e00\u4e2a\u57fa\u672c\u95ee\u9898\uff0c\u7279\u522b\u662f\u5f53\u60a8\u5fc5\u987b\u4e3a\u6bcf\u4e2a\u722c\u884c\u5668\u5904\u7406\u8bb8\u591a\u4e0d\u540c\u7684\u89e3\u6790\u89c4\u5219\u65f6\uff0c\u6709\u8bb8\u591a\u5f02\u5e38\uff0c\u4f46\u8fd8\u9700\u8981\u590d\u7528\u516c\u5171\u8f93\u5165\u8f93\u51fa\u5904\u7406\u5668\u65f6\u3002 Item Loaders\u65e8\u5728\u51cf\u8f7b\u89e3\u6790\u89c4\u5219\u7684\u7ef4\u62a4\u8d1f\u62c5\uff0c\u540c\u65f6\u4e0d\u4e27\u5931\u7075\u6d3b\u6027\uff0c\u5e76\u4e3a\u6269\u5c55\u548c\u8986\u76d6\u89c4\u5219\u63d0\u4f9b\u65b9\u4fbf\u7684\u673a\u5236\u3002\u56e0\u6b64\uff0cItem Loaders\u652f\u6301\u4f20\u7edf\u7684Python\u7c7b\u7ee7\u627f\uff0c\u4ee5\u5904\u7406\u7279\u5b9aspider(\u6216spider\u7ec4)\u7684\u5dee\u5f02\u3002 \u4f8b\u5982\uff0c\u5047\u8bbe\u67d0\u4e2a\u7279\u5b9a\u7ad9\u70b9\u5c06\u5b83\u4eec\u7684\u4ea7\u54c1\u540d\u79f0\u7528\u4e09\u4e2a\u6a2a\u6760\u62ec\u8d77\u6765(\u4f8b\u5982 --- plasma TV--- )\uff0c\u5e76\u4e14\u60a8\u4e0d\u5e0c\u671b\u5728\u6700\u7ec8\u4ea7\u54c1\u540d\u79f0\u4e2d\u4f7f\u7528\u8fd9\u4e9b\u6a2a\u6760\u3002 \u4e0b\u9762\u4ecb\u7ecd\u5982\u4f55\u901a\u8fc7\u590d\u7528\u548c\u6269\u5c55\u9ed8\u8ba4Product\u7684Item Loaders( ProductLoader )\u6765\u5220\u9664\u8fd9\u4e9b\u6a2a\u6760: from scrapy.loader.processors import MapCompose from myproject.ItemLoaders import ProductLoader def strip_dashes(x): return x.strip('-') class SiteSpecificLoader(ProductLoader): name_in = MapCompose(strip_dashes, ProductLoader.name_in) \u6269\u5c55Item Loaders\u975e\u5e38\u6709\u7528\u7684\u53e6\u4e00\u79cd\u60c5\u51b5\u662f\uff0c\u5f53\u60a8\u6709\u591a\u79cd\u6e90\u683c\u5f0f\u65f6\uff0c\u4f8b\u5982XML\u548cHTML\u3002\u5728XML\u7248\u672c\u4e2d\uff0c\u60a8\u53ef\u80fd\u5e0c\u671b\u5220\u9664\u51fa\u73b0\u7684 CDATA \u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u5982\u4f55\u505a\u5230\u8fd9\u4e00\u70b9\u7684\u4f8b\u5b50: from scrapy.loader.processors import MapCompose from myproject.ItemLoaders import ProductLoader from myproject.utils.xml import remove_cdata class XmlProductLoader(ProductLoader): name_in = MapCompose(remove_cdata, ProductLoader.name_in) \u8fd9\u5c31\u662f\u901a\u5e38\u6269\u5c55\u8f93\u5165\u5904\u7406\u5668\u7684\u65b9\u5f0f\u3002 \u5bf9\u4e8e\u8f93\u51fa\u5904\u7406\u5668\uff0c\u66f4\u5e38\u89c1\u7684\u505a\u6cd5\u662f\u5728\u5b57\u6bb5metadata\u4e2d\u5b9a\u4e49\u5b83\u4eec\uff0c\u56e0\u4e3a\u5b83\u4eec\u901a\u5e38\u53ea\u4f9d\u8d56\u4e8e\u5b57\u6bb5\uff0c\u800c\u4e0d\u4f9d\u8d56\u4e8e\u6bcf\u4e2a\u7279\u5b9a\u7684\u7ad9\u70b9\u89e3\u6790\u89c4\u5219(\u5982\u8f93\u5165\u5904\u7406\u5668)\u3002\u53c2\u89c1: \u8f93\u5165\u548c\u8f93\u51fa\u5904\u7406\u5668\u7684\u5b9a\u4e49 \u3002 \u6709\u8bb8\u591a\u5176\u4ed6\u53ef\u80fd\u7684\u65b9\u6cd5\u53ef\u4ee5\u6269\u5c55\u3001\u7ee7\u627f\u548c\u8986\u76d6Item Loaders\uff0c\u4e0d\u540c\u7684Item Loaders\u5c42\u6b21\u7ed3\u6784\u53ef\u80fd\u66f4\u9002\u5408\u4e0d\u540c\u7684\u9879\u76ee\u3002Scrapy\u53ea\u63d0\u4f9b\u673a\u5236;\u5b83\u4e0d\u4f1a\u5f3a\u5236\u60a8\u7684\u88c5\u8f7d\u5668\u96c6\u5408\u7684\u4efb\u4f55\u7279\u5b9a\u7ec4\u7ec7\u2014\u2014\u8fd9\u53d6\u51b3\u4e8e\u60a8\u548c\u60a8\u7684\u9879\u76ee\u7684\u9700\u6c42\u3002","title":"\u590d\u7528\u548c\u6269\u5c55Item Loaders"},{"location":"2. \u57fa\u672c\u6982\u5ff5/10-itemloaders/#_3","text":"\u5c3d\u7ba1\u60a8\u53ef\u4ee5\u4f7f\u7528\u4efb\u4f55\u53ef\u8c03\u7528\u51fd\u6570\u4f5c\u4e3a\u8f93\u5165\u548c\u8f93\u51fa\u5904\u7406\u5668\uff0c\u4f46Scrapy\u63d0\u4f9b\u4e86\u4e00\u4e9b\u5e38\u7528\u7684\u5904\u7406\u5668\uff0c\u5982\u4e0b\u6240\u8ff0\u3002\u5176\u4e2d\u4e00\u4e9b\u51fd\u6570\uff0c\u5982 MapCompose (\u901a\u5e38\u7528\u4f5c\u8f93\u5165\u5904\u7406\u5668)\uff0c\u8d1f\u8d23\u7ec4\u5408\u6309\u987a\u5e8f\u6267\u884c\u7684\u51e0\u4e2a\u51fd\u6570\u7684\u8f93\u51fa\uff0c\u4ee5\u751f\u6210\u6700\u7ec8\u89e3\u6790\u540e\u7684\u503c\u3002 \u4e0b\u9762\u662f\u6240\u6709\u5185\u7f6e\u5904\u7406\u5668\u7684\u5217\u8868:","title":"\u53ef\u7528\u7684\u5185\u7f6e\u5904\u7406\u5668"},{"location":"2. \u57fa\u672c\u6982\u5ff5/10-itemloaders/#scrapyloaderprocessorsidentity-class","text":"\u6700\u7b80\u5355\u7684\u5904\u7406\u5668\uff0c\u4ec0\u4e48\u90fd\u4e0d\u505a\u3002\u5b83\u8fd4\u56de\u539f\u503c\u4e0d\u53d8\u3002\u5b83\u4e0d\u63a5\u6536\u4efb\u4f55\u6784\u9020\u51fd\u6570\u53c2\u6570\uff0c\u4e5f\u4e0d\u63a5\u53d7\u52a0\u8f7d\u5668\u4e0a\u4e0b\u6587\u3002 \u4f8b\u5b50: from scrapy.loader.processors import Identity proc = Identity() proc(['one', 'two', 'three']) ['one', 'two', 'three']","title":"scrapy.loader.processors.Identity   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/10-itemloaders/#scrapyloaderprocessorstakefirst-class","text":"\u4ece\u63a5\u6536\u5230\u7684\u503c\u8fd4\u56de\u7b2c\u4e00\u4e2a\u975e\u7a7a/\u975e\u7a7a\u503c\uff0c\u56e0\u6b64\u5b83\u901a\u5e38\u4f5c\u4e3a\u8f93\u51fa\u5904\u7406\u5668\u7528\u4e8e\u5355\u503c\u5b57\u6bb5\u3002\u5b83\u4e0d\u63a5\u6536\u4efb\u4f55\u6784\u9020\u51fd\u6570\u53c2\u6570\uff0c\u4e5f\u4e0d\u63a5\u53d7\u52a0\u8f7d\u5668\u4e0a\u4e0b\u6587\u3002 \u4f8b\u5b50: from scrapy.loader.processors import TakeFirst proc = TakeFirst() proc(['', 'one', 'two', 'three']) 'one'","title":"scrapy.loader.processors.TakeFirst   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/10-itemloaders/#scrapyloaderprocessorsjoinseparatoru-class","text":"\u8fd4\u56de\u4e0e\u6784\u9020\u51fd\u6570\u4e2d\u7ed9\u51fa\u7684\u5206\u9694\u7b26\u8fde\u63a5\u7684\u503c\uff0c\u8be5\u5206\u9694\u7b26\u9ed8\u8ba4\u4e3au' '\u3002\u5b83\u4e0d\u63a5\u53d7\u52a0\u8f7d\u5668\u4e0a\u4e0b\u6587\u3002 \u5f53\u4f7f\u7528\u9ed8\u8ba4\u5206\u9694\u7b26\u65f6\uff0c\u8fd9\u4e2a\u5904\u7406\u5668\u76f8\u5f53\u4e8e\u51fd\u6570: u' '.join \u4f8b\u5b50: from scrapy.loader.processors import Join proc = Join() proc(['one', 'two', 'three']) u'one two three' proc = Join(' br ') proc(['one', 'two', 'three']) u'one br two br three'","title":"scrapy.loader.processors.Join(separator=u' ')   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/10-itemloaders/#scrapyloaderprocessorscompose42functions-4242default_loader_context-class","text":"\u7531\u7ed9\u5b9a\u51fd\u6570\u7684\u7ec4\u5408\u6784\u6210\u7684\u5904\u7406\u5668\u3002\u8fd9\u610f\u5473\u7740\u8fd9\u4e2a\u5904\u7406\u5668\u7684\u6bcf\u4e2a\u8f93\u5165\u503c\u90fd\u88ab\u4f20\u9012\u7ed9\u7b2c\u4e00\u4e2a\u51fd\u6570\uff0c\u8fd9\u4e2a\u51fd\u6570\u7684\u7ed3\u679c\u88ab\u4f20\u9012\u7ed9\u7b2c\u4e8c\u4e2a\u51fd\u6570\uff0c\u4ee5\u6b64\u7c7b\u63a8\uff0c\u76f4\u5230\u6700\u540e\u4e00\u4e2a\u51fd\u6570\u8fd4\u56de\u8fd9\u4e2a\u5904\u7406\u5668\u7684\u8f93\u51fa\u503c\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5728 None \u503c\u4e0a\u505c\u6b62\u5904\u7406\u3002\u901a\u8fc7\u4f20\u9012\u5173\u952e\u5b57\u53c2\u6570 stop_on_none=False \u53ef\u4ee5\u6539\u53d8\u8fd9\u79cd\u884c\u4e3a\u3002 \u4f8b\u5b50 from scrapy.loader.processors import Compose proc = Compose(lambda v: v[0], str.upper) proc(['hello', 'world']) 'HELLO' \u6bcf\u4e2a\u51fd\u6570\u90fd\u53ef\u4ee5\u9009\u62e9\u63a5\u6536 loader_context \u53c2\u6570\u3002\u5bf9\u4e8e\u8fd9\u6837\u505a\u7684\uff0c\u8fd9\u4e2a\u5904\u7406\u5668\u5c06\u901a\u8fc7\u8be5\u53c2\u6570\u4f20\u9012\u5f53\u524d\u6d3b\u52a8 \u52a0\u8f7d\u5668\u4e0a\u4e0b\u6587 \u3002 \u5728\u6784\u9020\u51fd\u6570\u4e2d\u4f20\u9012\u7684\u5173\u952e\u5b57\u53c2\u6570\u7528\u4f5c\u4f20\u9012\u7ed9\u6bcf\u4e2a\u51fd\u6570\u8c03\u7528\u7684\u9ed8\u8ba4\u662f\u52a0\u8f7d\u5668\u4e0a\u4e0b\u6587\u503c\u3002\u4f46\u662f\uff0c\u4f20\u9012\u7ed9\u51fd\u6570\u7684\u6700\u7ec8\u52a0\u8f7d\u5668\u4e0a\u4e0b\u6587\u503c\u88ab\u901a\u8fc7 ItemLoader.context() \u5c5e\u6027\u8bbf\u95ee\u7684\u5f53\u524d\u6d3b\u52a8\u52a0\u8f7d\u5668\u4e0a\u4e0b\u6587\u8986\u76d6\u3002","title":"scrapy.loader.processors.Compose(*functions, **default_loader_context)   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/10-itemloaders/#scrapyloaderprocessorsmapcompose42functions-4242default_loader_context-class","text":"\u7531\u7ed9\u5b9a\u51fd\u6570\u7684\u7ec4\u5408\u6784\u6210\u7684\u5904\u7406\u5668\uff0c\u7c7b\u4f3c\u4e8e\u6784\u6210 Compose \u5904\u7406\u5668\u3002\u8fd9\u4e2a\u5904\u7406\u5668\u7684\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\u5185\u90e8\u7ed3\u679c\u5728\u51fd\u6570\u4e4b\u95f4\u4f20\u9012\u7684\u65b9\u5f0f\uff0c\u5982\u4e0b\u6240\u793a: \u8fed\u4ee3\u8be5\u5904\u7406\u5668\u7684\u8f93\u5165\u503c\uff0c\u5e76\u5bf9\u6bcf\u4e2a\u5143\u7d20\u5e94\u7528\u7b2c\u4e00\u4e2a\u51fd\u6570\u3002\u8fd9\u4e9b\u51fd\u6570\u8c03\u7528\u7684\u7ed3\u679c(\u6bcf\u4e2a\u5143\u7d20\u4e00\u4e2a)\u88ab\u8fde\u63a5\u8d77\u6765\uff0c\u4ee5\u6784\u9020\u4e00\u4e2a\u65b0\u7684iterable\uff0c\u7136\u540e\u4f7f\u7528\u5b83\u5e94\u7528\u7b2c\u4e8c\u4e2a\u51fd\u6570\uff0c\u4f9d\u6b64\u7c7b\u63a8\uff0c\u76f4\u5230\u6700\u540e\u4e00\u4e2a\u51fd\u6570\u5e94\u7528\u5230\u5230\u76ee\u524d\u4e3a\u6b62\u6536\u96c6\u7684\u503c\u5217\u8868\u7684\u6bcf\u4e2a\u503c\u4e3a\u6b62\u3002\u6700\u540e\u4e00\u4e2a\u51fd\u6570\u7684\u8f93\u51fa\u503c\u88ab\u8fde\u63a5\u5728\u4e00\u8d77\u4ee5\u4ea7\u751f\u8fd9\u4e2a\u5904\u7406\u5668\u7684\u8f93\u51fa\u3002 \u6bcf\u4e2a\u7279\u5b9a\u7684\u51fd\u6570\u90fd\u53ef\u4ee5\u8fd4\u56de\u4e00\u4e2a\u503c\u6216\u4e00\u4e2a\u503c\u5217\u8868\uff0c\u8fd9\u4e2a\u503c\u5217\u8868\u4e0e\u5e94\u7528\u4e8e\u5176\u4ed6\u8f93\u5165\u503c\u7684\u76f8\u540c\u51fd\u6570\u8fd4\u56de\u7684\u503c\u5217\u8868\u662f\u76f8\u540c\u7684\u3002\u51fd\u6570\u8fd8\u53ef\u4ee5\u8fd4\u56de None \uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u8be5\u51fd\u6570\u7684\u8f93\u51fa\u5c06\u88ab\u5ffd\u7565\uff0c\u4ee5\u4fbf\u5728\u94fe\u4e0a\u8fdb\u884c\u8fdb\u4e00\u6b65\u5904\u7406\u3002 \u8fd9\u4e2a\u5904\u7406\u5668\u63d0\u4f9b\u4e86\u4e00\u79cd\u65b9\u4fbf\u7684\u65b9\u6cd5\u6765\u7ec4\u5408\u53ea\u4f7f\u7528\u5355\u4e2a\u503c(\u800c\u4e0d\u662f\u8fed\u4ee3)\u7684\u51fd\u6570\u3002\u7531\u4e8e\u8fd9\u4e2a\u539f\u56e0\uff0cMapCompose\u5904\u7406\u5668\u901a\u5e38\u7528\u4f5c\u8f93\u5165\u5904\u7406\u5668\uff0c\u56e0\u4e3a\u6570\u636e\u901a\u5e38\u662f\u4f7f\u7528\u9009\u62e9\u5668\u7684extract()\u65b9\u6cd5\u63d0\u53d6\u7684\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2aunicode\u5b57\u7b26\u4e32\u5217\u8868\u3002 \u4e0b\u9762\u7684\u4f8b\u5b50\u5e94\u8be5\u8bf4\u660e\u5b83\u662f\u5982\u4f55\u5de5\u4f5c\u7684:: def filter_world(x): ... return None if x == 'world' else x ... from scrapy.loader.processors import MapCompose proc = MapCompose(filter_world, unicode.upper) proc([u'hello', u'world', u'this', u'is', u'scrapy']) [u'HELLO, u'THIS', u'IS', u'SCRAPY'] \u4e0eCompose\u5904\u7406\u5668\u4e00\u6837\uff0c\u51fd\u6570\u53ef\u4ee5\u63a5\u6536\u88c5\u8f7d\u5668\u4e0a\u4e0b\u6587\uff0c\u800c\u6784\u9020\u51fd\u6570\u5173\u952e\u5b57\u53c2\u6570\u88ab\u7528\u4f5c\u9ed8\u8ba4\u4e0a\u4e0b\u6587\u503c\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Compose \u5904\u7406\u5668\u3002","title":"scrapy.loader.processors.MapCompose(*functions, **default_loader_context)   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/10-itemloaders/#scrapyloaderprocessorsselectjmesjson_path-class","text":"\u4f7f\u7528\u63d0\u4f9b\u7ed9\u6784\u9020\u51fd\u6570\u7684json\u8def\u5f84\u67e5\u8be2\u503c\u5e76\u8fd4\u56de\u8f93\u51fa\u3002\u9700\u8981\u8fd0\u884cjmespath ( https://github.com/jmespath/jmespath.py )\u3002\u8fd9\u4e2a\u5904\u7406\u5668\u4e00\u6b21\u53ea\u63a5\u53d7\u4e00\u4e2a\u8f93\u5165\u3002 \u4f8b\u5b50: from scrapy.loader.processors import SelectJmes, Compose, MapCompose proc = SelectJmes( foo ) # \u76f4\u63a5\u7528\u4e8e\u5217\u8868\u548c\u5b57\u5178 proc({'foo': 'bar'}) 'bar' proc({'foo': {'bar': 'baz'}}) {'bar': 'baz'} \u4e0eJSON\u4e00\u8d77\u5de5\u4f5c: import json proc_single_json_str = Compose(json.loads, SelectJmes( foo )) proc_single_json_str('{ foo : bar }') u'bar' proc_json_list = Compose(json.loads, MapCompose(SelectJmes('foo'))) proc_json_list('[{ foo : bar }, { baz : tar }]') [u'bar']","title":"scrapy.loader.processors.SelectJmes(json_path)   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/11-scrapy_shell/","text":"Scrapy shell(Scrapy\u7ec8\u7aef) Scrapy shell\u662f\u4e00\u4e2a\u4ea4\u4e92\u5f0fshell\uff0c\u60a8\u53ef\u4ee5\u5728\u5176\u4e2d\u5feb\u901f\u5c1d\u8bd5\u548c\u8c03\u8bd5\u6293\u53d6\u4ee3\u7801\uff0c\u800c\u65e0\u9700\u8fd0\u884c\u722c\u884c\u5668\u3002\u5b83\u672c\u6765\u662f\u7528\u6765\u6d4b\u8bd5\u6570\u636e\u63d0\u53d6\u4ee3\u7801\u7684\uff0c\u4f46\u5b9e\u9645\u4e0a\u60a8\u53ef\u4ee5\u7528\u5b83\u6765\u6d4b\u8bd5\u4efb\u4f55\u7c7b\u578b\u7684\u4ee3\u7801\uff0c\u56e0\u4e3a\u5b83\u4e5f\u662f\u4e00\u4e2a\u5e38\u89c4\u7684Python shell\u3002 shell\u7528\u4e8e\u6d4b\u8bd5XPath\u6216CSS\u8868\u8fbe\u5f0f\uff0c\u5e76\u67e5\u770b\u5b83\u4eec\u662f\u5982\u4f55\u5de5\u4f5c\u7684\uff0c\u4ee5\u53ca\u5b83\u4eec\u4ece\u60a8\u8bd5\u56fe\u83b7\u53d6\u7684web\u9875\u9762\u4e2d\u63d0\u53d6\u4e86\u54ea\u4e9b\u6570\u636e\u3002\u5b83\u5141\u8bb8\u60a8\u5728\u7f16\u5199\u722c\u884c\u5668\u65f6\u4ea4\u4e92\u5f0f\u5730\u6d4b\u8bd5\u8868\u8fbe\u5f0f\uff0c\u800c\u65e0\u9700\u8fd0\u884c\u722c\u884c\u5668\u6765\u6d4b\u8bd5\u6bcf\u4e2a\u66f4\u6539\u3002 \u4e00\u65e6\u719f\u6089\u4e86Scrapy shell\uff0c\u60a8\u5c31\u4f1a\u770b\u5230\u5b83\u662f\u5f00\u53d1\u548c\u8c03\u8bd5\u722c\u884c\u5668\u7684\u975e\u5e38\u6709\u7528\u7684\u5de5\u5177\u3002 \u914d\u7f6eshell \u5982\u679c\u5df2\u7ecf\u5b89\u88c5\u4e86 IPython \uff0c\u90a3\u4e48Scrapy shell\u5c06\u4f7f\u7528\u5b83(\u800c\u4e0d\u662f\u6807\u51c6\u7684Python\u63a7\u5236\u53f0)\u3002 IPython \u63a7\u5236\u53f0\u529f\u80fd\u66f4\u52a0\u5f3a\u5927\uff0c\u63d0\u4f9b\u4e86\u667a\u80fd\u81ea\u52a8\u5b8c\u6210\u548c\u5f69\u8272\u8f93\u51fa\u7b49\u529f\u80fd\u3002 \u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u60a8\u5b89\u88c5 IPython \uff0c\u7279\u522b\u662f\u5982\u679c\u60a8\u6b63\u5728\u4f7f\u7528Unix\u7cfb\u7edf( IPython \u64c5\u957f\u7684\u9886\u57df)\u65f6\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 IPython\u5b89\u88c5\u6307\u5357 \u3002 Scrapy\u8fd8\u652f\u6301 bpython \uff0c\u5e76\u5c06\u5728 IPython \u4e0d\u53ef\u7528\u7684\u5730\u65b9\u5c1d\u8bd5\u4f7f\u7528\u5b83\u3002 \u901a\u8fc7scrapy\u7684\u8bbe\u7f6e\uff0c\u60a8\u53ef\u4ee5\u5c06\u5176\u914d\u7f6e\u4e3a\u4efb\u4f55\u4e00\u4e2a ipython \u3001 bpython \u6216\u6807\u51c6 python shell\uff0c\u800c\u4e0d\u7ba1\u5b89\u88c5\u4e86\u54ea\u4e2a\u3002\u8fd9\u662f\u901a\u8fc7\u8bbe\u7f6e SCRAPY_PYTHON_SHELL \u73af\u5883\u53d8\u91cf\u6765\u5b9e\u73b0\u7684;\u6216\u8005\u5728 scrapy.cfg \u4e2d\u5b9a\u4e49\u5b83\u3002 [settings] shell = bpython \u542f\u52a8shell \u8981\u542f\u52a8Scrapy shell\uff0c\u53ef\u4ee5\u4f7f\u7528 shell \u547d\u4ee4\u5982\u4e0b: scrapy shell url \u5176\u4e2d url \u662f\u60a8\u60f3\u8981\u6293\u53d6\u7684\u9875\u9762\u3002 shell \u4e5f\u9002\u7528\u4e8e\u672c\u5730\u6587\u4ef6\u3002\u5982\u679c\u60a8\u60f3\u4f7f\u7528\u4e00\u4e2aweb\u9875\u9762\u7684\u672c\u5730\u526f\u672c\uff0c\u8fd9\u53ef\u80fd\u975e\u5e38\u65b9\u4fbf\u3002 shell \u5bf9\u672c\u5730\u6587\u4ef6\u7406\u89e3\u5982\u4e0b\u8bed\u6cd5: # UNIX-\u6837\u5f0f scrapy shell ./path/to/file.html scrapy shell ../other/path/to/file.html scrapy shell /absolute/path/to/file.html # \u6587\u4ef6URI scrapy shell file:///absolute/path/to/file.html \u5728\u4f7f\u7528\u76f8\u5bf9\u6587\u4ef6\u8def\u5f84\u65f6\uff0c\u8981\u663e\u5f0f\u5730\u5728\u5b83\u4eec\u524d\u9762\u52a0\u4e0a`./`(\u6216`../`)\u3002 `scrapy shell index.html`\u4e0d\u4f1a\u50cf\u9884\u671f\u7684\u90a3\u6837\u5de5\u4f5c(\u8fd9\u662f\u8bbe\u8ba1\u51fa\u6765\u7684\uff0c\u4e0d\u662fbug)\u3002 \u56e0\u4e3a`shell`\u66f4\u559c\u6b22HTTP url\u800c\u4e0d\u662f\u6587\u4ef6uri\u548c`index.html`, \u5728\u8bed\u6cd5\u4e0a\u4e0e`example.com`\u7c7b\u4f3c `shell`\u5c06\u5904\u7406`index.html`\u4f5c\u4e3a\u4e00\u4e2a\u57df\u540d\uff0c\u5e76\u89e6\u53d1\u4e00\u4e2aDNS\u67e5\u627e\u9519\u8bef: $ scrapy shell index.html [ ... scrapy shell starts ... ] [ ... traceback ... ] twisted.internet.error.DNSLookupError: DNS lookup failed: address 'index.html' not found: [Errno -5] No address associated with hostname. \u5982\u679c\u6587\u4ef6\u540d\u4e3a`index.html`\u5e76\u4e14\u5b58\u5728\u4e8e\u5f53\u524d\u76ee\u5f55\u4e2d, `shell`\u5c06\u4e0d\u4f1a\u9884\u5148\u6d4b\u8bd5\u3002\u518d\u6b21,\u8981\u660e\u786e\u3002 \u4f7f\u7528shell Scrapy shell\u53ea\u662f\u4e00\u4e2a\u5e38\u89c4\u7684Python\u63a7\u5236\u53f0(\u5982\u679c\u60a8\u6709\u5b83\u7684\u8bdd\uff0c\u4e5f\u53ef\u4ee5\u79f0\u4e3a IPython \u63a7\u5236\u53f0)\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e9b\u65b9\u4fbf\u7684\u9644\u52a0\u5feb\u6377\u51fd\u6570\u3002 \u53ef\u7528\u7684\u65b9\u6cd5 shelp() : \u5728\u63a7\u5236\u53f0\u6253\u5370\u5e2e\u52a9\u4fe1\u606f\u4ee5\u53ca\u4e00\u7cfb\u5217\u53ef\u7528\u5bf9\u8c61\u7684\u5217\u8868\u548c\u65b9\u6cd5 fetch(url[, redirect=True]) : \u4ece\u7ed9\u5b9a\u7684URL\u83b7\u53d6\u65b0\u7684response\u5e76\u76f8\u5e94\u5730\u66f4\u65b0\u6240\u6709\u76f8\u5173\u5bf9\u8c61\u3002\u60a8\u53ef\u4ee5\u9009\u62e9\u662f\u5426\u9700\u8981HTTP 3xx\u91cd\u5b9a\u5411\uff0c\u4ee5\u907f\u514d\u540e\u7eed\u7684\u4f20\u9012 redirect=False fetch(request) : \u4ece\u7ed9\u5b9a\u7684\u8bf7\u6c42\u4e2d\u83b7\u53d6\u4e00\u4e2a\u65b0\u7684response\uff0c\u5e76\u76f8\u5e94\u5730\u66f4\u65b0\u6240\u6709\u76f8\u5173\u5bf9\u8c61\u3002 view(response) : \u5728\u672c\u5730web\u6d4f\u89c8\u5668\u4e2d\u6253\u5f00\u7ed9\u5b9a\u7684response\uff0c\u4ee5\u4f9b\u68c0\u67e5\u3002\u8fd9\u5c06\u5411\u54cd\u5e94\u4f53\u6dfb\u52a0 base> tag \uff0c\u4ee5\u4fbf\u5916\u90e8\u94fe\u63a5(\u5982\u56fe\u50cf\u548c\u6837\u5f0f\u8868)\u6b63\u786e\u663e\u793a\u3002\u7136\u800c\uff0c\u8bf7\u6ce8\u610f\uff0c\u8fd9\u5c06\u5728\u60a8\u7684\u8ba1\u7b97\u673a\u4e2d\u521b\u5efa\u4e00\u4e2a\u4e34\u65f6\u6587\u4ef6\uff0c\u5b83\u4e0d\u4f1a\u88ab\u81ea\u52a8\u5220\u9664\u3002 \u53ef\u7528\u7684Scrapy\u5bf9\u8c61 Scrapy shell\u81ea\u52a8\u4ece\u4e0b\u8f7d\u7684\u9875\u9762\u521b\u5efa\u4e00\u4e9b\u65b9\u4fbf\u7684\u5bf9\u8c61\uff0c\u6bd4\u5982 Response \u5bf9\u8c61\u548c Selector \u5bf9\u8c61(HTML\u548cXML\u5185\u5bb9)\u3002 \u8fd9\u4e9b\u5bf9\u8c61\u662f: crawler : \u5f53\u524d Crawler \u5bf9\u8c61\u3002 spider : \u5df2\u77e5\u53ef\u4ee5\u5904\u7406URL\u7684Spider\uff0c\u6216\u8005\u5982\u679c\u6ca1\u6709\u4e3a\u5f53\u524dURL\u627e\u5230\u722c\u884c\u5668\uff0c\u5219\u4e3a\u5f53\u524d\u4e3a Spider \u5bf9\u8c61 request : \u4e00\u4e2a Request \u5bf9\u8c61\u7528\u4e8e\u83b7\u53d6\u6700\u65b0\u7684\u9875\u9762\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 replace() \u4fee\u6539\u6b64\u8bf7\u6c42\uff0c\u6216\u8005\u4f7f\u7528 fetch \u5feb\u6377\u65b9\u5f0f\u83b7\u53d6\u65b0\u8bf7\u6c42(\u4e0d\u79bb\u5f00shell)\u3002\u3002 response : \u4e00\u4e2a Response \u5bf9\u8c61\u5305\u62ec\u6700\u540e\u83b7\u53d6\u7684\u9875\u9762 settings : \u5f53\u524dScrapy\u7684\u8bbe\u7f6e shell\u4f1a\u8bdd\u793a\u4f8b \u4e0b\u9762\u662f\u4e00\u4e2a\u5178\u578b\u7684shell\u4f1a\u8bdd\u793a\u4f8b\uff0c\u6211\u4eec\u4ece\u6293\u53d6 https://scrapy.org \u9875\u9762\u5f00\u59cb\uff0c\u7136\u540e\u7ee7\u7eed\u6293\u53d6 https://reddit.com \u9875\u9762\u3002\u6700\u540e\uff0c\u6211\u4eec\u4fee\u6539\u4e86(Reddit)\u8bf7\u6c42\u65b9\u6cd5\u6765\u7528POST\u91cd\u65b0\u53d6\u56de\u5b83\uff0c\u5e76\u5f97\u5230\u4e00\u4e2a\u9519\u8bef\u3002\u6211\u4eec\u901a\u8fc7\u952e\u5165Ctrl-D(\u5728Unix\u7cfb\u7edf\u4e2d)\u6216Ctrl-Z\u6765\u7ed3\u675f\u4f1a\u8bdd\u3002 \u8bf7\u8bb0\u4f4f\uff0c\u8fd9\u91cc\u63d0\u53d6\u7684\u6570\u636e\u5728\u60a8\u5c1d\u8bd5\u65f6\u53ef\u80fd\u4e0d\u662f\u76f8\u540c\u7684\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u9875\u9762\u4e0d\u662f\u9759\u6001\u7684\uff0c\u5e76\u4e14\u5728\u60a8\u8fdb\u884c\u6d4b\u8bd5\u65f6\u53ef\u80fd\u5df2\u7ecf\u53d1\u751f\u4e86\u66f4\u6539\u3002\u8fd9\u4e2a\u793a\u4f8b\u7684\u552f\u4e00\u76ee\u7684\u662f\u8ba9\u60a8\u719f\u6089Scrapy shell\u7684\u5de5\u4f5c\u539f\u7406\u3002 \u9996\u5148\uff0c\u6211\u4eec\u542f\u52a8shell: scrapy shell 'https://scrapy.org' --nolog \u7136\u540e\uff0cshell\u83b7\u53d6URL(\u4f7f\u7528Scrapy downloader)\u5e76\u6253\u5370\u53ef\u7528\u5bf9\u8c61\u5217\u8868\u548c\u6709\u7528\u7684\u5feb\u6377\u65b9\u5f0f(\u60a8\u5c06\u6ce8\u610f\u5230\u8fd9\u4e9b\u884c\u90fd\u4ee5[s]\u524d\u7f00\u5f00\u5934): [s] Available Scrapy objects: [s] scrapy scrapy module (contains scrapy.Request, scrapy.Selector, etc) [s] crawler scrapy.crawler.Crawler object at 0x7f07395dd690 [s] item {} [s] request GET https://scrapy.org [s] response 200 https://scrapy.org/ [s] settings scrapy.settings.Settings object at 0x7f07395dd710 [s] spider DefaultSpider 'default' at 0x7f0735891690 [s] Useful shortcuts: [s] fetch(url[, redirect=True]) Fetch URL and update local objects (by default, redirects are followed) [s] fetch(req) Fetch a scrapy.Request and update local objects [s] shelp() Shell help (print this help) [s] view(response) View response in a browser \u5728\u90a3\u4e4b\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u6f14\u793a\u5bf9\u8c61: response.xpath('//title/text()').extract_first() 'Scrapy | A Fast and Powerful Scraping and Web Crawling Framework' fetch( https://reddit.com ) response.xpath('//title/text()').extract() ['reddit: the front page of the internet'] request = request.replace(method= POST ) fetch(request) response.status 404 from pprint import pprint pprint(response.headers) {'Accept-Ranges': ['bytes'], 'Cache-Control': ['max-age=0, must-revalidate'], 'Content-Type': ['text/html; charset=UTF-8'], 'Date': ['Thu, 08 Dec 2016 16:21:19 GMT'], 'Server': ['snooserv'], 'Set-Cookie': ['loid=KqNLou0V9SKMX4qb4n; Domain=reddit.com; Max-Age=63071999; Path=/; expires=Sat, 08-Dec-2018 16:21:19 GMT; secure', 'loidcreated=2016-12-08T16%3A21%3A19.445Z; Domain=reddit.com; Max-Age=63071999; Path=/; expires=Sat, 08-Dec-2018 16:21:19 GMT; secure', 'loid=vi0ZVe4NkxNWdlH7r7; Domain=reddit.com; Max-Age=63071999; Path=/; expires=Sat, 08-Dec-2018 16:21:19 GMT; secure', 'loidcreated=2016-12-08T16%3A21%3A19.459Z; Domain=reddit.com; Max-Age=63071999; Path=/; expires=Sat, 08-Dec-2018 16:21:19 GMT; secure'], 'Vary': ['accept-encoding'], 'Via': ['1.1 varnish'], 'X-Cache': ['MISS'], 'X-Cache-Hits': ['0'], 'X-Content-Type-Options': ['nosniff'], 'X-Frame-Options': ['SAMEORIGIN'], 'X-Moose': ['majestic'], 'X-Served-By': ['cache-cdg8730-CDG'], 'X-Timer': ['S1481214079.394283,VS0,VE159'], 'X-Ua-Compatible': ['IE=edge'], 'X-Xss-Protection': ['1; mode=block']} \u8c03\u7528spiders\u4e2d\u7684shell\u6765\u68c0\u67e5responses \u6709\u65f6\u5019\uff0c\u60a8\u5e0c\u671b\u68c0\u67e5\u5728\u60a8\u7684\u722c\u884c\u5668\u7684\u67d0\u4e2a\u70b9\u4e0a\u6b63\u5728\u5904\u7406\u7684responses\uff0c\u5982\u679c\u53ea\u662f\u4e3a\u4e86\u68c0\u67e5\u60a8\u671f\u671b\u7684response\u662f\u5426\u5230\u8fbe\u90a3\u91cc\u3002 \u8fd9\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528 scrap.shell.inspect_response \u51fd\u6570\u3002 \u4e0b\u9762\u662f\u4e00\u4e2a\u4f8b\u5b50\uff0c\u544a\u8bc9\u4f60\u5982\u4f55\u4ece\u4f60\u7684spider\u4e2d\u8c03\u7528\u5b83: import scrapy class MySpider(scrapy.Spider): name = myspider start_urls = [ http://example.com , http://example.org , http://example.net , ] def parse(self, response): # \u6211\u4eec\u60f3\u8981\u68c0\u67e5\u4e00\u4e2a\u7279\u5b9a\u7684response. if .org in response.url: from scrapy.shell import inspect_response inspect_response(response, self) # \u89e3\u6790\u4ee3\u7801\u7684\u5176\u4f59\u90e8\u5206. \u5f53\u4f60\u8fd0\u884cspider\u65f6\uff0c\u4f60\u4f1a\u5f97\u5230\u7c7b\u4f3c\u7684\u7ed3\u679c: 2014-01-23 17:48:31-0400 [scrapy.core.engine] DEBUG: Crawled (200) GET http://example.com (referer: None) 2014-01-23 17:48:31-0400 [scrapy.core.engine] DEBUG: Crawled (200) GET http://example.org (referer: None) [s] Available Scrapy objects: [s] crawler scrapy.crawler.Crawler object at 0x1e16b50 ... response.url 'http://example.org' \u7136\u540e\uff0c\u60a8\u53ef\u4ee5\u68c0\u67e5\u63d0\u53d6\u4ee3\u7801\u90e8\u5206\u662f\u5426\u5de5\u4f5c: response.xpath('//h1[@class= fn ]') [] \u4e0d,\u5b83\u4e0d\u662f\u3002\u6240\u4ee5\u4f60\u53ef\u4ee5\u5728\u4f60\u7684web\u6d4f\u89c8\u5668\u4e2d\u6253\u5f00response\uff0c\u770b\u770b\u5b83\u662f\u4e0d\u662f\u4f60\u671f\u671b\u7684response: view(response) True \u6700\u540e\uff0c\u6309Ctrl-D(\u6216\u7a97\u53e3\u4e2d\u7684Ctrl-Z)\u9000\u51fashell\u5e76\u6062\u590d\u722c\u884c: ^D 2014-01-23 17:50:03-0400 [scrapy.core.engine] DEBUG: Crawled (200) GET http://example.net (referer: None) ... \u6ce8\u610f\uff0c\u8fd9\u91cc\u4e0d\u80fd\u4f7f\u7528 fetch \u5feb\u6377\u65b9\u5f0f\uff0c\u56e0\u4e3aScrapy\u5f15\u64ce\u88abshell\u963b\u585e\u3002\u7136\u800c\uff0c\u5728\u4f60\u79bb\u5f00shell\u540e\uff0cspider\u4f1a\u7ee7\u7eed\u5728\u5b83\u505c\u6b62\u7684\u5730\u65b9\u722c\u884c\uff0c\u5982\u4e0a\u6240\u793a\u3002","title":"Scrapy shell(Scrapy\u7ec8\u7aef)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/11-scrapy_shell/#scrapy-shellscrapy","text":"Scrapy shell\u662f\u4e00\u4e2a\u4ea4\u4e92\u5f0fshell\uff0c\u60a8\u53ef\u4ee5\u5728\u5176\u4e2d\u5feb\u901f\u5c1d\u8bd5\u548c\u8c03\u8bd5\u6293\u53d6\u4ee3\u7801\uff0c\u800c\u65e0\u9700\u8fd0\u884c\u722c\u884c\u5668\u3002\u5b83\u672c\u6765\u662f\u7528\u6765\u6d4b\u8bd5\u6570\u636e\u63d0\u53d6\u4ee3\u7801\u7684\uff0c\u4f46\u5b9e\u9645\u4e0a\u60a8\u53ef\u4ee5\u7528\u5b83\u6765\u6d4b\u8bd5\u4efb\u4f55\u7c7b\u578b\u7684\u4ee3\u7801\uff0c\u56e0\u4e3a\u5b83\u4e5f\u662f\u4e00\u4e2a\u5e38\u89c4\u7684Python shell\u3002 shell\u7528\u4e8e\u6d4b\u8bd5XPath\u6216CSS\u8868\u8fbe\u5f0f\uff0c\u5e76\u67e5\u770b\u5b83\u4eec\u662f\u5982\u4f55\u5de5\u4f5c\u7684\uff0c\u4ee5\u53ca\u5b83\u4eec\u4ece\u60a8\u8bd5\u56fe\u83b7\u53d6\u7684web\u9875\u9762\u4e2d\u63d0\u53d6\u4e86\u54ea\u4e9b\u6570\u636e\u3002\u5b83\u5141\u8bb8\u60a8\u5728\u7f16\u5199\u722c\u884c\u5668\u65f6\u4ea4\u4e92\u5f0f\u5730\u6d4b\u8bd5\u8868\u8fbe\u5f0f\uff0c\u800c\u65e0\u9700\u8fd0\u884c\u722c\u884c\u5668\u6765\u6d4b\u8bd5\u6bcf\u4e2a\u66f4\u6539\u3002 \u4e00\u65e6\u719f\u6089\u4e86Scrapy shell\uff0c\u60a8\u5c31\u4f1a\u770b\u5230\u5b83\u662f\u5f00\u53d1\u548c\u8c03\u8bd5\u722c\u884c\u5668\u7684\u975e\u5e38\u6709\u7528\u7684\u5de5\u5177\u3002","title":"Scrapy shell(Scrapy\u7ec8\u7aef)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/11-scrapy_shell/#shell","text":"\u5982\u679c\u5df2\u7ecf\u5b89\u88c5\u4e86 IPython \uff0c\u90a3\u4e48Scrapy shell\u5c06\u4f7f\u7528\u5b83(\u800c\u4e0d\u662f\u6807\u51c6\u7684Python\u63a7\u5236\u53f0)\u3002 IPython \u63a7\u5236\u53f0\u529f\u80fd\u66f4\u52a0\u5f3a\u5927\uff0c\u63d0\u4f9b\u4e86\u667a\u80fd\u81ea\u52a8\u5b8c\u6210\u548c\u5f69\u8272\u8f93\u51fa\u7b49\u529f\u80fd\u3002 \u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u60a8\u5b89\u88c5 IPython \uff0c\u7279\u522b\u662f\u5982\u679c\u60a8\u6b63\u5728\u4f7f\u7528Unix\u7cfb\u7edf( IPython \u64c5\u957f\u7684\u9886\u57df)\u65f6\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 IPython\u5b89\u88c5\u6307\u5357 \u3002 Scrapy\u8fd8\u652f\u6301 bpython \uff0c\u5e76\u5c06\u5728 IPython \u4e0d\u53ef\u7528\u7684\u5730\u65b9\u5c1d\u8bd5\u4f7f\u7528\u5b83\u3002 \u901a\u8fc7scrapy\u7684\u8bbe\u7f6e\uff0c\u60a8\u53ef\u4ee5\u5c06\u5176\u914d\u7f6e\u4e3a\u4efb\u4f55\u4e00\u4e2a ipython \u3001 bpython \u6216\u6807\u51c6 python shell\uff0c\u800c\u4e0d\u7ba1\u5b89\u88c5\u4e86\u54ea\u4e2a\u3002\u8fd9\u662f\u901a\u8fc7\u8bbe\u7f6e SCRAPY_PYTHON_SHELL \u73af\u5883\u53d8\u91cf\u6765\u5b9e\u73b0\u7684;\u6216\u8005\u5728 scrapy.cfg \u4e2d\u5b9a\u4e49\u5b83\u3002 [settings] shell = bpython","title":"\u914d\u7f6eshell"},{"location":"2. \u57fa\u672c\u6982\u5ff5/11-scrapy_shell/#shell_1","text":"\u8981\u542f\u52a8Scrapy shell\uff0c\u53ef\u4ee5\u4f7f\u7528 shell \u547d\u4ee4\u5982\u4e0b: scrapy shell url \u5176\u4e2d url \u662f\u60a8\u60f3\u8981\u6293\u53d6\u7684\u9875\u9762\u3002 shell \u4e5f\u9002\u7528\u4e8e\u672c\u5730\u6587\u4ef6\u3002\u5982\u679c\u60a8\u60f3\u4f7f\u7528\u4e00\u4e2aweb\u9875\u9762\u7684\u672c\u5730\u526f\u672c\uff0c\u8fd9\u53ef\u80fd\u975e\u5e38\u65b9\u4fbf\u3002 shell \u5bf9\u672c\u5730\u6587\u4ef6\u7406\u89e3\u5982\u4e0b\u8bed\u6cd5: # UNIX-\u6837\u5f0f scrapy shell ./path/to/file.html scrapy shell ../other/path/to/file.html scrapy shell /absolute/path/to/file.html # \u6587\u4ef6URI scrapy shell file:///absolute/path/to/file.html \u5728\u4f7f\u7528\u76f8\u5bf9\u6587\u4ef6\u8def\u5f84\u65f6\uff0c\u8981\u663e\u5f0f\u5730\u5728\u5b83\u4eec\u524d\u9762\u52a0\u4e0a`./`(\u6216`../`)\u3002 `scrapy shell index.html`\u4e0d\u4f1a\u50cf\u9884\u671f\u7684\u90a3\u6837\u5de5\u4f5c(\u8fd9\u662f\u8bbe\u8ba1\u51fa\u6765\u7684\uff0c\u4e0d\u662fbug)\u3002 \u56e0\u4e3a`shell`\u66f4\u559c\u6b22HTTP url\u800c\u4e0d\u662f\u6587\u4ef6uri\u548c`index.html`, \u5728\u8bed\u6cd5\u4e0a\u4e0e`example.com`\u7c7b\u4f3c `shell`\u5c06\u5904\u7406`index.html`\u4f5c\u4e3a\u4e00\u4e2a\u57df\u540d\uff0c\u5e76\u89e6\u53d1\u4e00\u4e2aDNS\u67e5\u627e\u9519\u8bef: $ scrapy shell index.html [ ... scrapy shell starts ... ] [ ... traceback ... ] twisted.internet.error.DNSLookupError: DNS lookup failed: address 'index.html' not found: [Errno -5] No address associated with hostname. \u5982\u679c\u6587\u4ef6\u540d\u4e3a`index.html`\u5e76\u4e14\u5b58\u5728\u4e8e\u5f53\u524d\u76ee\u5f55\u4e2d, `shell`\u5c06\u4e0d\u4f1a\u9884\u5148\u6d4b\u8bd5\u3002\u518d\u6b21,\u8981\u660e\u786e\u3002","title":"\u542f\u52a8shell"},{"location":"2. \u57fa\u672c\u6982\u5ff5/11-scrapy_shell/#shell_2","text":"Scrapy shell\u53ea\u662f\u4e00\u4e2a\u5e38\u89c4\u7684Python\u63a7\u5236\u53f0(\u5982\u679c\u60a8\u6709\u5b83\u7684\u8bdd\uff0c\u4e5f\u53ef\u4ee5\u79f0\u4e3a IPython \u63a7\u5236\u53f0)\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e9b\u65b9\u4fbf\u7684\u9644\u52a0\u5feb\u6377\u51fd\u6570\u3002","title":"\u4f7f\u7528shell"},{"location":"2. \u57fa\u672c\u6982\u5ff5/11-scrapy_shell/#_1","text":"shelp() : \u5728\u63a7\u5236\u53f0\u6253\u5370\u5e2e\u52a9\u4fe1\u606f\u4ee5\u53ca\u4e00\u7cfb\u5217\u53ef\u7528\u5bf9\u8c61\u7684\u5217\u8868\u548c\u65b9\u6cd5 fetch(url[, redirect=True]) : \u4ece\u7ed9\u5b9a\u7684URL\u83b7\u53d6\u65b0\u7684response\u5e76\u76f8\u5e94\u5730\u66f4\u65b0\u6240\u6709\u76f8\u5173\u5bf9\u8c61\u3002\u60a8\u53ef\u4ee5\u9009\u62e9\u662f\u5426\u9700\u8981HTTP 3xx\u91cd\u5b9a\u5411\uff0c\u4ee5\u907f\u514d\u540e\u7eed\u7684\u4f20\u9012 redirect=False fetch(request) : \u4ece\u7ed9\u5b9a\u7684\u8bf7\u6c42\u4e2d\u83b7\u53d6\u4e00\u4e2a\u65b0\u7684response\uff0c\u5e76\u76f8\u5e94\u5730\u66f4\u65b0\u6240\u6709\u76f8\u5173\u5bf9\u8c61\u3002 view(response) : \u5728\u672c\u5730web\u6d4f\u89c8\u5668\u4e2d\u6253\u5f00\u7ed9\u5b9a\u7684response\uff0c\u4ee5\u4f9b\u68c0\u67e5\u3002\u8fd9\u5c06\u5411\u54cd\u5e94\u4f53\u6dfb\u52a0 base> tag \uff0c\u4ee5\u4fbf\u5916\u90e8\u94fe\u63a5(\u5982\u56fe\u50cf\u548c\u6837\u5f0f\u8868)\u6b63\u786e\u663e\u793a\u3002\u7136\u800c\uff0c\u8bf7\u6ce8\u610f\uff0c\u8fd9\u5c06\u5728\u60a8\u7684\u8ba1\u7b97\u673a\u4e2d\u521b\u5efa\u4e00\u4e2a\u4e34\u65f6\u6587\u4ef6\uff0c\u5b83\u4e0d\u4f1a\u88ab\u81ea\u52a8\u5220\u9664\u3002","title":"\u53ef\u7528\u7684\u65b9\u6cd5"},{"location":"2. \u57fa\u672c\u6982\u5ff5/11-scrapy_shell/#scrapy","text":"Scrapy shell\u81ea\u52a8\u4ece\u4e0b\u8f7d\u7684\u9875\u9762\u521b\u5efa\u4e00\u4e9b\u65b9\u4fbf\u7684\u5bf9\u8c61\uff0c\u6bd4\u5982 Response \u5bf9\u8c61\u548c Selector \u5bf9\u8c61(HTML\u548cXML\u5185\u5bb9)\u3002 \u8fd9\u4e9b\u5bf9\u8c61\u662f: crawler : \u5f53\u524d Crawler \u5bf9\u8c61\u3002 spider : \u5df2\u77e5\u53ef\u4ee5\u5904\u7406URL\u7684Spider\uff0c\u6216\u8005\u5982\u679c\u6ca1\u6709\u4e3a\u5f53\u524dURL\u627e\u5230\u722c\u884c\u5668\uff0c\u5219\u4e3a\u5f53\u524d\u4e3a Spider \u5bf9\u8c61 request : \u4e00\u4e2a Request \u5bf9\u8c61\u7528\u4e8e\u83b7\u53d6\u6700\u65b0\u7684\u9875\u9762\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 replace() \u4fee\u6539\u6b64\u8bf7\u6c42\uff0c\u6216\u8005\u4f7f\u7528 fetch \u5feb\u6377\u65b9\u5f0f\u83b7\u53d6\u65b0\u8bf7\u6c42(\u4e0d\u79bb\u5f00shell)\u3002\u3002 response : \u4e00\u4e2a Response \u5bf9\u8c61\u5305\u62ec\u6700\u540e\u83b7\u53d6\u7684\u9875\u9762 settings : \u5f53\u524dScrapy\u7684\u8bbe\u7f6e","title":"\u53ef\u7528\u7684Scrapy\u5bf9\u8c61"},{"location":"2. \u57fa\u672c\u6982\u5ff5/11-scrapy_shell/#shell_3","text":"\u4e0b\u9762\u662f\u4e00\u4e2a\u5178\u578b\u7684shell\u4f1a\u8bdd\u793a\u4f8b\uff0c\u6211\u4eec\u4ece\u6293\u53d6 https://scrapy.org \u9875\u9762\u5f00\u59cb\uff0c\u7136\u540e\u7ee7\u7eed\u6293\u53d6 https://reddit.com \u9875\u9762\u3002\u6700\u540e\uff0c\u6211\u4eec\u4fee\u6539\u4e86(Reddit)\u8bf7\u6c42\u65b9\u6cd5\u6765\u7528POST\u91cd\u65b0\u53d6\u56de\u5b83\uff0c\u5e76\u5f97\u5230\u4e00\u4e2a\u9519\u8bef\u3002\u6211\u4eec\u901a\u8fc7\u952e\u5165Ctrl-D(\u5728Unix\u7cfb\u7edf\u4e2d)\u6216Ctrl-Z\u6765\u7ed3\u675f\u4f1a\u8bdd\u3002 \u8bf7\u8bb0\u4f4f\uff0c\u8fd9\u91cc\u63d0\u53d6\u7684\u6570\u636e\u5728\u60a8\u5c1d\u8bd5\u65f6\u53ef\u80fd\u4e0d\u662f\u76f8\u540c\u7684\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u9875\u9762\u4e0d\u662f\u9759\u6001\u7684\uff0c\u5e76\u4e14\u5728\u60a8\u8fdb\u884c\u6d4b\u8bd5\u65f6\u53ef\u80fd\u5df2\u7ecf\u53d1\u751f\u4e86\u66f4\u6539\u3002\u8fd9\u4e2a\u793a\u4f8b\u7684\u552f\u4e00\u76ee\u7684\u662f\u8ba9\u60a8\u719f\u6089Scrapy shell\u7684\u5de5\u4f5c\u539f\u7406\u3002 \u9996\u5148\uff0c\u6211\u4eec\u542f\u52a8shell: scrapy shell 'https://scrapy.org' --nolog \u7136\u540e\uff0cshell\u83b7\u53d6URL(\u4f7f\u7528Scrapy downloader)\u5e76\u6253\u5370\u53ef\u7528\u5bf9\u8c61\u5217\u8868\u548c\u6709\u7528\u7684\u5feb\u6377\u65b9\u5f0f(\u60a8\u5c06\u6ce8\u610f\u5230\u8fd9\u4e9b\u884c\u90fd\u4ee5[s]\u524d\u7f00\u5f00\u5934): [s] Available Scrapy objects: [s] scrapy scrapy module (contains scrapy.Request, scrapy.Selector, etc) [s] crawler scrapy.crawler.Crawler object at 0x7f07395dd690 [s] item {} [s] request GET https://scrapy.org [s] response 200 https://scrapy.org/ [s] settings scrapy.settings.Settings object at 0x7f07395dd710 [s] spider DefaultSpider 'default' at 0x7f0735891690 [s] Useful shortcuts: [s] fetch(url[, redirect=True]) Fetch URL and update local objects (by default, redirects are followed) [s] fetch(req) Fetch a scrapy.Request and update local objects [s] shelp() Shell help (print this help) [s] view(response) View response in a browser \u5728\u90a3\u4e4b\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u6f14\u793a\u5bf9\u8c61: response.xpath('//title/text()').extract_first() 'Scrapy | A Fast and Powerful Scraping and Web Crawling Framework' fetch( https://reddit.com ) response.xpath('//title/text()').extract() ['reddit: the front page of the internet'] request = request.replace(method= POST ) fetch(request) response.status 404 from pprint import pprint pprint(response.headers) {'Accept-Ranges': ['bytes'], 'Cache-Control': ['max-age=0, must-revalidate'], 'Content-Type': ['text/html; charset=UTF-8'], 'Date': ['Thu, 08 Dec 2016 16:21:19 GMT'], 'Server': ['snooserv'], 'Set-Cookie': ['loid=KqNLou0V9SKMX4qb4n; Domain=reddit.com; Max-Age=63071999; Path=/; expires=Sat, 08-Dec-2018 16:21:19 GMT; secure', 'loidcreated=2016-12-08T16%3A21%3A19.445Z; Domain=reddit.com; Max-Age=63071999; Path=/; expires=Sat, 08-Dec-2018 16:21:19 GMT; secure', 'loid=vi0ZVe4NkxNWdlH7r7; Domain=reddit.com; Max-Age=63071999; Path=/; expires=Sat, 08-Dec-2018 16:21:19 GMT; secure', 'loidcreated=2016-12-08T16%3A21%3A19.459Z; Domain=reddit.com; Max-Age=63071999; Path=/; expires=Sat, 08-Dec-2018 16:21:19 GMT; secure'], 'Vary': ['accept-encoding'], 'Via': ['1.1 varnish'], 'X-Cache': ['MISS'], 'X-Cache-Hits': ['0'], 'X-Content-Type-Options': ['nosniff'], 'X-Frame-Options': ['SAMEORIGIN'], 'X-Moose': ['majestic'], 'X-Served-By': ['cache-cdg8730-CDG'], 'X-Timer': ['S1481214079.394283,VS0,VE159'], 'X-Ua-Compatible': ['IE=edge'], 'X-Xss-Protection': ['1; mode=block']}","title":"shell\u4f1a\u8bdd\u793a\u4f8b"},{"location":"2. \u57fa\u672c\u6982\u5ff5/11-scrapy_shell/#spidersshellresponses","text":"\u6709\u65f6\u5019\uff0c\u60a8\u5e0c\u671b\u68c0\u67e5\u5728\u60a8\u7684\u722c\u884c\u5668\u7684\u67d0\u4e2a\u70b9\u4e0a\u6b63\u5728\u5904\u7406\u7684responses\uff0c\u5982\u679c\u53ea\u662f\u4e3a\u4e86\u68c0\u67e5\u60a8\u671f\u671b\u7684response\u662f\u5426\u5230\u8fbe\u90a3\u91cc\u3002 \u8fd9\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528 scrap.shell.inspect_response \u51fd\u6570\u3002 \u4e0b\u9762\u662f\u4e00\u4e2a\u4f8b\u5b50\uff0c\u544a\u8bc9\u4f60\u5982\u4f55\u4ece\u4f60\u7684spider\u4e2d\u8c03\u7528\u5b83: import scrapy class MySpider(scrapy.Spider): name = myspider start_urls = [ http://example.com , http://example.org , http://example.net , ] def parse(self, response): # \u6211\u4eec\u60f3\u8981\u68c0\u67e5\u4e00\u4e2a\u7279\u5b9a\u7684response. if .org in response.url: from scrapy.shell import inspect_response inspect_response(response, self) # \u89e3\u6790\u4ee3\u7801\u7684\u5176\u4f59\u90e8\u5206. \u5f53\u4f60\u8fd0\u884cspider\u65f6\uff0c\u4f60\u4f1a\u5f97\u5230\u7c7b\u4f3c\u7684\u7ed3\u679c: 2014-01-23 17:48:31-0400 [scrapy.core.engine] DEBUG: Crawled (200) GET http://example.com (referer: None) 2014-01-23 17:48:31-0400 [scrapy.core.engine] DEBUG: Crawled (200) GET http://example.org (referer: None) [s] Available Scrapy objects: [s] crawler scrapy.crawler.Crawler object at 0x1e16b50 ... response.url 'http://example.org' \u7136\u540e\uff0c\u60a8\u53ef\u4ee5\u68c0\u67e5\u63d0\u53d6\u4ee3\u7801\u90e8\u5206\u662f\u5426\u5de5\u4f5c: response.xpath('//h1[@class= fn ]') [] \u4e0d,\u5b83\u4e0d\u662f\u3002\u6240\u4ee5\u4f60\u53ef\u4ee5\u5728\u4f60\u7684web\u6d4f\u89c8\u5668\u4e2d\u6253\u5f00response\uff0c\u770b\u770b\u5b83\u662f\u4e0d\u662f\u4f60\u671f\u671b\u7684response: view(response) True \u6700\u540e\uff0c\u6309Ctrl-D(\u6216\u7a97\u53e3\u4e2d\u7684Ctrl-Z)\u9000\u51fashell\u5e76\u6062\u590d\u722c\u884c: ^D 2014-01-23 17:50:03-0400 [scrapy.core.engine] DEBUG: Crawled (200) GET http://example.net (referer: None) ... \u6ce8\u610f\uff0c\u8fd9\u91cc\u4e0d\u80fd\u4f7f\u7528 fetch \u5feb\u6377\u65b9\u5f0f\uff0c\u56e0\u4e3aScrapy\u5f15\u64ce\u88abshell\u963b\u585e\u3002\u7136\u800c\uff0c\u5728\u4f60\u79bb\u5f00shell\u540e\uff0cspider\u4f1a\u7ee7\u7eed\u5728\u5b83\u505c\u6b62\u7684\u5730\u65b9\u722c\u884c\uff0c\u5982\u4e0a\u6240\u793a\u3002","title":"\u8c03\u7528spiders\u4e2d\u7684shell\u6765\u68c0\u67e5responses"},{"location":"2. \u57fa\u672c\u6982\u5ff5/12-item_pipeline/","text":"Item Pipeline(\u6a21\u7ec4\u7ba1\u9053) \u5728\u4e00\u4e2aitem\u88ab\u4e00\u4e2aspider\u6293\u53d6\u540e\uff0c\u5b83\u88ab\u53d1\u9001\u5230Item Pipeline\uff0c\u8be5\u7ba1\u9053\u901a\u8fc7\u987a\u5e8f\u6267\u884c\u7684\u51e0\u4e2a\u7ec4\u4ef6\u5904\u7406\u5b83\u3002 \u6bcf\u4e2aitem pipeline\u7ec4\u4ef6(\u6709\u65f6\u79f0\u4e3a\u201c\u9879\u76ee\u7ba1\u9053\u201d)\u90fd\u662f\u5b9e\u73b0\u7b80\u5355\u65b9\u6cd5\u7684Python\u7c7b\u3002\u4ed6\u4eec\u63a5\u6536\u4e00\u4e2aitem\u5e76\u5bf9\u5176\u6267\u884c\u4e00\u4e2a\u64cd\u4f5c\uff0c\u540c\u65f6\u8fd8\u51b3\u5b9a\u8be5item\u662f\u5426\u5e94\u8be5\u901a\u8fc7\u7ba1\u9053\u7ee7\u7eed\u8fdb\u884c\uff0c\u6216\u8005\u88ab\u5220\u9664\uff0c\u4e0d\u518d\u8fdb\u884c\u5904\u7406\u3002 Item Pipeline\u7684\u5178\u578b\u7528\u9014\u6709: \u6e05\u7406HTML\u6570\u636e \u9a8c\u8bc1\u6293\u53d6\u7684\u6570\u636e(\u68c0\u67e5items\u662f\u5426\u5305\u542b\u67d0\u4e9b\u5b57\u6bb5) \u68c0\u67e5\u526f\u672c(\u5e76\u5220\u9664\u5b83\u4eec) \u5c06\u6293\u53d6\u7684\u6570\u636e\u5b58\u50a8\u5728\u6570\u636e\u5e93\u4e2d \u7f16\u5199\u81ea\u5df1\u7684Item Pipeline \u6bcf\u4e2aItem Pipeline\u7ec4\u4ef6\u90fd\u662fPython\u7c7b\uff0c\u5fc5\u987b\u5b9e\u73b0\u4ee5\u4e0b\u65b9\u6cd5: process_item(self, item, spider) \u5bf9\u4e8e\u6bcf\u4e2aitem pipeline\u7ec4\u4ef6\u8c03\u7528\u6b64\u65b9\u6cd5\u3002 process_item() \u5fc5\u987b:\u8fd4\u56de\u4e00\u4e2a\u5e26\u6709\u6570\u636e\u7684\u5b57\u5178\uff0c\u8fd4\u56de\u4e00\u4e2a Item (\u6216\u4efb\u4f55\u5b50\u7c7b)\u5bf9\u8c61\uff0c\u8fd4\u56de\u4e00\u4e2a Twisted Deferred \u6216\u629b\u51fa DropItem \u5f02\u5e38\u3002\u88ab\u4e22\u5f03\u7684items\u4e0d\u518d\u7531\u5176\u4ed6pipeline\u7ec4\u4ef6\u5904\u7406\u3002 \u53c2\u6570: item ( Item \u5bf9\u8c61\u6216\u4e00\u4e2a\u5b57\u5178) - \u6293\u53d6\u7684item spider ( Spider \u5bf9\u8c61) - \u54ea\u4e2aspider\u6293\u53d6\u7684item \u6b64\u5916\uff0c\u5b83\u4eec\u8fd8\u53ef\u4ee5\u6267\u884c\u4e0b\u5217\u65b9\u6cd5: open_spider(self, spider) \u5f53\u542f\u52a8spider\u65f6\u8c03\u7528\u6b64\u65b9\u6cd5\u3002 \u53c2\u6570: spider (Spider\u5bf9\u8c61) \u2013 spider\u542f\u52a8\u7684\u65f6\u5019 close_spider(self, spider) \u5728\u5173\u95edspider\u65f6\u8c03\u7528\u6b64\u65b9\u6cd5\u3002 \u53c2\u6570: spider (Spider\u5bf9\u8c61) \u2013 spider\u5173\u95ed\u7684\u65f6\u5019 from_crawler(cls, crawler) \u5982\u679c\u5b58\u5728\uff0c\u5219\u8c03\u7528\u8fd9\u4e2a\u7c7b\u65b9\u6cd5\u662f\u4e3a\u4e86\u4ece Crawler \u4e2d\u521b\u5efa\u4e00\u4e2a\u7ba1\u9053\u5b9e\u4f8b\u3002\u5b83\u5fc5\u987b\u8fd4\u56depipeline\u7684\u65b0\u5b9e\u4f8b\u3002Crawler\u5bf9\u8c61\u63d0\u4f9b\u8bbf\u95ee\u6240\u6709Scrapy\u7684\u6838\u5fc3\u7ec4\u4ef6\uff0c\u5982settings(\u8bbe\u7f6e)\u548csignals(\u4fe1\u53f7);\u8fd9\u662f\u4e00\u79cdpipeline\u8bbf\u95ee\u5b83\u4eec\u5e76\u5c06\u5176\u529f\u80fd\u8fde\u63a5\u5230Scrapy\u7684\u65b9\u6cd5\u3002 \u53c2\u6570: crawler (Crawler\u5bf9\u8c61) \u2013 \u4f7f\u7528\u8fd9\u4e2apipeline\u7684crawler Item pipeline\u7684\u4f8b\u5b50 \u4ef7\u683c\u9a8c\u8bc1\u548c\u6ca1\u6709\u4ef7\u683c\u5c31\u5220\u6389items \u8ba9\u6211\u4eec\u6765\u770b\u770b\u4e0b\u9762\u8fd9\u4e2a\u5047\u60f3\u7684\u7ba1\u9053\uff0c\u5b83\u8c03\u6574\u4e0d\u5305\u542bVAT ( price_exclude des_vat \u5c5e\u6027)\u7684items\u7684 price \u5c5e\u6027\uff0c\u5e76\u5220\u9664\u4e0d\u5305\u542bprice\u7684\u6761\u76ee: from scrapy.exceptions import DropItem class PricePipeline(object): vat_factor = 1.15 def process_item(self, item, spider): if item['price']: if item['price_excludes_vat']: item['price'] = item['price'] * self.vat_factor return item else: raise DropItem( Missing price in %s % item) \u5c06items\u5199\u5165JSON\u6587\u4ef6 \u4e0b\u9762\u7684\u7ba1\u9053\u5c06\u6240\u6709spiders\u4e2d\u6293\u53d6\u6240\u6709\u7684items\u5b58\u50a8\u4e3a\u5355\u4e2a items.jl \u6587\u4ef6\uff0c\u6bcf\u884c\u5305\u542b\u4e00\u4e2aitem\uff0c\u4ee5JSON\u683c\u5f0f\u5e8f\u5217\u5316: import json class JsonWriterPipeline(object): def open_spider(self, spider): self.file = open('items.jl', 'w') def close_spider(self, spider): self.file.close() def process_item(self, item, spider): line = json.dumps(dict(item)) + \\n self.file.write(line) return item JsonWriterPipeline\u7684\u76ee\u7684\u662f\u4ecb\u7ecd\u5982\u4f55\u7f16\u5199Item pipeline\u3002 \u5982\u679c\u60a8\u771f\u7684\u60f3\u5c06\u6240\u6709\u6293\u53d6\u7684items\u5230JSON\u6587\u4ef6\u4e2d\uff0c\u90a3\u4e48\u5e94\u8be5\u4f7f\u7528Feed exports\u3002 \u5411MongoDB\u5199\u5165items \u5728\u672c\u4f8b\u4e2d\uff0c\u6211\u4eec\u5c06\u4f7f\u7528 pymongo \u5c06items\u5199\u5165 MongoDB \u3002MongoDB\u5730\u5740\u548c\u6570\u636e\u5e93\u540d\u5728Scrapy settings\u4e2d\u6307\u5b9a;MongoDB\u96c6\u5408\u662f\u4ee5item\u7c7b\u547d\u540d\u7684\u3002 \u8fd9\u4e2a\u4f8b\u5b50\u7684\u91cd\u70b9\u662f\u5c55\u793a\u5982\u4f55\u4f7f\u7528 from_crawler() \u65b9\u6cd5\u4ee5\u53ca\u5982\u4f55\u6b63\u786e\u6e05\u7406\u8d44\u6e90\u3002 import pymongo class MongoPipeline(object): collection_name = 'scrapy_items' def __init__(self, mongo_uri, mongo_db): self.mongo_uri = mongo_uri self.mongo_db = mongo_db @classmethod def from_crawler(cls, crawler): return cls( mongo_uri=crawler.settings.get('MONGO_URI'), mongo_db=crawler.settings.get('MONGO_DATABASE', 'items') ) def open_spider(self, spider): self.client = pymongo.MongoClient(self.mongo_uri) self.db = self.client[self.mongo_db] def close_spider(self, spider): self.client.close() def process_item(self, item, spider): self.db[self.collection_name].insert_one(dict(item)) return item item\u622a\u56fe \u8fd9\u4e2a\u4f8b\u5b50\u6f14\u793a\u4e86\u5982\u4f55\u4ece process_item() \u65b9\u6cd5\u91cc Deferred(\u5ef6\u8fdf) \u8fd4\u56de\u3002\u5b83\u4f7f\u7528 Splash \u6765render item url\u7684\u5c4f\u5e55\u622a\u56fe\u3002Pipeline\u8bf7\u6c42\u672c\u5730\u8fd0\u884c Splash \u5b9e\u4f8b\u3002\u5728\u4e0b\u8f7d\u8bf7\u6c42\u5e76\u5ef6\u8fdf\u56de\u8c03\u89e6\u53d1\u540e\uff0c\u5b83\u5c06item\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d\uff0c\u5e76\u5c06\u6587\u4ef6\u540d\u6dfb\u52a0\u5230item\u4e2d\u3002 import scrapy import hashlib from urllib.parse import quote class ScreenshotPipeline(object): \u4f7f\u7528Splash\u6765render\u6bcf\u4e2aScrapy item\u7684\u5c4f\u5e55\u622a\u56fe. SPLASH_URL = http://localhost:8050/render.png?url={} def process_item(self, item, spider): encoded_item_url = quote(item[ url ]) screenshot_url = self.SPLASH_URL.format(encoded_item_url) request = scrapy.Request(screenshot_url) dfd = spider.crawler.engine.download(request, spider) dfd.addBoth(self.return_item, item) return dfd def return_item(self, response, item): if response.status != 200: # \u53d1\u751f\u9519\u8bef\uff0c\u8fd4\u56deitem. return item # \u4fdd\u5b58\u622a\u56fe\u5230\u6587\u4ef6\uff0c\u6587\u4ef6\u540d\u5c06\u662furl\u7684\u54c8\u5e0c. url = item[ url ] url_hash = hashlib.md5(url.encode( utf8 )).hexdigest() filename = {}.png .format(url_hash) with open(filename, wb ) as f: f.write(response.body) # \u5728item\u4e2d\u5b58\u50a8\u6587\u4ef6\u540d. item[ screenshot_filename ] = filename return item Duplicates filter(\u91cd\u590d\u8fc7\u6ee4\u5668) \u4e00\u4e2a\u67e5\u627e\u91cd\u590ditems\u7684\u8fc7\u6ee4\u5668\uff0c\u5e76\u5220\u9664\u5df2\u5904\u7406\u7684items\u3002\u5047\u8bbe\u6211\u4eec\u7684item\u6709\u4e00\u4e2a\u552f\u4e00\u7684id\uff0c\u4f46\u662fspider\u8fd4\u56de\u591a\u4e2a\u5177\u6709\u76f8\u540cid\u7684items: from scrapy.exceptions import DropItem class DuplicatesPipeline(object): def __init__(self): self.ids_seen = set() def process_item(self, item, spider): if item['id'] in self.ids_seen: raise DropItem( Duplicate item found: %s % item) else: self.ids_seen.add(item['id']) return item \u6fc0\u6d3bItem pipeline\u7ec4\u4ef6 \u8981\u6fc0\u6d3bItem pipeline\u7ec4\u4ef6\uff0c\u5fc5\u987b\u5c06\u5176\u7c7b\u6dfb\u52a0\u5230 item_pipeline setting\u4e2d\uff0c\u5982\u4e0b\u4f8b\u6240\u793a: ITEM_PIPELINES = { 'myproject.pipelines.PricePipeline': 300, 'myproject.pipelines.JsonWriterPipeline': 800, } \u5728\u8fd9\u4e2asetting\u4e2d\uff0c\u60a8\u4e3a\u7c7b\u5206\u914d\u7684\u6574\u6570\u503c\u51b3\u5b9a\u4e86\u5b83\u4eec\u8fd0\u884c\u7684\u987a\u5e8f:items\u4ece\u4f4e\u503c\u7c7b\u5230\u9ad8\u503c\u7c7b\u3002\u901a\u5e38\u57280-1000\u8303\u56f4\u5185\u5b9a\u4e49\u8fd9\u4e9b\u6570\u5b57\u3002","title":"Item Pipeline(\u6a21\u7ec4\u7ba1\u9053)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/12-item_pipeline/#item-pipeline","text":"\u5728\u4e00\u4e2aitem\u88ab\u4e00\u4e2aspider\u6293\u53d6\u540e\uff0c\u5b83\u88ab\u53d1\u9001\u5230Item Pipeline\uff0c\u8be5\u7ba1\u9053\u901a\u8fc7\u987a\u5e8f\u6267\u884c\u7684\u51e0\u4e2a\u7ec4\u4ef6\u5904\u7406\u5b83\u3002 \u6bcf\u4e2aitem pipeline\u7ec4\u4ef6(\u6709\u65f6\u79f0\u4e3a\u201c\u9879\u76ee\u7ba1\u9053\u201d)\u90fd\u662f\u5b9e\u73b0\u7b80\u5355\u65b9\u6cd5\u7684Python\u7c7b\u3002\u4ed6\u4eec\u63a5\u6536\u4e00\u4e2aitem\u5e76\u5bf9\u5176\u6267\u884c\u4e00\u4e2a\u64cd\u4f5c\uff0c\u540c\u65f6\u8fd8\u51b3\u5b9a\u8be5item\u662f\u5426\u5e94\u8be5\u901a\u8fc7\u7ba1\u9053\u7ee7\u7eed\u8fdb\u884c\uff0c\u6216\u8005\u88ab\u5220\u9664\uff0c\u4e0d\u518d\u8fdb\u884c\u5904\u7406\u3002 Item Pipeline\u7684\u5178\u578b\u7528\u9014\u6709: \u6e05\u7406HTML\u6570\u636e \u9a8c\u8bc1\u6293\u53d6\u7684\u6570\u636e(\u68c0\u67e5items\u662f\u5426\u5305\u542b\u67d0\u4e9b\u5b57\u6bb5) \u68c0\u67e5\u526f\u672c(\u5e76\u5220\u9664\u5b83\u4eec) \u5c06\u6293\u53d6\u7684\u6570\u636e\u5b58\u50a8\u5728\u6570\u636e\u5e93\u4e2d","title":"Item Pipeline(\u6a21\u7ec4\u7ba1\u9053)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/12-item_pipeline/#item-pipeline_1","text":"\u6bcf\u4e2aItem Pipeline\u7ec4\u4ef6\u90fd\u662fPython\u7c7b\uff0c\u5fc5\u987b\u5b9e\u73b0\u4ee5\u4e0b\u65b9\u6cd5: process_item(self, item, spider) \u5bf9\u4e8e\u6bcf\u4e2aitem pipeline\u7ec4\u4ef6\u8c03\u7528\u6b64\u65b9\u6cd5\u3002 process_item() \u5fc5\u987b:\u8fd4\u56de\u4e00\u4e2a\u5e26\u6709\u6570\u636e\u7684\u5b57\u5178\uff0c\u8fd4\u56de\u4e00\u4e2a Item (\u6216\u4efb\u4f55\u5b50\u7c7b)\u5bf9\u8c61\uff0c\u8fd4\u56de\u4e00\u4e2a Twisted Deferred \u6216\u629b\u51fa DropItem \u5f02\u5e38\u3002\u88ab\u4e22\u5f03\u7684items\u4e0d\u518d\u7531\u5176\u4ed6pipeline\u7ec4\u4ef6\u5904\u7406\u3002 \u53c2\u6570: item ( Item \u5bf9\u8c61\u6216\u4e00\u4e2a\u5b57\u5178) - \u6293\u53d6\u7684item spider ( Spider \u5bf9\u8c61) - \u54ea\u4e2aspider\u6293\u53d6\u7684item \u6b64\u5916\uff0c\u5b83\u4eec\u8fd8\u53ef\u4ee5\u6267\u884c\u4e0b\u5217\u65b9\u6cd5: open_spider(self, spider) \u5f53\u542f\u52a8spider\u65f6\u8c03\u7528\u6b64\u65b9\u6cd5\u3002 \u53c2\u6570: spider (Spider\u5bf9\u8c61) \u2013 spider\u542f\u52a8\u7684\u65f6\u5019 close_spider(self, spider) \u5728\u5173\u95edspider\u65f6\u8c03\u7528\u6b64\u65b9\u6cd5\u3002 \u53c2\u6570: spider (Spider\u5bf9\u8c61) \u2013 spider\u5173\u95ed\u7684\u65f6\u5019 from_crawler(cls, crawler) \u5982\u679c\u5b58\u5728\uff0c\u5219\u8c03\u7528\u8fd9\u4e2a\u7c7b\u65b9\u6cd5\u662f\u4e3a\u4e86\u4ece Crawler \u4e2d\u521b\u5efa\u4e00\u4e2a\u7ba1\u9053\u5b9e\u4f8b\u3002\u5b83\u5fc5\u987b\u8fd4\u56depipeline\u7684\u65b0\u5b9e\u4f8b\u3002Crawler\u5bf9\u8c61\u63d0\u4f9b\u8bbf\u95ee\u6240\u6709Scrapy\u7684\u6838\u5fc3\u7ec4\u4ef6\uff0c\u5982settings(\u8bbe\u7f6e)\u548csignals(\u4fe1\u53f7);\u8fd9\u662f\u4e00\u79cdpipeline\u8bbf\u95ee\u5b83\u4eec\u5e76\u5c06\u5176\u529f\u80fd\u8fde\u63a5\u5230Scrapy\u7684\u65b9\u6cd5\u3002 \u53c2\u6570: crawler (Crawler\u5bf9\u8c61) \u2013 \u4f7f\u7528\u8fd9\u4e2apipeline\u7684crawler","title":"\u7f16\u5199\u81ea\u5df1\u7684Item Pipeline"},{"location":"2. \u57fa\u672c\u6982\u5ff5/12-item_pipeline/#item-pipeline_2","text":"","title":"Item pipeline\u7684\u4f8b\u5b50"},{"location":"2. \u57fa\u672c\u6982\u5ff5/12-item_pipeline/#items","text":"\u8ba9\u6211\u4eec\u6765\u770b\u770b\u4e0b\u9762\u8fd9\u4e2a\u5047\u60f3\u7684\u7ba1\u9053\uff0c\u5b83\u8c03\u6574\u4e0d\u5305\u542bVAT ( price_exclude des_vat \u5c5e\u6027)\u7684items\u7684 price \u5c5e\u6027\uff0c\u5e76\u5220\u9664\u4e0d\u5305\u542bprice\u7684\u6761\u76ee: from scrapy.exceptions import DropItem class PricePipeline(object): vat_factor = 1.15 def process_item(self, item, spider): if item['price']: if item['price_excludes_vat']: item['price'] = item['price'] * self.vat_factor return item else: raise DropItem( Missing price in %s % item)","title":"\u4ef7\u683c\u9a8c\u8bc1\u548c\u6ca1\u6709\u4ef7\u683c\u5c31\u5220\u6389items"},{"location":"2. \u57fa\u672c\u6982\u5ff5/12-item_pipeline/#itemsjson","text":"\u4e0b\u9762\u7684\u7ba1\u9053\u5c06\u6240\u6709spiders\u4e2d\u6293\u53d6\u6240\u6709\u7684items\u5b58\u50a8\u4e3a\u5355\u4e2a items.jl \u6587\u4ef6\uff0c\u6bcf\u884c\u5305\u542b\u4e00\u4e2aitem\uff0c\u4ee5JSON\u683c\u5f0f\u5e8f\u5217\u5316: import json class JsonWriterPipeline(object): def open_spider(self, spider): self.file = open('items.jl', 'w') def close_spider(self, spider): self.file.close() def process_item(self, item, spider): line = json.dumps(dict(item)) + \\n self.file.write(line) return item JsonWriterPipeline\u7684\u76ee\u7684\u662f\u4ecb\u7ecd\u5982\u4f55\u7f16\u5199Item pipeline\u3002 \u5982\u679c\u60a8\u771f\u7684\u60f3\u5c06\u6240\u6709\u6293\u53d6\u7684items\u5230JSON\u6587\u4ef6\u4e2d\uff0c\u90a3\u4e48\u5e94\u8be5\u4f7f\u7528Feed exports\u3002","title":"\u5c06items\u5199\u5165JSON\u6587\u4ef6"},{"location":"2. \u57fa\u672c\u6982\u5ff5/12-item_pipeline/#mongodbitems","text":"\u5728\u672c\u4f8b\u4e2d\uff0c\u6211\u4eec\u5c06\u4f7f\u7528 pymongo \u5c06items\u5199\u5165 MongoDB \u3002MongoDB\u5730\u5740\u548c\u6570\u636e\u5e93\u540d\u5728Scrapy settings\u4e2d\u6307\u5b9a;MongoDB\u96c6\u5408\u662f\u4ee5item\u7c7b\u547d\u540d\u7684\u3002 \u8fd9\u4e2a\u4f8b\u5b50\u7684\u91cd\u70b9\u662f\u5c55\u793a\u5982\u4f55\u4f7f\u7528 from_crawler() \u65b9\u6cd5\u4ee5\u53ca\u5982\u4f55\u6b63\u786e\u6e05\u7406\u8d44\u6e90\u3002 import pymongo class MongoPipeline(object): collection_name = 'scrapy_items' def __init__(self, mongo_uri, mongo_db): self.mongo_uri = mongo_uri self.mongo_db = mongo_db @classmethod def from_crawler(cls, crawler): return cls( mongo_uri=crawler.settings.get('MONGO_URI'), mongo_db=crawler.settings.get('MONGO_DATABASE', 'items') ) def open_spider(self, spider): self.client = pymongo.MongoClient(self.mongo_uri) self.db = self.client[self.mongo_db] def close_spider(self, spider): self.client.close() def process_item(self, item, spider): self.db[self.collection_name].insert_one(dict(item)) return item","title":"\u5411MongoDB\u5199\u5165items"},{"location":"2. \u57fa\u672c\u6982\u5ff5/12-item_pipeline/#item","text":"\u8fd9\u4e2a\u4f8b\u5b50\u6f14\u793a\u4e86\u5982\u4f55\u4ece process_item() \u65b9\u6cd5\u91cc Deferred(\u5ef6\u8fdf) \u8fd4\u56de\u3002\u5b83\u4f7f\u7528 Splash \u6765render item url\u7684\u5c4f\u5e55\u622a\u56fe\u3002Pipeline\u8bf7\u6c42\u672c\u5730\u8fd0\u884c Splash \u5b9e\u4f8b\u3002\u5728\u4e0b\u8f7d\u8bf7\u6c42\u5e76\u5ef6\u8fdf\u56de\u8c03\u89e6\u53d1\u540e\uff0c\u5b83\u5c06item\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d\uff0c\u5e76\u5c06\u6587\u4ef6\u540d\u6dfb\u52a0\u5230item\u4e2d\u3002 import scrapy import hashlib from urllib.parse import quote class ScreenshotPipeline(object): \u4f7f\u7528Splash\u6765render\u6bcf\u4e2aScrapy item\u7684\u5c4f\u5e55\u622a\u56fe. SPLASH_URL = http://localhost:8050/render.png?url={} def process_item(self, item, spider): encoded_item_url = quote(item[ url ]) screenshot_url = self.SPLASH_URL.format(encoded_item_url) request = scrapy.Request(screenshot_url) dfd = spider.crawler.engine.download(request, spider) dfd.addBoth(self.return_item, item) return dfd def return_item(self, response, item): if response.status != 200: # \u53d1\u751f\u9519\u8bef\uff0c\u8fd4\u56deitem. return item # \u4fdd\u5b58\u622a\u56fe\u5230\u6587\u4ef6\uff0c\u6587\u4ef6\u540d\u5c06\u662furl\u7684\u54c8\u5e0c. url = item[ url ] url_hash = hashlib.md5(url.encode( utf8 )).hexdigest() filename = {}.png .format(url_hash) with open(filename, wb ) as f: f.write(response.body) # \u5728item\u4e2d\u5b58\u50a8\u6587\u4ef6\u540d. item[ screenshot_filename ] = filename return item","title":"item\u622a\u56fe"},{"location":"2. \u57fa\u672c\u6982\u5ff5/12-item_pipeline/#duplicates-filter","text":"\u4e00\u4e2a\u67e5\u627e\u91cd\u590ditems\u7684\u8fc7\u6ee4\u5668\uff0c\u5e76\u5220\u9664\u5df2\u5904\u7406\u7684items\u3002\u5047\u8bbe\u6211\u4eec\u7684item\u6709\u4e00\u4e2a\u552f\u4e00\u7684id\uff0c\u4f46\u662fspider\u8fd4\u56de\u591a\u4e2a\u5177\u6709\u76f8\u540cid\u7684items: from scrapy.exceptions import DropItem class DuplicatesPipeline(object): def __init__(self): self.ids_seen = set() def process_item(self, item, spider): if item['id'] in self.ids_seen: raise DropItem( Duplicate item found: %s % item) else: self.ids_seen.add(item['id']) return item","title":"Duplicates filter(\u91cd\u590d\u8fc7\u6ee4\u5668)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/12-item_pipeline/#item-pipeline_3","text":"\u8981\u6fc0\u6d3bItem pipeline\u7ec4\u4ef6\uff0c\u5fc5\u987b\u5c06\u5176\u7c7b\u6dfb\u52a0\u5230 item_pipeline setting\u4e2d\uff0c\u5982\u4e0b\u4f8b\u6240\u793a: ITEM_PIPELINES = { 'myproject.pipelines.PricePipeline': 300, 'myproject.pipelines.JsonWriterPipeline': 800, } \u5728\u8fd9\u4e2asetting\u4e2d\uff0c\u60a8\u4e3a\u7c7b\u5206\u914d\u7684\u6574\u6570\u503c\u51b3\u5b9a\u4e86\u5b83\u4eec\u8fd0\u884c\u7684\u987a\u5e8f:items\u4ece\u4f4e\u503c\u7c7b\u5230\u9ad8\u503c\u7c7b\u3002\u901a\u5e38\u57280-1000\u8303\u56f4\u5185\u5b9a\u4e49\u8fd9\u4e9b\u6570\u5b57\u3002","title":"\u6fc0\u6d3bItem pipeline\u7ec4\u4ef6"},{"location":"2. \u57fa\u672c\u6982\u5ff5/13-feed_exports/","text":"Feed exports(\u5bfc\u51fa\u5404\u79cd\u683c\u5f0f\u6587\u4ef6) \u6700\u65b0\u7248\u672c0.10 \u5b9e\u73b0\u6293\u53d6\u5668\u6700\u7ecf\u5e38\u9700\u8981\u7684\u7279\u6027\u4e4b\u4e00\u662f\u80fd\u591f\u6b63\u786e\u5730\u5b58\u50a8\u88ab\u6293\u53d6\u7684\u6570\u636e\uff0c\u8fd9\u901a\u5e38\u610f\u5473\u7740\u4f7f\u7528\u88ab\u6293\u53d6\u7684\u6570\u636e(\u901a\u5e38\u79f0\u4e3a\u201cexport feed\u201d)\u751f\u6210\u4e00\u4e2a\u201c\u5bfc\u51fa\u6587\u4ef6\u201d\uff0c\u4ee5\u4f9b\u5176\u4ed6\u7cfb\u7edf\u4f7f\u7528\u3002 Scrapy\u901a\u8fc7Feed Exports\u63d0\u4f9b\u4e86\u8fd9\u79cd\u5f00\u7bb1\u5373\u7528\u7684\u529f\u80fd\uff0c\u5b83\u5141\u8bb8\u60a8\u6293\u53d6item\u751f\u6210feed\u5e76\u4f7f\u7528\u591a\u79cd\u5e8f\u5217\u5316\u683c\u5f0f\u6216\u8005\u8fdb\u884c\u5b58\u50a8\u540e\u7aef\u3002 \u5e8f\u5217\u5316 \u5bf9\u4e8e\u5e8f\u5217\u5316\u6293\u53d6\u7684\u6570\u636e\uff0cfeed exports\u4f7f\u7528 Item exporters \u3002\u8fd9\u4e9b\u683c\u5f0f\u652f\u6301\u5f00\u7bb1\u5373\u7528: JSON JSON lines CSV XML \u4f46\u662f\u60a8\u4e5f\u53ef\u4ee5\u901a\u8fc7 FEED_EXPORTERS \u8bbe\u7f6e\u6765\u6269\u5c55\u652f\u6301\u7684\u683c\u5f0f\u3002 JSON FEED_FORMAT : json Exporter used: JsonItemExporter \u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f\u5e26\u6709\u5927\u91cffeeds\u7684JSON\uff0c\u8bf7\u53c2\u9605 \u6b64\u8b66\u544a \u3002 JSON lines FEED_FORMAT : jsonlines Exporter used: JsonLinesItemExporter CSV FEED_FORMAT : csv Exporter used: JsonItemExporter \u8981\u6307\u5b9a\u8981\u5bfc\u51fa\u7684\u5217\u53ca\u5176\u987a\u5e8f\uff0c\u8bf7\u4f7f\u7528 FEED_EXPORT_FIELDS \u3002\u5176\u4ed6feed exporters\u4e5f\u53ef\u4ee5\u4f7f\u7528\u6b64\u9009\u9879\uff0c\u4f46\u5b83\u5bf9\u4e8eCSV\u5f88\u91cd\u8981\uff0c\u56e0\u4e3a\u4e0e\u8bb8\u591a\u5176\u4ed6\u5bfc\u51fa\u683c\u5f0f\u4e0d\u540c\uff0cCSV\u4f7f\u7528\u56fa\u5b9a\u7684\u5934\u3002 XML FEED_FORMAT : xml Exporter used: XmlItemExporter Pickle FEED_FORMAT : pickle Exporter used: PickleItemExporter Marshal FEED_FORMAT : marshal Exporter used: MarshalItemExporter \u5b58\u50a8\u8bbe\u5907 \u5728\u4f7f\u7528feed exports\u65f6\uff0c\u4f7f\u7528URI(\u901a\u8fc7 FEED_URI \u8bbe\u7f6e)\u5b9a\u4e49\u5b58\u50a8feed\u7684\u4f4d\u7f6e\u3002feed exports\u652f\u6301\u7531URI scheme\u5b9a\u4e49\u7684\u591a\u4e2a\u5b58\u50a8\u540e\u7aef\u7c7b\u578b\u3002 \u652f\u6301\u5f00\u7bb1\u5373\u7528\u7684\u5b58\u50a8\u540e\u7aef\u6709: Local filesystem FTP S3 (\u9700\u8981 botocore \u6216 boto ) Standard output \u5982\u679c\u6240\u9700\u7684\u5916\u90e8\u5e93\u4e0d\u53ef\u7528\u65f6\uff0c\u4e00\u4e9b\u5b58\u50a8\u540e\u7aef\u53ef\u80fd\u4e0d\u53ef\u7528\u3002\u4f8b\u5982\uff0cS3\u540e\u7aef\u4ec5\u5728\u5b89\u88c5\u4e86 botocore \u6216 boto \u5e93\u65f6\u53ef\u7528(Scrapy\u4ec5\u5728Python 2\u4e0a\u652f\u6301 boto )\u3002 \u5b58\u50a8URI\u53c2\u6570 \u5b58\u50a8URI\u8fd8\u53ef\u4ee5\u5305\u542b\u5728\u521b\u5efafeed\u65f6\u66ff\u6362feed\u7684\u53c2\u6570\u3002\u8fd9\u4e9b\u53c2\u6570\u662f: %(time)s - \u5728\u521b\u5efafeed\u65f6\u88ab\u65f6\u95f4\u6233\u66ff\u6362 %(name)s - \u88ab\u66ff\u6362\u4e3aspider\u540d\u79f0 \u4efb\u4f55\u5176\u4ed6\u547d\u540d\u53c2\u6570\u90fd\u4f1a\u88ab\u76f8\u540c\u540d\u79f0\u7684spider\u5c5e\u6027\u66ff\u6362\u3002\u4f8b\u5982\uff0c\u521b\u5efafeed\u7684\u90a3\u4e00\u523b %(site_id) \u5c06\u88ab\u66ff\u6362\u4e3a spider.site_id \u5c5e\u6027 \u8fd9\u91cc\u6709\u4e00\u4e9b\u4f8b\u5b50\u6765\u8bf4\u660e: \u5b58\u50a8\u5728FTP\u4e0a, \u6bcf\u4e2aspider\u4f7f\u7528\u4e00\u4e2a\u76ee\u5f55 ftp://user:password@ftp.example.com/scraping/feeds/%(name)s/%(time)s.json \u5b58\u50a8\u5728S3\u4e0a, \u6bcf\u4e2aspider\u4f7f\u7528\u4e00\u4e2a\u76ee\u5f55 s3://mybucket/scraping/feeds/%(name)s/%(time)s.json \u5b58\u50a8\u540e\u7aef \u672c\u5730\u6587\u4ef6\u7cfb\u7edf \u5b58\u50a8URI\u8fd8\u53ef\u4ee5\u5305\u542b\u53c2\u6570 URI scheme: file URI\u4f8b\u5b50: file:///tmp/export.csv \u9700\u8981\u5916\u90e8\u5e93: none \u6ce8\u610f\uff0c\u5bf9\u4e8e\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u5b58\u50a8(\u4ec5)\uff0c\u5982\u679c\u6307\u5b9a\u4e86 /tmp/export.csv \u8fd9\u6837\u7684\u7edd\u5bf9\u8def\u5f84\uff0c\u5219\u53ef\u4ee5\u7701\u7565\u8be5\u65b9\u6848\u3002\u4f46\u8fd9\u53ea\u9002\u7528\u4e8eUnix\u7cfb\u7edf\u3002 FTP \u5b58\u50a8\u5728FTP\u670d\u52a1\u5668\u4e0a\u7684feeds URI scheme: ftp URI\u4f8b\u5b50: ftp://user:pass@ftp.example.com/path/to/export.csv \u9700\u8981\u5916\u90e8\u5e93: none S3 \u5b58\u50a8\u5728 \u4e9a\u9a6c\u900aS3 \u4e0a\u7684feeds URI scheme: s3 URI\u4f8b\u5b50: s3://mybucket/path/to/export.csv s3://aws_key:aws_secret@mybucket/path/to/export.csv \u9700\u8981\u5916\u90e8\u5e93: botocore (Python 2 and Python 3)\u6216 boto (Python 2 only) AWS\u51ed\u8bc1\u53ef\u4ee5\u5728URI\u4e2d\u4f5c\u4e3a\u7528\u6237/\u5bc6\u7801\u4f20\u9012\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u8bbe\u7f6e\u4f20\u9012: AWS_ACCESS_KEY_ID AWS_SECRET_ACCESS_KEY \u6807\u51c6\u8f93\u51fa feed\u88ab\u5199\u5165\u5230Scrapy\u5904\u7406\u7684\u6807\u51c6\u8f93\u51fa\u3002 URI scheme: stdout URI\u4f8b\u5b50: stdout: \u9700\u8981\u5916\u90e8\u5e93: none \u8bbe\u7f6e \u8fd9\u4e9b\u8bbe\u7f6e\u7528\u4e8e\u914d\u7f6efeed exports: FEED_URI (\u5f3a\u5236) FEED_FORMAT FEED_STORAGES FEED_EXPORTERS FEED_STORE_EMPTY FEED_EXPORT_ENCODING FEED_EXPORT_FIELDS FEED_EXPORT_INDENT FEED_URI \u9ed8\u8ba4: None \u5bfc\u51fafeed\u7684URI\u3002\u6709\u5173\u53d7\u652f\u6301\u7684URI\u65b9\u6848\uff0c\u8bf7\u53c2\u9605 \u5b58\u50a8\u540e\u7aef \u3002 \u542f\u7528 feed_exports \u9700\u8981\u6b64\u8bbe\u7f6e\u3002 FEED_FORMAT \u7528\u4e8efeed\u683c\u5f0f\u7684\u5e8f\u5217\u5316\u3002\u6709\u5173\u53ef\u80fd\u7684\u503c\uff0c\u8bf7\u53c2\u9605 \u5e8f\u5217\u5316\u683c\u5f0f \u3002 FEED_EXPORT_ENCODING \u9ed8\u8ba4: None feed\u7684\u7f16\u7801\u3002 \u5982\u679c\u672a\u8bbe\u7f6e\u6216\u8bbe\u7f6e\u4e3a None (\u9ed8\u8ba4)\uff0c\u9664\u4e86JSON\u8f93\u51fa\uff0c\u5b83\u5bf9\u6240\u6709\u5185\u5bb9\u90fd\u4f7f\u7528UTF-8\uff0c\u51fa\u4e8e\u5386\u53f2\u539f\u56e0\uff0cJSON\u8f93\u51fa\u4f7f\u7528\u5b89\u5168\u7684\u6570\u5b57\u7f16\u7801(\\uXXXX\u5e8f\u5217)\u3002 \u5982\u679c\u8981\u4e3aJSON\u4f7f\u7528utf-8\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528utf-8\u3002 FEED_EXPORT_FIELDS \u9ed8\u8ba4: None \u8981\u5bfc\u51fa\u7684\u5b57\u6bb5\u5217\u8868\uff0c\u53ef\u9009\u3002\u4f8b\u5b50: FEED_EXPORT_FIELDS = [\"foo\", \"bar\", \"baz\"] \u4f7f\u7528FEED_EXPORT_FIELDS\u9009\u9879\u5b9a\u4e49\u8981\u5bfc\u51fa\u7684\u5b57\u6bb5\u53ca\u5176\u987a\u5e8f\u3002 \u5f53FEED_EXPORT_FIELDS\u4e3a\u7a7a\u6216\u4e3aNone(\u9ed8\u8ba4)\u65f6\uff0cScrapy\u4f7f\u7528dicts\u4e2d\u5b9a\u4e49\u7684\u5b57\u6bb5\u6216spider\u751f\u6210\u7684 Item \u5b50\u7c7b\u3002 \u5982\u679c\u5bfc\u51fa\u8005\u9700\u8981\u4e00\u7ec4\u56fa\u5b9a\u7684\u5b57\u6bb5(\u8fd9\u662f CSV \u5bfc\u51fa\u683c\u5f0f\u7684\u60c5\u51b5)\uff0c\u4e14FEED_EXPORT_FIELDS\u4e3a\u7a7a\u6216\u4e3aNone\uff0c\u90a3\u4e48Scrapy\u5c1d\u8bd5\u4ece\u5bfc\u51fa\u7684\u6570\u636e\u63a8\u65ad\u5b57\u6bb5\u540d \u2014\u2014 \u76ee\u524d\u5b83\u4f7f\u7528\u7684\u5b57\u6bb5\u540d\u6765\u81ea\u7b2c\u4e00\u4e2aitem\u3002 FEED_EXPORT_INDENT \u9ed8\u8ba4: 0 \u7528\u4e8e\u7f29\u8fdb\u6bcf\u4e2a\u7ea7\u522b\u4e0a\u7684\u8f93\u51fa\u7684\u7a7a\u95f4\u91cf\u3002\u5982\u679cfeed_export_\u7f29\u8fdb\u662f\u4e00\u4e2a\u975e\u8d1f\u6574\u6570\uff0c\u90a3\u4e48\u6570\u7ec4\u5143\u7d20\u548c\u5bf9\u8c61\u6210\u5458\u5c06\u7528\u7f29\u8fdb\u7ea7\u522b\u6f02\u4eae\u5730\u6253\u5370\u51fa\u6765\u3002\u7f29\u8fdb\u7ea7\u522b\u4e3a0(\u9ed8\u8ba4\u503c)\u6216\u8d1f\u503c\uff0c\u5c06\u628a\u6bcf\u4e2a\u9879\u653e\u5230\u65b0\u884c\u4e2d\u3002 None \u9009\u62e9\u6700\u7d27\u51d1\u7684\u8868\u793a\u5f62\u5f0f\u3002 \u76ee\u524d\u53ea\u7531 jsonitemexports \u548c xmlitemexports \u5b9e\u73b0\uff0c\u5373\u5f53\u60a8\u5bfc\u51fa\u5230 .json \u6216 .xml\u65f6 \u3002 FEED_STORE_EMPTY \u9ed8\u8ba4: False \u662f\u5426\u5bfc\u51fa\u7a7a\u7684feed(\u5373\u3002\u6ca1\u6709item\u7684feed)\u3002 FEED_STORAGES \u9ed8\u8ba4: {} \u5305\u542b\u60a8\u7684\u9879\u76ee\u652f\u6301\u7684\u989d\u5916feed\u5b58\u50a8\u540e\u7aef\u7684dict\u3002 \u952e\u662fURI schemes\uff0c\u503c\u662f\u5b58\u50a8\u7c7b\u7684\u8def\u5f84\u3002 FEED_STORAGES_BASE { '': 'scrapy.extensions.feedexport.FileFeedStorage', 'file': 'scrapy.extensions.feedexport.FileFeedStorage', 'stdout': 'scrapy.extensions.feedexport.StdoutFeedStorage', 's3': 'scrapy.extensions.feedexport.S3FeedStorage', 'ftp': 'scrapy.extensions.feedexport.FTPFeedStorage', } \u4e00\u4e2a\u5b57\u5178\uff0c\u5305\u542b\u7531Scrapy\u652f\u6301\u7684\u5185\u7f6efeed\u5b58\u50a8\u540e\u7aef\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u5728 FEED_STORAGES \u4e2d\u4e3a\u5b83\u4eec\u7684URI scheme\u5206\u914d None \u6765\u7981\u7528\u4efb\u4f55\u8fd9\u4e9b\u540e\u7aef\u3002\u4f8b\u5982\uff0c\u8981\u7981\u7528\u5185\u7f6eFTP\u5b58\u50a8\u540e\u7aef(\u4e0d\u9700\u8981\u66ff\u6362)\uff0c\u8bf7\u5c06\u5176\u653e\u5728\u60a8\u7684 settings.py \u4e2d\u3002 FEED_STORAGES = { 'ftp': None, } FEED_EXPORTERS \u9ed8\u8ba4: {} \u5305\u542b\u7531\u60a8\u7684\u9879\u76ee\u652f\u6301\u7684\u989d\u5916exporters\u7684\u4e00\u79cddict\u3002\u952e\u662f\u5e8f\u5217\u5316\u683c\u5f0f\uff0c\u503c\u662f Item exporter \u7c7b\u7684\u8def\u5f84\u3002 FEED_EXPORTERS_BASE \u9ed8\u8ba4: { 'json': 'scrapy.exporters.JsonItemExporter', 'jsonlines': 'scrapy.exporters.JsonLinesItemExporter', 'jl': 'scrapy.exporters.JsonLinesItemExporter', 'csv': 'scrapy.exporters.CsvItemExporter', 'xml': 'scrapy.exporters.XmlItemExporter', 'marshal': 'scrapy.exporters.MarshalItemExporter', 'pickle': 'scrapy.exporters.PickleItemExporter', } \u5305\u542b\u7531Scrapy\u652f\u6301\u7684\u5185\u7f6efeed exporters\u7684\u4e00\u79cddict\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u5728 FEED_EXPORTERS \u4e2d\u4e3a\u5b83\u4eec\u7684\u5e8f\u5217\u5316\u683c\u5f0f\u5206\u914d None \u6765\u7981\u7528\u8fd9\u4e9bexporters\u4e2d\u7684\u4efb\u4f55\u4e00\u4e2a\u3002\u4f8b\u5982\uff0c\u8981\u7981\u7528\u5185\u7f6e\u7684CSV\u5bfc\u51fa\u5668(\u4e0d\u9700\u8981\u66ff\u6362)\uff0c\u8bf7\u5c06\u5176\u653e\u5728\u60a8\u7684 settings.py : FEED_EXPORTERS = { 'csv': None, }","title":"Feed exports(\u5bfc\u51fa\u5404\u79cd\u683c\u5f0f\u6587\u4ef6)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/13-feed_exports/#feed-exports","text":"\u6700\u65b0\u7248\u672c0.10 \u5b9e\u73b0\u6293\u53d6\u5668\u6700\u7ecf\u5e38\u9700\u8981\u7684\u7279\u6027\u4e4b\u4e00\u662f\u80fd\u591f\u6b63\u786e\u5730\u5b58\u50a8\u88ab\u6293\u53d6\u7684\u6570\u636e\uff0c\u8fd9\u901a\u5e38\u610f\u5473\u7740\u4f7f\u7528\u88ab\u6293\u53d6\u7684\u6570\u636e(\u901a\u5e38\u79f0\u4e3a\u201cexport feed\u201d)\u751f\u6210\u4e00\u4e2a\u201c\u5bfc\u51fa\u6587\u4ef6\u201d\uff0c\u4ee5\u4f9b\u5176\u4ed6\u7cfb\u7edf\u4f7f\u7528\u3002 Scrapy\u901a\u8fc7Feed Exports\u63d0\u4f9b\u4e86\u8fd9\u79cd\u5f00\u7bb1\u5373\u7528\u7684\u529f\u80fd\uff0c\u5b83\u5141\u8bb8\u60a8\u6293\u53d6item\u751f\u6210feed\u5e76\u4f7f\u7528\u591a\u79cd\u5e8f\u5217\u5316\u683c\u5f0f\u6216\u8005\u8fdb\u884c\u5b58\u50a8\u540e\u7aef\u3002","title":"Feed exports(\u5bfc\u51fa\u5404\u79cd\u683c\u5f0f\u6587\u4ef6)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/13-feed_exports/#_1","text":"\u5bf9\u4e8e\u5e8f\u5217\u5316\u6293\u53d6\u7684\u6570\u636e\uff0cfeed exports\u4f7f\u7528 Item exporters \u3002\u8fd9\u4e9b\u683c\u5f0f\u652f\u6301\u5f00\u7bb1\u5373\u7528: JSON JSON lines CSV XML \u4f46\u662f\u60a8\u4e5f\u53ef\u4ee5\u901a\u8fc7 FEED_EXPORTERS \u8bbe\u7f6e\u6765\u6269\u5c55\u652f\u6301\u7684\u683c\u5f0f\u3002","title":"\u5e8f\u5217\u5316"},{"location":"2. \u57fa\u672c\u6982\u5ff5/13-feed_exports/#json","text":"FEED_FORMAT : json Exporter used: JsonItemExporter \u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f\u5e26\u6709\u5927\u91cffeeds\u7684JSON\uff0c\u8bf7\u53c2\u9605 \u6b64\u8b66\u544a \u3002","title":"JSON"},{"location":"2. \u57fa\u672c\u6982\u5ff5/13-feed_exports/#json-lines","text":"FEED_FORMAT : jsonlines Exporter used: JsonLinesItemExporter","title":"JSON lines"},{"location":"2. \u57fa\u672c\u6982\u5ff5/13-feed_exports/#csv","text":"FEED_FORMAT : csv Exporter used: JsonItemExporter \u8981\u6307\u5b9a\u8981\u5bfc\u51fa\u7684\u5217\u53ca\u5176\u987a\u5e8f\uff0c\u8bf7\u4f7f\u7528 FEED_EXPORT_FIELDS \u3002\u5176\u4ed6feed exporters\u4e5f\u53ef\u4ee5\u4f7f\u7528\u6b64\u9009\u9879\uff0c\u4f46\u5b83\u5bf9\u4e8eCSV\u5f88\u91cd\u8981\uff0c\u56e0\u4e3a\u4e0e\u8bb8\u591a\u5176\u4ed6\u5bfc\u51fa\u683c\u5f0f\u4e0d\u540c\uff0cCSV\u4f7f\u7528\u56fa\u5b9a\u7684\u5934\u3002","title":"CSV"},{"location":"2. \u57fa\u672c\u6982\u5ff5/13-feed_exports/#xml","text":"FEED_FORMAT : xml Exporter used: XmlItemExporter","title":"XML"},{"location":"2. \u57fa\u672c\u6982\u5ff5/13-feed_exports/#pickle","text":"FEED_FORMAT : pickle Exporter used: PickleItemExporter","title":"Pickle"},{"location":"2. \u57fa\u672c\u6982\u5ff5/13-feed_exports/#marshal","text":"FEED_FORMAT : marshal Exporter used: MarshalItemExporter","title":"Marshal"},{"location":"2. \u57fa\u672c\u6982\u5ff5/13-feed_exports/#_2","text":"\u5728\u4f7f\u7528feed exports\u65f6\uff0c\u4f7f\u7528URI(\u901a\u8fc7 FEED_URI \u8bbe\u7f6e)\u5b9a\u4e49\u5b58\u50a8feed\u7684\u4f4d\u7f6e\u3002feed exports\u652f\u6301\u7531URI scheme\u5b9a\u4e49\u7684\u591a\u4e2a\u5b58\u50a8\u540e\u7aef\u7c7b\u578b\u3002 \u652f\u6301\u5f00\u7bb1\u5373\u7528\u7684\u5b58\u50a8\u540e\u7aef\u6709: Local filesystem FTP S3 (\u9700\u8981 botocore \u6216 boto ) Standard output \u5982\u679c\u6240\u9700\u7684\u5916\u90e8\u5e93\u4e0d\u53ef\u7528\u65f6\uff0c\u4e00\u4e9b\u5b58\u50a8\u540e\u7aef\u53ef\u80fd\u4e0d\u53ef\u7528\u3002\u4f8b\u5982\uff0cS3\u540e\u7aef\u4ec5\u5728\u5b89\u88c5\u4e86 botocore \u6216 boto \u5e93\u65f6\u53ef\u7528(Scrapy\u4ec5\u5728Python 2\u4e0a\u652f\u6301 boto )\u3002","title":"\u5b58\u50a8\u8bbe\u5907"},{"location":"2. \u57fa\u672c\u6982\u5ff5/13-feed_exports/#uri","text":"\u5b58\u50a8URI\u8fd8\u53ef\u4ee5\u5305\u542b\u5728\u521b\u5efafeed\u65f6\u66ff\u6362feed\u7684\u53c2\u6570\u3002\u8fd9\u4e9b\u53c2\u6570\u662f: %(time)s - \u5728\u521b\u5efafeed\u65f6\u88ab\u65f6\u95f4\u6233\u66ff\u6362 %(name)s - \u88ab\u66ff\u6362\u4e3aspider\u540d\u79f0 \u4efb\u4f55\u5176\u4ed6\u547d\u540d\u53c2\u6570\u90fd\u4f1a\u88ab\u76f8\u540c\u540d\u79f0\u7684spider\u5c5e\u6027\u66ff\u6362\u3002\u4f8b\u5982\uff0c\u521b\u5efafeed\u7684\u90a3\u4e00\u523b %(site_id) \u5c06\u88ab\u66ff\u6362\u4e3a spider.site_id \u5c5e\u6027 \u8fd9\u91cc\u6709\u4e00\u4e9b\u4f8b\u5b50\u6765\u8bf4\u660e: \u5b58\u50a8\u5728FTP\u4e0a, \u6bcf\u4e2aspider\u4f7f\u7528\u4e00\u4e2a\u76ee\u5f55 ftp://user:password@ftp.example.com/scraping/feeds/%(name)s/%(time)s.json \u5b58\u50a8\u5728S3\u4e0a, \u6bcf\u4e2aspider\u4f7f\u7528\u4e00\u4e2a\u76ee\u5f55 s3://mybucket/scraping/feeds/%(name)s/%(time)s.json","title":"\u5b58\u50a8URI\u53c2\u6570"},{"location":"2. \u57fa\u672c\u6982\u5ff5/13-feed_exports/#_3","text":"","title":"\u5b58\u50a8\u540e\u7aef"},{"location":"2. \u57fa\u672c\u6982\u5ff5/13-feed_exports/#_4","text":"\u5b58\u50a8URI\u8fd8\u53ef\u4ee5\u5305\u542b\u53c2\u6570 URI scheme: file URI\u4f8b\u5b50: file:///tmp/export.csv \u9700\u8981\u5916\u90e8\u5e93: none \u6ce8\u610f\uff0c\u5bf9\u4e8e\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u5b58\u50a8(\u4ec5)\uff0c\u5982\u679c\u6307\u5b9a\u4e86 /tmp/export.csv \u8fd9\u6837\u7684\u7edd\u5bf9\u8def\u5f84\uff0c\u5219\u53ef\u4ee5\u7701\u7565\u8be5\u65b9\u6848\u3002\u4f46\u8fd9\u53ea\u9002\u7528\u4e8eUnix\u7cfb\u7edf\u3002","title":"\u672c\u5730\u6587\u4ef6\u7cfb\u7edf"},{"location":"2. \u57fa\u672c\u6982\u5ff5/13-feed_exports/#ftp","text":"\u5b58\u50a8\u5728FTP\u670d\u52a1\u5668\u4e0a\u7684feeds URI scheme: ftp URI\u4f8b\u5b50: ftp://user:pass@ftp.example.com/path/to/export.csv \u9700\u8981\u5916\u90e8\u5e93: none","title":"FTP"},{"location":"2. \u57fa\u672c\u6982\u5ff5/13-feed_exports/#s3","text":"\u5b58\u50a8\u5728 \u4e9a\u9a6c\u900aS3 \u4e0a\u7684feeds URI scheme: s3 URI\u4f8b\u5b50: s3://mybucket/path/to/export.csv s3://aws_key:aws_secret@mybucket/path/to/export.csv \u9700\u8981\u5916\u90e8\u5e93: botocore (Python 2 and Python 3)\u6216 boto (Python 2 only) AWS\u51ed\u8bc1\u53ef\u4ee5\u5728URI\u4e2d\u4f5c\u4e3a\u7528\u6237/\u5bc6\u7801\u4f20\u9012\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u8bbe\u7f6e\u4f20\u9012: AWS_ACCESS_KEY_ID AWS_SECRET_ACCESS_KEY","title":"S3"},{"location":"2. \u57fa\u672c\u6982\u5ff5/13-feed_exports/#_5","text":"feed\u88ab\u5199\u5165\u5230Scrapy\u5904\u7406\u7684\u6807\u51c6\u8f93\u51fa\u3002 URI scheme: stdout URI\u4f8b\u5b50: stdout: \u9700\u8981\u5916\u90e8\u5e93: none","title":"\u6807\u51c6\u8f93\u51fa"},{"location":"2. \u57fa\u672c\u6982\u5ff5/13-feed_exports/#_6","text":"\u8fd9\u4e9b\u8bbe\u7f6e\u7528\u4e8e\u914d\u7f6efeed exports: FEED_URI (\u5f3a\u5236) FEED_FORMAT FEED_STORAGES FEED_EXPORTERS FEED_STORE_EMPTY FEED_EXPORT_ENCODING FEED_EXPORT_FIELDS FEED_EXPORT_INDENT","title":"\u8bbe\u7f6e"},{"location":"2. \u57fa\u672c\u6982\u5ff5/13-feed_exports/#feed_uri","text":"\u9ed8\u8ba4: None \u5bfc\u51fafeed\u7684URI\u3002\u6709\u5173\u53d7\u652f\u6301\u7684URI\u65b9\u6848\uff0c\u8bf7\u53c2\u9605 \u5b58\u50a8\u540e\u7aef \u3002 \u542f\u7528 feed_exports \u9700\u8981\u6b64\u8bbe\u7f6e\u3002","title":"FEED_URI"},{"location":"2. \u57fa\u672c\u6982\u5ff5/13-feed_exports/#feed_format","text":"\u7528\u4e8efeed\u683c\u5f0f\u7684\u5e8f\u5217\u5316\u3002\u6709\u5173\u53ef\u80fd\u7684\u503c\uff0c\u8bf7\u53c2\u9605 \u5e8f\u5217\u5316\u683c\u5f0f \u3002","title":"FEED_FORMAT"},{"location":"2. \u57fa\u672c\u6982\u5ff5/13-feed_exports/#feed_export_encoding","text":"\u9ed8\u8ba4: None feed\u7684\u7f16\u7801\u3002 \u5982\u679c\u672a\u8bbe\u7f6e\u6216\u8bbe\u7f6e\u4e3a None (\u9ed8\u8ba4)\uff0c\u9664\u4e86JSON\u8f93\u51fa\uff0c\u5b83\u5bf9\u6240\u6709\u5185\u5bb9\u90fd\u4f7f\u7528UTF-8\uff0c\u51fa\u4e8e\u5386\u53f2\u539f\u56e0\uff0cJSON\u8f93\u51fa\u4f7f\u7528\u5b89\u5168\u7684\u6570\u5b57\u7f16\u7801(\\uXXXX\u5e8f\u5217)\u3002 \u5982\u679c\u8981\u4e3aJSON\u4f7f\u7528utf-8\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528utf-8\u3002","title":"FEED_EXPORT_ENCODING"},{"location":"2. \u57fa\u672c\u6982\u5ff5/13-feed_exports/#feed_export_fields","text":"\u9ed8\u8ba4: None \u8981\u5bfc\u51fa\u7684\u5b57\u6bb5\u5217\u8868\uff0c\u53ef\u9009\u3002\u4f8b\u5b50: FEED_EXPORT_FIELDS = [\"foo\", \"bar\", \"baz\"] \u4f7f\u7528FEED_EXPORT_FIELDS\u9009\u9879\u5b9a\u4e49\u8981\u5bfc\u51fa\u7684\u5b57\u6bb5\u53ca\u5176\u987a\u5e8f\u3002 \u5f53FEED_EXPORT_FIELDS\u4e3a\u7a7a\u6216\u4e3aNone(\u9ed8\u8ba4)\u65f6\uff0cScrapy\u4f7f\u7528dicts\u4e2d\u5b9a\u4e49\u7684\u5b57\u6bb5\u6216spider\u751f\u6210\u7684 Item \u5b50\u7c7b\u3002 \u5982\u679c\u5bfc\u51fa\u8005\u9700\u8981\u4e00\u7ec4\u56fa\u5b9a\u7684\u5b57\u6bb5(\u8fd9\u662f CSV \u5bfc\u51fa\u683c\u5f0f\u7684\u60c5\u51b5)\uff0c\u4e14FEED_EXPORT_FIELDS\u4e3a\u7a7a\u6216\u4e3aNone\uff0c\u90a3\u4e48Scrapy\u5c1d\u8bd5\u4ece\u5bfc\u51fa\u7684\u6570\u636e\u63a8\u65ad\u5b57\u6bb5\u540d \u2014\u2014 \u76ee\u524d\u5b83\u4f7f\u7528\u7684\u5b57\u6bb5\u540d\u6765\u81ea\u7b2c\u4e00\u4e2aitem\u3002","title":"FEED_EXPORT_FIELDS"},{"location":"2. \u57fa\u672c\u6982\u5ff5/13-feed_exports/#feed_export_indent","text":"\u9ed8\u8ba4: 0 \u7528\u4e8e\u7f29\u8fdb\u6bcf\u4e2a\u7ea7\u522b\u4e0a\u7684\u8f93\u51fa\u7684\u7a7a\u95f4\u91cf\u3002\u5982\u679cfeed_export_\u7f29\u8fdb\u662f\u4e00\u4e2a\u975e\u8d1f\u6574\u6570\uff0c\u90a3\u4e48\u6570\u7ec4\u5143\u7d20\u548c\u5bf9\u8c61\u6210\u5458\u5c06\u7528\u7f29\u8fdb\u7ea7\u522b\u6f02\u4eae\u5730\u6253\u5370\u51fa\u6765\u3002\u7f29\u8fdb\u7ea7\u522b\u4e3a0(\u9ed8\u8ba4\u503c)\u6216\u8d1f\u503c\uff0c\u5c06\u628a\u6bcf\u4e2a\u9879\u653e\u5230\u65b0\u884c\u4e2d\u3002 None \u9009\u62e9\u6700\u7d27\u51d1\u7684\u8868\u793a\u5f62\u5f0f\u3002 \u76ee\u524d\u53ea\u7531 jsonitemexports \u548c xmlitemexports \u5b9e\u73b0\uff0c\u5373\u5f53\u60a8\u5bfc\u51fa\u5230 .json \u6216 .xml\u65f6 \u3002","title":"FEED_EXPORT_INDENT"},{"location":"2. \u57fa\u672c\u6982\u5ff5/13-feed_exports/#feed_store_empty","text":"\u9ed8\u8ba4: False \u662f\u5426\u5bfc\u51fa\u7a7a\u7684feed(\u5373\u3002\u6ca1\u6709item\u7684feed)\u3002","title":"FEED_STORE_EMPTY"},{"location":"2. \u57fa\u672c\u6982\u5ff5/13-feed_exports/#feed_storages","text":"\u9ed8\u8ba4: {} \u5305\u542b\u60a8\u7684\u9879\u76ee\u652f\u6301\u7684\u989d\u5916feed\u5b58\u50a8\u540e\u7aef\u7684dict\u3002 \u952e\u662fURI schemes\uff0c\u503c\u662f\u5b58\u50a8\u7c7b\u7684\u8def\u5f84\u3002","title":"FEED_STORAGES"},{"location":"2. \u57fa\u672c\u6982\u5ff5/13-feed_exports/#feed_storages_base","text":"{ '': 'scrapy.extensions.feedexport.FileFeedStorage', 'file': 'scrapy.extensions.feedexport.FileFeedStorage', 'stdout': 'scrapy.extensions.feedexport.StdoutFeedStorage', 's3': 'scrapy.extensions.feedexport.S3FeedStorage', 'ftp': 'scrapy.extensions.feedexport.FTPFeedStorage', } \u4e00\u4e2a\u5b57\u5178\uff0c\u5305\u542b\u7531Scrapy\u652f\u6301\u7684\u5185\u7f6efeed\u5b58\u50a8\u540e\u7aef\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u5728 FEED_STORAGES \u4e2d\u4e3a\u5b83\u4eec\u7684URI scheme\u5206\u914d None \u6765\u7981\u7528\u4efb\u4f55\u8fd9\u4e9b\u540e\u7aef\u3002\u4f8b\u5982\uff0c\u8981\u7981\u7528\u5185\u7f6eFTP\u5b58\u50a8\u540e\u7aef(\u4e0d\u9700\u8981\u66ff\u6362)\uff0c\u8bf7\u5c06\u5176\u653e\u5728\u60a8\u7684 settings.py \u4e2d\u3002 FEED_STORAGES = { 'ftp': None, }","title":"FEED_STORAGES_BASE"},{"location":"2. \u57fa\u672c\u6982\u5ff5/13-feed_exports/#feed_exporters","text":"\u9ed8\u8ba4: {} \u5305\u542b\u7531\u60a8\u7684\u9879\u76ee\u652f\u6301\u7684\u989d\u5916exporters\u7684\u4e00\u79cddict\u3002\u952e\u662f\u5e8f\u5217\u5316\u683c\u5f0f\uff0c\u503c\u662f Item exporter \u7c7b\u7684\u8def\u5f84\u3002","title":"FEED_EXPORTERS"},{"location":"2. \u57fa\u672c\u6982\u5ff5/13-feed_exports/#feed_exporters_base","text":"\u9ed8\u8ba4: { 'json': 'scrapy.exporters.JsonItemExporter', 'jsonlines': 'scrapy.exporters.JsonLinesItemExporter', 'jl': 'scrapy.exporters.JsonLinesItemExporter', 'csv': 'scrapy.exporters.CsvItemExporter', 'xml': 'scrapy.exporters.XmlItemExporter', 'marshal': 'scrapy.exporters.MarshalItemExporter', 'pickle': 'scrapy.exporters.PickleItemExporter', } \u5305\u542b\u7531Scrapy\u652f\u6301\u7684\u5185\u7f6efeed exporters\u7684\u4e00\u79cddict\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u5728 FEED_EXPORTERS \u4e2d\u4e3a\u5b83\u4eec\u7684\u5e8f\u5217\u5316\u683c\u5f0f\u5206\u914d None \u6765\u7981\u7528\u8fd9\u4e9bexporters\u4e2d\u7684\u4efb\u4f55\u4e00\u4e2a\u3002\u4f8b\u5982\uff0c\u8981\u7981\u7528\u5185\u7f6e\u7684CSV\u5bfc\u51fa\u5668(\u4e0d\u9700\u8981\u66ff\u6362)\uff0c\u8bf7\u5c06\u5176\u653e\u5728\u60a8\u7684 settings.py : FEED_EXPORTERS = { 'csv': None, }","title":"FEED_EXPORTERS_BASE"},{"location":"2. \u57fa\u672c\u6982\u5ff5/14-requests_response/","text":"Requests\u548cResponses Scrapy\u4f7f\u7528 Request \u548c Response \u5bf9\u8c61\u6765\u6293\u53d6web\u7ad9\u70b9\u3002 \u901a\u5e38\uff0c Request \u5bf9\u8c61\u5728spiders\u4e2d\u751f\u6210\u5e76\u5728\u7cfb\u7edf\u4e2d\u4f20\u9012\uff0c\u76f4\u5230\u5b83\u4eec\u5230\u8fbeDownloader\uff0cDownloader\u6267\u884crequest\u5e76\u8fd4\u56de\u53d1\u51farequest\u7684spider\u7684 Response \u5bf9\u8c61\u3002 Request \u7c7b\u548c Response \u7c7b\u90fd\u6709\u6dfb\u52a0\u57fa\u7c7b\u4e2d\u4e0d\u9700\u8981\u7684\u529f\u80fd\u7684\u5b50\u7c7b\u3002\u4e0b\u9762\u5728 \u8bf7\u6c42\u5b50\u7c7b \u548c \u54cd\u5e94\u5b50\u7c7b \u4e2d\u63cf\u8ff0\u4e86\u8fd9\u4e9b\u3002 Request\u5bf9\u8c61 scrapy.http.Request(url[, callback, method='GET', headers, body, cookies, meta, encoding='utf-8', priority=0, dont_filter=False, errback, flags]) \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) Request \u5bf9\u8c61\u8868\u793aHTTP\u8bf7\u6c42\uff0c\u901a\u5e38\u5728Spider\u4e2d\u751f\u6210\u5e76\u7531Downloader\u6267\u884c\uff0c\u4ece\u800c\u751f\u6210 Response \u3002 \u53c2\u6570: url (\u5b57\u7b26\u4e32) \u2013 \u6b64\u6b21\u8bf7\u6c42\u7684url callback (\u53ef\u8c03\u7528\u7684) \u2014 \u8fd9\u4e2a\u51fd\u6570\u5c06\u88ab\u8c03\u7528\uff0c\u5e76\u5c06\u6b64request\u7684response(\u4e0b\u8f7d\u540e)\u4f5c\u4e3a\u5176\u7b2c\u4e00\u4e2a\u53c2\u6570\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 \u5c06\u989d\u5916\u6570\u636e\u4f20\u9012\u7ed9\u56de\u8c03\u51fd\u6570 \u3002\u5982\u679c\u8bf7\u6c42\u6ca1\u6709\u6307\u5b9acallback\uff0c\u5c06\u4f7f\u7528spider\u7684 parse() \u65b9\u6cd5\u3002\u6ce8\u610f\uff0c\u5982\u679c\u5728\u5904\u7406\u671f\u95f4\u5f15\u53d1\u5f02\u5e38\uff0c\u5219\u4f1a\u8c03\u7528 errback \u3002 method (\u5b57\u7b26\u4e32) \u2013 \u6b64request\u7684HTTP\u65b9\u6cd5\u3002\u9ed8\u8ba4\u4e3a'GET'. meta (\u5b57\u5178) \u2013 Request.meta \u7684\u521d\u59cb\u503c\u3002\u5143\u5c5e\u6027\u3002\u5982\u679c\u7ed9\u5b9a\uff0c\u5728\u6b64\u53c2\u6570\u4e2d\u4f20\u9012\u7684dict\u5c06\u88ab\u6d45\u590d\u5236\u3002 body (\u5b57\u7b26\u4e32\u6216unicode) \u2013 request\u4e3b\u4f53\u3002\u5982\u679c\u4f20\u9012\u4e86 unicode \uff0c\u5219\u4f7f\u7528\u4f20\u9012\u7684\u7f16\u7801(\u9ed8\u8ba4\u4e3autf-8)\u5c06\u5176\u7f16\u7801\u4e3astr\u3002\u5982\u679c\u6ca1\u6709\u7ed9\u51fabody\uff0c\u5219\u5b58\u50a8\u4e00\u4e2a\u7a7a\u5b57\u7b26\u4e32\u3002\u4e0d\u7ba1\u8fd9\u4e2a\u53c2\u6570\u7684\u7c7b\u578b\u662f\u4ec0\u4e48\uff0c\u6700\u7ec8\u5b58\u50a8\u7684\u503c\u90fd\u5c06\u662f str (\u4ece\u4e0d\u4f7f\u7528 unicode \u6216 None )\u3002 headers (\u5b57\u5178) \u2013 \u6b64\u8bf7\u6c42\u7684headers\u3002\u5b57\u5178\u7684\u503c\u53ef\u4ee5\u662f\u5b57\u7b26\u4e32(\u7528\u4e8e\u5355\u503cheaders)\u6216\u5217\u8868(\u7528\u4e8e\u591a\u503cheaders)\u3002\u5982\u679c None \u4f5c\u4e3a\u503c\u4f20\u9012\uff0c\u5219\u6839\u672c\u4e0d\u4f1a\u53d1\u9001HTTP\u5934\u3002 cookies (\u5b57\u5178\u6216\u5217\u8868) \u2013\u6b64\u8bf7\u6c42\u7684cookie\u3002\u53ef\u4ee5\u4ee5\u4e24\u79cd\u5f62\u5f0f\u53d1\u9001\u3002 \u4f7f\u7528\u5b57\u5178 request_with_cookies = Request(url= http://www.example.com , cookies={'currency': 'USD', 'country': 'UY'}) \u4f7f\u7528\u5b57\u5178\u5217\u8868 request_with_cookies = Request(url= http://www.example.com , cookies=[{'name': 'currency', 'value': 'USD', 'domain': 'example.com', 'path': '/currency'}]) \u540e\u4e00\u79cd\u5f62\u5f0f\u5141\u8bb8\u5b9a\u5236cookie\u7684 domain \u548c path \u5c5e\u6027\u3002\u8fd9\u53ea\u5728cookie\u4e3a\u4ee5\u540e\u7684\u8bf7\u6c42\u4fdd\u5b58\u65f6\u6709\u7528\u3002 \u5f53\u67d0\u4e9b\u7ad9\u70b9\u8fd4\u56decookie(\u5728response\u4e2d)\u65f6\uff0c\u8fd9\u4e9bcookie\u5b58\u50a8\u5728\u8be5\u57df\u7684cookie\u4e2d\uff0c\u5e76\u5c06\u5728\u4ee5\u540e\u7684request\u4e2d\u518d\u6b21\u53d1\u9001\u3002\u8fd9\u662f\u4efb\u4f55\u666e\u901aweb\u6d4f\u89c8\u5668\u7684\u5178\u578b\u884c\u4e3a\u3002\u4f46\u662f\uff0c\u5982\u679c\u51fa\u4e8e\u67d0\u79cd\u539f\u56e0\uff0c\u60a8\u60f3\u907f\u514d\u4e0e\u73b0\u6709cookie\u5408\u5e76\uff0c\u90a3\u4e48\u53ef\u4ee5\u901a\u8fc7\u5728 Request.meta \u4e2d\u5c06 dont_merge_cookie \u952e\u8bbe\u7f6e\u4e3aTrue\u6765\u6307\u793aScrapy\u8fd9\u6837\u505a\u3002 request\u4e0d\u5408\u5e76cookie\u7684\u4f8b\u5b50: request_with_cookies = Request(url= http://www.example.com , cookies={'currency': 'USD', 'country': 'UY'}, meta={'dont_merge_cookies': True}) \u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 CookiesMiddleware \u3002 encoding (\u5b57\u7b26\u4e32) \u2013 \u6b64\u8bf7\u6c42\u7684\u7f16\u7801(\u9ed8\u8ba4\u4e3a 'utf-8' )\u3002 \u8fd9\u79cd\u7f16\u7801\u5c06\u7528\u4e8e\u5bf9URL\u8fdb\u884c\u767e\u5206\u6bd4\u7f16\u7801\uff0c\u5e76\u5c06body\u8f6c\u6362\u4e3a str (\u5982\u679c\u4ee5 unicode \u8868\u793a\u7684\u8bdd)\u3002 priority (\u6574\u578b) \u2013 \u6b64\u8bf7\u6c42\u7684\u4f18\u5148\u7ea7(\u9ed8\u8ba4\u4e3a 0 ).\u8c03\u5ea6\u7a0b\u5e8f\u4f7f\u7528\u8be5\u4f18\u5148\u7ea7\u5b9a\u4e49\u5904\u7406\u8bf7\u6c42\u7684\u987a\u5e8f\u3002\u5177\u6709\u66f4\u9ad8\u4f18\u5148\u7ea7\u503c\u7684\u8bf7\u6c42\u5c06\u66f4\u65e9\u6267\u884c\u3002\u4e3a\u4e86\u8868\u793a\u76f8\u5bf9\u8f83\u4f4e\u7684\u4f18\u5148\u7ea7\uff0c\u5141\u8bb8\u4f7f\u7528\u8d1f\u503c\u3002 dont_filter (\u5e03\u5c14) - \u6307\u793a\u8c03\u5ea6\u7a0b\u5e8f\u4e0d\u5e94\u8be5\u8fc7\u6ee4\u6b64\u8bf7\u6c42\u3002\u5f53\u60a8\u60f3\u8981\u591a\u6b21\u6267\u884c\u76f8\u540c\u7684\u8bf7\u6c42\uff0c\u4ee5\u5ffd\u7565\u53bb\u91cd\u8fc7\u6ee4\u5668\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u8fd9\u79cd\u65b9\u6cd5\u3002\u5c0f\u5fc3\u4f7f\u7528\u5b83\uff0c\u5426\u5219\u4f60\u4f1a\u9677\u5165\u722c\u884c\u5faa\u73af\u3002\u9ed8\u8ba4\u4e3a False \u3002 errback(\u53ef\u8c03\u7528\u7684) - \u5728\u5904\u7406\u8bf7\u6c42\u65f6\uff0c\u5982\u679c\u51fa\u73b0\u4efb\u4f55\u5f02\u5e38\uff0c\u5c06\u8c03\u7528\u8be5\u51fd\u6570\u3002\u8fd9\u5305\u62ec404 HTTP\u9519\u8bef\u7b49\u5931\u8d25\u7684\u9875\u9762\u3002\u5b83\u63a5\u6536\u4e00\u4e2a Twisted Failure \u5b9e\u4f8b\u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u53c2\u6570\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1\u4e0b\u9762 \u4f7f\u7528errbacks\u6355\u83b7\u8bf7\u6c42\u5904\u7406\u4e2d\u7684\u5f02\u5e38 \u3002 flags(\u5217\u8868)-\u53d1\u9001\u5230\u8bf7\u6c42\u7684flag\uff0c\u53ef\u4ee5\u7528\u4e8e\u65e5\u5fd7\u8bb0\u5f55\u6216\u7c7b\u4f3c\u76ee\u7684\u3002 url \u5305\u542b\u6b64\u8bf7\u6c42URL\u7684\u5b57\u7b26\u4e32\u3002\u8bf7\u8bb0\u4f4f\uff0c\u8be5\u5c5e\u6027\u5305\u542b\u8f6c\u4e49URL\uff0c\u56e0\u6b64\u5b83\u53ef\u80fd\u4e0e\u5728\u6784\u9020\u51fd\u6570\u4e2d\u4f20\u9012\u7684URL\u4e0d\u540c\u3002 \u8fd9\u4e2a\u5c5e\u6027\u662f\u53ea\u8bfb\u7684\u3002\u8981\u66f4\u6539\u8bf7\u6c42\u7684URL\uff0c\u8bf7\u4f7f\u7528 replace() \u3002 method \u8868\u793a\u8bf7\u6c42\u7684HTTP\u65b9\u6cd5\u7684\u5b57\u7b26\u4e32\u3002\u8fd9\u4fdd\u8bc1\u662f\u5927\u5199\u7684\u3002\u4f8b\u5982: GET , POST , PUT \u7b49\u7b49 headers \u5305\u542b\u8bf7\u6c42headers\u7684\u7c7b\u4f3c\u5b57\u5178\u7684\u5bf9\u8c61\u3002 body \u5305\u542b\u8bf7\u6c42body\u7684\u5b57\u7b26\u4e32\u3002 \u8fd9\u4e2a\u5c5e\u6027\u662f\u53ea\u8bfb\u7684\u3002\u8981\u66f4\u6539\u8bf7\u6c42\u7684body\uff0c\u8bf7\u4f7f\u7528 replace() \u3002 meta \u5305\u542b\u6b64\u8bf7\u6c42\u7684\u4efb\u610fmetadata\u7684\u5b57\u5178\u3002\u8fd9\u4e2adict\u5bf9\u4e8e\u65b0\u8bf7\u6c42\u662f\u7a7a\u7684\uff0c\u901a\u5e38\u7531\u4e0d\u540c\u7684Scrapy\u7ec4\u4ef6(extensions(\u6269\u5c55)\u3001middlewares(\u4e2d\u95f4\u4ef6)\u7b49)\u586b\u5145\u3002\u56e0\u6b64\uff0c\u5b57\u5178\u4e2d\u5305\u542b\u7684\u6570\u636e\u53d6\u51b3\u4e8e\u60a8\u542f\u7528\u7684(extensions(\u6269\u5c55)\u3002 \u770b\u4e00\u4e0b Request.meta\u7279\u6b8a\u952e \u3002\u7531Scrapy\u8bc6\u522b\u7684\u4e00\u7ec4\u7279\u6b8ameta\u952e\u3002 \u5f53\u4f7f\u7528 copy() \u6216 replace() \u65b9\u6cd5\u514b\u9686\u8bf7\u6c42\u65f6\uff0c\u8fd9\u4e2adict\u662f \u6d45\u590d\u5236 \u7684\uff0c\u4e5f\u53ef\u4ee5\u5728\u60a8\u7684spider\u4e2d\u4eceresponse\u8bbf\u95ee response.meta \u5c5e\u6027\u3002 copy() \u8fd4\u56de\u4e00\u4e2a\u65b0\u8bf7\u6c42\uff0c\u8be5\u8bf7\u6c42\u662f\u6b64\u8bf7\u6c42\u7684\u526f\u672c\u3002\u8bf7\u53c2\u9605: \u5c06\u989d\u5916\u6570\u636e\u4f20\u9012\u7ed9\u56de\u8c03\u51fd\u6570 \u3002 replace([url, method, headers, body, cookies, meta, encoding, dont_filter, callback, errback]) \u8fd4\u56de\u5177\u6709\u76f8\u540c\u6210\u5458\u7684\u8bf7\u6c42\u5bf9\u8c61\uff0c\u9664\u4e86\u90a3\u4e9b\u7531\u6307\u5b9a\u7684\u5173\u952e\u5b57\u53c2\u6570\u8d4b\u4e88\u65b0\u503c\u7684\u6210\u5458\u3002 \u9ed8\u8ba4\u7684 Request.meta \u60c5\u51b5\u4e0b\uff0cmeta\u4f1a\u88ab\u590d\u5236(\u9664\u975e\u5728 meta \u53c2\u6570\u4e2d\u7ed9\u51fa\u4e86\u4e00\u4e2a\u65b0\u7684\u503c)\u3002\u8bf7\u53c2\u9605 \u5411\u56de\u8c03\u51fd\u6570\u4f20\u9012\u989d\u5916\u6570\u636e \u3002 \u5c06\u989d\u5916\u6570\u636e\u4f20\u9012\u7ed9callback\u51fd\u6570 \u8bf7\u6c42\u7684callback\u51fd\u6570\u662f\u5728\u4e0b\u8f7d\u8be5request\u7684response\u65f6\u8c03\u7528\u7684\u51fd\u6570\u3002\u5c06\u4f7f\u7528\u4e0b\u8f7d\u7684 Response \u5bf9\u8c61\u4f5c\u4e3a\u5176\u7b2c\u4e00\u4e2a\u53c2\u6570\u8c03\u7528callback\u51fd\u6570\u3002 \u4f8b\u5b50: def parse_page1(self, response): return scrapy.Request( http://www.example.com/some_page.html , callback=self.parse_page2) def parse_page2(self, response): # \u8fd9\u5c06\u4f1a\u65e5\u5fd7\u8bb0\u5f55\u4e0b\u6765 http://www.example.com/some_page.html self.logger.info( Visited %s , response.url) \u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u60a8\u53ef\u80fd\u5bf9\u5411\u8fd9\u4e9bcallback\u51fd\u6570\u4f20\u9012\u53c2\u6570\u611f\u5174\u8da3\uff0c\u4ee5\u4fbf\u7a0d\u540e\u5728\u7b2c\u4e8c\u6b21callback\u4e2d\u63a5\u6536\u8fd9\u4e9b\u53c2\u6570\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 Request.meta \u5c5e\u6027\u3002 \u4e0b\u9762\u662f\u5982\u4f55\u4f7f\u7528\u8fd9\u79cd\u673a\u5236\u4f20\u9012item\u7684\u793a\u4f8b\uff0c\u4ee5\u586b\u5145\u6765\u81ea\u4e0d\u540c\u9875\u9762\u7684\u4e0d\u540c\u5b57\u6bb5: def parse_page1(self, response): item = MyItem() item['main_url'] = response.url request = scrapy.Request( http://www.example.com/some_page.html , callback=self.parse_page2) request.meta['item'] = item yield request def parse_page2(self, response): item = response.meta['item'] item['other_url'] = response.url yield item \u4f7f\u7528errback\u5728\u8bf7\u6c42\u5904\u7406\u4e2d\u6355\u83b7\u5f02\u5e38 \u8bf7\u6c42\u7684errback\u662f\u5728\u5904\u7406\u5f02\u5e38\u65f6\u8c03\u7528\u7684\u51fd\u6570\u3002 \u5b83\u63a5\u6536\u4e00\u4e2a Twisted Failure \u5b9e\u4f8b\u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u53c2\u6570\uff0c\u53ef\u4ee5\u7528\u6765\u8ddf\u8e2a\u8fde\u63a5\u5efa\u7acb\u8d85\u65f6\u3001DNS\u9519\u8bef\u7b49\u3002 \u4e0b\u9762\u662f\u4e00\u4e2aspider\u8bb0\u5f55\u6240\u6709\u9519\u8bef\u7684\u4f8b\u5b50\uff0c\u5982\u679c\u9700\u8981\uff0c\u5b83\u53ef\u4ee5\u6355\u83b7\u4e00\u4e9b\u7279\u5b9a\u7684\u9519\u8bef: import scrapy from scrapy.spidermiddlewares.httperror import HttpError from twisted.internet.error import DNSLookupError from twisted.internet.error import TimeoutError, TCPTimedOutError class ErrbackSpider(scrapy.Spider): name = errback_example start_urls = [ http://www.httpbin.org/ , # \u9884\u8ba1\u662fHTTP 200 http://www.httpbin.org/status/404 , # \u6ca1\u6709\u627e\u5230\u7684\u9519\u8bef http://www.httpbin.org/status/500 , # \u670d\u52a1\u5668\u95ee\u9898 http://www.httpbin.org:12345/ , # \u672a\u54cd\u5e94\u4e3b\u673a, \u9884\u8ba1\u8d85\u65f6 http://www.httphttpbinbin.org/ , # \u9884\u8ba1\u662fDNS\u9519\u8bef ] def start_requests(self): for u in self.start_urls: yield scrapy.Request(u, callback=self.parse_httpbin, errback=self.errback_httpbin, dont_filter=True) def parse_httpbin(self, response): self.logger.info('Got successful response from {}'.format(response.url)) # \u505a\u4e00\u4e9b\u6709\u7528\u7684\u4e8b\u60c5... def errback_httpbin(self, failure): # \u8bb0\u5f55\u6240\u6709\u9519\u8bef self.logger.error(repr(failure)) # \u5982\u679c\u4f60\u60f3\u5bf9\u4e00\u4e9b\u9519\u8bef\u505a\u4e00\u4e9b\u7279\u522b\u7684\u5904\u7406, # \u4f60\u53ef\u80fd\u9700\u8981\u5931\u8d25\u7684\u7c7b\u578b: if failure.check(HttpError): # \u8fd9\u4e9b\u5f02\u5e38\u6765\u81eaHttpError spider \u4e2d\u95f4\u4ef6 # \u4f60\u53ef\u4ee5\u5f97\u5230\u975e200\u7684response response = failure.value.response self.logger.error('HttpError on %s', response.url) elif failure.check(DNSLookupError): # \u8fd9\u662f\u539f\u59cb\u8bf7\u6c42 request = failure.request self.logger.error('DNSLookupError on %s', request.url) elif failure.check(TimeoutError, TCPTimedOutError): request = failure.request self.logger.error('TimeoutError on %s', request.url) Request.meta \u7279\u6b8a\u952e Request.meta \u5c5e\u6027\u53ef\u4ee5\u5305\u542b\u4efb\u610f\u7684\u6570\u636e\uff0c\u4f46\u662f\u6709\u4e00\u4e9b\u7279\u6b8a\u7684\u952e\u88abScrapy\u548c\u5b83\u7684\u5185\u7f6e\u6269\u5c55\u6240\u8bc6\u522b\u3002 \u8fd9\u4e9b\u662f: dont_redirect dont_retry handle_httpstatus_list handle_httpstatus_all dont_merge_cookies cookiejar dont_cache redirect_urls bindaddress dont_obey_robotstxt download_timeout download_maxsize download_latency download_fail_on_dataloss proxy ftp_user \uff08\u8bf7\u53c2\u9605 FTP_USER \u4ee5\u83b7\u5f97\u66f4\u591a\u4fe1\u606f\uff09 ftp_password \uff08\u8bf7\u53c2\u9605 FTP_PASSWORD \u4ee5\u83b7\u5f97\u66f4\u591a\u4fe1\u606f\uff09 referrer_policy max_retry_times bindaddress \u8f93\u51faIP\u5730\u5740\u7684IP\u7528\u4e8e\u6267\u884c\u8bf7\u6c42\u3002 download_timeout \u5728\u8d85\u65f6\u4e4b\u524d\uff0cdownloader\u5c06\u7b49\u5f85\u6700\u5927\u65f6\u95f4\uff08\u79d2\uff09\u3002\u53c2\u89c1: DOWNLOAD_TIMEOUT \u3002 download_latency \u7528\u4e8e\u83b7\u53d6response\u7684\u65f6\u95f4\uff0c\u56e0\u4e3arequest\u5df2\u7ecf\u542f\u52a8\uff0c\u5373\u901a\u8fc7\u7f51\u7edc\u53d1\u9001\u7684HTTP\u6d88\u606f\u3002\u53ea\u6709\u5f53response\u88ab\u4e0b\u8f7d\u65f6\uff0c\u8fd9\u4e2ameta\u952e\u624d\u4f1a\u51fa\u73b0\u3002\u800c\u5927\u591a\u6570\u5176\u4ed6meta\u952e\u90fd\u662f\u7528\u6765\u63a7\u5236Scrapy\u884c\u4e3a\u7684\uff0c\u4f46\u662f\u8fd9\u4e2a\u5e94\u8be5\u662f\u53ea\u8bfb\u7684\u3002 download_fail_on_dataloss \u662f\u5426\u4f1a\u5728\u635f\u574f\u7684response\u4e2d\u5931\u8d25\u3002\u770b\u5230: DOWNLOAD_FAIL_ON_DATALOSS \u3002 max_retry_times \u8fd9\u4e2ameta\u952e\u88ab\u7528\u6765\u8bbe\u7f6e\u6bcf\u4e2a\u8bf7\u6c42\u7684\u91cd\u8bd5\u65f6\u95f4\u3002\u5f53\u521d\u59cb\u5316\u65f6\uff0c max_retry_times meta\u952e\u6bd4 RETRY_TIMES \u8bbe\u7f6e\u4f18\u5148\u7ea7\u66f4\u9ad8\u3002 Request subclasses \u4e0b\u9762\u662f\u5185\u7f6e Request \u5b50\u7c7b\u7684\u5217\u8868\u3002\u60a8\u8fd8\u53ef\u4ee5\u5bf9\u5b83\u8fdb\u884c\u5b50\u7c7b\u5316\u6765\u5b9e\u73b0\u60a8\u81ea\u5df1\u7684\u5b9a\u5236\u529f\u80fd\u3002 FormRequest objects FormRequest\u7c7b\u6269\u5c55\u4e86 Request \u57fa\u7c7b\uff0c\u5e76\u63d0\u4f9b\u4e86\u5904\u7406HTML\u8868\u5355\u7684\u529f\u80fd\u3002\u5b83\u4f7f\u7528 lxml.html\u8868\u5355 \u4ece Response \u5bf9\u8c61\u7684\u8868\u5355\u6570\u636e\u9884\u5148\u586b\u5145\u8868\u5355\u5b57\u6bb5 scrapy.http.FormRequest(url[, formdata, ...]) \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) FormRequest \u7c7b\u5411\u6784\u9020\u51fd\u6570\u6dfb\u52a0\u4e86\u4e00\u4e2a\u65b0\u7684\u53c2\u6570\u3002\u5269\u4e0b\u7684\u53c2\u6570\u4e0e Request \u7c7b\u76f8\u540c\uff0c\u8fd9\u91cc\u6ca1\u6709\u6587\u6863\u8bb0\u5f55\u3002 \u53c2\u6570: formdata (\u5b57\u5178\u6216\u8005\u662f\u4e00\u4e2a\u53ef\u8fed\u4ee3\u7684\u5143\u7ec4) - \u662f\u4e00\u4e2a\u5b57\u5178(\u6216\u8005\u662f\u4e00\u4e2a\u53ef\u8fed\u4ee3\u7684\u952e\u503c\u5bf9\u5143\u7ec4)\u5305\u542bHTML\u8868\u5355\u6570\u636e\uff0c\u8fd9\u4e9b\u6570\u636e\u5c06\u88aburl\u7f16\u7801\u5e76\u5206\u914d\u7ed9request\u7684body\u3002 \u9664\u4e86\u6807\u51c6 Request \u65b9\u6cd5\u4e4b\u5916\uff0c FormRequest \u5bf9\u8c61\u8fd8\u652f\u6301\u4e0b\u5217\u7c7b\u65b9\u6cd5\uff1a from_response (response[, formname=None, formid=None, formnumber=0, formdata=None, formxpath=None, formcss=None, clickdata=None, dont_click=False, ...]) \u8fd9\u662f\u4e00\u4e2a\u7c7b\u65b9\u6cd5(classmethod) \u8fd4\u56de\u4e00\u4e2a\u65b0\u7684 FormRequest \u5bf9\u8c61\uff0c\u5b83\u7684\u8868\u5355\u5b57\u6bb5\u503c\u9884\u5148\u586b\u5145\u4e86\u5728\u7ed9\u5b9aresponse\u4e2d\u5305\u542b\u7684HTML form \u5143\u7d20\u4e2d\u7684\u5143\u7d20\u3002\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u770b\u4e00\u4e0b \u4f7f\u7528FormRequest.from_response()\u6765\u6a21\u62df\u7528\u6237\u767b\u5f55 \u3002 \u8be5\u7b56\u7565\u662f\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5728\u4efb\u4f55\u770b\u8d77\u6765\u53ef\u70b9\u51fb\u7684\u5143\u7d20\u4e0a\u81ea\u52a8\u6a21\u62df\u70b9\u51fb\uff0c\u5c31\u50cf input type=\"submit\" \u3002\u5c3d\u7ba1\u8fd9\u5f88\u65b9\u4fbf\uff0c\u800c\u4e14\u901a\u5e38\u662f\u6211\u4eec\u60f3\u8981\u7684\u884c\u4e3a\uff0c\u4f46\u6709\u65f6\u5b83\u4f1a\u5bfc\u81f4\u96be\u4ee5\u8c03\u8bd5\u7684\u95ee\u9898\u3002\u4f8b\u5982\uff0c\u5728\u4f7f\u7528javascript\u586b\u5199\u548c/\u6216\u63d0\u4ea4\u7684\u8868\u5355\u65f6\uff0c\u9ed8\u8ba4\u7684 from_response() \u884c\u4e3a\u53ef\u80fd\u4e0d\u662f\u6700\u5408\u9002\u7684\u3002\u8981\u7981\u7528\u8fd9\u79cd\u884c\u4e3a\uff0c\u60a8\u53ef\u4ee5\u5c06 dont_click \u53c2\u6570\u8bbe\u7f6e\u4e3a True \u3002\u53e6\u5916\uff0c\u5982\u679c\u4f60\u60f3\u8981\u6539\u53d8\u63a7\u5236\u70b9\u51fb\uff08\u800c\u4e0d\u662f\u7981\u7528\u5b83\uff09\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 clickdata \u53c2\u6570 \u8b66\u544a!!!!!!! \u4f7f\u7528\u8fd9\u79cd\u65b9\u6cd5\uff0c\u9009\u62e9\u5177\u6709\u524d\u5bfc\u7684\u5143\u7d20\u6216\u5728\u9009\u9879\u503c\u4e2d\u7ed3\u5c3e\u7a7a\u767d\u5c06\u65e0\u6cd5\u5de5\u4f5c\uff0c \u56e0\u4e3alxml\u4e2d\u7684\u4e00\u4e2abug(https://bugs.launchpad.net/lxml/+bug/1665241)\uff0c \u5e94\u8be5\u5728lxml 3.8\u548c\u66f4\u9ad8\u7248\u672c\u4e2d\u4fee\u590d\u3002 \u53c2\u6570: response([Request]\u5bf9\u8c61) - \u5305\u542b\u4e00\u4e2aHTML\u8868\u5355\u7684response\uff0c\u8be5\u8868\u5355\u5c06\u7528\u4e8e\u9884\u586b\u5145\u8868\u5355\u5b57\u6bb5 formname(\u5b57\u7b26\u4e32) - \u5982\u679c\u7ed9\u5b9a\u7684\u8bdd\uff0c\u5e26\u6709name\u5c5e\u6027\u7684\u8868\u5355\u5c06\u88ab\u4f7f\u7528\u3002 formid (\u5b57\u7b26\u4e32) - \u5982\u679c\u7ed9\u5b9a\uff0c\u5e26\u6709id\u5c5e\u6027\u7684\u8868\u5355\u5c06\u88ab\u4f7f\u7528 formxpath(\u5b57\u7b26\u4e32) - \u5982\u679c\u7ed9\u5b9a, \u7b2c\u4e00\u4e2a\u4e0expath\u5339\u914d\u7684\u8868\u5355\u5c06\u88ab\u4f7f\u7528 formcss (\u5b57\u7b26\u4e32) \u2013 \u5982\u679c\u7ed9\u5b9a, \u4e0ecss\u9009\u62e9\u5668\u5339\u914d\u7684\u7b2c\u4e00\u4e2a\u8868\u5355\u5c06\u88ab\u4f7f\u7528\u3002 formnumber (int\u6574\u578b) \u2013 \u5f53\u54cd\u5e94\u5305\u542b\u591a\u4e2a\u8868\u5355\u65f6\uff0c\u8981\u4f7f\u7528\u7684\u8868\u5355\u6570\u503c\u5730\u5740\u3002\u7b2c\u4e00\u4e2a\uff08\u4e5f\u662f\u9ed8\u8ba4\u503c\uff09\u662f 0 formdata (\u5b57\u5178) \u2013 \u5728\u8868\u5355\u6570\u636e\u4e2d\u8981\u8986\u76d6\u7684\u5b57\u6bb5\u3002\u5982\u679c\u4e00\u4e2a\u5b57\u6bb5\u5df2\u7ecf\u51fa\u73b0\u5728response\u7684 form \u5143\u7d20\u4e2d\uff0c\u90a3\u4e48\u5b83\u7684\u503c\u5c31\u4f1a\u88ab\u8fd9\u4e2a\u53c2\u6570\u4e2d\u4f20\u9012\u7684\u503c\u6240\u8986\u76d6\u3002\u5982\u679c\u5728\u8fd9\u4e2a\u53c2\u6570\u4e2d\u4f20\u9012\u7684\u503c\u662f None \uff0c\u8be5\u5b57\u6bb5\u5c06\u4e0d\u5305\u542b\u5728request\u4e2d\uff0c\u5373\u4f7f\u5b83\u662f\u5728response\u7684 form \u5143\u7d20\u4e2d\u51fa\u73b0\u7684\u3002 clickdata (\u5b57\u5178) \u2013 \u67e5\u627e\u53ef\u5355\u51fb\u63a7\u4ef6\u7684\u5c5e\u6027\u3002\u5982\u679c\u6ca1\u6709\u7ed9\u51fa\uff0c\u8868\u5355\u6570\u636e\u5c06\u88ab\u63d0\u4ea4\u6a21\u62df\u7b2c\u4e00\u4e2a\u53ef\u70b9\u51fb\u5143\u7d20\u7684\u70b9\u51fb\u3002\u9664\u4e86html\u5c5e\u6027\u4e4b\u5916\uff0c\u901a\u8fc7 nr \u5c5e\u6027\uff0c\u76f8\u5bf9\u4e8e\u8868\u5355\u5185\u7684\u5176\u4ed6\u63d0\u4ea4\u8868\u8f93\u5165, \u53ef\u4ee5\u901a\u8fc7\u5176\u57fa\u4e8e\u96f6\u7684\u7d22\u5f15\u6765\u8bc6\u522b\u63a7\u5236\u3002 dont_click(\u5e03\u5c14\u7c7b\u578b) - \u5982\u679c\u662f True \uff0c\u8868\u5355\u6570\u636e\u5c06\u5728\u4e0d\u5355\u51fb\u4efb\u4f55\u5143\u7d20\u7684\u60c5\u51b5\u4e0b\u63d0\u4ea4\u3002 \u8fd9\u4e2a\u7c7b\u65b9\u6cd5\u7684\u5176\u4ed6\u53c2\u6570\u76f4\u63a5\u4f20\u9012\u7ed9 FormRequest \u6784\u9020\u51fd\u6570\u3002 \u57280.10.3\u65b0\u7248\u672c: \u6dfb\u52a0\u4e86 formname \u53c2\u6570\u3002 \u57280.17\u65b0\u7248\u672c: \u6dfb\u52a0\u4e86 formxpath \u53c2\u6570\u3002 \u57281.1.0:\u65b0\u7248\u672c: \u6dfb\u52a0\u4e86 formcss \u53c2\u6570\u3002 \u57281.1.0\u65b0\u7248\u672c: \u6dfb\u52a0\u4e86 formid \u53c2\u6570\u3002 Request\u7528\u6cd5\u793a\u4f8b \u4f7f\u7528FormRequest\u901a\u8fc7HTTP POST\u53d1\u9001\u6570\u636e \u5982\u679c\u4f60\u60f3\u5728\u4f60\u7684spider\u4e2d\u6a21\u62df\u4e00\u4e2aHTML\u8868\u5355\uff0c\u5e76\u53d1\u9001\u51e0\u4e2a\u952e\u503c\u5b57\u6bb5\uff0c\u4f60\u53ef\u4ee5\u8fd4\u56de\u4e00\u4e2a FormRequest \u5bf9\u8c61\uff08\u6765\u81ea\u4f60\u7684spider\uff09\uff0c\u5982\u4e0b\u6240\u793a\uff1a return [FormRequest(url= http://www.example.com/post/action , formdata={'name': 'John Doe', 'age': '27'}, callback=self.after_post)] \u4f7f\u7528FormRequest.from_response()\u6765\u6a21\u62df\u7528\u6237\u767b\u5f55 web\u7ad9\u70b9\u901a\u5e38\u901a\u8fc7 input type=\"hidden\" \u5143\u7d20\u6765\u63d0\u4f9b\u9884\u5148\u586b\u5145\u7684\u8868\u5355\u5b57\u6bb5, \u4f8b\u5982session\u76f8\u5173\u7684\u6570\u636e\u6216\u8eab\u4efd\u9a8c\u8bc1token(\u7528\u4e8e\u767b\u5f55\u9875\u9762), \u5728\u6293\u53d6\u65f6\uff0c\u60a8\u4f1a\u5e0c\u671b\u8fd9\u4e9b\u5b57\u6bb5\u662f\u81ea\u52a8\u9884\u586b\u5145\u7684\uff0c\u5e76\u4e14\u60a8\u53ea\u60f3\u8986\u76d6\u5176\u4e2d\u7684\u51e0\u4e2a\u5b57\u6bb5\uff0c\u6bd4\u5982\u7528\u6237\u540d\u548c\u5bc6\u7801\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 FormRequest.from_response() \u65b9\u6cd5\u6765\u5b8c\u6210\u8fd9\u9879\u5de5\u4f5c\u3002\u8fd9\u662f\u4e00\u4e2a\u4f7f\u7528\u5b83\u7684spider\uff1a import scrapy class LoginSpider(scrapy.Spider): name = 'example.com' start_urls = ['http://www.example.com/users/login.php'] def parse(self, response): return scrapy.FormRequest.from_response( response, formdata={'username': 'john', 'password': 'secret'}, callback=self.after_login ) def after_login(self, response): # \u5728\u7ee7\u7eed\u4e4b\u524d\uff0c\u68c0\u67e5\u662f\u5426\u767b\u5f55\u6210\u529f if authentication failed in response.body: self.logger.error( Login failed ) return # \u7ee7\u7eed\u7528\u7ecf\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u7684\u4f1a\u8bdd\u8fdb\u884c\u6293\u53d6... Response\u5bf9\u8c61 scrapy.http.Response(url[, status=200, headers=None, body=b'', flags=None, request=None]) \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) Response \u5bf9\u8c61\u4ee3\u8868HTTP response, \u5b83\u901a\u5e38\u88ab\u4e0b\u8f7d\uff08\u7531Downloader\uff09\uff0c\u5e76\u5582\u7ed9Spiders\u8fdb\u884c\u5904\u7406\u3002 \u53c2\u6570: url(\u5b57\u7b26\u4e32) \u2013 \u8bf7\u6c42url\u7684response status (int\u6574\u578b) \u2013 response\u7684HTTP\u72b6\u6001\u3002\u9ed8\u8ba4\u4e3a200\u3002 headers(\u5b57\u5178) \u2013 \u8fd9\u4e2aresponse\u7684headers\u3002\u53ef\u4ee5\u662f\u5b57\u7b26\u4e32\uff08\u5bf9\u4e8e\u5355\u503c\u5934\uff09\u6216\u5217\u8868\uff08\u5bf9\u4e8e\u591a\u503c\u5934\uff09\u3002 body (bytes) \u2013 response\u7684body\u3002\u5c06\u89e3\u7801\u7684\u6587\u672c\u4f5c\u4e3astr(Python 2\u4e2d\u7684unicode)\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 response.text \u6765\u81eaencoding-aware Request \u5b50\u7c7b\u7684\u6587\u672c\uff0c\u5982 TextResponse \u3002 flags (\u5217\u8868) \u2013 \u662f\u4e00\u4e2a\u5305\u542b Response.flags \u5c5e\u6027\u7684\u521d\u59cb\u503c\u7684\u5217\u8868\u3002 \u5982\u679c\u7ed9\u5b9a\uff0c\u8be5\u5217\u8868\u5c06\u88ab\u7b80\u5355\u5730\u590d\u5236\u3002 request ( Request \u5bf9\u8c61) \u2013 Response.request \u5c5e\u6027\u7684\u521d\u59cb\u503c\u3002 \u8fd9\u8868\u793a\u4ea7\u751f\u6b64response\u7684 Request \u3002 url \u5305\u542bresponse\u7684URL\u7684\u5b57\u7b26\u4e32\u3002 \u8fd9\u4e2a\u5c5e\u6027\u662f\u53ea\u8bfb\u7684\u3002\u8981\u6539\u53d8response\u7684URL\u4f7f\u7528 replace() status \u4e00\u4e2a\u8868\u793aresponse\u7684HTTP\u72b6\u6001\u7684\u6574\u6570\u3002 \u4f8b\u5b50: 200 , 404 headers \u4e00\u4e2a\u7c7b\u4f3c\u4e8e\u5b57\u5178\u7684\u5bf9\u8c61\uff0c\u5b83\u5305\u542bresponse headers\u3002\u53ef\u4ee5\u4f7f\u7528 get() \u6765\u53d6\u503c\uff0c\u7528\u6307\u5b9a\u7684\u540d\u5b57\u8fd4\u56de\u7b2c\u4e00\u4e2aheader\u7684\u503c\u6216 getlist() \u7528\u6307\u5b9a\u7684\u540d\u5b57\u8fd4\u56de\u6240\u6709\u7684header\u503c\u3002 \u4f8b\u5982\uff0c\u8c03\u7528\u8fd9\u4e2a\u4f1a\u63d0\u4f9bheaders\u4e2d\u6240\u6709\u7684cookie\uff1a response.headers.getlist('Set-Cookie') body response\u7684body\u3002\u8bf7\u7262\u8bb0 Response.body \u603b\u662f\u4e00\u4e2a bytes \u5bf9\u8c61\u3002\u5982\u679c\u4f60\u60f3\u8981unicode\u7248\u672c\uff0c\u4f7f\u7528 TextResponse.text (\u4ec5\u5728 TextResponse \u548c\u5b50\u7c7b\u4e2d\u53ef\u7528)\u3002 \u8fd9\u4e2a\u5c5e\u6027\u662f\u53ea\u8bfb\u7684\u3002\u8981\u66f4\u6539response body\uff0c\u8bf7\u4f7f\u7528 replace() \u3002 request \u751f\u6210\u6b64response\u7684 Request \u5bf9\u8c61\u3002\u5728response\u548crequest\u901a\u8fc7\u6240\u6709 Downloader Middlewares \u4e4b\u540e\uff0c\u8fd9\u4e2a\u5c5e\u6027\u88ab\u5206\u914d\u5230Scrapy\u5f15\u64ce\u4e2d\u3002\u7279\u522b\u5730\uff0c\u8fd9\u610f\u5473\u7740: HTTP\u91cd\u5b9a\u5411\u5c06\u5bfc\u81f4\u539f\u59cb\u8bf7\u6c42(\u91cd\u5b9a\u5411\u524d\u7684URL)\u88ab\u5206\u914d\u7ed9\u91cd\u5b9a\u5411response(\u91cd\u5b9a\u5411\u540e\u7684\u6700\u7ec8URL)\u3002 Response.request.url\u5e76\u4e0d\u603b\u662f\u7b49\u4e8eResponse.url \u8be5\u5c5e\u6027\u4ec5\u5728spider\u4ee3\u7801\u548c Spider Middlewares \u4e2d\u53ef\u7528\uff0c\u4f46\u5728 Downloader Middlewares \u4e2d\u4e0d\u53ef\u7528(\u5c3d\u7ba1\u60a8\u53ef\u4ee5\u901a\u8fc7\u5176\u4ed6\u65b9\u5f0f\u83b7\u5f97\u8bf7\u6c42)\u548c response_downloaded \u4fe1\u53f7\u7684\u5904\u7406\u7a0b\u5e8f\u4e2d\u4e0d\u53ef\u7528\u3002 meta Response.request \u5bf9\u8c61(\u5373\u3002 self.request.meta )\u7684 Request.meta \u5c5e\u6027\u7684\u5feb\u6377\u65b9\u5f0f\u3002 \u4e0d\u540c\u4e8e Response.request \u5c5e\u6027, Response.meta \u5c5e\u6027\u901a\u8fc7\u91cd\u5b9a\u5411\u548c\u91cd\u8bd5\u4f20\u64ad, \u4f60\u4f1a\u4ece\u4f60\u7684spider\u5f97\u5230\u539f\u59cb\u7684 Request.meta \u3002 \u53c2\u89c1Request.meta\u5c5e\u6027 flags \u5305\u542b\u6b64response flag\u7684\u5217\u8868\u3002 flag\u662f\u7528\u4e8e\u6807\u8bb0response\u7684\u6807\u7b7e\u3002\u4f8b\u5982:'cached'\uff0c'redirect'\u7b49\u7b49\uff0c\u5b83\u4eec\u663e\u793a\u5728response\u7684\u5b57\u7b26\u4e32\u8868\u793a\u4e0a(__str__\u65b9\u6cd5)\uff0c\u8be5\u65b9\u6cd5\u88ab\u5f15\u64ce\u7528\u4e8e\u65e5\u5fd7\u8bb0\u5f55\u3002 copy() \u8fd4\u56de\u4e00\u4e2a\u65b0response\uff0c\u8be5response\u662f\u6b64response\u7684\u526f\u672c\u3002 replace([url, status, headers, body, request, flags, cls]) \u8fd4\u56de\u5177\u6709\u76f8\u540c\u6210\u5458\u7684response\u5bf9\u8c61\uff0c\u9664\u4e86\u90a3\u4e9b\u7531\u6307\u5b9a\u7684\u5173\u952e\u5b57\u53c2\u6570\u8d4b\u4e88\u65b0\u503c\u7684\u6210\u5458\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c Response.meta \u4f1a\u88ab\u590d\u5236\u3002 urljoin(url) \u901a\u8fc7\u5c06response\u7684url\u4e0e\u76f8\u5bf9url\u76f8\u7ed3\u5408\u6765\u6784\u9020\u4e00\u4e2a\u7edd\u5bf9url\u3002 \u8fd9\u662f urlparse.urljoin \u4e4b\u4e0a\u7684\u4e00\u4e2a\u5305\u88c5\u5668\uff0c\u5b83\u53ea\u662f\u8fdb\u884c\u6b64\u8c03\u7528\u7684\u522b\u540d: urlparse.urljoin(response.url, url) follow (url, callback=None, method='GET', headers=None, body=None, cookies=None, meta=None, encoding='utf-8', priority=0, dont_filter=False, errback=None) \u8fd4\u56de Request \u5b9e\u4f8b\u4ee5\u8ddf\u968f\u94fe\u63a5 url \u3002\u5b83\u63a5\u53d7\u4e0e Request.__init__ \u65b9\u6cd5\u76f8\u540c\u7684\u53c2\u6570\u3002\uff0c\u4f46 url \u53ef\u4ee5\u662f\u76f8\u5bf9url\u6216 scrapy.link.Link \u5bf9\u8c61\uff0c\u4e0d\u53ea\u662f\u7edd\u5bf9URL\u3002 TextResponse \u63d0\u4f9b\u4e86 follow() \u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u9664\u4e86\u652f\u6301\u7edd\u5bf9/\u76f8\u5bf9url\u548c\u94fe\u63a5\u5bf9\u8c61\u4e4b\u5916\uff0c\u8fd8\u652f\u6301\u9009\u62e9\u5668\u3002 Response\u5b50\u7c7b TextResponse\u5bf9\u8c61 scrapy.http.TextResponse(url[, encoding[, ...]]) \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) TextResponse \u5bf9\u8c61\u5411 Response \u57fa\u7c7b\u6dfb\u52a0\u7f16\u7801\u529f\u80fd\uff0c Response \u57fa\u7c7b\u53ea\u7528\u4e8e\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u5982\u56fe\u50cf\u3001\u58f0\u97f3\u6216\u4efb\u4f55\u5a92\u4f53\u6587\u4ef6\u3002 \u9664\u4e86\u57fa\u672c Response \u5bf9\u8c61\u4e4b\u5916\uff0c TextResponse \u5bf9\u8c61\u8fd8\u652f\u6301\u4e00\u4e2a\u65b0\u7684\u6784\u9020\u51fd\u6570\u53c2\u6570, \u5176\u4f59\u7684\u529f\u80fd\u4e0e Response \u7c7b\u76f8\u540c \u53c2\u6570: encoding (\u5b57\u7b26\u4e32) \u2013 \u5305\u542b\u7528\u4e8e\u6b64response\u7684\u7f16\u7801\u7684\u5b57\u7b26\u4e32, \u5982\u679c\u60a8\u4f7f\u7528unicode body\u521b\u5efa\u4e00\u4e2a TextResponse \u5bf9\u8c61, \u5b83\u5c06\u4f7f\u7528\u8fd9\u79cd\u7f16\u7801\u8fdb\u884c\u7f16\u7801(\u8bf7\u8bb0\u4f4fbody\u5c5e\u6027\u603b\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32), \u5982\u679c encoding \u4e3a None (\u9ed8\u8ba4\u503c)\uff0c\u5219\u5728response headers\u548cbody\u4e2d\u67e5\u627e\u7f16\u7801\u3002 \u9664\u4e86\u652f\u6301\u6807\u51c6\u7684 Response \u5c5e\u6027\u5916\uff0c TextResponse \u5bf9\u8c61\u8fd8\u652f\u6301\u4ee5\u4e0b\u5c5e\u6027: text response body\uff0c\u4f5c\u4e3aunicode\u3002 \u4e0e response.body.decode(response.encoding) \u76f8\u540c\uff0c\u4f46\u662f\u7ed3\u679c\u5728\u7b2c\u4e00\u6b21\u8c03\u7528\u4e4b\u540e\u7f13\u5b58\uff0c\u6240\u4ee5\u4f60\u53ef\u4ee5\u8bbf\u95ee response.text \u591a\u6b21\uff0c\u6ca1\u6709\u989d\u5916\u7684\u5f00\u9500\u3002 unicode(response.body)\u4e0d\u662f\u5c06response body\u8f6c\u6362\u4e3aunicode\u7684\u6b63\u786e\u65b9\u6cd5: \u60a8\u5c06\u4f7f\u7528\u7cfb\u7edf\u9ed8\u8ba4\u7f16\u7801(\u901a\u5e38\u662fascii)\uff0c\u800c\u4e0d\u662fresponse\u7f16\u7801\u3002 encoding \u5e26\u6709\u6b64response\u7f16\u7801\u7684\u5b57\u7b26\u4e32\u3002\u6309\u7167\u987a\u5e8f\uff0c\u53ef\u4ee5\u901a\u8fc7\u5c1d\u8bd5\u4ee5\u4e0b\u673a\u5236\u6765\u89e3\u51b3\u7f16\u7801\u95ee\u9898: \u5728\u6784\u9020\u51fd\u6570\u7f16\u7801\u53c2\u6570\u4e2d\u4f20\u9012\u7684\u7f16\u7801 HTTP headers\u5934\u91ccContent-Type\u58f0\u660e\u7f16\u7801\u3002\u5982\u679c\u6b64\u7f16\u7801\u65e0\u6548(\u5373\u672a\u77e5)\uff0c\u5b83\u88ab\u5ffd\u7565\uff0c\u5e76\u5c1d\u8bd5\u4e0b\u4e00\u4e2a\u89e3\u51b3\u673a\u5236\u3002 response body\u4f53\u4e2d\u58f0\u660e\u7684\u7f16\u7801\u3002 TextResponse \u7c7b\u6ca1\u6709\u4e3a\u6b64\u63d0\u4f9b\u4efb\u4f55\u7279\u6b8a\u529f\u80fd\u3002\u7136\u800c\uff0c HtmlResponse \u548c XmlResponse \u7c7bdo\u3002 \u7f16\u7801\u662f\u901a\u8fc7\u89c2\u5bdfresponse body\u4f53\u6765\u63a8\u65ad\u7684\u3002\u8fd9\u662f\u6bd4\u8f83\u8106\u5f31\u7684\u65b9\u6cd5\uff0c\u4e5f\u662f\u6700\u540e\u4e00\u4e2a\u5c1d\u8bd5\u7684\u65b9\u6cd5\u3002 selector \u4f7f\u7528response\u4f5c\u4e3a\u76ee\u6807\u7684 Selector \u5b9e\u4f8b\u3002\u9009\u62e9\u5668\u5728\u7b2c\u4e00\u6b21\u8bbf\u95ee\u65f6\u60f0\u6027\u5b9e\u4f8b\u5316\u3002 TextResponse \u5bf9\u8c61\u9664\u4e86\u652f\u6301\u6807\u51c6 Response \u65b9\u6cd5\u5916\uff0c\u8fd8\u652f\u6301\u4ee5\u4e0b\u65b9\u6cd5: xpath(query) TextResponse.selector.xpath(query) \u7684\u5feb\u6377\u65b9\u5f0f response.xpath('//p') css(query) TextResponse.selector.css(query) \u7684\u5feb\u6377\u65b9\u5f0f response.css('p') follow(url, callback=None, method='GET', headers=None, body=None, cookies=None, meta=None, encoding=None, priority=0, dont_filter=False, errback=None) \u8fd4\u56de Request \u5b9e\u4f8b\u4ee5\u8ddf\u968f\u94fe\u63a5 url \u3002\u5b83\u63a5\u53d7\u4e0e Request.__init__ \u76f8\u540c\u7684\u53c2\u6570\u3002 \u4f46 url \u4e0d\u4ec5\u53ef\u4ee5\u662f\u4e00\u4e2a\u7edd\u5bf9url\uff0c\u800c\u4e14\u4e5f\u662f \u4e00\u4e2a\u76f8\u5bf9URL \u4e00\u4e2ascrapy.link.Link\u5bf9\u8c61(\u5982link extractor(\u94fe\u63a5\u63d0\u53d6\u5668)\u7ed3\u679c); \u4e00\u4e2a\u5c5e\u6027Selector(\u4e0d\u662fSelectorList) - \u6bd4\u5982 response.css('a::attr(href)')[0] \u6216 response.xpath('//img/@src')[0] \u3002 \u4e00\u4e2a a \u6216 link \u5143\u7d20\u7684Selector, \u6bd4\u5982 response.css('a.my_link')[0] \u8bf7\u53c2\u9605 \u521b\u5efaRequests\u7684\u5feb\u6377\u65b9\u5f0f \u4f7f\u7528\u4f8b\u5b50 body_as_unicode() \u4e0e text \u76f8\u540c\uff0c\u4f46\u4f5c\u4e3a\u65b9\u6cd5\u53ef\u7528\u3002\u8fd9\u79cd\u65b9\u6cd5\u662f\u4e3a\u4e86\u5411\u540e\u517c\u5bb9;\u8bf7\u9009\u62e9 response.text \u3002 HtmlResponse\u5bf9\u8c61 scrapy.http.HtmlResponse(url[, ...]) \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) HtmlResponse \u7c7b\u662f TextResponse \u7684\u4e00\u4e2a\u5b50\u7c7b\uff0c\u5b83\u901a\u8fc7\u67e5\u627eHTML\u7684 meta http-equiv \u5c5e\u6027\u6765\u6dfb\u52a0\u7f16\u7801\u81ea\u52a8\u53d1\u73b0\u652f\u6301\u3002\u770b TextResponse.encoding \u3002 XmlResponse\u5bf9\u8c61 scrapy.http.XmlResponse(url[, ...]) \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) XmlResponse \u7c7b\u662f TextResponse \u7684\u5b50\u7c7b\uff0c\u5b83\u901a\u8fc7\u67e5\u770bXML\u58f0\u660e\u884c\u6dfb\u52a0\u7f16\u7801\u81ea\u52a8\u53d1\u73b0\u652f\u6301\u3002\u770b TextResponse.encoding \u3002","title":"Requests\u548cResponses"},{"location":"2. \u57fa\u672c\u6982\u5ff5/14-requests_response/#requestsresponses","text":"Scrapy\u4f7f\u7528 Request \u548c Response \u5bf9\u8c61\u6765\u6293\u53d6web\u7ad9\u70b9\u3002 \u901a\u5e38\uff0c Request \u5bf9\u8c61\u5728spiders\u4e2d\u751f\u6210\u5e76\u5728\u7cfb\u7edf\u4e2d\u4f20\u9012\uff0c\u76f4\u5230\u5b83\u4eec\u5230\u8fbeDownloader\uff0cDownloader\u6267\u884crequest\u5e76\u8fd4\u56de\u53d1\u51farequest\u7684spider\u7684 Response \u5bf9\u8c61\u3002 Request \u7c7b\u548c Response \u7c7b\u90fd\u6709\u6dfb\u52a0\u57fa\u7c7b\u4e2d\u4e0d\u9700\u8981\u7684\u529f\u80fd\u7684\u5b50\u7c7b\u3002\u4e0b\u9762\u5728 \u8bf7\u6c42\u5b50\u7c7b \u548c \u54cd\u5e94\u5b50\u7c7b \u4e2d\u63cf\u8ff0\u4e86\u8fd9\u4e9b\u3002","title":"Requests\u548cResponses"},{"location":"2. \u57fa\u672c\u6982\u5ff5/14-requests_response/#request","text":"","title":"Request\u5bf9\u8c61"},{"location":"2. \u57fa\u672c\u6982\u5ff5/14-requests_response/#scrapyhttprequesturl-callback-methodget-headers-body-cookies-meta-encodingutf-8-priority0-dont_filterfalse-errback-flags-class","text":"Request \u5bf9\u8c61\u8868\u793aHTTP\u8bf7\u6c42\uff0c\u901a\u5e38\u5728Spider\u4e2d\u751f\u6210\u5e76\u7531Downloader\u6267\u884c\uff0c\u4ece\u800c\u751f\u6210 Response \u3002 \u53c2\u6570: url (\u5b57\u7b26\u4e32) \u2013 \u6b64\u6b21\u8bf7\u6c42\u7684url callback (\u53ef\u8c03\u7528\u7684) \u2014 \u8fd9\u4e2a\u51fd\u6570\u5c06\u88ab\u8c03\u7528\uff0c\u5e76\u5c06\u6b64request\u7684response(\u4e0b\u8f7d\u540e)\u4f5c\u4e3a\u5176\u7b2c\u4e00\u4e2a\u53c2\u6570\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 \u5c06\u989d\u5916\u6570\u636e\u4f20\u9012\u7ed9\u56de\u8c03\u51fd\u6570 \u3002\u5982\u679c\u8bf7\u6c42\u6ca1\u6709\u6307\u5b9acallback\uff0c\u5c06\u4f7f\u7528spider\u7684 parse() \u65b9\u6cd5\u3002\u6ce8\u610f\uff0c\u5982\u679c\u5728\u5904\u7406\u671f\u95f4\u5f15\u53d1\u5f02\u5e38\uff0c\u5219\u4f1a\u8c03\u7528 errback \u3002 method (\u5b57\u7b26\u4e32) \u2013 \u6b64request\u7684HTTP\u65b9\u6cd5\u3002\u9ed8\u8ba4\u4e3a'GET'. meta (\u5b57\u5178) \u2013 Request.meta \u7684\u521d\u59cb\u503c\u3002\u5143\u5c5e\u6027\u3002\u5982\u679c\u7ed9\u5b9a\uff0c\u5728\u6b64\u53c2\u6570\u4e2d\u4f20\u9012\u7684dict\u5c06\u88ab\u6d45\u590d\u5236\u3002 body (\u5b57\u7b26\u4e32\u6216unicode) \u2013 request\u4e3b\u4f53\u3002\u5982\u679c\u4f20\u9012\u4e86 unicode \uff0c\u5219\u4f7f\u7528\u4f20\u9012\u7684\u7f16\u7801(\u9ed8\u8ba4\u4e3autf-8)\u5c06\u5176\u7f16\u7801\u4e3astr\u3002\u5982\u679c\u6ca1\u6709\u7ed9\u51fabody\uff0c\u5219\u5b58\u50a8\u4e00\u4e2a\u7a7a\u5b57\u7b26\u4e32\u3002\u4e0d\u7ba1\u8fd9\u4e2a\u53c2\u6570\u7684\u7c7b\u578b\u662f\u4ec0\u4e48\uff0c\u6700\u7ec8\u5b58\u50a8\u7684\u503c\u90fd\u5c06\u662f str (\u4ece\u4e0d\u4f7f\u7528 unicode \u6216 None )\u3002 headers (\u5b57\u5178) \u2013 \u6b64\u8bf7\u6c42\u7684headers\u3002\u5b57\u5178\u7684\u503c\u53ef\u4ee5\u662f\u5b57\u7b26\u4e32(\u7528\u4e8e\u5355\u503cheaders)\u6216\u5217\u8868(\u7528\u4e8e\u591a\u503cheaders)\u3002\u5982\u679c None \u4f5c\u4e3a\u503c\u4f20\u9012\uff0c\u5219\u6839\u672c\u4e0d\u4f1a\u53d1\u9001HTTP\u5934\u3002 cookies (\u5b57\u5178\u6216\u5217\u8868) \u2013\u6b64\u8bf7\u6c42\u7684cookie\u3002\u53ef\u4ee5\u4ee5\u4e24\u79cd\u5f62\u5f0f\u53d1\u9001\u3002 \u4f7f\u7528\u5b57\u5178 request_with_cookies = Request(url= http://www.example.com , cookies={'currency': 'USD', 'country': 'UY'}) \u4f7f\u7528\u5b57\u5178\u5217\u8868 request_with_cookies = Request(url= http://www.example.com , cookies=[{'name': 'currency', 'value': 'USD', 'domain': 'example.com', 'path': '/currency'}]) \u540e\u4e00\u79cd\u5f62\u5f0f\u5141\u8bb8\u5b9a\u5236cookie\u7684 domain \u548c path \u5c5e\u6027\u3002\u8fd9\u53ea\u5728cookie\u4e3a\u4ee5\u540e\u7684\u8bf7\u6c42\u4fdd\u5b58\u65f6\u6709\u7528\u3002 \u5f53\u67d0\u4e9b\u7ad9\u70b9\u8fd4\u56decookie(\u5728response\u4e2d)\u65f6\uff0c\u8fd9\u4e9bcookie\u5b58\u50a8\u5728\u8be5\u57df\u7684cookie\u4e2d\uff0c\u5e76\u5c06\u5728\u4ee5\u540e\u7684request\u4e2d\u518d\u6b21\u53d1\u9001\u3002\u8fd9\u662f\u4efb\u4f55\u666e\u901aweb\u6d4f\u89c8\u5668\u7684\u5178\u578b\u884c\u4e3a\u3002\u4f46\u662f\uff0c\u5982\u679c\u51fa\u4e8e\u67d0\u79cd\u539f\u56e0\uff0c\u60a8\u60f3\u907f\u514d\u4e0e\u73b0\u6709cookie\u5408\u5e76\uff0c\u90a3\u4e48\u53ef\u4ee5\u901a\u8fc7\u5728 Request.meta \u4e2d\u5c06 dont_merge_cookie \u952e\u8bbe\u7f6e\u4e3aTrue\u6765\u6307\u793aScrapy\u8fd9\u6837\u505a\u3002 request\u4e0d\u5408\u5e76cookie\u7684\u4f8b\u5b50: request_with_cookies = Request(url= http://www.example.com , cookies={'currency': 'USD', 'country': 'UY'}, meta={'dont_merge_cookies': True}) \u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 CookiesMiddleware \u3002 encoding (\u5b57\u7b26\u4e32) \u2013 \u6b64\u8bf7\u6c42\u7684\u7f16\u7801(\u9ed8\u8ba4\u4e3a 'utf-8' )\u3002 \u8fd9\u79cd\u7f16\u7801\u5c06\u7528\u4e8e\u5bf9URL\u8fdb\u884c\u767e\u5206\u6bd4\u7f16\u7801\uff0c\u5e76\u5c06body\u8f6c\u6362\u4e3a str (\u5982\u679c\u4ee5 unicode \u8868\u793a\u7684\u8bdd)\u3002 priority (\u6574\u578b) \u2013 \u6b64\u8bf7\u6c42\u7684\u4f18\u5148\u7ea7(\u9ed8\u8ba4\u4e3a 0 ).\u8c03\u5ea6\u7a0b\u5e8f\u4f7f\u7528\u8be5\u4f18\u5148\u7ea7\u5b9a\u4e49\u5904\u7406\u8bf7\u6c42\u7684\u987a\u5e8f\u3002\u5177\u6709\u66f4\u9ad8\u4f18\u5148\u7ea7\u503c\u7684\u8bf7\u6c42\u5c06\u66f4\u65e9\u6267\u884c\u3002\u4e3a\u4e86\u8868\u793a\u76f8\u5bf9\u8f83\u4f4e\u7684\u4f18\u5148\u7ea7\uff0c\u5141\u8bb8\u4f7f\u7528\u8d1f\u503c\u3002 dont_filter (\u5e03\u5c14) - \u6307\u793a\u8c03\u5ea6\u7a0b\u5e8f\u4e0d\u5e94\u8be5\u8fc7\u6ee4\u6b64\u8bf7\u6c42\u3002\u5f53\u60a8\u60f3\u8981\u591a\u6b21\u6267\u884c\u76f8\u540c\u7684\u8bf7\u6c42\uff0c\u4ee5\u5ffd\u7565\u53bb\u91cd\u8fc7\u6ee4\u5668\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u8fd9\u79cd\u65b9\u6cd5\u3002\u5c0f\u5fc3\u4f7f\u7528\u5b83\uff0c\u5426\u5219\u4f60\u4f1a\u9677\u5165\u722c\u884c\u5faa\u73af\u3002\u9ed8\u8ba4\u4e3a False \u3002 errback(\u53ef\u8c03\u7528\u7684) - \u5728\u5904\u7406\u8bf7\u6c42\u65f6\uff0c\u5982\u679c\u51fa\u73b0\u4efb\u4f55\u5f02\u5e38\uff0c\u5c06\u8c03\u7528\u8be5\u51fd\u6570\u3002\u8fd9\u5305\u62ec404 HTTP\u9519\u8bef\u7b49\u5931\u8d25\u7684\u9875\u9762\u3002\u5b83\u63a5\u6536\u4e00\u4e2a Twisted Failure \u5b9e\u4f8b\u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u53c2\u6570\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1\u4e0b\u9762 \u4f7f\u7528errbacks\u6355\u83b7\u8bf7\u6c42\u5904\u7406\u4e2d\u7684\u5f02\u5e38 \u3002 flags(\u5217\u8868)-\u53d1\u9001\u5230\u8bf7\u6c42\u7684flag\uff0c\u53ef\u4ee5\u7528\u4e8e\u65e5\u5fd7\u8bb0\u5f55\u6216\u7c7b\u4f3c\u76ee\u7684\u3002 url \u5305\u542b\u6b64\u8bf7\u6c42URL\u7684\u5b57\u7b26\u4e32\u3002\u8bf7\u8bb0\u4f4f\uff0c\u8be5\u5c5e\u6027\u5305\u542b\u8f6c\u4e49URL\uff0c\u56e0\u6b64\u5b83\u53ef\u80fd\u4e0e\u5728\u6784\u9020\u51fd\u6570\u4e2d\u4f20\u9012\u7684URL\u4e0d\u540c\u3002 \u8fd9\u4e2a\u5c5e\u6027\u662f\u53ea\u8bfb\u7684\u3002\u8981\u66f4\u6539\u8bf7\u6c42\u7684URL\uff0c\u8bf7\u4f7f\u7528 replace() \u3002 method \u8868\u793a\u8bf7\u6c42\u7684HTTP\u65b9\u6cd5\u7684\u5b57\u7b26\u4e32\u3002\u8fd9\u4fdd\u8bc1\u662f\u5927\u5199\u7684\u3002\u4f8b\u5982: GET , POST , PUT \u7b49\u7b49 headers \u5305\u542b\u8bf7\u6c42headers\u7684\u7c7b\u4f3c\u5b57\u5178\u7684\u5bf9\u8c61\u3002 body \u5305\u542b\u8bf7\u6c42body\u7684\u5b57\u7b26\u4e32\u3002 \u8fd9\u4e2a\u5c5e\u6027\u662f\u53ea\u8bfb\u7684\u3002\u8981\u66f4\u6539\u8bf7\u6c42\u7684body\uff0c\u8bf7\u4f7f\u7528 replace() \u3002 meta \u5305\u542b\u6b64\u8bf7\u6c42\u7684\u4efb\u610fmetadata\u7684\u5b57\u5178\u3002\u8fd9\u4e2adict\u5bf9\u4e8e\u65b0\u8bf7\u6c42\u662f\u7a7a\u7684\uff0c\u901a\u5e38\u7531\u4e0d\u540c\u7684Scrapy\u7ec4\u4ef6(extensions(\u6269\u5c55)\u3001middlewares(\u4e2d\u95f4\u4ef6)\u7b49)\u586b\u5145\u3002\u56e0\u6b64\uff0c\u5b57\u5178\u4e2d\u5305\u542b\u7684\u6570\u636e\u53d6\u51b3\u4e8e\u60a8\u542f\u7528\u7684(extensions(\u6269\u5c55)\u3002 \u770b\u4e00\u4e0b Request.meta\u7279\u6b8a\u952e \u3002\u7531Scrapy\u8bc6\u522b\u7684\u4e00\u7ec4\u7279\u6b8ameta\u952e\u3002 \u5f53\u4f7f\u7528 copy() \u6216 replace() \u65b9\u6cd5\u514b\u9686\u8bf7\u6c42\u65f6\uff0c\u8fd9\u4e2adict\u662f \u6d45\u590d\u5236 \u7684\uff0c\u4e5f\u53ef\u4ee5\u5728\u60a8\u7684spider\u4e2d\u4eceresponse\u8bbf\u95ee response.meta \u5c5e\u6027\u3002 copy() \u8fd4\u56de\u4e00\u4e2a\u65b0\u8bf7\u6c42\uff0c\u8be5\u8bf7\u6c42\u662f\u6b64\u8bf7\u6c42\u7684\u526f\u672c\u3002\u8bf7\u53c2\u9605: \u5c06\u989d\u5916\u6570\u636e\u4f20\u9012\u7ed9\u56de\u8c03\u51fd\u6570 \u3002 replace([url, method, headers, body, cookies, meta, encoding, dont_filter, callback, errback]) \u8fd4\u56de\u5177\u6709\u76f8\u540c\u6210\u5458\u7684\u8bf7\u6c42\u5bf9\u8c61\uff0c\u9664\u4e86\u90a3\u4e9b\u7531\u6307\u5b9a\u7684\u5173\u952e\u5b57\u53c2\u6570\u8d4b\u4e88\u65b0\u503c\u7684\u6210\u5458\u3002 \u9ed8\u8ba4\u7684 Request.meta \u60c5\u51b5\u4e0b\uff0cmeta\u4f1a\u88ab\u590d\u5236(\u9664\u975e\u5728 meta \u53c2\u6570\u4e2d\u7ed9\u51fa\u4e86\u4e00\u4e2a\u65b0\u7684\u503c)\u3002\u8bf7\u53c2\u9605 \u5411\u56de\u8c03\u51fd\u6570\u4f20\u9012\u989d\u5916\u6570\u636e \u3002","title":"scrapy.http.Request(url[, callback, method='GET', headers, body, cookies, meta, encoding='utf-8', priority=0, dont_filter=False, errback, flags])   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/14-requests_response/#callback","text":"\u8bf7\u6c42\u7684callback\u51fd\u6570\u662f\u5728\u4e0b\u8f7d\u8be5request\u7684response\u65f6\u8c03\u7528\u7684\u51fd\u6570\u3002\u5c06\u4f7f\u7528\u4e0b\u8f7d\u7684 Response \u5bf9\u8c61\u4f5c\u4e3a\u5176\u7b2c\u4e00\u4e2a\u53c2\u6570\u8c03\u7528callback\u51fd\u6570\u3002 \u4f8b\u5b50: def parse_page1(self, response): return scrapy.Request( http://www.example.com/some_page.html , callback=self.parse_page2) def parse_page2(self, response): # \u8fd9\u5c06\u4f1a\u65e5\u5fd7\u8bb0\u5f55\u4e0b\u6765 http://www.example.com/some_page.html self.logger.info( Visited %s , response.url) \u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u60a8\u53ef\u80fd\u5bf9\u5411\u8fd9\u4e9bcallback\u51fd\u6570\u4f20\u9012\u53c2\u6570\u611f\u5174\u8da3\uff0c\u4ee5\u4fbf\u7a0d\u540e\u5728\u7b2c\u4e8c\u6b21callback\u4e2d\u63a5\u6536\u8fd9\u4e9b\u53c2\u6570\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 Request.meta \u5c5e\u6027\u3002 \u4e0b\u9762\u662f\u5982\u4f55\u4f7f\u7528\u8fd9\u79cd\u673a\u5236\u4f20\u9012item\u7684\u793a\u4f8b\uff0c\u4ee5\u586b\u5145\u6765\u81ea\u4e0d\u540c\u9875\u9762\u7684\u4e0d\u540c\u5b57\u6bb5: def parse_page1(self, response): item = MyItem() item['main_url'] = response.url request = scrapy.Request( http://www.example.com/some_page.html , callback=self.parse_page2) request.meta['item'] = item yield request def parse_page2(self, response): item = response.meta['item'] item['other_url'] = response.url yield item","title":"\u5c06\u989d\u5916\u6570\u636e\u4f20\u9012\u7ed9callback\u51fd\u6570"},{"location":"2. \u57fa\u672c\u6982\u5ff5/14-requests_response/#errback","text":"\u8bf7\u6c42\u7684errback\u662f\u5728\u5904\u7406\u5f02\u5e38\u65f6\u8c03\u7528\u7684\u51fd\u6570\u3002 \u5b83\u63a5\u6536\u4e00\u4e2a Twisted Failure \u5b9e\u4f8b\u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u53c2\u6570\uff0c\u53ef\u4ee5\u7528\u6765\u8ddf\u8e2a\u8fde\u63a5\u5efa\u7acb\u8d85\u65f6\u3001DNS\u9519\u8bef\u7b49\u3002 \u4e0b\u9762\u662f\u4e00\u4e2aspider\u8bb0\u5f55\u6240\u6709\u9519\u8bef\u7684\u4f8b\u5b50\uff0c\u5982\u679c\u9700\u8981\uff0c\u5b83\u53ef\u4ee5\u6355\u83b7\u4e00\u4e9b\u7279\u5b9a\u7684\u9519\u8bef: import scrapy from scrapy.spidermiddlewares.httperror import HttpError from twisted.internet.error import DNSLookupError from twisted.internet.error import TimeoutError, TCPTimedOutError class ErrbackSpider(scrapy.Spider): name = errback_example start_urls = [ http://www.httpbin.org/ , # \u9884\u8ba1\u662fHTTP 200 http://www.httpbin.org/status/404 , # \u6ca1\u6709\u627e\u5230\u7684\u9519\u8bef http://www.httpbin.org/status/500 , # \u670d\u52a1\u5668\u95ee\u9898 http://www.httpbin.org:12345/ , # \u672a\u54cd\u5e94\u4e3b\u673a, \u9884\u8ba1\u8d85\u65f6 http://www.httphttpbinbin.org/ , # \u9884\u8ba1\u662fDNS\u9519\u8bef ] def start_requests(self): for u in self.start_urls: yield scrapy.Request(u, callback=self.parse_httpbin, errback=self.errback_httpbin, dont_filter=True) def parse_httpbin(self, response): self.logger.info('Got successful response from {}'.format(response.url)) # \u505a\u4e00\u4e9b\u6709\u7528\u7684\u4e8b\u60c5... def errback_httpbin(self, failure): # \u8bb0\u5f55\u6240\u6709\u9519\u8bef self.logger.error(repr(failure)) # \u5982\u679c\u4f60\u60f3\u5bf9\u4e00\u4e9b\u9519\u8bef\u505a\u4e00\u4e9b\u7279\u522b\u7684\u5904\u7406, # \u4f60\u53ef\u80fd\u9700\u8981\u5931\u8d25\u7684\u7c7b\u578b: if failure.check(HttpError): # \u8fd9\u4e9b\u5f02\u5e38\u6765\u81eaHttpError spider \u4e2d\u95f4\u4ef6 # \u4f60\u53ef\u4ee5\u5f97\u5230\u975e200\u7684response response = failure.value.response self.logger.error('HttpError on %s', response.url) elif failure.check(DNSLookupError): # \u8fd9\u662f\u539f\u59cb\u8bf7\u6c42 request = failure.request self.logger.error('DNSLookupError on %s', request.url) elif failure.check(TimeoutError, TCPTimedOutError): request = failure.request self.logger.error('TimeoutError on %s', request.url)","title":"\u4f7f\u7528errback\u5728\u8bf7\u6c42\u5904\u7406\u4e2d\u6355\u83b7\u5f02\u5e38"},{"location":"2. \u57fa\u672c\u6982\u5ff5/14-requests_response/#requestmeta","text":"Request.meta \u5c5e\u6027\u53ef\u4ee5\u5305\u542b\u4efb\u610f\u7684\u6570\u636e\uff0c\u4f46\u662f\u6709\u4e00\u4e9b\u7279\u6b8a\u7684\u952e\u88abScrapy\u548c\u5b83\u7684\u5185\u7f6e\u6269\u5c55\u6240\u8bc6\u522b\u3002 \u8fd9\u4e9b\u662f: dont_redirect dont_retry handle_httpstatus_list handle_httpstatus_all dont_merge_cookies cookiejar dont_cache redirect_urls bindaddress dont_obey_robotstxt download_timeout download_maxsize download_latency download_fail_on_dataloss proxy ftp_user \uff08\u8bf7\u53c2\u9605 FTP_USER \u4ee5\u83b7\u5f97\u66f4\u591a\u4fe1\u606f\uff09 ftp_password \uff08\u8bf7\u53c2\u9605 FTP_PASSWORD \u4ee5\u83b7\u5f97\u66f4\u591a\u4fe1\u606f\uff09 referrer_policy max_retry_times","title":"Request.meta \u7279\u6b8a\u952e"},{"location":"2. \u57fa\u672c\u6982\u5ff5/14-requests_response/#bindaddress","text":"\u8f93\u51faIP\u5730\u5740\u7684IP\u7528\u4e8e\u6267\u884c\u8bf7\u6c42\u3002","title":"bindaddress"},{"location":"2. \u57fa\u672c\u6982\u5ff5/14-requests_response/#download_timeout","text":"\u5728\u8d85\u65f6\u4e4b\u524d\uff0cdownloader\u5c06\u7b49\u5f85\u6700\u5927\u65f6\u95f4\uff08\u79d2\uff09\u3002\u53c2\u89c1: DOWNLOAD_TIMEOUT \u3002","title":"download_timeout"},{"location":"2. \u57fa\u672c\u6982\u5ff5/14-requests_response/#download_latency","text":"\u7528\u4e8e\u83b7\u53d6response\u7684\u65f6\u95f4\uff0c\u56e0\u4e3arequest\u5df2\u7ecf\u542f\u52a8\uff0c\u5373\u901a\u8fc7\u7f51\u7edc\u53d1\u9001\u7684HTTP\u6d88\u606f\u3002\u53ea\u6709\u5f53response\u88ab\u4e0b\u8f7d\u65f6\uff0c\u8fd9\u4e2ameta\u952e\u624d\u4f1a\u51fa\u73b0\u3002\u800c\u5927\u591a\u6570\u5176\u4ed6meta\u952e\u90fd\u662f\u7528\u6765\u63a7\u5236Scrapy\u884c\u4e3a\u7684\uff0c\u4f46\u662f\u8fd9\u4e2a\u5e94\u8be5\u662f\u53ea\u8bfb\u7684\u3002","title":"download_latency"},{"location":"2. \u57fa\u672c\u6982\u5ff5/14-requests_response/#download_fail_on_dataloss","text":"\u662f\u5426\u4f1a\u5728\u635f\u574f\u7684response\u4e2d\u5931\u8d25\u3002\u770b\u5230: DOWNLOAD_FAIL_ON_DATALOSS \u3002","title":"download_fail_on_dataloss"},{"location":"2. \u57fa\u672c\u6982\u5ff5/14-requests_response/#max_retry_times","text":"\u8fd9\u4e2ameta\u952e\u88ab\u7528\u6765\u8bbe\u7f6e\u6bcf\u4e2a\u8bf7\u6c42\u7684\u91cd\u8bd5\u65f6\u95f4\u3002\u5f53\u521d\u59cb\u5316\u65f6\uff0c max_retry_times meta\u952e\u6bd4 RETRY_TIMES \u8bbe\u7f6e\u4f18\u5148\u7ea7\u66f4\u9ad8\u3002","title":"max_retry_times"},{"location":"2. \u57fa\u672c\u6982\u5ff5/14-requests_response/#request-subclasses","text":"\u4e0b\u9762\u662f\u5185\u7f6e Request \u5b50\u7c7b\u7684\u5217\u8868\u3002\u60a8\u8fd8\u53ef\u4ee5\u5bf9\u5b83\u8fdb\u884c\u5b50\u7c7b\u5316\u6765\u5b9e\u73b0\u60a8\u81ea\u5df1\u7684\u5b9a\u5236\u529f\u80fd\u3002","title":"Request subclasses"},{"location":"2. \u57fa\u672c\u6982\u5ff5/14-requests_response/#formrequest-objects","text":"FormRequest\u7c7b\u6269\u5c55\u4e86 Request \u57fa\u7c7b\uff0c\u5e76\u63d0\u4f9b\u4e86\u5904\u7406HTML\u8868\u5355\u7684\u529f\u80fd\u3002\u5b83\u4f7f\u7528 lxml.html\u8868\u5355 \u4ece Response \u5bf9\u8c61\u7684\u8868\u5355\u6570\u636e\u9884\u5148\u586b\u5145\u8868\u5355\u5b57\u6bb5","title":"FormRequest objects"},{"location":"2. \u57fa\u672c\u6982\u5ff5/14-requests_response/#scrapyhttpformrequesturl-formdata-class","text":"FormRequest \u7c7b\u5411\u6784\u9020\u51fd\u6570\u6dfb\u52a0\u4e86\u4e00\u4e2a\u65b0\u7684\u53c2\u6570\u3002\u5269\u4e0b\u7684\u53c2\u6570\u4e0e Request \u7c7b\u76f8\u540c\uff0c\u8fd9\u91cc\u6ca1\u6709\u6587\u6863\u8bb0\u5f55\u3002 \u53c2\u6570: formdata (\u5b57\u5178\u6216\u8005\u662f\u4e00\u4e2a\u53ef\u8fed\u4ee3\u7684\u5143\u7ec4) - \u662f\u4e00\u4e2a\u5b57\u5178(\u6216\u8005\u662f\u4e00\u4e2a\u53ef\u8fed\u4ee3\u7684\u952e\u503c\u5bf9\u5143\u7ec4)\u5305\u542bHTML\u8868\u5355\u6570\u636e\uff0c\u8fd9\u4e9b\u6570\u636e\u5c06\u88aburl\u7f16\u7801\u5e76\u5206\u914d\u7ed9request\u7684body\u3002 \u9664\u4e86\u6807\u51c6 Request \u65b9\u6cd5\u4e4b\u5916\uff0c FormRequest \u5bf9\u8c61\u8fd8\u652f\u6301\u4e0b\u5217\u7c7b\u65b9\u6cd5\uff1a from_response (response[, formname=None, formid=None, formnumber=0, formdata=None, formxpath=None, formcss=None, clickdata=None, dont_click=False, ...]) \u8fd9\u662f\u4e00\u4e2a\u7c7b\u65b9\u6cd5(classmethod) \u8fd4\u56de\u4e00\u4e2a\u65b0\u7684 FormRequest \u5bf9\u8c61\uff0c\u5b83\u7684\u8868\u5355\u5b57\u6bb5\u503c\u9884\u5148\u586b\u5145\u4e86\u5728\u7ed9\u5b9aresponse\u4e2d\u5305\u542b\u7684HTML form \u5143\u7d20\u4e2d\u7684\u5143\u7d20\u3002\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u770b\u4e00\u4e0b \u4f7f\u7528FormRequest.from_response()\u6765\u6a21\u62df\u7528\u6237\u767b\u5f55 \u3002 \u8be5\u7b56\u7565\u662f\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5728\u4efb\u4f55\u770b\u8d77\u6765\u53ef\u70b9\u51fb\u7684\u5143\u7d20\u4e0a\u81ea\u52a8\u6a21\u62df\u70b9\u51fb\uff0c\u5c31\u50cf input type=\"submit\" \u3002\u5c3d\u7ba1\u8fd9\u5f88\u65b9\u4fbf\uff0c\u800c\u4e14\u901a\u5e38\u662f\u6211\u4eec\u60f3\u8981\u7684\u884c\u4e3a\uff0c\u4f46\u6709\u65f6\u5b83\u4f1a\u5bfc\u81f4\u96be\u4ee5\u8c03\u8bd5\u7684\u95ee\u9898\u3002\u4f8b\u5982\uff0c\u5728\u4f7f\u7528javascript\u586b\u5199\u548c/\u6216\u63d0\u4ea4\u7684\u8868\u5355\u65f6\uff0c\u9ed8\u8ba4\u7684 from_response() \u884c\u4e3a\u53ef\u80fd\u4e0d\u662f\u6700\u5408\u9002\u7684\u3002\u8981\u7981\u7528\u8fd9\u79cd\u884c\u4e3a\uff0c\u60a8\u53ef\u4ee5\u5c06 dont_click \u53c2\u6570\u8bbe\u7f6e\u4e3a True \u3002\u53e6\u5916\uff0c\u5982\u679c\u4f60\u60f3\u8981\u6539\u53d8\u63a7\u5236\u70b9\u51fb\uff08\u800c\u4e0d\u662f\u7981\u7528\u5b83\uff09\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 clickdata \u53c2\u6570 \u8b66\u544a!!!!!!! \u4f7f\u7528\u8fd9\u79cd\u65b9\u6cd5\uff0c\u9009\u62e9\u5177\u6709\u524d\u5bfc\u7684\u5143\u7d20\u6216\u5728\u9009\u9879\u503c\u4e2d\u7ed3\u5c3e\u7a7a\u767d\u5c06\u65e0\u6cd5\u5de5\u4f5c\uff0c \u56e0\u4e3alxml\u4e2d\u7684\u4e00\u4e2abug(https://bugs.launchpad.net/lxml/+bug/1665241)\uff0c \u5e94\u8be5\u5728lxml 3.8\u548c\u66f4\u9ad8\u7248\u672c\u4e2d\u4fee\u590d\u3002 \u53c2\u6570: response([Request]\u5bf9\u8c61) - \u5305\u542b\u4e00\u4e2aHTML\u8868\u5355\u7684response\uff0c\u8be5\u8868\u5355\u5c06\u7528\u4e8e\u9884\u586b\u5145\u8868\u5355\u5b57\u6bb5 formname(\u5b57\u7b26\u4e32) - \u5982\u679c\u7ed9\u5b9a\u7684\u8bdd\uff0c\u5e26\u6709name\u5c5e\u6027\u7684\u8868\u5355\u5c06\u88ab\u4f7f\u7528\u3002 formid (\u5b57\u7b26\u4e32) - \u5982\u679c\u7ed9\u5b9a\uff0c\u5e26\u6709id\u5c5e\u6027\u7684\u8868\u5355\u5c06\u88ab\u4f7f\u7528 formxpath(\u5b57\u7b26\u4e32) - \u5982\u679c\u7ed9\u5b9a, \u7b2c\u4e00\u4e2a\u4e0expath\u5339\u914d\u7684\u8868\u5355\u5c06\u88ab\u4f7f\u7528 formcss (\u5b57\u7b26\u4e32) \u2013 \u5982\u679c\u7ed9\u5b9a, \u4e0ecss\u9009\u62e9\u5668\u5339\u914d\u7684\u7b2c\u4e00\u4e2a\u8868\u5355\u5c06\u88ab\u4f7f\u7528\u3002 formnumber (int\u6574\u578b) \u2013 \u5f53\u54cd\u5e94\u5305\u542b\u591a\u4e2a\u8868\u5355\u65f6\uff0c\u8981\u4f7f\u7528\u7684\u8868\u5355\u6570\u503c\u5730\u5740\u3002\u7b2c\u4e00\u4e2a\uff08\u4e5f\u662f\u9ed8\u8ba4\u503c\uff09\u662f 0 formdata (\u5b57\u5178) \u2013 \u5728\u8868\u5355\u6570\u636e\u4e2d\u8981\u8986\u76d6\u7684\u5b57\u6bb5\u3002\u5982\u679c\u4e00\u4e2a\u5b57\u6bb5\u5df2\u7ecf\u51fa\u73b0\u5728response\u7684 form \u5143\u7d20\u4e2d\uff0c\u90a3\u4e48\u5b83\u7684\u503c\u5c31\u4f1a\u88ab\u8fd9\u4e2a\u53c2\u6570\u4e2d\u4f20\u9012\u7684\u503c\u6240\u8986\u76d6\u3002\u5982\u679c\u5728\u8fd9\u4e2a\u53c2\u6570\u4e2d\u4f20\u9012\u7684\u503c\u662f None \uff0c\u8be5\u5b57\u6bb5\u5c06\u4e0d\u5305\u542b\u5728request\u4e2d\uff0c\u5373\u4f7f\u5b83\u662f\u5728response\u7684 form \u5143\u7d20\u4e2d\u51fa\u73b0\u7684\u3002 clickdata (\u5b57\u5178) \u2013 \u67e5\u627e\u53ef\u5355\u51fb\u63a7\u4ef6\u7684\u5c5e\u6027\u3002\u5982\u679c\u6ca1\u6709\u7ed9\u51fa\uff0c\u8868\u5355\u6570\u636e\u5c06\u88ab\u63d0\u4ea4\u6a21\u62df\u7b2c\u4e00\u4e2a\u53ef\u70b9\u51fb\u5143\u7d20\u7684\u70b9\u51fb\u3002\u9664\u4e86html\u5c5e\u6027\u4e4b\u5916\uff0c\u901a\u8fc7 nr \u5c5e\u6027\uff0c\u76f8\u5bf9\u4e8e\u8868\u5355\u5185\u7684\u5176\u4ed6\u63d0\u4ea4\u8868\u8f93\u5165, \u53ef\u4ee5\u901a\u8fc7\u5176\u57fa\u4e8e\u96f6\u7684\u7d22\u5f15\u6765\u8bc6\u522b\u63a7\u5236\u3002 dont_click(\u5e03\u5c14\u7c7b\u578b) - \u5982\u679c\u662f True \uff0c\u8868\u5355\u6570\u636e\u5c06\u5728\u4e0d\u5355\u51fb\u4efb\u4f55\u5143\u7d20\u7684\u60c5\u51b5\u4e0b\u63d0\u4ea4\u3002 \u8fd9\u4e2a\u7c7b\u65b9\u6cd5\u7684\u5176\u4ed6\u53c2\u6570\u76f4\u63a5\u4f20\u9012\u7ed9 FormRequest \u6784\u9020\u51fd\u6570\u3002 \u57280.10.3\u65b0\u7248\u672c: \u6dfb\u52a0\u4e86 formname \u53c2\u6570\u3002 \u57280.17\u65b0\u7248\u672c: \u6dfb\u52a0\u4e86 formxpath \u53c2\u6570\u3002 \u57281.1.0:\u65b0\u7248\u672c: \u6dfb\u52a0\u4e86 formcss \u53c2\u6570\u3002 \u57281.1.0\u65b0\u7248\u672c: \u6dfb\u52a0\u4e86 formid \u53c2\u6570\u3002","title":"scrapy.http.FormRequest(url[, formdata, ...])   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/14-requests_response/#request_1","text":"","title":"Request\u7528\u6cd5\u793a\u4f8b"},{"location":"2. \u57fa\u672c\u6982\u5ff5/14-requests_response/#formrequesthttp-post","text":"\u5982\u679c\u4f60\u60f3\u5728\u4f60\u7684spider\u4e2d\u6a21\u62df\u4e00\u4e2aHTML\u8868\u5355\uff0c\u5e76\u53d1\u9001\u51e0\u4e2a\u952e\u503c\u5b57\u6bb5\uff0c\u4f60\u53ef\u4ee5\u8fd4\u56de\u4e00\u4e2a FormRequest \u5bf9\u8c61\uff08\u6765\u81ea\u4f60\u7684spider\uff09\uff0c\u5982\u4e0b\u6240\u793a\uff1a return [FormRequest(url= http://www.example.com/post/action , formdata={'name': 'John Doe', 'age': '27'}, callback=self.after_post)]","title":"\u4f7f\u7528FormRequest\u901a\u8fc7HTTP POST\u53d1\u9001\u6570\u636e"},{"location":"2. \u57fa\u672c\u6982\u5ff5/14-requests_response/#formrequestfrom_response","text":"web\u7ad9\u70b9\u901a\u5e38\u901a\u8fc7 input type=\"hidden\" \u5143\u7d20\u6765\u63d0\u4f9b\u9884\u5148\u586b\u5145\u7684\u8868\u5355\u5b57\u6bb5, \u4f8b\u5982session\u76f8\u5173\u7684\u6570\u636e\u6216\u8eab\u4efd\u9a8c\u8bc1token(\u7528\u4e8e\u767b\u5f55\u9875\u9762), \u5728\u6293\u53d6\u65f6\uff0c\u60a8\u4f1a\u5e0c\u671b\u8fd9\u4e9b\u5b57\u6bb5\u662f\u81ea\u52a8\u9884\u586b\u5145\u7684\uff0c\u5e76\u4e14\u60a8\u53ea\u60f3\u8986\u76d6\u5176\u4e2d\u7684\u51e0\u4e2a\u5b57\u6bb5\uff0c\u6bd4\u5982\u7528\u6237\u540d\u548c\u5bc6\u7801\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 FormRequest.from_response() \u65b9\u6cd5\u6765\u5b8c\u6210\u8fd9\u9879\u5de5\u4f5c\u3002\u8fd9\u662f\u4e00\u4e2a\u4f7f\u7528\u5b83\u7684spider\uff1a import scrapy class LoginSpider(scrapy.Spider): name = 'example.com' start_urls = ['http://www.example.com/users/login.php'] def parse(self, response): return scrapy.FormRequest.from_response( response, formdata={'username': 'john', 'password': 'secret'}, callback=self.after_login ) def after_login(self, response): # \u5728\u7ee7\u7eed\u4e4b\u524d\uff0c\u68c0\u67e5\u662f\u5426\u767b\u5f55\u6210\u529f if authentication failed in response.body: self.logger.error( Login failed ) return # \u7ee7\u7eed\u7528\u7ecf\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u7684\u4f1a\u8bdd\u8fdb\u884c\u6293\u53d6...","title":"\u4f7f\u7528FormRequest.from_response()\u6765\u6a21\u62df\u7528\u6237\u767b\u5f55"},{"location":"2. \u57fa\u672c\u6982\u5ff5/14-requests_response/#response","text":"","title":"Response\u5bf9\u8c61"},{"location":"2. \u57fa\u672c\u6982\u5ff5/14-requests_response/#scrapyhttpresponseurl-status200-headersnone-bodyb-flagsnone-requestnone-class","text":"Response \u5bf9\u8c61\u4ee3\u8868HTTP response, \u5b83\u901a\u5e38\u88ab\u4e0b\u8f7d\uff08\u7531Downloader\uff09\uff0c\u5e76\u5582\u7ed9Spiders\u8fdb\u884c\u5904\u7406\u3002 \u53c2\u6570: url(\u5b57\u7b26\u4e32) \u2013 \u8bf7\u6c42url\u7684response status (int\u6574\u578b) \u2013 response\u7684HTTP\u72b6\u6001\u3002\u9ed8\u8ba4\u4e3a200\u3002 headers(\u5b57\u5178) \u2013 \u8fd9\u4e2aresponse\u7684headers\u3002\u53ef\u4ee5\u662f\u5b57\u7b26\u4e32\uff08\u5bf9\u4e8e\u5355\u503c\u5934\uff09\u6216\u5217\u8868\uff08\u5bf9\u4e8e\u591a\u503c\u5934\uff09\u3002 body (bytes) \u2013 response\u7684body\u3002\u5c06\u89e3\u7801\u7684\u6587\u672c\u4f5c\u4e3astr(Python 2\u4e2d\u7684unicode)\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 response.text \u6765\u81eaencoding-aware Request \u5b50\u7c7b\u7684\u6587\u672c\uff0c\u5982 TextResponse \u3002 flags (\u5217\u8868) \u2013 \u662f\u4e00\u4e2a\u5305\u542b Response.flags \u5c5e\u6027\u7684\u521d\u59cb\u503c\u7684\u5217\u8868\u3002 \u5982\u679c\u7ed9\u5b9a\uff0c\u8be5\u5217\u8868\u5c06\u88ab\u7b80\u5355\u5730\u590d\u5236\u3002 request ( Request \u5bf9\u8c61) \u2013 Response.request \u5c5e\u6027\u7684\u521d\u59cb\u503c\u3002 \u8fd9\u8868\u793a\u4ea7\u751f\u6b64response\u7684 Request \u3002 url \u5305\u542bresponse\u7684URL\u7684\u5b57\u7b26\u4e32\u3002 \u8fd9\u4e2a\u5c5e\u6027\u662f\u53ea\u8bfb\u7684\u3002\u8981\u6539\u53d8response\u7684URL\u4f7f\u7528 replace() status \u4e00\u4e2a\u8868\u793aresponse\u7684HTTP\u72b6\u6001\u7684\u6574\u6570\u3002 \u4f8b\u5b50: 200 , 404 headers \u4e00\u4e2a\u7c7b\u4f3c\u4e8e\u5b57\u5178\u7684\u5bf9\u8c61\uff0c\u5b83\u5305\u542bresponse headers\u3002\u53ef\u4ee5\u4f7f\u7528 get() \u6765\u53d6\u503c\uff0c\u7528\u6307\u5b9a\u7684\u540d\u5b57\u8fd4\u56de\u7b2c\u4e00\u4e2aheader\u7684\u503c\u6216 getlist() \u7528\u6307\u5b9a\u7684\u540d\u5b57\u8fd4\u56de\u6240\u6709\u7684header\u503c\u3002 \u4f8b\u5982\uff0c\u8c03\u7528\u8fd9\u4e2a\u4f1a\u63d0\u4f9bheaders\u4e2d\u6240\u6709\u7684cookie\uff1a response.headers.getlist('Set-Cookie') body response\u7684body\u3002\u8bf7\u7262\u8bb0 Response.body \u603b\u662f\u4e00\u4e2a bytes \u5bf9\u8c61\u3002\u5982\u679c\u4f60\u60f3\u8981unicode\u7248\u672c\uff0c\u4f7f\u7528 TextResponse.text (\u4ec5\u5728 TextResponse \u548c\u5b50\u7c7b\u4e2d\u53ef\u7528)\u3002 \u8fd9\u4e2a\u5c5e\u6027\u662f\u53ea\u8bfb\u7684\u3002\u8981\u66f4\u6539response body\uff0c\u8bf7\u4f7f\u7528 replace() \u3002 request \u751f\u6210\u6b64response\u7684 Request \u5bf9\u8c61\u3002\u5728response\u548crequest\u901a\u8fc7\u6240\u6709 Downloader Middlewares \u4e4b\u540e\uff0c\u8fd9\u4e2a\u5c5e\u6027\u88ab\u5206\u914d\u5230Scrapy\u5f15\u64ce\u4e2d\u3002\u7279\u522b\u5730\uff0c\u8fd9\u610f\u5473\u7740: HTTP\u91cd\u5b9a\u5411\u5c06\u5bfc\u81f4\u539f\u59cb\u8bf7\u6c42(\u91cd\u5b9a\u5411\u524d\u7684URL)\u88ab\u5206\u914d\u7ed9\u91cd\u5b9a\u5411response(\u91cd\u5b9a\u5411\u540e\u7684\u6700\u7ec8URL)\u3002 Response.request.url\u5e76\u4e0d\u603b\u662f\u7b49\u4e8eResponse.url \u8be5\u5c5e\u6027\u4ec5\u5728spider\u4ee3\u7801\u548c Spider Middlewares \u4e2d\u53ef\u7528\uff0c\u4f46\u5728 Downloader Middlewares \u4e2d\u4e0d\u53ef\u7528(\u5c3d\u7ba1\u60a8\u53ef\u4ee5\u901a\u8fc7\u5176\u4ed6\u65b9\u5f0f\u83b7\u5f97\u8bf7\u6c42)\u548c response_downloaded \u4fe1\u53f7\u7684\u5904\u7406\u7a0b\u5e8f\u4e2d\u4e0d\u53ef\u7528\u3002 meta Response.request \u5bf9\u8c61(\u5373\u3002 self.request.meta )\u7684 Request.meta \u5c5e\u6027\u7684\u5feb\u6377\u65b9\u5f0f\u3002 \u4e0d\u540c\u4e8e Response.request \u5c5e\u6027, Response.meta \u5c5e\u6027\u901a\u8fc7\u91cd\u5b9a\u5411\u548c\u91cd\u8bd5\u4f20\u64ad, \u4f60\u4f1a\u4ece\u4f60\u7684spider\u5f97\u5230\u539f\u59cb\u7684 Request.meta \u3002 \u53c2\u89c1Request.meta\u5c5e\u6027 flags \u5305\u542b\u6b64response flag\u7684\u5217\u8868\u3002 flag\u662f\u7528\u4e8e\u6807\u8bb0response\u7684\u6807\u7b7e\u3002\u4f8b\u5982:'cached'\uff0c'redirect'\u7b49\u7b49\uff0c\u5b83\u4eec\u663e\u793a\u5728response\u7684\u5b57\u7b26\u4e32\u8868\u793a\u4e0a(__str__\u65b9\u6cd5)\uff0c\u8be5\u65b9\u6cd5\u88ab\u5f15\u64ce\u7528\u4e8e\u65e5\u5fd7\u8bb0\u5f55\u3002 copy() \u8fd4\u56de\u4e00\u4e2a\u65b0response\uff0c\u8be5response\u662f\u6b64response\u7684\u526f\u672c\u3002 replace([url, status, headers, body, request, flags, cls]) \u8fd4\u56de\u5177\u6709\u76f8\u540c\u6210\u5458\u7684response\u5bf9\u8c61\uff0c\u9664\u4e86\u90a3\u4e9b\u7531\u6307\u5b9a\u7684\u5173\u952e\u5b57\u53c2\u6570\u8d4b\u4e88\u65b0\u503c\u7684\u6210\u5458\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c Response.meta \u4f1a\u88ab\u590d\u5236\u3002 urljoin(url) \u901a\u8fc7\u5c06response\u7684url\u4e0e\u76f8\u5bf9url\u76f8\u7ed3\u5408\u6765\u6784\u9020\u4e00\u4e2a\u7edd\u5bf9url\u3002 \u8fd9\u662f urlparse.urljoin \u4e4b\u4e0a\u7684\u4e00\u4e2a\u5305\u88c5\u5668\uff0c\u5b83\u53ea\u662f\u8fdb\u884c\u6b64\u8c03\u7528\u7684\u522b\u540d: urlparse.urljoin(response.url, url) follow (url, callback=None, method='GET', headers=None, body=None, cookies=None, meta=None, encoding='utf-8', priority=0, dont_filter=False, errback=None) \u8fd4\u56de Request \u5b9e\u4f8b\u4ee5\u8ddf\u968f\u94fe\u63a5 url \u3002\u5b83\u63a5\u53d7\u4e0e Request.__init__ \u65b9\u6cd5\u76f8\u540c\u7684\u53c2\u6570\u3002\uff0c\u4f46 url \u53ef\u4ee5\u662f\u76f8\u5bf9url\u6216 scrapy.link.Link \u5bf9\u8c61\uff0c\u4e0d\u53ea\u662f\u7edd\u5bf9URL\u3002 TextResponse \u63d0\u4f9b\u4e86 follow() \u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u9664\u4e86\u652f\u6301\u7edd\u5bf9/\u76f8\u5bf9url\u548c\u94fe\u63a5\u5bf9\u8c61\u4e4b\u5916\uff0c\u8fd8\u652f\u6301\u9009\u62e9\u5668\u3002","title":"scrapy.http.Response(url[, status=200, headers=None, body=b'', flags=None, request=None])   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/14-requests_response/#response_1","text":"","title":"Response\u5b50\u7c7b"},{"location":"2. \u57fa\u672c\u6982\u5ff5/14-requests_response/#textresponse","text":"","title":"TextResponse\u5bf9\u8c61"},{"location":"2. \u57fa\u672c\u6982\u5ff5/14-requests_response/#scrapyhttptextresponseurl-encoding-class","text":"TextResponse \u5bf9\u8c61\u5411 Response \u57fa\u7c7b\u6dfb\u52a0\u7f16\u7801\u529f\u80fd\uff0c Response \u57fa\u7c7b\u53ea\u7528\u4e8e\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u5982\u56fe\u50cf\u3001\u58f0\u97f3\u6216\u4efb\u4f55\u5a92\u4f53\u6587\u4ef6\u3002 \u9664\u4e86\u57fa\u672c Response \u5bf9\u8c61\u4e4b\u5916\uff0c TextResponse \u5bf9\u8c61\u8fd8\u652f\u6301\u4e00\u4e2a\u65b0\u7684\u6784\u9020\u51fd\u6570\u53c2\u6570, \u5176\u4f59\u7684\u529f\u80fd\u4e0e Response \u7c7b\u76f8\u540c \u53c2\u6570: encoding (\u5b57\u7b26\u4e32) \u2013 \u5305\u542b\u7528\u4e8e\u6b64response\u7684\u7f16\u7801\u7684\u5b57\u7b26\u4e32, \u5982\u679c\u60a8\u4f7f\u7528unicode body\u521b\u5efa\u4e00\u4e2a TextResponse \u5bf9\u8c61, \u5b83\u5c06\u4f7f\u7528\u8fd9\u79cd\u7f16\u7801\u8fdb\u884c\u7f16\u7801(\u8bf7\u8bb0\u4f4fbody\u5c5e\u6027\u603b\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32), \u5982\u679c encoding \u4e3a None (\u9ed8\u8ba4\u503c)\uff0c\u5219\u5728response headers\u548cbody\u4e2d\u67e5\u627e\u7f16\u7801\u3002 \u9664\u4e86\u652f\u6301\u6807\u51c6\u7684 Response \u5c5e\u6027\u5916\uff0c TextResponse \u5bf9\u8c61\u8fd8\u652f\u6301\u4ee5\u4e0b\u5c5e\u6027: text response body\uff0c\u4f5c\u4e3aunicode\u3002 \u4e0e response.body.decode(response.encoding) \u76f8\u540c\uff0c\u4f46\u662f\u7ed3\u679c\u5728\u7b2c\u4e00\u6b21\u8c03\u7528\u4e4b\u540e\u7f13\u5b58\uff0c\u6240\u4ee5\u4f60\u53ef\u4ee5\u8bbf\u95ee response.text \u591a\u6b21\uff0c\u6ca1\u6709\u989d\u5916\u7684\u5f00\u9500\u3002 unicode(response.body)\u4e0d\u662f\u5c06response body\u8f6c\u6362\u4e3aunicode\u7684\u6b63\u786e\u65b9\u6cd5: \u60a8\u5c06\u4f7f\u7528\u7cfb\u7edf\u9ed8\u8ba4\u7f16\u7801(\u901a\u5e38\u662fascii)\uff0c\u800c\u4e0d\u662fresponse\u7f16\u7801\u3002 encoding \u5e26\u6709\u6b64response\u7f16\u7801\u7684\u5b57\u7b26\u4e32\u3002\u6309\u7167\u987a\u5e8f\uff0c\u53ef\u4ee5\u901a\u8fc7\u5c1d\u8bd5\u4ee5\u4e0b\u673a\u5236\u6765\u89e3\u51b3\u7f16\u7801\u95ee\u9898: \u5728\u6784\u9020\u51fd\u6570\u7f16\u7801\u53c2\u6570\u4e2d\u4f20\u9012\u7684\u7f16\u7801 HTTP headers\u5934\u91ccContent-Type\u58f0\u660e\u7f16\u7801\u3002\u5982\u679c\u6b64\u7f16\u7801\u65e0\u6548(\u5373\u672a\u77e5)\uff0c\u5b83\u88ab\u5ffd\u7565\uff0c\u5e76\u5c1d\u8bd5\u4e0b\u4e00\u4e2a\u89e3\u51b3\u673a\u5236\u3002 response body\u4f53\u4e2d\u58f0\u660e\u7684\u7f16\u7801\u3002 TextResponse \u7c7b\u6ca1\u6709\u4e3a\u6b64\u63d0\u4f9b\u4efb\u4f55\u7279\u6b8a\u529f\u80fd\u3002\u7136\u800c\uff0c HtmlResponse \u548c XmlResponse \u7c7bdo\u3002 \u7f16\u7801\u662f\u901a\u8fc7\u89c2\u5bdfresponse body\u4f53\u6765\u63a8\u65ad\u7684\u3002\u8fd9\u662f\u6bd4\u8f83\u8106\u5f31\u7684\u65b9\u6cd5\uff0c\u4e5f\u662f\u6700\u540e\u4e00\u4e2a\u5c1d\u8bd5\u7684\u65b9\u6cd5\u3002 selector \u4f7f\u7528response\u4f5c\u4e3a\u76ee\u6807\u7684 Selector \u5b9e\u4f8b\u3002\u9009\u62e9\u5668\u5728\u7b2c\u4e00\u6b21\u8bbf\u95ee\u65f6\u60f0\u6027\u5b9e\u4f8b\u5316\u3002 TextResponse \u5bf9\u8c61\u9664\u4e86\u652f\u6301\u6807\u51c6 Response \u65b9\u6cd5\u5916\uff0c\u8fd8\u652f\u6301\u4ee5\u4e0b\u65b9\u6cd5: xpath(query) TextResponse.selector.xpath(query) \u7684\u5feb\u6377\u65b9\u5f0f response.xpath('//p') css(query) TextResponse.selector.css(query) \u7684\u5feb\u6377\u65b9\u5f0f response.css('p') follow(url, callback=None, method='GET', headers=None, body=None, cookies=None, meta=None, encoding=None, priority=0, dont_filter=False, errback=None) \u8fd4\u56de Request \u5b9e\u4f8b\u4ee5\u8ddf\u968f\u94fe\u63a5 url \u3002\u5b83\u63a5\u53d7\u4e0e Request.__init__ \u76f8\u540c\u7684\u53c2\u6570\u3002 \u4f46 url \u4e0d\u4ec5\u53ef\u4ee5\u662f\u4e00\u4e2a\u7edd\u5bf9url\uff0c\u800c\u4e14\u4e5f\u662f \u4e00\u4e2a\u76f8\u5bf9URL \u4e00\u4e2ascrapy.link.Link\u5bf9\u8c61(\u5982link extractor(\u94fe\u63a5\u63d0\u53d6\u5668)\u7ed3\u679c); \u4e00\u4e2a\u5c5e\u6027Selector(\u4e0d\u662fSelectorList) - \u6bd4\u5982 response.css('a::attr(href)')[0] \u6216 response.xpath('//img/@src')[0] \u3002 \u4e00\u4e2a a \u6216 link \u5143\u7d20\u7684Selector, \u6bd4\u5982 response.css('a.my_link')[0] \u8bf7\u53c2\u9605 \u521b\u5efaRequests\u7684\u5feb\u6377\u65b9\u5f0f \u4f7f\u7528\u4f8b\u5b50 body_as_unicode() \u4e0e text \u76f8\u540c\uff0c\u4f46\u4f5c\u4e3a\u65b9\u6cd5\u53ef\u7528\u3002\u8fd9\u79cd\u65b9\u6cd5\u662f\u4e3a\u4e86\u5411\u540e\u517c\u5bb9;\u8bf7\u9009\u62e9 response.text \u3002","title":"scrapy.http.TextResponse(url[, encoding[, ...]])   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/14-requests_response/#htmlresponse","text":"","title":"HtmlResponse\u5bf9\u8c61"},{"location":"2. \u57fa\u672c\u6982\u5ff5/14-requests_response/#scrapyhttphtmlresponseurl-class","text":"HtmlResponse \u7c7b\u662f TextResponse \u7684\u4e00\u4e2a\u5b50\u7c7b\uff0c\u5b83\u901a\u8fc7\u67e5\u627eHTML\u7684 meta http-equiv \u5c5e\u6027\u6765\u6dfb\u52a0\u7f16\u7801\u81ea\u52a8\u53d1\u73b0\u652f\u6301\u3002\u770b TextResponse.encoding \u3002","title":"scrapy.http.HtmlResponse(url[, ...])   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/14-requests_response/#xmlresponse","text":"","title":"XmlResponse\u5bf9\u8c61"},{"location":"2. \u57fa\u672c\u6982\u5ff5/14-requests_response/#scrapyhttpxmlresponseurl-class","text":"XmlResponse \u7c7b\u662f TextResponse \u7684\u5b50\u7c7b\uff0c\u5b83\u901a\u8fc7\u67e5\u770bXML\u58f0\u660e\u884c\u6dfb\u52a0\u7f16\u7801\u81ea\u52a8\u53d1\u73b0\u652f\u6301\u3002\u770b TextResponse.encoding \u3002","title":"scrapy.http.XmlResponse(url[, ...])   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/15-extractors/","text":"Link Extractors(\u94fe\u63a5\u63d0\u53d6\u5668) Link extractors\u662f\u53ea\u7528\u4e8e\u4eceweb\u9875\u9762( scrapy.http.Response \u5bf9\u8c61)\u4e2d\u63d0\u53d6\u94fe\u63a5\u7684\u5bf9\u8c61\uff0c\u6700\u7ec8\u5c06\u88ab\u8ddf\u8e2a\u3002 scrapy.linkextractors.LinkExtractor \u53ef\u4ee5\u5728Scrapy\u4e2d\u4f7f\u7528\uff0c\u4f46\u662f\u60a8\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e2a\u7b80\u5355\u7684\u63a5\u53e3\u521b\u5efa\u81ea\u5df1\u7684\u81ea\u5b9a\u4e49Link Extractors\u6765\u6ee1\u8db3\u60a8\u7684\u9700\u6c42\u3002 \u6bcf\u4e2alink extractor\u90fd\u62e5\u6709\u7684\u60df\u4e00\u516c\u5171\u65b9\u6cd5\u662f extract_links \uff0c\u5b83\u63a5\u6536\u4e00\u4e2a Response \u5bf9\u8c61\u5e76\u8fd4\u56de\u4e00\u4e2a scrapy.link.Link \u5bf9\u8c61\u5217\u8868\u3002Link extractors\u53ea\u9700\u8981\u5b9e\u4f8b\u5316\u4e00\u6b21\uff0c\u5b83\u4eec\u7684 extract_links \u65b9\u6cd5\u8981\u8c03\u7528\u597d\u51e0\u6b21\uff0c\u4f7f\u7528\u4e0d\u540c\u7684responses\u63d0\u53d6\u8981\u8ddf\u8e2a\u7684\u94fe\u63a5\u3002 Link extractors\u7528\u4e8e CrawlSpider \u7c7b(Scrapy\u4e2d\u53ef\u7528)\uff0c\u901a\u8fc7\u4e00\u7ec4\u89c4\u5219\uff0c\u4f46\u662f\u60a8\u4e5f\u53ef\u4ee5\u5728spiders\u4e2d\u4f7f\u7528\u5b83\uff0c\u5373\u4f7f\u60a8\u6ca1\u6709\u4ece CrawlSpider \u5b50\u7c7b\u5316\u5b83\uff0c\u56e0\u4e3a\u5b83\u7684\u76ee\u7684\u975e\u5e38\u7b80\u5355:\u63d0\u53d6\u94fe\u63a5\u3002 \u5185\u7f6elink extractors\u53c2\u8003 scrapy.linkextractors \u6a21\u5757\u4e2d\u63d0\u4f9b\u4e86\u4e0eScrapy\u7ed1\u5b9a\u7684Link extractors\u7c7b\u3002 \u9ed8\u8ba4\u7684link extractor\u662f LinkExtractor \uff0c\u4e0e LxmlLinkExtractor \u76f8\u540c: from scrapy.linkextractors import LinkExtractor \u5728\u4ee5\u524d\u7684Scrapy\u6309\u672c\u4e2d\u66fe\u7ecf\u6709\u5176\u4ed6\u7684link extractor\u7c7b\uff0c\u4f46\u662f\u73b0\u5728\u5b83\u4eec\u5df2\u7ecf\u88ab\u5e9f\u5f03\u4e86\u3002 LxmlLinkExtractor scrapy.linkextractors.lxmlhtml.LxmlLinkExtractor(allow=(), deny=(), allow_domains=(), deny_domains=(), deny_extensions=None, restrict_xpaths=(), restrict_css=(), tags=('a', 'area'), attrs=('href', ), canonicalize=False, unique=True, process_value=None, strip=True) \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) LxmlLinkExtractor\u662f\u63a8\u8350\u7684\u5177\u6709\u65b9\u4fbf\u8fc7\u6ee4\u9009\u9879\u7684link extractor\u3002\u5b83\u662f\u4f7f\u7528\u5065\u58ee\u7684lxml HTMLParser\u5b9e\u73b0\u7684\u3002 \u53c2\u6570: allow (\u6b63\u5219\u8868\u8fbe\u5f0f(\u6216\u5217\u8868)) \u2013 \u5355\u4e2a\u6b63\u5219\u8868\u8fbe\u5f0f(\u6216\u6b63\u5219\u8868\u8fbe\u5f0f\u5217\u8868), (\u7edd\u5bf9)url\u5fc5\u987b\u5339\u914d\u624d\u80fd\u88ab\u63d0\u53d6, \u5982\u679c\u6ca1\u6709\u7ed9\u51fa(\u6216\u7a7a)\uff0c\u5b83\u5c06\u5339\u914d\u6240\u6709\u94fe\u63a5\u3002 deny (\u6b63\u5219\u8868\u8fbe\u5f0f(\u6216\u5217\u8868)) - \u5355\u4e2a\u6b63\u5219\u8868\u8fbe\u5f0f(\u6216\u6b63\u5219\u8868\u8fbe\u5f0f\u5217\u8868), (\u7edd\u5bf9)url\u5fc5\u987b\u5339\u914d\u624d\u80fd\u88ab\u6392\u9664\u3002(\u65e2,\u4e0d\u63d0\u53d6)\u3002 \u5b83\u4f18\u5148\u4e8e allow \u53c2\u6570, \u5982\u679c\u6ca1\u6709\u7ed9\u51fa(\u6216\u7a7a)\uff0c\u5b83\u4e0d\u4f1a\u6392\u9664\u4efb\u4f55\u94fe\u63a5\u3002 allow_domains (\u5b57\u7b26\u4e32\u6216\u5217\u8868) - \u7528\u4e8e\u63d0\u53d6\u94fe\u63a5\u7684\u5355\u4e2a\u503c\u6216\u5305\u542bdomains\u7684\u5b57\u7b26\u4e32\u5217\u8868 deny_domains (\u5b57\u7b26\u4e32\u6216\u5217\u8868) - \u5305\u542bdomains\u7684\u5355\u4e2a\u503c\u6216\u5b57\u7b26\u4e32\u5217\u8868\uff0c\u8fd9\u4e9bdomains\u4e0d\u7528\u4e8e\u63d0\u53d6\u94fe\u63a5 deny_extensions (\u5217\u8868) - \u5305\u542b\u5728\u63d0\u53d6\u94fe\u63a5\u65f6\u5e94\u5ffd\u7565\u7684extensions(\u6269\u5c55)\u7684\u5355\u4e2a\u503c\u6216\u5b57\u7b26\u4e32\u5217\u8868\u3002\u5982\u679c\u6ca1\u6709\u6307\u5b9a\uff0c\u5b83\u5c06\u9ed8\u8ba4\u8bbe\u7f6e\u4e3ascrapy\u4e2d\u5b9a\u4e49\u7684 IGNORED_EXTENSIONS \u5217\u8868\u5728 scrapy.linkextractors \u5305\u4e0b\u3002 restrict_xpaths (\u5b57\u7b26\u4e32\u6216\u5217\u8868) \u2013 \u4e00\u4e2aXPath(\u6216XPath\u7684\u5217\u8868)\uff0c\u5b83\u5b9a\u4e49\u4e86response\u4e2d\u7684\u94fe\u63a5\u5e94\u8be5\u4ece\u54ea\u91cc\u63d0\u53d6\u3002 \u5982\u679c\u7ed9\u5b9a\uff0c\u5219\u53ea\u626b\u63cf\u8fd9\u4e9bXPath\u9009\u62e9\u7684\u6587\u672c\u4ee5\u67e5\u627e\u94fe\u63a5\u3002\u8bf7\u53c2\u89c1\u4e0b\u9762\u7684\u4f8b\u5b50\u3002 restrict_css (\u5b57\u7b26\u4e32\u6216\u5217\u8868) \u2013 \u4e00\u4e2aCSS\u9009\u62e9\u5668(\u6216selectors\u5217\u8868)\uff0c\u5b83\u5b9a\u4e49\u4e86response\u4e2d\u7684\u94fe\u63a5\u5e94\u8be5\u4ece\u54ea\u91cc\u63d0\u53d6\u3002 \u5177\u6709\u4e0e restrict_xpaths \u76f8\u540c\u7684\u884c\u4e3a\u3002 tags (\u5b57\u7b26\u4e32\u6216\u5217\u8868) \u2013 \u63d0\u53d6\u94fe\u63a5\u65f6\u8981\u8003\u8651\u7684\u6807\u8bb0\u6216\u6807\u8bb0\u5217\u8868\u3002 \u9ed8\u8ba4\u4e3a ('a'\uff0c 'area') \u3002 attrs (\u5217\u8868) \u2013 \u5728\u5bfb\u627e\u8981\u63d0\u53d6\u7684\u94fe\u63a5\u65f6\u5e94\u8be5\u8003\u8651\u7684\u5c5e\u6027\u6216\u5c5e\u6027\u5217\u8868(\u4ec5\u9002\u7528\u4e8e tags \u53c2\u6570\u4e2d\u6307\u5b9a\u7684\u6807\u8bb0), \u9ed8\u8ba4\u4e3a ('href') canonicalize (\u5e03\u5c14\u7c7b\u578b) \u2013 \u89c4\u8303\u5316\u6bcf\u4e2a\u63d0\u53d6\u7684url(\u4f7f\u7528w3lib.url.canonicalize_url), \u9ed8\u8ba4\u4e3a False , \u6ce8\u610f\uff0ccanonicalize_url\u662f\u7528\u4e8e\u91cd\u590d\u68c0\u67e5\u7684: \u5b83\u53ef\u4ee5\u6539\u53d8\u5728\u670d\u52a1\u5668\u7aef\u53ef\u89c1\u7684URL, \u56e0\u6b64\uff0c\u5bf9\u4e8e\u5177\u6709\u89c4\u8303\u5316\u548c\u539f\u59cburl\u7684requests\uff0cresponse\u53ef\u80fd\u4e0d\u540c, \u5982\u679c\u60a8\u4f7f\u7528LinkExtractor\u6765\u8ddf\u8e2a\u94fe\u63a5\uff0c\u90a3\u4e48\u4fdd\u6301\u9ed8\u8ba4\u8bbe\u7f6e canonicalize=False \u4f1a\u66f4\u52a0\u5065\u58ee unique (\u5e03\u5c14\u7c7b\u578b) \u2013 \u662f\u5426\u5bf9\u63d0\u53d6\u7684\u94fe\u63a5\u5e94\u7528\u91cd\u590d\u8fc7\u6ee4\u3002 process_value (\u53ef\u8c03\u7528\u7684) \u2013 \u4e00\u4e2a\u51fd\u6570\uff0c\u5b83\u63a5\u6536\u4ece\u5df2\u626b\u63cf\u7684tag\u548cattributes\u4e2d\u63d0\u53d6\u7684\u6bcf\u4e2a\u503c\uff0c\u5e76\u4e14\u53ef\u4ee5\u4fee\u6539\u8fd9\u4e2a\u503c\u5e76\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684\u503c\uff0c\u6216\u8005\u8fd4\u56de None \u4ee5\u5b8c\u5168\u5ffd\u7565\u94fe\u63a5\u3002 \u5982\u679c\u6ca1\u6709\u7ed9\u51fa\uff0c process_value \u9ed8\u8ba4\u4e3a lambda x: x \u4f8b\u5982\uff0c\u4ece\u8fd9\u6bb5\u4ee3\u7801\u4e2d\u63d0\u53d6\u94fe\u63a5: a href=\"javascript:goToPage('../other/page.html'); return false\" Link text /a \u60a8\u53ef\u4ee5\u5728 process_value \u4e2d\u4f7f\u7528\u4ee5\u4e0b\u51fd\u6570: def process_value(value): m = re.search(\"javascript:goToPage\\('(.*?)'\", value) if m: return m.group(1) strip (\u5e03\u5c14\u7c7b\u578b) \u2013 \u662f\u5426\u4ece\u63d0\u53d6\u7684attributes\u4e2d\u5220\u9664\u7a7a\u767d, \u6839\u636eHTML5\u6807\u51c6\uff0c\u5fc5\u987b\u4ece a \u3001 area \u7b49\u5143\u7d20\u7684href\u5c5e\u6027\u3001 img \u3001 iframe \u5143\u7d20\u7684 src \u5c5e\u6027\u4e2d\u53bb\u6389\u5f00\u5934\u548c\u7ed3\u5c3e\u7684\u7a7a\u767d, \u7b49\u7b49\uff0c\u6240\u4ee5\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cLinkExtractor\u4f1a\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5220\u9664\u7a7a\u683c\u5b57\u7b26, \u8bbe\u7f6e strip=False \u6765\u5173\u95ed\u5b83(\u4f8b\u5982\uff0c\u5982\u679c\u4f60\u6b63\u5728\u4eceelements\u6216attributes\u4e2d\u63d0\u53d6url\uff0c\u8fd9\u4e9belements\u6216attributes\u5141\u8bb8\u5f00\u5934/\u7ed3\u5c3e\u6709\u7a7a\u683c)","title":"Link Extractors(\u94fe\u63a5\u63d0\u53d6\u5668)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/15-extractors/#link-extractors","text":"Link extractors\u662f\u53ea\u7528\u4e8e\u4eceweb\u9875\u9762( scrapy.http.Response \u5bf9\u8c61)\u4e2d\u63d0\u53d6\u94fe\u63a5\u7684\u5bf9\u8c61\uff0c\u6700\u7ec8\u5c06\u88ab\u8ddf\u8e2a\u3002 scrapy.linkextractors.LinkExtractor \u53ef\u4ee5\u5728Scrapy\u4e2d\u4f7f\u7528\uff0c\u4f46\u662f\u60a8\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e2a\u7b80\u5355\u7684\u63a5\u53e3\u521b\u5efa\u81ea\u5df1\u7684\u81ea\u5b9a\u4e49Link Extractors\u6765\u6ee1\u8db3\u60a8\u7684\u9700\u6c42\u3002 \u6bcf\u4e2alink extractor\u90fd\u62e5\u6709\u7684\u60df\u4e00\u516c\u5171\u65b9\u6cd5\u662f extract_links \uff0c\u5b83\u63a5\u6536\u4e00\u4e2a Response \u5bf9\u8c61\u5e76\u8fd4\u56de\u4e00\u4e2a scrapy.link.Link \u5bf9\u8c61\u5217\u8868\u3002Link extractors\u53ea\u9700\u8981\u5b9e\u4f8b\u5316\u4e00\u6b21\uff0c\u5b83\u4eec\u7684 extract_links \u65b9\u6cd5\u8981\u8c03\u7528\u597d\u51e0\u6b21\uff0c\u4f7f\u7528\u4e0d\u540c\u7684responses\u63d0\u53d6\u8981\u8ddf\u8e2a\u7684\u94fe\u63a5\u3002 Link extractors\u7528\u4e8e CrawlSpider \u7c7b(Scrapy\u4e2d\u53ef\u7528)\uff0c\u901a\u8fc7\u4e00\u7ec4\u89c4\u5219\uff0c\u4f46\u662f\u60a8\u4e5f\u53ef\u4ee5\u5728spiders\u4e2d\u4f7f\u7528\u5b83\uff0c\u5373\u4f7f\u60a8\u6ca1\u6709\u4ece CrawlSpider \u5b50\u7c7b\u5316\u5b83\uff0c\u56e0\u4e3a\u5b83\u7684\u76ee\u7684\u975e\u5e38\u7b80\u5355:\u63d0\u53d6\u94fe\u63a5\u3002","title":"Link Extractors(\u94fe\u63a5\u63d0\u53d6\u5668)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/15-extractors/#link-extractors_1","text":"scrapy.linkextractors \u6a21\u5757\u4e2d\u63d0\u4f9b\u4e86\u4e0eScrapy\u7ed1\u5b9a\u7684Link extractors\u7c7b\u3002 \u9ed8\u8ba4\u7684link extractor\u662f LinkExtractor \uff0c\u4e0e LxmlLinkExtractor \u76f8\u540c: from scrapy.linkextractors import LinkExtractor \u5728\u4ee5\u524d\u7684Scrapy\u6309\u672c\u4e2d\u66fe\u7ecf\u6709\u5176\u4ed6\u7684link extractor\u7c7b\uff0c\u4f46\u662f\u73b0\u5728\u5b83\u4eec\u5df2\u7ecf\u88ab\u5e9f\u5f03\u4e86\u3002","title":"\u5185\u7f6elink extractors\u53c2\u8003"},{"location":"2. \u57fa\u672c\u6982\u5ff5/15-extractors/#lxmllinkextractor","text":"","title":"LxmlLinkExtractor"},{"location":"2. \u57fa\u672c\u6982\u5ff5/15-extractors/#scrapylinkextractorslxmlhtmllxmllinkextractorallow-deny-allow_domains-deny_domains-deny_extensionsnone-restrict_xpaths-restrict_css-tagsa-area-attrshref-canonicalizefalse-uniquetrue-process_valuenone-striptrue-class","text":"LxmlLinkExtractor\u662f\u63a8\u8350\u7684\u5177\u6709\u65b9\u4fbf\u8fc7\u6ee4\u9009\u9879\u7684link extractor\u3002\u5b83\u662f\u4f7f\u7528\u5065\u58ee\u7684lxml HTMLParser\u5b9e\u73b0\u7684\u3002 \u53c2\u6570: allow (\u6b63\u5219\u8868\u8fbe\u5f0f(\u6216\u5217\u8868)) \u2013 \u5355\u4e2a\u6b63\u5219\u8868\u8fbe\u5f0f(\u6216\u6b63\u5219\u8868\u8fbe\u5f0f\u5217\u8868), (\u7edd\u5bf9)url\u5fc5\u987b\u5339\u914d\u624d\u80fd\u88ab\u63d0\u53d6, \u5982\u679c\u6ca1\u6709\u7ed9\u51fa(\u6216\u7a7a)\uff0c\u5b83\u5c06\u5339\u914d\u6240\u6709\u94fe\u63a5\u3002 deny (\u6b63\u5219\u8868\u8fbe\u5f0f(\u6216\u5217\u8868)) - \u5355\u4e2a\u6b63\u5219\u8868\u8fbe\u5f0f(\u6216\u6b63\u5219\u8868\u8fbe\u5f0f\u5217\u8868), (\u7edd\u5bf9)url\u5fc5\u987b\u5339\u914d\u624d\u80fd\u88ab\u6392\u9664\u3002(\u65e2,\u4e0d\u63d0\u53d6)\u3002 \u5b83\u4f18\u5148\u4e8e allow \u53c2\u6570, \u5982\u679c\u6ca1\u6709\u7ed9\u51fa(\u6216\u7a7a)\uff0c\u5b83\u4e0d\u4f1a\u6392\u9664\u4efb\u4f55\u94fe\u63a5\u3002 allow_domains (\u5b57\u7b26\u4e32\u6216\u5217\u8868) - \u7528\u4e8e\u63d0\u53d6\u94fe\u63a5\u7684\u5355\u4e2a\u503c\u6216\u5305\u542bdomains\u7684\u5b57\u7b26\u4e32\u5217\u8868 deny_domains (\u5b57\u7b26\u4e32\u6216\u5217\u8868) - \u5305\u542bdomains\u7684\u5355\u4e2a\u503c\u6216\u5b57\u7b26\u4e32\u5217\u8868\uff0c\u8fd9\u4e9bdomains\u4e0d\u7528\u4e8e\u63d0\u53d6\u94fe\u63a5 deny_extensions (\u5217\u8868) - \u5305\u542b\u5728\u63d0\u53d6\u94fe\u63a5\u65f6\u5e94\u5ffd\u7565\u7684extensions(\u6269\u5c55)\u7684\u5355\u4e2a\u503c\u6216\u5b57\u7b26\u4e32\u5217\u8868\u3002\u5982\u679c\u6ca1\u6709\u6307\u5b9a\uff0c\u5b83\u5c06\u9ed8\u8ba4\u8bbe\u7f6e\u4e3ascrapy\u4e2d\u5b9a\u4e49\u7684 IGNORED_EXTENSIONS \u5217\u8868\u5728 scrapy.linkextractors \u5305\u4e0b\u3002 restrict_xpaths (\u5b57\u7b26\u4e32\u6216\u5217\u8868) \u2013 \u4e00\u4e2aXPath(\u6216XPath\u7684\u5217\u8868)\uff0c\u5b83\u5b9a\u4e49\u4e86response\u4e2d\u7684\u94fe\u63a5\u5e94\u8be5\u4ece\u54ea\u91cc\u63d0\u53d6\u3002 \u5982\u679c\u7ed9\u5b9a\uff0c\u5219\u53ea\u626b\u63cf\u8fd9\u4e9bXPath\u9009\u62e9\u7684\u6587\u672c\u4ee5\u67e5\u627e\u94fe\u63a5\u3002\u8bf7\u53c2\u89c1\u4e0b\u9762\u7684\u4f8b\u5b50\u3002 restrict_css (\u5b57\u7b26\u4e32\u6216\u5217\u8868) \u2013 \u4e00\u4e2aCSS\u9009\u62e9\u5668(\u6216selectors\u5217\u8868)\uff0c\u5b83\u5b9a\u4e49\u4e86response\u4e2d\u7684\u94fe\u63a5\u5e94\u8be5\u4ece\u54ea\u91cc\u63d0\u53d6\u3002 \u5177\u6709\u4e0e restrict_xpaths \u76f8\u540c\u7684\u884c\u4e3a\u3002 tags (\u5b57\u7b26\u4e32\u6216\u5217\u8868) \u2013 \u63d0\u53d6\u94fe\u63a5\u65f6\u8981\u8003\u8651\u7684\u6807\u8bb0\u6216\u6807\u8bb0\u5217\u8868\u3002 \u9ed8\u8ba4\u4e3a ('a'\uff0c 'area') \u3002 attrs (\u5217\u8868) \u2013 \u5728\u5bfb\u627e\u8981\u63d0\u53d6\u7684\u94fe\u63a5\u65f6\u5e94\u8be5\u8003\u8651\u7684\u5c5e\u6027\u6216\u5c5e\u6027\u5217\u8868(\u4ec5\u9002\u7528\u4e8e tags \u53c2\u6570\u4e2d\u6307\u5b9a\u7684\u6807\u8bb0), \u9ed8\u8ba4\u4e3a ('href') canonicalize (\u5e03\u5c14\u7c7b\u578b) \u2013 \u89c4\u8303\u5316\u6bcf\u4e2a\u63d0\u53d6\u7684url(\u4f7f\u7528w3lib.url.canonicalize_url), \u9ed8\u8ba4\u4e3a False , \u6ce8\u610f\uff0ccanonicalize_url\u662f\u7528\u4e8e\u91cd\u590d\u68c0\u67e5\u7684: \u5b83\u53ef\u4ee5\u6539\u53d8\u5728\u670d\u52a1\u5668\u7aef\u53ef\u89c1\u7684URL, \u56e0\u6b64\uff0c\u5bf9\u4e8e\u5177\u6709\u89c4\u8303\u5316\u548c\u539f\u59cburl\u7684requests\uff0cresponse\u53ef\u80fd\u4e0d\u540c, \u5982\u679c\u60a8\u4f7f\u7528LinkExtractor\u6765\u8ddf\u8e2a\u94fe\u63a5\uff0c\u90a3\u4e48\u4fdd\u6301\u9ed8\u8ba4\u8bbe\u7f6e canonicalize=False \u4f1a\u66f4\u52a0\u5065\u58ee unique (\u5e03\u5c14\u7c7b\u578b) \u2013 \u662f\u5426\u5bf9\u63d0\u53d6\u7684\u94fe\u63a5\u5e94\u7528\u91cd\u590d\u8fc7\u6ee4\u3002 process_value (\u53ef\u8c03\u7528\u7684) \u2013 \u4e00\u4e2a\u51fd\u6570\uff0c\u5b83\u63a5\u6536\u4ece\u5df2\u626b\u63cf\u7684tag\u548cattributes\u4e2d\u63d0\u53d6\u7684\u6bcf\u4e2a\u503c\uff0c\u5e76\u4e14\u53ef\u4ee5\u4fee\u6539\u8fd9\u4e2a\u503c\u5e76\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684\u503c\uff0c\u6216\u8005\u8fd4\u56de None \u4ee5\u5b8c\u5168\u5ffd\u7565\u94fe\u63a5\u3002 \u5982\u679c\u6ca1\u6709\u7ed9\u51fa\uff0c process_value \u9ed8\u8ba4\u4e3a lambda x: x \u4f8b\u5982\uff0c\u4ece\u8fd9\u6bb5\u4ee3\u7801\u4e2d\u63d0\u53d6\u94fe\u63a5: a href=\"javascript:goToPage('../other/page.html'); return false\" Link text /a \u60a8\u53ef\u4ee5\u5728 process_value \u4e2d\u4f7f\u7528\u4ee5\u4e0b\u51fd\u6570: def process_value(value): m = re.search(\"javascript:goToPage\\('(.*?)'\", value) if m: return m.group(1) strip (\u5e03\u5c14\u7c7b\u578b) \u2013 \u662f\u5426\u4ece\u63d0\u53d6\u7684attributes\u4e2d\u5220\u9664\u7a7a\u767d, \u6839\u636eHTML5\u6807\u51c6\uff0c\u5fc5\u987b\u4ece a \u3001 area \u7b49\u5143\u7d20\u7684href\u5c5e\u6027\u3001 img \u3001 iframe \u5143\u7d20\u7684 src \u5c5e\u6027\u4e2d\u53bb\u6389\u5f00\u5934\u548c\u7ed3\u5c3e\u7684\u7a7a\u767d, \u7b49\u7b49\uff0c\u6240\u4ee5\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cLinkExtractor\u4f1a\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5220\u9664\u7a7a\u683c\u5b57\u7b26, \u8bbe\u7f6e strip=False \u6765\u5173\u95ed\u5b83(\u4f8b\u5982\uff0c\u5982\u679c\u4f60\u6b63\u5728\u4eceelements\u6216attributes\u4e2d\u63d0\u53d6url\uff0c\u8fd9\u4e9belements\u6216attributes\u5141\u8bb8\u5f00\u5934/\u7ed3\u5c3e\u6709\u7a7a\u683c)","title":"scrapy.linkextractors.lxmlhtml.LxmlLinkExtractor(allow=(), deny=(), allow_domains=(), deny_domains=(), deny_extensions=None, restrict_xpaths=(), restrict_css=(), tags=('a', 'area'), attrs=('href', ), canonicalize=False, unique=True, process_value=None, strip=True)   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/","text":"Settings(\u8bbe\u7f6e) Scrapy settings\u5141\u8bb8\u60a8\u81ea\u5b9a\u4e49\u6240\u6709Scrapy\u7ec4\u4ef6\u7684\u884c\u4e3a\uff0c\u5305\u62eccore\u3001extensions\u3001pipelines\u548cspiders\u672c\u8eab\u3002 settings\u7684\u57fa\u7840\u7ed3\u6784\u63d0\u4f9b\u4e86\u952e\u503c\u6620\u5c04\u7684\u5168\u5c40\u547d\u540d\u7a7a\u95f4\uff0c\u4ee3\u7801\u53ef\u4ee5\u4f7f\u7528\u5b83\u6765\u63d0\u53d6\u914d\u7f6e\u503c\u3002\u53ef\u4ee5\u901a\u8fc7\u4e0d\u540c\u7684\u673a\u5236\u586b\u5145\u8bbe\u7f6e\uff0c\u5982\u4e0b\u6240\u8ff0\u3002 \u8fd9\u4e9b\u8bbe\u7f6e\u4e5f\u662f\u9009\u62e9\u5f53\u524d\u6d3b\u52a8\u7684Scrapy\u9879\u76ee(\u5982\u679c\u60a8\u6709\u5f88\u591a\u8fd9\u6837\u7684\u9879\u76ee)\u7684\u673a\u5236\u3002 \u6709\u5173\u53ef\u7528\u7684\u5185\u7f6e\u8bbe\u7f6e\u7684\u5217\u8868\uff0c\u8bf7\u53c2\u9605: \u5185\u7f6e\u7684settings\u53c2\u8003 \u6307\u5b9a\u8bbe\u7f6e \u5f53\u4f60\u4f7f\u7528Scrapy\u65f6\uff0c\u4f60\u5fc5\u987b\u544a\u8bc9\u5b83\u4f60\u4f7f\u7528\u7684\u662f\u54ea\u4e9b\u8bbe\u7f6e\u3002\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u73af\u5883\u53d8\u91cf SCRAPY_SETTINGS_MODULE \u6765\u5b9e\u73b0\u3002 SCRAPY_SETTINGS_MODULE \u7684\u503c\u5e94\u8be5\u662fPython\u8def\u5f84\u8bed\u6cd5\uff0c\u4f8b\u5982 myproject.settings \u3002\u6ce8\u610f\uff0c\u8bbe\u7f6e\u6a21\u5757\u5e94\u8be5\u4f4d\u4e8ePython \u5bfc\u5165\u641c\u7d22\u8def\u5f84 \u4e0a\u3002 \u586b\u5145\u8bbe\u7f6e \u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u7684\u673a\u5236\u586b\u5145\u8bbe\u7f6e\uff0c\u6bcf\u79cd\u673a\u5236\u5177\u6709\u4e0d\u540c\u7684\u4f18\u5148\u7ea7\u3002\u4ee5\u4e0b\u662f\u6309\u4f18\u5148\u987a\u5e8f\u9012\u51cf\u7684\u5217\u8868: \u547d\u4ee4\u884c\u9009\u9879(\u6700\u4f18\u5148\u7ea7) \u5355\u72ec\u8bbe\u7f6e\u6bcf\u4e2aspider \u9879\u76eesettings\u6a21\u5757 \u6bcf\u4e2asettings\u9ed8\u8ba4\u7684\u547d\u4ee4 \u9ed8\u8ba4\u5168\u5c40settings(\u4f4e\u4f18\u5148\u7ea7) \u8fd9\u4e9b\u6e90\u8bbe\u7f6e\u7684\u586b\u5145\u7531\u5185\u90e8\u5904\u7406\uff0c\u4f46\u662f\u53ef\u4ee5\u4f7f\u7528API\u8c03\u7528\u8fdb\u884c\u624b\u52a8\u5904\u7406\u3002\u53c2\u89c1 \u8bbe\u7f6eAPI \u4e3b\u9898\u4ee5\u4f9b\u53c2\u8003\u3002 \u4e0b\u9762\u5c06\u66f4\u8be6\u7ec6\u5730\u63cf\u8ff0\u8fd9\u4e9b\u673a\u5236\u3002 1.\u547d\u4ee4\u884c\u9009\u9879 \u547d\u4ee4\u884c\u63d0\u4f9b\u7684\u53c2\u6570\u4f18\u5148\u7ea7\u6700\u9ad8\uff0c\u8d85\u8fc7\u4e86\u4efb\u4f55\u5176\u4ed6\u9009\u9879\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 -s (\u6216 --set )\u547d\u4ee4\u884c\u9009\u9879\u663e\u5f0f\u5730\u8986\u76d6\u4e00\u4e2a(\u6216\u591a\u4e2a)\u8bbe\u7f6e\u3002 \u4f8b\u5b50: scrapy crawl myspider -s LOG_FILE=scrapy.log 2. \u5355\u72ec\u8bbe\u7f6e\u6bcf\u4e2aspider spider(\u8bf7\u53c2\u9605 Spiders \u4e00\u7ae0\u4ee5\u83b7\u53d6\u53c2\u8003)\u53ef\u4ee5\u5b9a\u4e49\u81ea\u5df1\u7684setting\uff0c\u8fd9\u4e9bsetting\u5c06\u4f18\u5148\u4f7f\u7528\u5e76\u8986\u76d6\u9879\u76ee\u7684setting\u3002\u4ed6\u4eec\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e custom_settings \u5c5e\u6027\u6765\u505a\u5230\u8fd9\u4e00\u70b9: class MySpider(scrapy.Spider): name = 'myspider' custom_settings = { 'SOME_SETTING': 'some value', } 3. \u9879\u76eesetting\u6a21\u5757 \u9879\u76eesetting\u6a21\u5757\u662f\u4f60\u7684Scrapy\u9879\u76ee\u7684\u6807\u51c6\u914d\u7f6e\u6587\u4ef6\uff0c\u5927\u591a\u6570\u81ea\u5b9a\u4e49\u8bbe\u7f6e\u90fd\u662f\u5728\u8fd9\u91cc\u586b\u5145\u7684\u3002\u5bf9\u4e8e\u6807\u51c6\u7684Scrapy\u9879\u76ee\uff0c\u8fd9\u610f\u5473\u7740\u8981\u5728\u4f60\u7684\u9879\u76ee\u4e2d settings.py \u4e2d\u6dfb\u52a0\u6216\u66f4\u6539settings 4. \u6bcf\u4e2asettings\u9ed8\u8ba4\u7684\u547d\u4ee4 \u6bcf\u4e2a Scrapy\u5de5\u5177 \u547d\u4ee4\u53ef\u4ee5\u6709\u81ea\u5df1\u7684\u9ed8\u8ba4\u8bbe\u7f6e\uff0c\u5b83\u8986\u76d6\u5168\u5c40\u9ed8\u8ba4\u8bbe\u7f6e\u3002\u8fd9\u4e9b\u81ea\u5b9a\u4e49\u547d\u4ee4\u8bbe\u7f6e\u5728\u547d\u4ee4\u7c7b\u7684 default_settings \u5c5e\u6027\u4e2d\u6307\u5b9a\u3002 5. \u5168\u5c40settings \u5168\u5c40\u9ed8\u8ba4\u503c\u4f4d\u4e8e scrapy.settings.default_settings \u6a21\u5757\u4e2d\uff0c\u5728 \u5185\u7f6esettings\u53c2\u8003 \u90e8\u5206\u4e2d\u6709\u6587\u6863\u8bf4\u660e\u3002 \u5982\u4f55\u8bbf\u95eesetings \u5728spider\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7 self.settings \u8fdb\u884c\u8bbe\u7f6e class MySpider(scrapy.Spider): name = 'myspider' start_urls = ['http://example.com'] def parse(self, response): print(u \u73b0\u6709\u7684\u8bbe\u7f6e: %s % self.settings.attributes.keys()) \u6ce8\u610f!!!! `settings`\u5c5e\u6027\u662f\u5728\u521d\u59cb\u5316spider\u4e4b\u540e\u5728\u57fa\u672cspider\u7c7b\u4e2d\u8bbe\u7f6e\u7684\u3002 \u5982\u679c\u60a8\u60f3\u5728\u521d\u59cb\u5316\u4e4b\u524d\u4f7f\u7528\u8fd9\u4e9b\u8bbe\u7f6e(\u4f8b\u5982\uff0c\u5728\u60a8\u7684spider\u7684`__init__()`\u65b9\u6cd5\u4e2d)\uff0c \u60a8\u9700\u8981\u8986\u76d6[from_crawler()](#)\u65b9\u6cd5\u3002 Settings\u53ef\u4ee5\u901a\u8fc7Crawler\u7684 scrapy.crawler.Crawler.settings \u5c5e\u6027\u8bbf\u95ee\uff0c\u8be5\u5c5e\u6027\u5728extensions\u3001middlewares\u548citem pipelines\u4e2d\u4f20\u9012\u7ed9 from_crawler \u65b9\u6cd5: class MyExtension(object): def __init__(self, log_is_enabled=False): if log_is_enabled: print(u log\u5df2\u7ecf\u6fc0\u6d3b! ) @classmethod def from_crawler(cls, crawler): settings = crawler.settings return cls(settings.getbool('LOG_ENABLED')) settings\u5bf9\u8c61\u53ef\u4ee5\u50cfdict\u4e00\u6837\u4f7f\u7528(\u4f8b\u5982\uff0c settings['LOG_ENABLED'] )\uff0c\u4f46\u662f\u901a\u5e38\u9996\u9009\u4f7f\u7528 Settings API\u63d0\u4f9b\u7684\u65b9\u6cd5\u63d0\u53d6\u8bbe\u7f6e\uff0c\u4ee5\u907f\u514d\u7c7b\u578b\u9519\u8bef\u3002 setting\u540d\u79f0\u7684\u57fa\u672c\u539f\u7406 Setting\u540d\u79f0\u901a\u5e38\u4ee5\u5b83\u4eec\u914d\u7f6e\u7684\u7ec4\u4ef6\u4e3a\u524d\u7f00\u3002\u4f8b\u5982\uff0c\u865a\u6784\u7684robots.txt\u6269\u5c55\u7684\u6b63\u786e\u547d\u540d\u3002\u53ef\u4ee5\u662f ROBOTSTXT_ENABLED , ROBOTSTXT_OBEY , ROBOTSTXT_CACHEDIR \u7b49\u3002 \u5185\u7f6e\u7684settings\u53c2\u8003 \u4e0b\u9762\u662f\u6240\u6709\u53ef\u7528\u7684Scrapy settings\u7684\u5217\u8868\uff0c\u6309\u5b57\u6bcd\u987a\u5e8f\u6392\u5217\uff0c\u4ee5\u53ca\u5b83\u4eec\u7684\u9ed8\u8ba4\u503c\u548c\u5e94\u7528\u5b83\u4eec\u7684\u8303\u56f4\u3002 \u5982\u679c\u8be5\u8303\u56f4\u4e0e\u4efb\u4f55\u7279\u5b9a\u7ec4\u4ef6\u76f8\u5173\u8054\uff0c\u90a3\u4e48\u5728\u53ef\u7528\u7684\u60c5\u51b5\u4e0b\uff0c\u8be5\u8303\u56f4\u5c06\u663e\u793a\u4f7f\u7528\u8be5setting\u7684\u4f4d\u7f6e\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u7ec4\u4ef6\u7684\u6a21\u5757\u5c06\u663e\u793a\u51fa\u6765\uff0c\u901a\u5e38\u662f\u4e00\u4e2aextension\u3001middleware\u6216pipeline\u3002\u8fd9\u8fd8\u610f\u5473\u7740\uff0c\u4e3a\u4e86\u4f7fsetting\u4ea7\u751f\u4efb\u4f55\u6548\u679c\uff0c\u5fc5\u987b\u542f\u7528\u7ec4\u4ef6\u3002 AWS_ACCESS_KEY_ID \u9ed8\u8ba4: None \u4ee3\u7801\u4f7f\u7528\u7684AWS access key\u7528\u4e8e\u9700\u8981\u8bbf\u95ee Amazon Web\u670d\u52a1 , \u4f8b\u5982S3 feed \u5b58\u50a8\u540e\u7aef\u3002 AWS_SECRET_ACCESS_KEY \u9ed8\u8ba4: None \u4ee3\u7801\u4f7f\u7528\u7684AWS secret key\u7528\u4e8e\u9700\u8981\u8bbf\u95ee Amazon Web\u670d\u52a1 , \u4f8b\u5982S3 feed \u5b58\u50a8\u540e\u7aef\u3002 BOT_NAME \u9ed8\u8ba4: scrapybot \u8fd9\u4e2aScrapy\u9879\u76ee\u5b9e\u4f8b\u5316\u7684bot\u7684\u540d\u79f0(\u4e5f\u79f0\u4e3a\u9879\u76ee\u540d\u79f0)\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8fd9\u5c06\u7528\u4e8e\u6784\u9020\u7528\u6237\u4ee3\u7406\uff0c\u4ee5\u53ca\u65e5\u5fd7\u8bb0\u5f55\u3002 \u5f53\u60a8\u4f7f\u7528 startproject \u547d\u4ee4\u521b\u5efa\u9879\u76ee\u65f6\uff0c\u5b83\u4f1a\u81ea\u52a8\u586b\u5145\u60a8\u7684\u9879\u76ee\u540d\u79f0\u3002 CONCURRENT_ITEMS \u9ed8\u8ba4: 100 \u5728Item Processor(\u4e5f\u79f0\u4e3a Item Pipeline )\u4e2d\u5e76\u884c\u5904\u7406\u7684\u5e76\u53d1items(\u6bcf\u4e2aresponse)\u7684\u6700\u5927\u6570\u76ee\u3002 CONCURRENT_REQUESTS \u9ed8\u8ba4: 16 \u7531Scrapy downloader\u6267\u884c\u7684\u5e76\u53d1(\u5373\u3002\u540c\u65f6)\u8bf7\u6c42\u7684\u6700\u5927\u6570\u76ee\u3002 CONCURRENT_REQUESTS_PER_DOMAIN \u9ed8\u8ba4: 8 \u5bf9\u4efb\u4f55\u5355\u4e2aDOMAIN\u6267\u884c\u7684\u5e76\u53d1\u8bf7\u6c42\u7684\u6700\u5927\u6570\u76ee\u3002 CONCURRENT_REQUESTS_PER_IP \u9ed8\u8ba4: 0 \u5bf9\u4efb\u4f55\u5355\u4e2aIP\u6267\u884c\u7684\u5e76\u53d1\u8bf7\u6c42\u7684\u6700\u5927\u6570\u76ee\u3002 \u5982\u679c\u975e\u96f6\uff0c\u5219\u5ffd\u7565 CONCURRENT_REQUESTS_PER_DOMAIN \u8bbe\u7f6e\uff0c\u800c\u4f7f\u7528\u7684\u662f\u8fd9\u4e2a\u8bbe\u7f6e\u5417\u6362\u53e5\u8bdd\u8bf4\uff0c\u5e76\u53d1\u9650\u5236\u5c06\u5e94\u7528\u4e8e\u6bcf\u4e2aIP\uff0c\u800c\u4e0d\u662f\u6bcf\u4e2aDOMAIN\u3002 \u8fd9\u4e2a\u8bbe\u7f6e\u8fd8\u4f1a\u5f71\u54cd DOWNLOAD_DELAY \u548c AutoThrottle extension : \u5982\u679c CONCURRENT_REQUESTS_PER_IP \u4e3a\u975e\u96f6\uff0c\u5219\u6309\u6bcf\u4e2aIP\u6267\u884cDOWNLOAD_DELAY\uff0c\u800c\u4e0d\u662f\u6309\u6bcf\u4e2aDOMAIN\u6267\u884c\u3002 DEFAULT_ITEM_CLASS \u9ed8\u8ba4: 'scrapy.item.Item' \u7528\u4e8e\u5b9e\u4f8b\u5316 Scrapy shell \u4e2d\u7684items\u7684\u9ed8\u8ba4\u7c7b\u3002 DEFAULT_REQUEST_HEADERS \u9ed8\u8ba4: { 'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8', 'Accept-Language': 'en', } \u7528\u4e8eScrapy HTTP requests\u7684\u9ed8\u8ba4headers\u3002\u5b83\u4eec\u5728 DefaultHeadersMiddleware \u4e2d\u3002 DEPTH_LIMIT \u9ed8\u8ba4: 0 \u8303\u56f4: scrapy.spidermiddlewares.depth.DepthMiddleware \u5141\u8bb8\u722c\u884c\u4efb\u4f55\u7ad9\u70b9\u7684\u6700\u5927\u6df1\u5ea6\u3002\u5982\u679c\u4e3a\u96f6\uff0c\u5c31\u4e0d\u4f1a\u6709\u4efb\u4f55\u9650\u5236\u3002 DEPTH_PRIORITY \u9ed8\u8ba4: 0 \u8303\u56f4: scrapy.spidermiddlewares.depth.DepthMiddleware \u7528\u4e8e\u6839\u636e\u8bf7\u6c42\u6df1\u5ea6\u8c03\u6574\u8bf7\u6c42\u4f18\u5148\u7ea7\u7684\u6574\u6570: \u5982\u679c\u4e3a\u96f6(\u9ed8\u8ba4)\uff0c\u5219\u4e0d\u8fdb\u884c\u6df1\u5ea6\u4f18\u5148\u7ea7\u8c03\u6574 \u6b63\u503c\u5c06\u964d\u4f4e\u4f18\u5148\u7ea7\uff0c\u5373\u7a0d\u540e\u5c06\u5904\u7406\u66f4\u9ad8\u7684\u6df1\u5ea6\u8bf7\u6c42 ;\u8fd9\u901a\u5e38\u7528\u4e8e\u8fdb\u884c\u5e7f\u5ea6\u4f18\u5148\u722c\u884c(BFO) \u8d1f\u6570\u5c06\u589e\u52a0\u4f18\u5148\u7ea7\uff0c\u5373\u3002\u6df1\u5ea6\u8d8a\u9ad8\u7684\u8bf7\u6c42\u5904\u7406\u8d8a\u5feb(DFO) \u8bf7\u53c2\u9605: Scrapy\u662f\u6309\u5e7f\u5ea6\u4f18\u5148\u987a\u5e8f\u8fd8\u662f\u6df1\u5ea6\u4f18\u5148\u987a\u5e8f\u6293\u53d6? \u5173\u4e8eBFO\u6216DFO\u7684\u8c03\u4f18\u95ee\u9898\u3002 \u6ce8\u610f!!!!!! \u4e0e\u5176\u4ed6\u4f18\u5148\u7ea7\u8bbe\u7f6e[REDIRECT_PRIORITY_ADJUST](#)\u548c[RETRY_PRIORITY_ADJUST](#)\u76f8\u6bd4\uff0c \u6b64\u8bbe\u7f6e\u4ee5\u76f8\u53cd\u7684\u65b9\u5f0f\u8c03\u6574\u4f18\u5148\u7ea7\u3002 DEPTH_STATS \u9ed8\u8ba4: True \u8303\u56f4: scrapy.spidermiddlewares.depth.DepthMiddleware \u662f\u5426\u6536\u96c6\u6700\u5927\u6df1\u5ea6\u5c5e\u6027\u3002 DEPTH_STATS_VERBOSE \u9ed8\u8ba4: False \u8303\u56f4: scrapy.spidermiddlewares.depth.DepthMiddleware \u662f\u5426\u6536\u96c6\u8be6\u7ec6\u6df1\u5ea6\u7edf\u8ba1\u4fe1\u606f\u3002\u5982\u679c\u542f\u7528\u4e86\u6b64\u529f\u80fd\uff0c\u5219\u5728\u7edf\u8ba1\u6570\u636e\u4e2d\u6536\u96c6\u6bcf\u4e2a\u6df1\u5ea6\u7684\u8bf7\u6c42\u6570\u91cf\u3002 DNSCACHE_ENABLED \u9ed8\u8ba4: True \u662f\u5426\u542f\u7528DNS\u5185\u5b58\u7f13\u5b58\u3002 DNSCACHE_SIZE \u9ed8\u8ba4: 10000 DNS\u5185\u5b58\u7f13\u5b58\u5927\u5c0f\u3002 DNS_TIMEOUT \u9ed8\u8ba4\u503c: 60 \u5904\u7406DNS\u67e5\u8be2\u7684\u8d85\u65f6\u65f6\u95f4(\u4ee5\u79d2\u4e3a\u5355\u4f4d)\u3002\u652f\u6301Float\u3002 DOWNLOADER \u9ed8\u8ba4: 'scrapy.core.downloader.Downloader' \u7528\u4e8e\u722c\u53d6\u7684\u4e0b\u8f7d\u5668\u3002 DOWNLOADER_HTTPCLIENTFACTORY \u9ed8\u8ba4: 'scrapy.core.downloader.webclient.ScrapyHTTPClientFactory' \u5b9a\u4e49\u7528\u4e8eHTTP/1.0\u8fde\u63a5\u7684Twisted protocol.ClientFactory \u7c7b(\u7528\u4e8e HTTP10DownloadHandler ) HTTP/1.0\u73b0\u5728\u5f88\u5c11\u4f7f\u7528\uff0c\u6240\u4ee5\u60a8\u53ef\u4ee5\u653e\u5fc3\u5730\u5ffd\u7565\u8fd9\u4e2a\u8bbe\u7f6e\uff0c\u9664\u975e\u60a8\u4f7f\u7528Twisted 11.1\uff0c \u6216\u8005\u60a8\u771f\u7684\u60f3\u4f7f\u7528HTTP/1.0\uff0c\u5e76\u4e3a`HTTP(s)` scheme\u91cd\u5199[DOWNLOAD_HANDLERS_BASE](#)\uff0c \u5373'scrapy.core.downloader.handlers.http.HTTP10DownloadHandler'\u3002 DOWNLOADER_CLIENTCONTEXTFACTORY \u9ed8\u8ba4: 'scrapy.core.downloader.contextfactory.ScrapyClientContextFactory' \u8868\u793a\u8981\u4f7f\u7528\u7684ContextFactory\u7684\u7c7b\u8def\u5f84\u3002 \u5728\u8fd9\u91cc\uff0c\u201cContextFactory\u201d\u662f\u4e00\u4e2a\u7528\u4e8eSSL/TLS\u4e0a\u4e0b\u6587\u7684Twisted\u672f\u8bed\uff0c\u5b83\u5b9a\u4e49\u4e86\u8981\u4f7f\u7528\u7684TLS/SSL\u534f\u8bae\u7248\u672c\uff0c\u65e0\u8bba\u662f\u8fdb\u884c\u8bc1\u4e66\u9a8c\u8bc1\uff0c\u8fd8\u662f\u542f\u7528\u5ba2\u6237\u7aef\u8eab\u4efd\u9a8c\u8bc1(\u4ee5\u53ca\u5176\u4ed6\u5404\u79cd\u4e8b\u60c5)\u3002 Scrapy\u9ed8\u8ba4context factory\u4e0d\u6267\u884c\u8fdc\u7a0b\u670d\u52a1\u5668\u8bc1\u4e66\u9a8c\u8bc1\u3002\u8fd9\u5bf9\u4e8eweb\u6293\u53d6\u6765\u8bf4\u662f\u5f88\u597d\u7684\u3002 \u5982\u679c\u786e\u5b9e\u9700\u8981\u542f\u7528\u8fdc\u7a0b\u670d\u52a1\u5668\u8bc1\u4e66\u9a8c\u8bc1\uff0cScrapy\u8fd8\u6709\u53e6\u4e00\u4e2a\u53ef\u4ee5\u8bbe\u7f6e\u7684context factory\u7c7b 'scrapy.core.downloader.contextfactory.BrowserLikeContextFactory'\u3002 \u5b83\u4f7f\u7528\u5e73\u53f0\u7684\u8bc1\u4e66\u6765\u9a8c\u8bc1\u8fdc\u7a0b\u7aef\u70b9\u3002\u53ea\u6709\u5728\u4f7f\u7528Twisted =14.0\u65f6\u624d\u53ef\u7528\u3002 \u5982\u679c\u4f7f\u7528\u81ea\u5b9a\u4e49ContextFactory\uff0c\u8bf7\u786e\u4fdd\u5b83\u5728init\u4e2d\u63a5\u53d7 method \u53c2\u6570(\u8fd9\u662f OpenSSL.SSL \u65b9\u6cd5\u6620\u5c04 DOWNLOADER_CLIENT_TLS_METHOD ) DOWNLOADER_CLIENT_TLS_METHOD \u9ed8\u8ba4: 'TLS' \u4f7f\u7528\u6b64\u8bbe\u7f6e\u81ea\u5b9a\u4e49\u9ed8\u8ba4HTTP/1.1 downloader\u4f7f\u7528\u7684TLS/SSL\u65b9\u6cd5\u3002 \u6b64\u8bbe\u7f6e\u5fc5\u987b\u662f\u4ee5\u4e0b\u5b57\u7b26\u4e32\u503c\u4e4b\u4e00: 'TLS' : \u6620\u5c04\u5230OpenSSL\u7684 TLS_method() (a.k.a SSLv23_method() )\uff0c\u5b83\u5141\u8bb8\u534f\u8bae\u534f\u5546\uff0c\u4ece\u5e73\u53f0\u652f\u6301\u7684\u6700\u9ad8\u7ea7\u522b\u5f00\u59cb; \u9ed8\u8ba4\u60c5\u51b5\u4e0b,\u63a8\u8350 'TLSv1.0' : \u8fd9\u4e2a\u503c\u5f3a\u5236HTTPS\u8fde\u63a5\u4f7f\u7528TLS\u7248\u672c1.0;\u5982\u679c\u4f60\u60f3\u8981Scrapy\u7684\u884c\u4e3a\u8bbe\u7f6e\u8fd9\u4e2a, \u5fc5\u987bScrapy 1.1 'TLSv1.1' : \u5f3a\u5236TLS\u7248\u672c1.1 'TLSv1.2' : \u5f3a\u5236TLS\u7248\u672c1.2 'SSLv3' : \u5f3a\u5236SSL\u7248\u672c3(\u4e0d\u63a8\u8350) \u6211\u4eec\u5efa\u8bae\u60a8\u4f7f\u7528PyOpenSSL =0.13, Twisted =0.13\u6216\u4ee5\u4e0a(Twisted =14.0)\u3002 DOWNLOADER_MIDDLEWARES \u9ed8\u8ba4: {} \u5305\u542b\u4f60\u7684\u9879\u76ee\u4e2d\u542f\u7528\u7684downloader middlewares\u53ca\u5176\u5bf9\u5e94\u7684\u6570\u5b57\u7684\u5b57\u5178. \u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1 \u6fc0\u6d3bdownloader middleware \u3002 DOWNLOADER_MIDDLEWARES_BASE \u9ed8\u8ba4: { 'scrapy.downloadermiddlewares.robotstxt.RobotsTxtMiddleware': 100, 'scrapy.downloadermiddlewares.httpauth.HttpAuthMiddleware': 300, 'scrapy.downloadermiddlewares.downloadtimeout.DownloadTimeoutMiddleware': 350, 'scrapy.downloadermiddlewares.defaultheaders.DefaultHeadersMiddleware': 400, 'scrapy.downloadermiddlewares.useragent.UserAgentMiddleware': 500, 'scrapy.downloadermiddlewares.retry.RetryMiddleware': 550, 'scrapy.downloadermiddlewares.ajaxcrawl.AjaxCrawlMiddleware': 560, 'scrapy.downloadermiddlewares.redirect.MetaRefreshMiddleware': 580, 'scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware': 590, 'scrapy.downloadermiddlewares.redirect.RedirectMiddleware': 600, 'scrapy.downloadermiddlewares.cookies.CookiesMiddleware': 700, 'scrapy.downloadermiddlewares.httpproxy.HttpProxyMiddleware': 750, 'scrapy.downloadermiddlewares.stats.DownloaderStats': 850, 'scrapy.downloadermiddlewares.httpcache.HttpCacheMiddleware': 900, } \u5728Scrapy\u4e2d\u9ed8\u8ba4\u542f\u7528\u7684\u5305\u542bdownloader middlewares\u7684\u5b57\u5178\u3002\u6570\u5b57\u8d8a\u4f4e\u8d8a\u63a5\u8fd1engine\uff0c\u6570\u5b57\u8d8a\u9ad8\u8d8a\u63a5\u8fd1downloader\u3002\u6c38\u8fdc\u4e0d\u8981\u5728\u9879\u76ee\u4e2d\u4fee\u6539\u8fd9\u4e2a\u8bbe\u7f6e\uff0c\u4fee\u6539 downloader_middleware \u9664\u5916\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1 \u6fc0\u6d3bdownloader middleware \u3002 DOWNLOADER_STATS \u9ed8\u8ba4: True \u662f\u5426\u542f\u7528\u4e0b\u8f7d\u52a0\u8f7d\u5668\u7edf\u8ba1\u4fe1\u606f\u6536\u96c6\u3002 DOWNLOAD_DELAY \u9ed8\u8ba4: 0 downloader\u5728\u4ece\u540c\u4e00\u7f51\u7ad9\u4e0b\u8f7d\u8fde\u7eed\u9875\u9762\u4e4b\u524d\u5e94\u8be5\u7b49\u5f85\u7684\u65f6\u95f4(\u4ee5\u79d2\u4e3a\u5355\u4f4d)\u3002\u8fd9\u53ef\u4ee5\u7528\u6765\u63a7\u5236\u722c\u866b\u901f\u5ea6\uff0c\u907f\u514d\u5bf9\u670d\u52a1\u5668\u9020\u6210\u592a\u5927\u7684\u51b2\u51fb\u3002\u652f\u6301\u5341\u8fdb\u5236\u6570\u3002\u4f8b\u5b50: DOWNLOAD_DELAY = 0.25 # \u5ef6\u8fdf250ms \u8fd9\u4e2a\u8bbe\u7f6e\u8fd8\u53d7\u5230 RANDOMIZE_DOWNLOAD_DELAY \u8bbe\u7f6e(\u9ed8\u8ba4\u542f\u7528)\u7684\u5f71\u54cd\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cScrapy\u4e0d\u4f1a\u5728\u8bf7\u6c42\u4e4b\u95f4\u7b49\u5f85\u56fa\u5b9a\u7684\u65f6\u95f4\uff0c\u800c\u662f\u4f7f\u75280.5 * DOWNLOAD_DELAY \u548c1.5 * DOWNLOAD_DELAY \u4e4b\u95f4\u7684\u968f\u673a\u95f4\u9694\u3002 \u5f53 CONCURRENT_REQUESTS_PER_IP \u662f\u975e\u96f6\u65f6\uff0c\u6bcf\u4e2aip\u5730\u5740\u800c\u4e0d\u662f\u6bcf\u4e2adomain\u90fd\u4f1a\u53d1\u751f\u5ef6\u8fdf\u3002 \u8fd8\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e download_delay spider\u5c5e\u6027\u4e3a\u6bcf\u4e2aspider\u66f4\u6539\u6b64setting\u3002 DOWNLOAD_HANDLERS \u9ed8\u8ba4: {} \u5305\u542b\u5728\u4f60\u7684\u9879\u76ee\u4e2d\u542f\u7528\u7684request downloader handlers\u7684\u5b57\u5178\u3002\u53c2\u89c1 DOWNLOAD_HANDLERS_BASE \u793a\u4f8b\u683c\u5f0f\u3002 DOWNLOAD_HANDLERS_BASE \u9ed8\u8ba4: { 'file': 'scrapy.core.downloader.handlers.file.FileDownloadHandler', 'http': 'scrapy.core.downloader.handlers.http.HTTPDownloadHandler', 'https': 'scrapy.core.downloader.handlers.http.HTTPDownloadHandler', 's3': 'scrapy.core.downloader.handlers.s3.S3DownloadHandler', 'ftp': 'scrapy.core.downloader.handlers.ftp.FTPDownloadHandler', } \u5728Scrapy\u4e2d\u9ed8\u8ba4\u542f\u7528\u7684\u5305\u542brequest download handlers\u7684\u5b57\u5178\u3002\u6c38\u8fdc\u4e0d\u8981\u5728\u9879\u76ee\u4e2d\u4fee\u6539\u8fd9\u4e2a\u8bbe\u7f6e\uff0c\u4fee\u6539 DOWNLOAD_HANDLERS \u9664\u5916\u3002 \u60a8\u53ef\u4ee5\u901a\u8fc7\u5728 DOWNLOAD_HANDLERS \u4e2d\u4e3a\u5b83\u4eec\u7684URI scheme\u5206\u914d None \u6765\u7981\u7528\u8fd9\u4e9bdownload handlers\u3002\u4f8b\u5982\uff0c\u8981\u7981\u7528\u5185\u7f6e\u7684FTP\u5904\u7406\u7a0b\u5e8f(\u4e0d\u9700\u8981\u66ff\u6362)\uff0c\u8bf7\u5c06\u5176\u653e\u5728\u60a8\u7684 settings.py \u4e2d\u3002 DOWNLOAD_HANDLERS = { 'ftp': None, } DOWNLOAD_TIMEOUT \u9ed8\u8ba4: 180 downloader\u5728\u8d85\u65f6\u524d\u7b49\u5f85\u7684\u65f6\u95f4(\u4ee5\u79d2\u4e3a\u5355\u4f4d)\u3002 \u53ef\u4ee5\u4e3a\u6bcf\u4e2aspider\u8bbe\u7f6e`download_timeout` spider\u5c5e\u6027\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\uff0c \u4e5f\u53ef\u4ee5\u4f7f\u7528`download_timeout` Request.meta key\u4e3a\u6bcf\u4e2arequest\u4f7f\u7528 DOWNLOAD_MAXSIZE \u9ed8\u8ba4: 1073741824 (1024MB) downloader\u5c06\u4e0b\u8f7d\u7684\u6700\u5927response\u5927\u5c0f(\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d)\u3002 \u5982\u679c\u4f60\u60f3\u7981\u7528\u5b83\u8bbe\u7f6e\u4e3a0\u3002 \u8fd9\u4e2a\u5927\u5c0f\u53ef\u4ee5\u4f7f\u7528`download_maxsize` spider\u5c5e\u6027\u4e3a\u6bcf\u4e2aspider\u8bbe\u7f6e\uff0c \u4e5f\u53ef\u4ee5\u4f7f\u7528`download_maxsize` Request.meta key\u4e3a\u6bcf\u4e2arequest\u4f7f\u7528 \u8fd9\u4e2a\u7279\u6027\u9700\u8981Twisted = 11.1\u3002 DOWNLOAD_WARNSIZE \u9ed8\u8ba4: 33554432 (32MB) downloader\u5c06\u5f00\u59cb\u8b66\u544a\u7684response\u5927\u5c0f(\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d)\u3002 \u5982\u679c\u4f60\u60f3\u7981\u7528\u5b83\u8bbe\u7f6e\u4e3a0\u3002 \u8fd9\u4e2a\u5927\u5c0f\u53ef\u4ee5\u4f7f\u7528`download_warnsize` spider\u5c5e\u6027\u4e3a\u6bcf\u4e2a\u722c\u884c\u5668\u8bbe\u7f6e\uff0c \u4e5f\u53ef\u4ee5\u4f7f\u7528`download_warnsize` Request.meta key\u4e3a\u6bcf\u4e2arequest\u4f7f\u7528 \u8fd9\u4e2a\u7279\u6027\u9700\u8981Twisted = 11.1\u3002 DOWNLOAD_FAIL_ON_DATALOSS \u9ed8\u8ba4: True \u5728\u4e2d\u65ad\u7684response\u4e0a\u662f\u5426\u5931\u8d25\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u58f0\u660e\u7684 Content-Length \u4e0e\u670d\u52a1\u5668\u53d1\u9001\u7684\u5185\u5bb9\u4e0d\u5339\u914d\uff0c\u6216\u8005\u5757\u72b6\u7684\u54cd\u5e94\u6ca1\u6709\u6b63\u786e\u5b8c\u6210\u3002\u5982\u679c\u4e3a True \uff0c\u8fd9\u4e9bresponse\u5c06\u5f15\u53d1 ResponseFailed([_DataLoss]) \u9519\u8bef\u3002\u5982\u679c\u4e3a False \uff0c\u5219\u4f20\u9012\u8fd9\u4e9bresponses\uff0c\u5e76\u5c06flag(\u6807\u8bb0) dataloss \u6dfb\u52a0\u5230response\u4e2d\uff0c\u5373: 'dataloss' in response.flags \u662f True \u53ef\u9009\u5730\uff0c\u8fd9\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528 download_fail_on_dataloss \u8bbe\u7f6e\u4e3a False \u6765\u8bbe\u7f6e\u6bcf\u4e2arequests\u7684\u57fa\u7840 \u5728\u4e00\u4e9b\u60c5\u51b5\u4e0b\uff0c\u4ece\u670d\u52a1\u5668\u9519\u8bef\u914d\u7f6e\u5230\u7f51\u7edc\u9519\u8bef\uff0c\u518d\u5230\u6570\u636e\u635f\u574f\uff0c \u53ef\u80fd\u4f1a\u51fa\u73b0\u54cd\u5e94\u4e2d\u65ad\u6216\u6570\u636e\u4e22\u5931\u9519\u8bef\u3002\u8003\u8651\u5230\u4e2d\u65ad\u7684\u54cd\u5e94\u53ef\u80fd\u5305\u542b\u90e8\u5206\u5185\u5bb9\u6216\u4e0d\u5b8c\u6574\u7684\u5185\u5bb9\uff0c \u7531\u7528\u6237\u51b3\u5b9a\u662f\u5426\u6709\u5fc5\u8981\u5bf9\u5176\u8fdb\u884c\u5904\u7406\u3002\u5982\u679c[RETRY_ENABLED](#)\u4e3a`True`\uff0c \u4e14\u8be5setting\u4e3a`True`\uff0c\u5219`ResponseFailed([_DataLoss])`\u5931\u8d25\u5c06\u50cf\u5f80\u5e38\u4e00\u6837\u91cd\u8bd5\u3002 DUPEFILTER_CLASS \u9ed8\u8ba4: 'scrapy.dupefilters.RFPDupeFilter' \u7528\u4e8e\u68c0\u6d4b\u548c\u8fc7\u6ee4\u91cd\u590drequests\u7684\u7c7b\u3002 \u9ed8\u8ba4\u7684( RFPDupeFilter )\u8fc7\u6ee4\u5668\u57fa\u4e8e\u4f7f\u7528 scrapy.utils.request.request_fingerprint \u51fd\u6570\u3002\u4e3a\u4e86\u6539\u53d8\u91cd\u590d\u68c0\u67e5\u7684\u65b9\u5f0f\uff0c\u60a8\u53ef\u4ee5\u5b50\u7c7b\u5316 RFPDupeFilter \u5e76\u8986\u76d6\u5b83\u7684 request_fingerprint \u65b9\u6cd5\u3002\u8fd9\u4e2a\u65b9\u6cd5\u5e94\u8be5\u63a5\u53d7scrapy[Request]\u5bf9\u8c61\u5e76\u8fd4\u56de\u5b83\u7684fingerprint(\u4e00\u4e2a\u5b57\u7b26\u4e32)\u3002 \u60a8\u53ef\u4ee5\u901a\u8fc7\u5c06 DUPEFILTER_CLASS \u8bbe\u7f6e\u4e3a 'scrapy.dupefilters.BaseDupeFilter' \u6765\u7981\u7528\u5bf9\u91cd\u590d\u8bf7\u6c42\u7684\u8fc7\u6ee4\u3002\u4f46\u662f\u8981\u975e\u5e38\u5c0f\u5fc3\uff0c\u56e0\u4e3a\u60a8\u53ef\u80fd\u4f1a\u8fdb\u5165\u6293\u53d6\u5faa\u73af\u3002\u5bf9\u4e8e\u4e0d\u5e94\u8be5\u88ab\u8fc7\u6ee4\u7684\u7279\u5b9a Request \uff0c\u6700\u597d\u5c06 dont_filter \u53c2\u6570\u8bbe\u7f6e\u4e3a True \u3002 DUPEFILTER_DEBUG \u9ed8\u8ba4: False \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c RFPDupeFilter \u53ea\u8bb0\u5f55\u7b2c\u4e00\u4e2a\u91cd\u590d\u8bf7\u6c42\u3002\u5c06 DUPEFILTER_DEBUG \u8bbe\u7f6e\u4e3a True \u5c06\u4f7f\u5b83\u8bb0\u5f55\u6240\u6709\u91cd\u590d\u7684\u8bf7\u6c42\u3002 EDITOR \u9ed8\u8ba4: vi (\u5728Unix\u7cfb\u7edf\u4e0a)\u6216\u95f2\u7f6e\u7f16\u8f91\u5668(\u5728Windows\u4e0a) \u4f7f\u7528 edit \u547d\u4ee4\u7f16\u8f91spiders\u7684\u7f16\u8f91\u5668\u3002\u6b64\u5916\uff0c\u5982\u679c\u8bbe\u7f6e\u4e86 EDITOR \u73af\u5883\u53d8\u91cf\uff0c\u90a3\u4e48 edit \u547d\u4ee4\u5c06\u66f4\u559c\u6b22\u5b83\u800c\u4e0d\u662f\u9ed8\u8ba4\u8bbe\u7f6e\u3002 EXTENSIONS \u9ed8\u8ba4: {} \u5305\u542b\u9879\u76ee\u4e2d\u542f\u7528\u7684extensions(\u6269\u5c55)\u53ca\u5176\u5bf9\u5e94\u7684\u6570\u5b57\u7684dict\u3002 EXTENSIONS_BASE \u9ed8\u8ba4: { 'scrapy.extensions.corestats.CoreStats': 0, 'scrapy.extensions.telnet.TelnetConsole': 0, 'scrapy.extensions.memusage.MemoryUsage': 0, 'scrapy.extensions.memdebug.MemoryDebugger': 0, 'scrapy.extensions.closespider.CloseSpider': 0, 'scrapy.extensions.feedexport.FeedExporter': 0, 'scrapy.extensions.logstats.LogStats': 0, 'scrapy.extensions.spiderstate.SpiderState': 0, 'scrapy.extensions.throttle.AutoThrottle': 0, } \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cScrapy\u4e2d\u5305\u542b\u9879\u76ee\u4e2d\u542f\u7528\u7684extensions(\u6269\u5c55)\u53ca\u5176\u5bf9\u5e94\u7684\u6570\u5b57\u6743\u91cd\u7684dict\u3002\u6b64\u8bbe\u7f6e\u5305\u542b\u6240\u6709\u7a33\u5b9a\u7684\u5185\u7f6e\u6269\u5c55\u3002\u8bf7\u8bb0\u4f4f\uff0c\u5176\u4e2d\u4e00\u4e9b\u9700\u8981\u901a\u8fc7\u8bbe\u7f6e\u542f\u7528\u3002 \u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 \u6269\u5c55\u7528\u6237\u6307\u5357 \u548c \u53ef\u7528\u6269\u5c55\u5217\u8868 \u3002 FEED_TEMPDIR Feed Temp dir\u5141\u8bb8\u60a8\u5728\u4e0a\u4f20 FTP feed storage \u548c Amazon S3 \u4e4b\u524d\u8bbe\u7f6e\u4e00\u4e2a\u81ea\u5b9a\u4e49\u6587\u4ef6\u5939\u6765\u4fdd\u5b58\u722c\u866b\u4e34\u65f6\u6587\u4ef6\u3002 FTP_PASSIVE_MODE \u9ed8\u8ba4: True \u542f\u52a8FTP\u4f20\u8f93\u65f6\u662f\u5426\u4f7f\u7528\u88ab\u52a8\u6a21\u5f0f\u3002 FTP_PASSWORD \u9ed8\u8ba4: \"guest\" \u5f53FTP\u8fde\u63a5\u65f6\u4f7f\u7528\u7684\u5bc6\u7801\u6ca1\u6709\u5199\u5728 Request meta\u91cc\u7684 \"ftp_password\" \u53d9\u8ff0[RFC 1635](https://tools.ietf.org/html/rfc1635)\uff0c \u5c3d\u7ba1\u901a\u5e38\u5728\u533f\u540dFTP\u4e0a\u4f7f\u7528\u201cguest\u201d\u5bc6\u7801\u6216\u7535\u5b50\u90ae\u4ef6\u5730\u5740\u5f88\u5e38\u89c1\uff0c \u4f46\u4e00\u4e9bFTP\u670d\u52a1\u5668\u660e\u786e\u8981\u6c42\u7528\u6237\u7684\u7535\u5b50\u90ae\u4ef6\u5730\u5740\uff0c\u4e0d\u5141\u8bb8\u4f7f\u7528\u201cguest\u201d\u5bc6\u7801\u767b\u5f55\u3002 FTP_USER \u9ed8\u8ba4: \"anonymous\" \u5f53FTP\u8fde\u63a5\u65f6\u4f7f\u7528\u7684\u5bc6\u7801\u6ca1\u6709\u5199\u5728 Request meta\u91cc\u7684 \"ftp_user\" ITEM_PIPELINES \u9ed8\u8ba4: {} \u4e00\u79cd\u5b57\u5178\uff0c\u5305\u542b\u8981\u4f7f\u7528\u7684item pipelines\u53ca\u5176\u5bf9\u5e94\u7684\u6570\u5b57\u3002\u6570\u5b57\u503c\u662f\u4efb\u610f\u7684\uff0c\u4f46\u662f\u901a\u5e38\u57280-1000\u8303\u56f4\u5185\u5b9a\u4e49\u5b83\u4eec\u3002\u4f4e\u6570\u5b57\u5728\u641e\u6570\u5b57\u4e4b\u524d\u5904\u7406\u3002 \u4f8b\u5b50: ITEM_PIPELINES = { 'mybot.pipelines.validate.ValidateMyItem': 300, 'mybot.pipelines.validate.StoreMyItem': 800, } ITEM_PIPELINES_BASE \u9ed8\u8ba4: {} \u5728Scrapy\u4e2d\u9ed8\u8ba4\u542f\u7528\u7684\u5305\u542bpipelines\u7684dict\u3002\u6c38\u8fdc\u4e0d\u8981\u5728\u9879\u76ee\u4e2d\u4fee\u6539\u8fd9\u4e2a\u8bbe\u7f6e\uff0c\u4fee\u6539 ITEM_PIPELINES \u9664\u5916\u3002 LOG_ENABLED \u9ed8\u8ba4: True \u662f\u5426\u542f\u7528\u65e5\u5fd7\u8bb0\u5f55\u3002 LOG_ENCODING \u9ed8\u8ba4\u503c: 'utf - 8' \u7528\u4e8e\u65e5\u5fd7\u8bb0\u5f55\u7684\u7f16\u7801\u3002 LOG_FILE \u9ed8\u8ba4\u503c: None \u7528\u4e8e\u8bb0\u5f55\u8f93\u51fa\u7684\u6587\u4ef6\u540d\u3002\u5982\u679c\u6ca1\u6709\uff0c\u5219\u4f7f\u7528\u6807\u51c6\u9519\u8bef LOG_FORMAT \u9ed8\u8ba4: '%(asctime)s [%(name)s] %(levelname)s: %(message)s' \u7528\u4e8e\u683c\u5f0f\u5316\u65e5\u5fd7\u6d88\u606f\u7684\u5b57\u7b26\u4e32\u3002\u6709\u5173\u53ef\u7528\u5360\u4f4d\u7b26\u7684\u5b8c\u6574\u5217\u8868\uff0c\u8bf7\u53c2\u9605 Python\u65e5\u5fd7\u8bb0\u5f55\u6587\u6863 \u3002 LOG_DATEFORMAT Default: '%Y-%m-%d %H:%M:%S' \u7528\u4e8e\u683c\u5f0f\u5316\u65e5\u671f/\u65f6\u95f4\u7684\u5b57\u7b26\u4e32\uff0c\u4ee5 LOG_FORMAT \u5c55\u5f00 %(asctime)s \u7684\u5360\u4f4d\u7b26, \u6709\u5173\u53ef\u7528\u6307\u4ee4\u7684\u5b8c\u6574\u5217\u8868\uff0c\u8bf7\u53c2\u9605 Python datetime\u6587\u6863 \u3002 LOG_LEVEL \u9ed8\u8ba4: 'DEBUG' \u65e5\u5fd7\u7684\u6700\u4f4e\u7ea7\u522b\u3002\u53ef\u7528\u7684\u7ea7\u522b\u662f: CRITICAL (\u5173\u952e\u7ea7\u522b)\u3001 ERROR (\u9519\u8bef\u7ea7\u522b)\u3001 WARNING (\u8b66\u544a\u7ea7\u522b)\u3001 INFO (\u4fe1\u606f\u7ea7\u522b)\u3001 DEBUG (\u8c03\u8bd5\u7ea7\u522b)\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1 \u65e5\u5fd7\u8bb0\u5f55 \u3002 LOG_STDOUT \u9ed8\u8ba4: False \u5982\u679c\u4e3a True \uff0c\u8fdb\u7a0b\u7684\u6240\u6709\u6807\u51c6\u8f93\u51fa(\u548c\u9519\u8bef)\u5c06\u88ab\u91cd\u5b9a\u5411\u5230\u65e5\u5fd7\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8 print 'hello' \uff0c\u5b83\u5c06\u51fa\u73b0\u5728Scrapy\u65e5\u5fd7\u4e2d\u3002 LOG_SHORT_NAMES \u9ed8\u8ba4: False \u5982\u679c\u4e3a True \uff0c\u65e5\u5fd7\u53ea\u5305\u542b\u6839\u8def\u5f84\u3002\u5982\u679c\u8bbe\u7f6e\u4e3a False \uff0c\u5219\u663e\u793a\u8d1f\u8d23\u65e5\u5fd7\u8f93\u51fa\u7684\u7ec4\u4ef6 MEMDEBUG_ENABLED \u9ed8\u8ba4: False \u662f\u5426\u542f\u7528\u5185\u5b58\u8c03\u8bd5\u3002 MEMDEBUG_NOTIFY \u9ed8\u8ba4: [] \u5f53\u542f\u7528\u5185\u5b58\u8c03\u8bd5\u65f6\uff0c\u5982\u679c\u8be5\u8bbe\u7f6e\u4e0d\u662f\u7a7a\u7684\uff0c\u5185\u5b58\u62a5\u544a\u5c06\u88ab\u53d1\u9001\u5230\u6307\u5b9a\u7684\u5730\u5740\uff0c\u5426\u5219\u62a5\u544a\u5c06\u88ab\u5199\u5165\u65e5\u5fd7\u3002 \u4f8b\u5b50: MEMDEBUG_NOTIFY = ['user@example.com'] MEMUSAGE_ENABLED \u9ed8\u8ba4: True \u8303\u56f4: scrapy.extensions.memusage \u662f\u5426\u542f\u7528\u5185\u5b58\u4f7f\u7528\u6269\u5c55\u3002\u6b64\u6269\u5c55\u8ddf\u8e2a\u8fdb\u7a0b\u4f7f\u7528\u7684\u5cf0\u503c\u5185\u5b58(\u5c06\u5176\u5199\u5230stats\u4e2d)\u3002\u5f53\u5185\u5b58\u8d85\u8fc7\u9650\u5236(\u8bf7\u53c2\u9605 MEMUSAGE_LIMIT_MB )\u65f6\uff0c\u5b83\u8fd8\u53ef\u4ee5\u9009\u62e9\u5173\u95edScrapy\u8fdb\u7a0b\uff0c\u5e76\u5728\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\u65f6\u901a\u8fc7\u7535\u5b50\u90ae\u4ef6\u901a\u77e5(\u8bf7\u53c2\u9605 MEMUSAGE_NOTIFY_MAIL )\u3002 \u53c2\u89c1 \u5185\u5b58\u4f7f\u7528\u6269\u5c55 \u3002 MEMUSAGE_LIMIT_MB \u9ed8\u8ba4: 0 \u8303\u56f4: scrapy.extensions.memusage \u5173\u95edScrapy(\u5982\u679cMEMUSAGE_ENABLED\u4e3aTrue)\u4e4b\u524d\u5141\u8bb8\u7684\u6700\u5927\u5185\u5b58\u6570\u91cf(\u4ee5\u5146\u5b57\u8282\u4e3a\u5355\u4f4d)\u3002\u5982\u679c\u4e3a\u96f6\uff0c\u5219\u4e0d\u6267\u884c\u68c0\u67e5\u3002 \u53c2\u89c1 \u5185\u5b58\u4f7f\u7528\u6269\u5c55 \u3002 MEMUSAGE_CHECK_INTERVAL_SECONDS \u6700\u65b0\u7248\u672c1.1 \u9ed8\u8ba4: 60.0 \u5185\u5b58\u4f7f\u7528\u6269\u5c55 \u68c0\u67e5\u5f53\u524d\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\uff0c\u800c\u4e0d\u662f MEMUSAGE_LIMIT_MB \u548c MEMUSAGE_WARNING_MB \u5728\u56fa\u5b9a\u65f6\u95f4\u95f4\u9694\u8bbe\u7f6e\u7684\u9650\u5236\u3002 \u8fd9\u5c06\u8bbe\u7f6e\u8fd9\u4e9b\u95f4\u9694\u7684\u957f\u5ea6\uff0c\u4ee5\u79d2\u4e3a\u5355\u4f4d\u3002 \u53c2\u89c1 \u5185\u5b58\u4f7f\u7528\u6269\u5c55 \u3002 MEMUSAGE_NOTIFY_MAIL \u9ed8\u8ba4: False \u8303\u56f4: scrapy.extensions.memusage \u4e00\u4e2a\u7535\u5b50\u90ae\u4ef6\u5217\u8868\uff0c\u5982\u679c\u5185\u5b58\u8fbe\u5230\u9650\u5236\u5c31\u901a\u77e5\u3002 \u4f8b\u5b50: MEMUSAGE_NOTIFY_MAIL = ['user@example.com'] \u53c2\u89c1 \u5185\u5b58\u4f7f\u7528\u6269\u5c55 \u3002 MEMUSAGE_WARNING_MB \u9ed8\u8ba4: 0 \u8303\u56f4: scrapy.extensions.memusage \u53d1\u9001\u8b66\u544a\u90ae\u4ef6\u901a\u77e5\u4e4b\u524d\u5141\u8bb8\u7684\u6700\u5927\u5185\u5b58\u5bb9\u91cf(\u4ee5\u5146\u5b57\u8282\u4e3a\u5355\u4f4d)\u3002\u5982\u679c\u4e3a\u96f6\uff0c\u5219\u4e0d\u4f1a\u53d1\u51fa\u8b66\u544a\u3002 NEWSPIDER_MODULE \u9ed8\u8ba4: '' \u4f7f\u7528genspider\u547d\u4ee4\u521b\u5efa\u65b0spider\u7684\u6a21\u5757\u3002 \u4f8b\u5b50: NEWSPIDER_MODULE = 'mybot.spiders_dev' RANDOMIZE_DOWNLOAD_DELAY \u9ed8\u8ba4: True \u5982\u679c\u542f\u7528\u4e86,Scrapy\u5728\u4ece\u540c\u4e00\u7f51\u7ad9\u83b7\u53d6\u8bf7\u6c42\u65f6\u5c06\u4f1a\u7b49\u5f85\u4e00\u6bb5\u968f\u673a\u7684\u65f6\u95f4(\u4ecb\u4e8e0.5 * DOWNLOAD_DELAY \u548c1.5 * DOWNLOAD_DELAY \u4e4b\u95f4)\u3002 \u8fd9\u79cd\u968f\u673a\u5316\u964d\u4f4e\u4e86\u722c\u866b\u7a0b\u5e8f\u88ab\u5206\u6790\u8bf7\u6c42\u7684\u7ad9\u70b9\u68c0\u6d4b\u5230(\u5e76\u968f\u540e\u88ab\u963b\u6b62)\u7684\u673a\u4f1a\uff0c\u8fd9\u4e9b\u7ad9\u70b9\u5728\u8bf7\u6c42\u4e4b\u95f4\u5bfb\u627e\u7edf\u8ba1\u4e0a\u663e\u8457\u7684\u76f8\u4f3c\u6027\u3002 \u968f\u673a\u5316\u7b56\u7565\u4e0e wget \u2014-random-wait \u9009\u9879\u76f8\u540c\u3002 \u5982\u679c DOWNLOAD_DELAY \u4e3a\u96f6(\u9ed8\u8ba4)\uff0c\u6b64\u9009\u9879\u65e0\u6548\u3002 REACTOR_THREADPOOL_MAXSIZE \u9ed8\u8ba4: 10 Twisted Reactor\u7ebf\u7a0b\u6c60\u5927\u5c0f\u7684\u6700\u5927\u9650\u5236\u3002\u8fd9\u662f\u5e38\u7528\u7684\u591a\u7528\u9014\u7ebf\u7a0b\u6c60\uff0c\u7528\u4e8e\u5404\u79cd\u65e0\u7528\u7684\u7ec4\u4ef6\u3002\u7ebf\u7a0bDNS\u89e3\u6790\u5668\u3001BlockingFeedStorage\u3001S3FilesStore\u7b49\u7b49\u3002\u5982\u679c\u9047\u5230\u963b\u585eIO\u4e0d\u8db3\u7684\u95ee\u9898\uff0c\u8bf7\u589e\u52a0\u6b64\u503c\u3002 REDIRECT_MAX_TIMES \u9ed8\u8ba4: 20 \u5b9a\u4e49\u53ef\u91cd\u5b9a\u5411\u8bf7\u6c42\u7684\u6700\u5927\u6b21\u6570\u3002\u5728\u6b64\u6700\u5927\u503c\u4e4b\u540e\uff0c\u8bf7\u6c42\u7684\u54cd\u5e94\u5c06\u6309\u539f\u6837\u8fd4\u56de\u3002\u5bf9\u4e8e\u540c\u4e00\u4efb\u52a1\uff0c\u6211\u4eec\u4f7f\u7528Firefox\u9ed8\u8ba4\u503c\u3002 REDIRECT_PRIORITY_ADJUST \u9ed8\u8ba4: +2 \u8303\u56f4: scrapy.downloadermiddlewares.redirect.RedirectMiddleware \u8c03\u6574\u91cd\u5b9a\u5411\u8bf7\u6c42\u4f18\u5148\u7ea7\u76f8\u5bf9\u4e8e\u539f\u59cb\u8bf7\u6c42: \u6b63\u4f18\u5148\u7ea7\u8c03\u6574(\u9ed8\u8ba4)\u610f\u5473\u7740\u66f4\u9ad8\u4f18\u5148\u7ea7\u3002 \u8d1f\u4f18\u5148\u7ea7\u8c03\u6574\u610f\u5473\u7740\u4f4e\u4f18\u5148\u7ea7\u3002 RETRY_PRIORITY_ADJUST \u9ed8\u8ba4: -1 \u8303\u56f4: scrapy.downloadermiddlewares.retry.RetryMiddleware \u8c03\u6574\u91cd\u8bd5\u8bf7\u6c42\u4f18\u5148\u7ea7\u76f8\u5bf9\u4e8e\u539f\u59cb\u8bf7\u6c42: \u6b63\u4f18\u5148\u7ea7\u8c03\u6574\u610f\u5473\u7740\u66f4\u9ad8\u4f18\u5148\u7ea7\u3002 \u8d1f\u4f18\u5148\u7ea7\u8c03\u6574(\u9ed8\u8ba4)\u610f\u5473\u7740\u4f4e\u4f18\u5148\u7ea7\u3002 ROBOTSTXT_OBEY \u9ed8\u8ba4: False \u8303\u56f4: scrapy.downloadermiddlewares.robotstxt \u5982\u679c\u542f\u7528\uff0cScrapy\u5c06\u5c0a\u91cdrobots.txt\u3002\u4e09\u79cd\u653f\u7b56\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 RobotsTxtMiddleware \u3002 \u7531\u4e8e\u5386\u53f2\u539f\u56e0\uff0c\u9ed8\u8ba4\u503c\u4e3a`False`\uff0c\u4f46\u5728\u8bbe\u7f6e\u4e2d\u9ed8\u8ba4\u542f\u7528\u6b64\u9009\u9879\u3002 \u7531`scrapy startproject`\u547d\u4ee4\u751f\u6210\u7684py\u6587\u4ef6\u3002 SCHEDULER \u9ed8\u8ba4: 'scrapy.core.scheduler.Scheduler' \u7528\u4e8e\u6293\u53d6\u7684\u8c03\u5ea6\u7a0b\u5e8f\u3002 SCHEDULER_DEBUG \u9ed8\u8ba4: False \u8bbe\u7f6e\u4e3a True \u5c06\u8bb0\u5f55\u6709\u5173requests scheduler\u7684\u8c03\u8bd5\u4fe1\u606f\u3002\u5982\u679crequests\u4e0d\u80fd\u5e8f\u5217\u5316\u5230\u78c1\u76d8\u4e0a\uff0c\u5219\u5f53\u524d\u65e5\u5fd7\u8bb0\u5f55(\u4ec5\u4e00\u6b21)\u3002Stats\u8ba1\u6570\u5668( scheduler/unserializable )\u8ddf\u8e2a\u53d1\u751f\u8fd9\u79cd\u60c5\u51b5\u7684\u6b21\u6570\u3002 \u65e5\u5fd7\u4e2d\u7684\u793a\u4f8b: 1956-01-31 00:00:00+0800 [scrapy.core.scheduler] ERROR: Unable to serialize request: GET http://example.com - reason: cannot serialize Request at 0x9a7c7ec (type Request) - no more unserializable requests will be logged (see 'scheduler/unserializable' stats counter) SCHEDULER_DISK_QUEUE \u9ed8\u8ba4: 'scrapy.squeues.PickleLifoDiskQueue' scheduler\u5c06\u4f7f\u7528\u7684\u78c1\u76d8\u961f\u5217\u7684\u7c7b\u578b\u3002 \u5176\u4ed6\u53ef\u7528\u7684\u7c7b\u578b\u662f scrapy.squeues.PickleFifoDiskQueue , scrapy.squeues.MarshalFifoDiskQueue , scrapy.squeues.MarshalLifoDiskQueue SCHEDULER_MEMORY_QUEUE \u9ed8\u8ba4: 'scrapy.squeues.LifoMemoryQueue' scheduler\u4f7f\u7528\u7684\u5185\u5b58\u961f\u5217\u7684\u7c7b\u578b\u3002\u5176\u4ed6\u53ef\u7528\u7684\u7c7b\u578b\u662f: scrapy.squeues.FifoMemoryQueue SCHEDULER_PRIORITY_QUEUE \u9ed8\u8ba4: 'queuelib.PriorityQueue' scheduler\u4f7f\u7528\u7684\u4f18\u5148\u961f\u5217\u7684\u7c7b\u578b\u3002 SPIDER_CONTRACTS \u9ed8\u8ba4: {} \u5305\u542b\u5728\u4f60\u7684\u9879\u76ee\u4e2d\u542f\u7528\u7684spider\u7684contracts\u7684dict\uff0c\u7528\u4e8e\u6d4b\u8bd5spiders\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1 Spiders Contracts \u3002 SPIDER_CONTRACTS_BASE \u9ed8\u8ba4: { 'scrapy.contracts.default.UrlContract' : 1, 'scrapy.contracts.default.ReturnsContract': 2, 'scrapy.contracts.default.ScrapesContract': 3, } \u5728scrapy\u4e2d\u9ed8\u8ba4\u542f\u7528\u5305\u542bscrapy contracts\u7684dict\u3002\u6c38\u8fdc\u4e0d\u8981\u5728\u9879\u76ee\u4e2d\u4fee\u6539\u8fd9\u4e2a\u8bbe\u7f6e\uff0c\u4fee\u6539 spider_contract \u9664\u5916\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1 Spiders Contracts \u3002 \u60a8\u53ef\u4ee5\u901a\u8fc7\u5728 SPIDER_CONTRACTS \u4e2d\u4e3a\u5b83\u4eec\u7684\u7c7b\u8def\u5f84\u5206\u914d None \u6765\u7981\u7528\u4efb\u4f55\u8fd9\u4e9bcontracts\u3002\u4f8b\u5982\uff0c\u8981\u7981\u7528\u5185\u7f6e\u7684 ScrapesContract \uff0c\u8bf7\u5c06\u5176\u653e\u5728\u60a8\u7684 settings.py \u4e2d\u3002 SPIDER_CONTRACTS = { 'scrapy.contracts.default.ScrapesContract': None, } SPIDER_LOADER_CLASS \u9ed8\u8ba4: 'scrapy.spiderloader.SpiderLoader' \u7528\u4e8e\u88c5\u8f7dspider\u7684\u7c7b\uff0c\u5b83\u5fc5\u987b\u5b9e\u73b0 SpiderLoader API \u3002 SPIDER_LOADER_WARN_ONLY \u6700\u65b0\u7248\u672c1.3.3 \u9ed8\u8ba4: False \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5f53scrapy\u8bd5\u56fe\u4ece SPIDER_MODULES \u4e2d\u5bfc\u5165spider\u7c7b\u65f6\uff0c\u5982\u679c\u5b58\u5728 ImportError \u5f02\u5e38\uff0c\u5b83\u5c06\u4f1a\u663e\u8457\u5931\u8d25\u3002\u4f46\u662f\u60a8\u53ef\u4ee5\u9009\u62e9\u5173\u95ed\u8fd9\u4e2a\u5f02\u5e38\uff0c\u5e76\u901a\u8fc7\u8bbe\u7f6e SPIDER_LOADER_WARN_ONLY = True \u5c06\u5176\u8f6c\u6362\u4e3a\u4e00\u4e2a\u7b80\u5355\u7684\u8b66\u544a\u3002 \u4e00\u4e9b[scrapy\u547d\u4ee4](#)\u5728\u8fd9\u4e2asetting\u4e3aTrue\u65f6\u5df2\u7ecf\u8fd0\u884c(\u5373\u5b83\u4eec\u53ea\u4f1a\u53d1\u51fa\u8b66\u544a\u5e76\u4e14\u4e0d\u4f1a\u5931\u8d25) \uff0c \u56e0\u4e3a\u5b83\u4eec\u5b9e\u9645\u4e0a\u4e0d\u9700\u8981\u52a0\u8f7dspider\u7c7b\u6765\u5de5\u4f5c:[scrapy runspider](#)\u3001[scrapy\u8bbe\u7f6e](#)\u3001 [scrapy startproject](#)\u3001[scrapy\u7248\u672c](#)\u3002 SPIDER_MIDDLEWARES \u9ed8\u8ba4: {} \u5305\u542b\u5728\u60a8\u7684\u9879\u76ee\u4e2d\u542f\u7528\u7684spider middlewares\u53ca\u5176\u5bf9\u5e94\u7684\u6570\u5b57\u7684dict\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1 \u6fc0\u6d3bspider middleware \u3002 SPIDER_MIDDLEWARES_BASE \u9ed8\u8ba4 { 'scrapy.spidermiddlewares.httperror.HttpErrorMiddleware': 50, 'scrapy.spidermiddlewares.offsite.OffsiteMiddleware': 500, 'scrapy.spidermiddlewares.referer.RefererMiddleware': 700, 'scrapy.spidermiddlewares.urllength.UrlLengthMiddleware': 800, 'scrapy.spidermiddlewares.depth.DepthMiddleware': 900, } \u5728Scrapy\u4e2d\u9ed8\u8ba4\u542f\u7528\u7684\u5305\u542bspider middlewares\u53ca\u5176\u5bf9\u5e94\u7684\u6570\u5b57\u7684dict, \u4f4e\u6570\u5b57\u66f4\u63a5\u8fd1engine\uff0c\u9ad8\u6570\u5b57\u66f4\u63a5\u8fd1spider, \u8bf7\u53c2\u89c1 \u6fc0\u6d3bspider middleware \u3002 SPIDER_MODULES \u9ed8\u8ba4: [] \u4e00\u4e2a\u6a21\u5757\u5217\u8868\uff0c\u5176\u4e2dScrapy\u5c06\u67e5\u627espider\u3002 \u4f8b\u5b50: SPIDER_MODULES = ['mybot.spiders_prod', 'mybot.spiders_dev'] STATS_CLASS \u9ed8\u8ba4: 'scrapy.statscollectors.MemoryStatsCollector' \u7528\u4e8e\u6536\u96c6\u7edf\u8ba1\u6570\u636e\u7684\u7c7b\uff0c\u5b83\u5fc5\u987b\u5b9e\u4f8b\u5316 Stats Collector API \u3002 STATS_DUMP \u9ed8\u8ba4: True \u5728spider\u5b8c\u6210\u540e\uff0c\u5c06 Scrapy stats \u8f6c\u50a8(\u5230Scrapy log)\u3002 \u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1: Stats Collection \u3002 STATSMAILER_RCPTS \u9ed8\u8ba4: [] (\u7a7a\u5217\u8868) \u5728spider\u5b8c\u6210\u6293\u53d6\u540e\u53d1\u9001Scrapy stats\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 StatsMailer \u3002 TELNETCONSOLE_ENABLED \u9ed8\u8ba4: True \u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u7528\u4e8e\u6307\u5b9a\u662f\u5426\u542f\u7528 telnet\u63a7\u5236\u53f0 (\u5982\u679c\u5b83\u7684\u6269\u5c55\u4e5f\u662f\u542f\u7528\u7684)\u3002 TELNETCONSOLE_PORT \u9ed8\u8ba4: [6023, 6073] \u7528\u4e8etelnet\u63a7\u5236\u53f0\u7684\u7aef\u53e3\u8303\u56f4, \u5982\u679c\u8bbe\u7f6e\u4e3a None \u6216 0 , \uff0c\u5219\u4f7f\u7528\u52a8\u6001\u5206\u914d\u7684\u7aef\u53e3, \u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Telnet\u63a7\u5236\u53f0 \u3002 TEMPLATES_DIR \u9ed8\u8ba4: \u5728scrapy\u6a21\u5757\u5185\u7684 templates \u76ee\u5f55 \u4f7f\u7528 startproject \u547d\u4ee4\u521b\u5efa\u65b0\u9879\u76ee\u548c\u4f7f\u7528 genspider \u547d\u4ee4\u521b\u5efa\u65b0spier\u65f6\u67e5\u627e\u6a21\u677f\u7684\u76ee\u5f55\u3002 \u9879\u76ee\u540d\u79f0\u4e0d\u5f97\u4e0e project \u5b50\u76ee\u5f55\u4e2d\u7684\u81ea\u5b9a\u4e49\u6587\u4ef6\u6216\u76ee\u5f55\u7684\u540d\u79f0\u76f8\u51b2\u7a81\u3002 URLLENGTH_LIMIT \u9ed8\u8ba4: 2083 \u8303\u56f4: spidermiddlewares.urllength \u5141\u8bb8\u6293\u53d6URL\u7684\u6700\u5927URL\u957f\u5ea6, \u6709\u5173\u6b64\u8bbe\u7f6e\u7684\u9ed8\u8ba4\u503c\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 https://boutell.com/newfaq/misc/urllength.html USER_AGENT \u9ed8\u8ba4: \"Scrapy/VERSION (+https://scrapy.org)\" \u722c\u884c\u65f6\u8981\u4f7f\u7528\u7684\u9ed8\u8ba4\u7528\u6237\u4ee3\u7406\uff0c\u9664\u975e\u91cd\u5199\u3002 Settings\u5176\u4ed6\u8bb0\u5f55: \u4ee5\u4e0b\u8bbe\u7f6e\u5df2\u5728\u5176\u4ed6\u5730\u65b9\u8bb0\u5f55\u5728\u6848\uff0c\u8bf7\u68c0\u67e5\u6bcf\u4e2a\u7279\u5b9a\u7684\u60c5\u51b5\uff0c\u4ee5\u67e5\u770b\u5982\u4f55\u542f\u7528\u548c\u4f7f\u7528\u5b83\u4eec\u3002 AJAXCRAWL_ENABLED AUTOTHROTTLE_DEBUG AUTOTHROTTLE_ENABLED AUTOTHROTTLE_MAX_DELAY AUTOTHROTTLE_START_DELAY AUTOTHROTTLE_TARGET_CONCURRENCY CLOSESPIDER_ERRORCOUNT CLOSESPIDER_ITEMCOUNT CLOSESPIDER_PAGECOUNT CLOSESPIDER_TIMEOUT COMMANDS_MODULE COMPRESSION_ENABLED COOKIES_DEBUG COOKIES_ENABLED FEED_EXPORTERS FEED_EXPORTERS_BASE FEED_EXPORT_ENCODING FEED_EXPORT_FIELDS FEED_EXPORT_INDENT FEED_FORMAT FEED_STORAGES FEED_STORAGES_BASE FEED_STORE_EMPTY FEED_URI FILES_EXPIRES FILES_RESULT_FIELD FILES_STORE FILES_STORE_S3_ACL FILES_URLS_FIELD GCS_PROJECT_ID HTTPCACHE_ALWAYS_STORE HTTPCACHE_DBM_MODULE HTTPCACHE_DIR HTTPCACHE_ENABLED HTTPCACHE_EXPIRATION_SECS HTTPCACHE_GZIP HTTPCACHE_IGNORE_HTTP_CODES HTTPCACHE_IGNORE_MISSING HTTPCACHE_IGNORE_RESPONSE_CACHE_CONTROLS HTTPCACHE_IGNORE_SCHEMES HTTPCACHE_POLICY HTTPCACHE_STORAGE HTTPERROR_ALLOWED_CODES HTTPERROR_ALLOW_ALL HTTPPROXY_AUTH_ENCODING HTTPPROXY_ENABLED IMAGES_EXPIRES IMAGES_MIN_HEIGHT IMAGES_MIN_WIDTH IMAGES_RESULT_FIELD IMAGES_STORE IMAGES_STORE_S3_ACL IMAGES_THUMBS IMAGES_URLS_FIELD MAIL_FROM MAIL_HOST MAIL_PASS MAIL_PORT MAIL_SSL MAIL_TLS MAIL_USER MEDIA_ALLOW_REDIRECTS METAREFRESH_ENABLED METAREFRESH_MAXDELAY REDIRECT_ENABLED REDIRECT_MAX_TIMES REFERER_ENABLED REFERRER_POLICY RETRY_ENABLED RETRY_HTTP_CODES RETRY_TIMES TELNETCONSOLE_HOST TELNETCONSOLE_PORT","title":"Settings(\u8bbe\u7f6e)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#settings","text":"Scrapy settings\u5141\u8bb8\u60a8\u81ea\u5b9a\u4e49\u6240\u6709Scrapy\u7ec4\u4ef6\u7684\u884c\u4e3a\uff0c\u5305\u62eccore\u3001extensions\u3001pipelines\u548cspiders\u672c\u8eab\u3002 settings\u7684\u57fa\u7840\u7ed3\u6784\u63d0\u4f9b\u4e86\u952e\u503c\u6620\u5c04\u7684\u5168\u5c40\u547d\u540d\u7a7a\u95f4\uff0c\u4ee3\u7801\u53ef\u4ee5\u4f7f\u7528\u5b83\u6765\u63d0\u53d6\u914d\u7f6e\u503c\u3002\u53ef\u4ee5\u901a\u8fc7\u4e0d\u540c\u7684\u673a\u5236\u586b\u5145\u8bbe\u7f6e\uff0c\u5982\u4e0b\u6240\u8ff0\u3002 \u8fd9\u4e9b\u8bbe\u7f6e\u4e5f\u662f\u9009\u62e9\u5f53\u524d\u6d3b\u52a8\u7684Scrapy\u9879\u76ee(\u5982\u679c\u60a8\u6709\u5f88\u591a\u8fd9\u6837\u7684\u9879\u76ee)\u7684\u673a\u5236\u3002 \u6709\u5173\u53ef\u7528\u7684\u5185\u7f6e\u8bbe\u7f6e\u7684\u5217\u8868\uff0c\u8bf7\u53c2\u9605: \u5185\u7f6e\u7684settings\u53c2\u8003","title":"Settings(\u8bbe\u7f6e)"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#_1","text":"\u5f53\u4f60\u4f7f\u7528Scrapy\u65f6\uff0c\u4f60\u5fc5\u987b\u544a\u8bc9\u5b83\u4f60\u4f7f\u7528\u7684\u662f\u54ea\u4e9b\u8bbe\u7f6e\u3002\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u73af\u5883\u53d8\u91cf SCRAPY_SETTINGS_MODULE \u6765\u5b9e\u73b0\u3002 SCRAPY_SETTINGS_MODULE \u7684\u503c\u5e94\u8be5\u662fPython\u8def\u5f84\u8bed\u6cd5\uff0c\u4f8b\u5982 myproject.settings \u3002\u6ce8\u610f\uff0c\u8bbe\u7f6e\u6a21\u5757\u5e94\u8be5\u4f4d\u4e8ePython \u5bfc\u5165\u641c\u7d22\u8def\u5f84 \u4e0a\u3002","title":"\u6307\u5b9a\u8bbe\u7f6e"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#_2","text":"\u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u7684\u673a\u5236\u586b\u5145\u8bbe\u7f6e\uff0c\u6bcf\u79cd\u673a\u5236\u5177\u6709\u4e0d\u540c\u7684\u4f18\u5148\u7ea7\u3002\u4ee5\u4e0b\u662f\u6309\u4f18\u5148\u987a\u5e8f\u9012\u51cf\u7684\u5217\u8868: \u547d\u4ee4\u884c\u9009\u9879(\u6700\u4f18\u5148\u7ea7) \u5355\u72ec\u8bbe\u7f6e\u6bcf\u4e2aspider \u9879\u76eesettings\u6a21\u5757 \u6bcf\u4e2asettings\u9ed8\u8ba4\u7684\u547d\u4ee4 \u9ed8\u8ba4\u5168\u5c40settings(\u4f4e\u4f18\u5148\u7ea7) \u8fd9\u4e9b\u6e90\u8bbe\u7f6e\u7684\u586b\u5145\u7531\u5185\u90e8\u5904\u7406\uff0c\u4f46\u662f\u53ef\u4ee5\u4f7f\u7528API\u8c03\u7528\u8fdb\u884c\u624b\u52a8\u5904\u7406\u3002\u53c2\u89c1 \u8bbe\u7f6eAPI \u4e3b\u9898\u4ee5\u4f9b\u53c2\u8003\u3002 \u4e0b\u9762\u5c06\u66f4\u8be6\u7ec6\u5730\u63cf\u8ff0\u8fd9\u4e9b\u673a\u5236\u3002","title":"\u586b\u5145\u8bbe\u7f6e"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#1","text":"\u547d\u4ee4\u884c\u63d0\u4f9b\u7684\u53c2\u6570\u4f18\u5148\u7ea7\u6700\u9ad8\uff0c\u8d85\u8fc7\u4e86\u4efb\u4f55\u5176\u4ed6\u9009\u9879\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 -s (\u6216 --set )\u547d\u4ee4\u884c\u9009\u9879\u663e\u5f0f\u5730\u8986\u76d6\u4e00\u4e2a(\u6216\u591a\u4e2a)\u8bbe\u7f6e\u3002 \u4f8b\u5b50: scrapy crawl myspider -s LOG_FILE=scrapy.log","title":"1.\u547d\u4ee4\u884c\u9009\u9879"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#2-spider","text":"spider(\u8bf7\u53c2\u9605 Spiders \u4e00\u7ae0\u4ee5\u83b7\u53d6\u53c2\u8003)\u53ef\u4ee5\u5b9a\u4e49\u81ea\u5df1\u7684setting\uff0c\u8fd9\u4e9bsetting\u5c06\u4f18\u5148\u4f7f\u7528\u5e76\u8986\u76d6\u9879\u76ee\u7684setting\u3002\u4ed6\u4eec\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e custom_settings \u5c5e\u6027\u6765\u505a\u5230\u8fd9\u4e00\u70b9: class MySpider(scrapy.Spider): name = 'myspider' custom_settings = { 'SOME_SETTING': 'some value', }","title":"2. \u5355\u72ec\u8bbe\u7f6e\u6bcf\u4e2aspider"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#3-setting","text":"\u9879\u76eesetting\u6a21\u5757\u662f\u4f60\u7684Scrapy\u9879\u76ee\u7684\u6807\u51c6\u914d\u7f6e\u6587\u4ef6\uff0c\u5927\u591a\u6570\u81ea\u5b9a\u4e49\u8bbe\u7f6e\u90fd\u662f\u5728\u8fd9\u91cc\u586b\u5145\u7684\u3002\u5bf9\u4e8e\u6807\u51c6\u7684Scrapy\u9879\u76ee\uff0c\u8fd9\u610f\u5473\u7740\u8981\u5728\u4f60\u7684\u9879\u76ee\u4e2d settings.py \u4e2d\u6dfb\u52a0\u6216\u66f4\u6539settings","title":"3. \u9879\u76eesetting\u6a21\u5757"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#4-settings","text":"\u6bcf\u4e2a Scrapy\u5de5\u5177 \u547d\u4ee4\u53ef\u4ee5\u6709\u81ea\u5df1\u7684\u9ed8\u8ba4\u8bbe\u7f6e\uff0c\u5b83\u8986\u76d6\u5168\u5c40\u9ed8\u8ba4\u8bbe\u7f6e\u3002\u8fd9\u4e9b\u81ea\u5b9a\u4e49\u547d\u4ee4\u8bbe\u7f6e\u5728\u547d\u4ee4\u7c7b\u7684 default_settings \u5c5e\u6027\u4e2d\u6307\u5b9a\u3002","title":"4. \u6bcf\u4e2asettings\u9ed8\u8ba4\u7684\u547d\u4ee4"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#5-settings","text":"\u5168\u5c40\u9ed8\u8ba4\u503c\u4f4d\u4e8e scrapy.settings.default_settings \u6a21\u5757\u4e2d\uff0c\u5728 \u5185\u7f6esettings\u53c2\u8003 \u90e8\u5206\u4e2d\u6709\u6587\u6863\u8bf4\u660e\u3002","title":"5. \u5168\u5c40settings"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#setings","text":"\u5728spider\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7 self.settings \u8fdb\u884c\u8bbe\u7f6e class MySpider(scrapy.Spider): name = 'myspider' start_urls = ['http://example.com'] def parse(self, response): print(u \u73b0\u6709\u7684\u8bbe\u7f6e: %s % self.settings.attributes.keys()) \u6ce8\u610f!!!! `settings`\u5c5e\u6027\u662f\u5728\u521d\u59cb\u5316spider\u4e4b\u540e\u5728\u57fa\u672cspider\u7c7b\u4e2d\u8bbe\u7f6e\u7684\u3002 \u5982\u679c\u60a8\u60f3\u5728\u521d\u59cb\u5316\u4e4b\u524d\u4f7f\u7528\u8fd9\u4e9b\u8bbe\u7f6e(\u4f8b\u5982\uff0c\u5728\u60a8\u7684spider\u7684`__init__()`\u65b9\u6cd5\u4e2d)\uff0c \u60a8\u9700\u8981\u8986\u76d6[from_crawler()](#)\u65b9\u6cd5\u3002 Settings\u53ef\u4ee5\u901a\u8fc7Crawler\u7684 scrapy.crawler.Crawler.settings \u5c5e\u6027\u8bbf\u95ee\uff0c\u8be5\u5c5e\u6027\u5728extensions\u3001middlewares\u548citem pipelines\u4e2d\u4f20\u9012\u7ed9 from_crawler \u65b9\u6cd5: class MyExtension(object): def __init__(self, log_is_enabled=False): if log_is_enabled: print(u log\u5df2\u7ecf\u6fc0\u6d3b! ) @classmethod def from_crawler(cls, crawler): settings = crawler.settings return cls(settings.getbool('LOG_ENABLED')) settings\u5bf9\u8c61\u53ef\u4ee5\u50cfdict\u4e00\u6837\u4f7f\u7528(\u4f8b\u5982\uff0c settings['LOG_ENABLED'] )\uff0c\u4f46\u662f\u901a\u5e38\u9996\u9009\u4f7f\u7528 Settings API\u63d0\u4f9b\u7684\u65b9\u6cd5\u63d0\u53d6\u8bbe\u7f6e\uff0c\u4ee5\u907f\u514d\u7c7b\u578b\u9519\u8bef\u3002","title":"\u5982\u4f55\u8bbf\u95eesetings"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#setting","text":"Setting\u540d\u79f0\u901a\u5e38\u4ee5\u5b83\u4eec\u914d\u7f6e\u7684\u7ec4\u4ef6\u4e3a\u524d\u7f00\u3002\u4f8b\u5982\uff0c\u865a\u6784\u7684robots.txt\u6269\u5c55\u7684\u6b63\u786e\u547d\u540d\u3002\u53ef\u4ee5\u662f ROBOTSTXT_ENABLED , ROBOTSTXT_OBEY , ROBOTSTXT_CACHEDIR \u7b49\u3002","title":"setting\u540d\u79f0\u7684\u57fa\u672c\u539f\u7406"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#settings_1","text":"\u4e0b\u9762\u662f\u6240\u6709\u53ef\u7528\u7684Scrapy settings\u7684\u5217\u8868\uff0c\u6309\u5b57\u6bcd\u987a\u5e8f\u6392\u5217\uff0c\u4ee5\u53ca\u5b83\u4eec\u7684\u9ed8\u8ba4\u503c\u548c\u5e94\u7528\u5b83\u4eec\u7684\u8303\u56f4\u3002 \u5982\u679c\u8be5\u8303\u56f4\u4e0e\u4efb\u4f55\u7279\u5b9a\u7ec4\u4ef6\u76f8\u5173\u8054\uff0c\u90a3\u4e48\u5728\u53ef\u7528\u7684\u60c5\u51b5\u4e0b\uff0c\u8be5\u8303\u56f4\u5c06\u663e\u793a\u4f7f\u7528\u8be5setting\u7684\u4f4d\u7f6e\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u7ec4\u4ef6\u7684\u6a21\u5757\u5c06\u663e\u793a\u51fa\u6765\uff0c\u901a\u5e38\u662f\u4e00\u4e2aextension\u3001middleware\u6216pipeline\u3002\u8fd9\u8fd8\u610f\u5473\u7740\uff0c\u4e3a\u4e86\u4f7fsetting\u4ea7\u751f\u4efb\u4f55\u6548\u679c\uff0c\u5fc5\u987b\u542f\u7528\u7ec4\u4ef6\u3002","title":"\u5185\u7f6e\u7684settings\u53c2\u8003"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#aws_access_key_id","text":"\u9ed8\u8ba4: None \u4ee3\u7801\u4f7f\u7528\u7684AWS access key\u7528\u4e8e\u9700\u8981\u8bbf\u95ee Amazon Web\u670d\u52a1 , \u4f8b\u5982S3 feed \u5b58\u50a8\u540e\u7aef\u3002","title":"AWS_ACCESS_KEY_ID"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#aws_secret_access_key","text":"\u9ed8\u8ba4: None \u4ee3\u7801\u4f7f\u7528\u7684AWS secret key\u7528\u4e8e\u9700\u8981\u8bbf\u95ee Amazon Web\u670d\u52a1 , \u4f8b\u5982S3 feed \u5b58\u50a8\u540e\u7aef\u3002","title":"AWS_SECRET_ACCESS_KEY"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#bot_name","text":"\u9ed8\u8ba4: scrapybot \u8fd9\u4e2aScrapy\u9879\u76ee\u5b9e\u4f8b\u5316\u7684bot\u7684\u540d\u79f0(\u4e5f\u79f0\u4e3a\u9879\u76ee\u540d\u79f0)\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8fd9\u5c06\u7528\u4e8e\u6784\u9020\u7528\u6237\u4ee3\u7406\uff0c\u4ee5\u53ca\u65e5\u5fd7\u8bb0\u5f55\u3002 \u5f53\u60a8\u4f7f\u7528 startproject \u547d\u4ee4\u521b\u5efa\u9879\u76ee\u65f6\uff0c\u5b83\u4f1a\u81ea\u52a8\u586b\u5145\u60a8\u7684\u9879\u76ee\u540d\u79f0\u3002","title":"BOT_NAME"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#concurrent_items","text":"\u9ed8\u8ba4: 100 \u5728Item Processor(\u4e5f\u79f0\u4e3a Item Pipeline )\u4e2d\u5e76\u884c\u5904\u7406\u7684\u5e76\u53d1items(\u6bcf\u4e2aresponse)\u7684\u6700\u5927\u6570\u76ee\u3002","title":"CONCURRENT_ITEMS"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#concurrent_requests","text":"\u9ed8\u8ba4: 16 \u7531Scrapy downloader\u6267\u884c\u7684\u5e76\u53d1(\u5373\u3002\u540c\u65f6)\u8bf7\u6c42\u7684\u6700\u5927\u6570\u76ee\u3002","title":"CONCURRENT_REQUESTS"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#concurrent_requests_per_domain","text":"\u9ed8\u8ba4: 8 \u5bf9\u4efb\u4f55\u5355\u4e2aDOMAIN\u6267\u884c\u7684\u5e76\u53d1\u8bf7\u6c42\u7684\u6700\u5927\u6570\u76ee\u3002","title":"CONCURRENT_REQUESTS_PER_DOMAIN"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#concurrent_requests_per_ip","text":"\u9ed8\u8ba4: 0 \u5bf9\u4efb\u4f55\u5355\u4e2aIP\u6267\u884c\u7684\u5e76\u53d1\u8bf7\u6c42\u7684\u6700\u5927\u6570\u76ee\u3002 \u5982\u679c\u975e\u96f6\uff0c\u5219\u5ffd\u7565 CONCURRENT_REQUESTS_PER_DOMAIN \u8bbe\u7f6e\uff0c\u800c\u4f7f\u7528\u7684\u662f\u8fd9\u4e2a\u8bbe\u7f6e\u5417\u6362\u53e5\u8bdd\u8bf4\uff0c\u5e76\u53d1\u9650\u5236\u5c06\u5e94\u7528\u4e8e\u6bcf\u4e2aIP\uff0c\u800c\u4e0d\u662f\u6bcf\u4e2aDOMAIN\u3002 \u8fd9\u4e2a\u8bbe\u7f6e\u8fd8\u4f1a\u5f71\u54cd DOWNLOAD_DELAY \u548c AutoThrottle extension : \u5982\u679c CONCURRENT_REQUESTS_PER_IP \u4e3a\u975e\u96f6\uff0c\u5219\u6309\u6bcf\u4e2aIP\u6267\u884cDOWNLOAD_DELAY\uff0c\u800c\u4e0d\u662f\u6309\u6bcf\u4e2aDOMAIN\u6267\u884c\u3002","title":"CONCURRENT_REQUESTS_PER_IP"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#default_item_class","text":"\u9ed8\u8ba4: 'scrapy.item.Item' \u7528\u4e8e\u5b9e\u4f8b\u5316 Scrapy shell \u4e2d\u7684items\u7684\u9ed8\u8ba4\u7c7b\u3002","title":"DEFAULT_ITEM_CLASS"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#default_request_headers","text":"\u9ed8\u8ba4: { 'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8', 'Accept-Language': 'en', } \u7528\u4e8eScrapy HTTP requests\u7684\u9ed8\u8ba4headers\u3002\u5b83\u4eec\u5728 DefaultHeadersMiddleware \u4e2d\u3002","title":"DEFAULT_REQUEST_HEADERS"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#depth_limit","text":"\u9ed8\u8ba4: 0 \u8303\u56f4: scrapy.spidermiddlewares.depth.DepthMiddleware \u5141\u8bb8\u722c\u884c\u4efb\u4f55\u7ad9\u70b9\u7684\u6700\u5927\u6df1\u5ea6\u3002\u5982\u679c\u4e3a\u96f6\uff0c\u5c31\u4e0d\u4f1a\u6709\u4efb\u4f55\u9650\u5236\u3002","title":"DEPTH_LIMIT"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#depth_priority","text":"\u9ed8\u8ba4: 0 \u8303\u56f4: scrapy.spidermiddlewares.depth.DepthMiddleware \u7528\u4e8e\u6839\u636e\u8bf7\u6c42\u6df1\u5ea6\u8c03\u6574\u8bf7\u6c42\u4f18\u5148\u7ea7\u7684\u6574\u6570: \u5982\u679c\u4e3a\u96f6(\u9ed8\u8ba4)\uff0c\u5219\u4e0d\u8fdb\u884c\u6df1\u5ea6\u4f18\u5148\u7ea7\u8c03\u6574 \u6b63\u503c\u5c06\u964d\u4f4e\u4f18\u5148\u7ea7\uff0c\u5373\u7a0d\u540e\u5c06\u5904\u7406\u66f4\u9ad8\u7684\u6df1\u5ea6\u8bf7\u6c42 ;\u8fd9\u901a\u5e38\u7528\u4e8e\u8fdb\u884c\u5e7f\u5ea6\u4f18\u5148\u722c\u884c(BFO) \u8d1f\u6570\u5c06\u589e\u52a0\u4f18\u5148\u7ea7\uff0c\u5373\u3002\u6df1\u5ea6\u8d8a\u9ad8\u7684\u8bf7\u6c42\u5904\u7406\u8d8a\u5feb(DFO) \u8bf7\u53c2\u9605: Scrapy\u662f\u6309\u5e7f\u5ea6\u4f18\u5148\u987a\u5e8f\u8fd8\u662f\u6df1\u5ea6\u4f18\u5148\u987a\u5e8f\u6293\u53d6? \u5173\u4e8eBFO\u6216DFO\u7684\u8c03\u4f18\u95ee\u9898\u3002 \u6ce8\u610f!!!!!! \u4e0e\u5176\u4ed6\u4f18\u5148\u7ea7\u8bbe\u7f6e[REDIRECT_PRIORITY_ADJUST](#)\u548c[RETRY_PRIORITY_ADJUST](#)\u76f8\u6bd4\uff0c \u6b64\u8bbe\u7f6e\u4ee5\u76f8\u53cd\u7684\u65b9\u5f0f\u8c03\u6574\u4f18\u5148\u7ea7\u3002","title":"DEPTH_PRIORITY"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#depth_stats","text":"\u9ed8\u8ba4: True \u8303\u56f4: scrapy.spidermiddlewares.depth.DepthMiddleware \u662f\u5426\u6536\u96c6\u6700\u5927\u6df1\u5ea6\u5c5e\u6027\u3002","title":"DEPTH_STATS"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#depth_stats_verbose","text":"\u9ed8\u8ba4: False \u8303\u56f4: scrapy.spidermiddlewares.depth.DepthMiddleware \u662f\u5426\u6536\u96c6\u8be6\u7ec6\u6df1\u5ea6\u7edf\u8ba1\u4fe1\u606f\u3002\u5982\u679c\u542f\u7528\u4e86\u6b64\u529f\u80fd\uff0c\u5219\u5728\u7edf\u8ba1\u6570\u636e\u4e2d\u6536\u96c6\u6bcf\u4e2a\u6df1\u5ea6\u7684\u8bf7\u6c42\u6570\u91cf\u3002","title":"DEPTH_STATS_VERBOSE"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#dnscache_enabled","text":"\u9ed8\u8ba4: True \u662f\u5426\u542f\u7528DNS\u5185\u5b58\u7f13\u5b58\u3002","title":"DNSCACHE_ENABLED"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#dnscache_size","text":"\u9ed8\u8ba4: 10000 DNS\u5185\u5b58\u7f13\u5b58\u5927\u5c0f\u3002","title":"DNSCACHE_SIZE"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#dns_timeout","text":"\u9ed8\u8ba4\u503c: 60 \u5904\u7406DNS\u67e5\u8be2\u7684\u8d85\u65f6\u65f6\u95f4(\u4ee5\u79d2\u4e3a\u5355\u4f4d)\u3002\u652f\u6301Float\u3002","title":"DNS_TIMEOUT"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#downloader","text":"\u9ed8\u8ba4: 'scrapy.core.downloader.Downloader' \u7528\u4e8e\u722c\u53d6\u7684\u4e0b\u8f7d\u5668\u3002","title":"DOWNLOADER"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#downloader_httpclientfactory","text":"\u9ed8\u8ba4: 'scrapy.core.downloader.webclient.ScrapyHTTPClientFactory' \u5b9a\u4e49\u7528\u4e8eHTTP/1.0\u8fde\u63a5\u7684Twisted protocol.ClientFactory \u7c7b(\u7528\u4e8e HTTP10DownloadHandler ) HTTP/1.0\u73b0\u5728\u5f88\u5c11\u4f7f\u7528\uff0c\u6240\u4ee5\u60a8\u53ef\u4ee5\u653e\u5fc3\u5730\u5ffd\u7565\u8fd9\u4e2a\u8bbe\u7f6e\uff0c\u9664\u975e\u60a8\u4f7f\u7528Twisted 11.1\uff0c \u6216\u8005\u60a8\u771f\u7684\u60f3\u4f7f\u7528HTTP/1.0\uff0c\u5e76\u4e3a`HTTP(s)` scheme\u91cd\u5199[DOWNLOAD_HANDLERS_BASE](#)\uff0c \u5373'scrapy.core.downloader.handlers.http.HTTP10DownloadHandler'\u3002","title":"DOWNLOADER_HTTPCLIENTFACTORY"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#downloader_clientcontextfactory","text":"\u9ed8\u8ba4: 'scrapy.core.downloader.contextfactory.ScrapyClientContextFactory' \u8868\u793a\u8981\u4f7f\u7528\u7684ContextFactory\u7684\u7c7b\u8def\u5f84\u3002 \u5728\u8fd9\u91cc\uff0c\u201cContextFactory\u201d\u662f\u4e00\u4e2a\u7528\u4e8eSSL/TLS\u4e0a\u4e0b\u6587\u7684Twisted\u672f\u8bed\uff0c\u5b83\u5b9a\u4e49\u4e86\u8981\u4f7f\u7528\u7684TLS/SSL\u534f\u8bae\u7248\u672c\uff0c\u65e0\u8bba\u662f\u8fdb\u884c\u8bc1\u4e66\u9a8c\u8bc1\uff0c\u8fd8\u662f\u542f\u7528\u5ba2\u6237\u7aef\u8eab\u4efd\u9a8c\u8bc1(\u4ee5\u53ca\u5176\u4ed6\u5404\u79cd\u4e8b\u60c5)\u3002 Scrapy\u9ed8\u8ba4context factory\u4e0d\u6267\u884c\u8fdc\u7a0b\u670d\u52a1\u5668\u8bc1\u4e66\u9a8c\u8bc1\u3002\u8fd9\u5bf9\u4e8eweb\u6293\u53d6\u6765\u8bf4\u662f\u5f88\u597d\u7684\u3002 \u5982\u679c\u786e\u5b9e\u9700\u8981\u542f\u7528\u8fdc\u7a0b\u670d\u52a1\u5668\u8bc1\u4e66\u9a8c\u8bc1\uff0cScrapy\u8fd8\u6709\u53e6\u4e00\u4e2a\u53ef\u4ee5\u8bbe\u7f6e\u7684context factory\u7c7b 'scrapy.core.downloader.contextfactory.BrowserLikeContextFactory'\u3002 \u5b83\u4f7f\u7528\u5e73\u53f0\u7684\u8bc1\u4e66\u6765\u9a8c\u8bc1\u8fdc\u7a0b\u7aef\u70b9\u3002\u53ea\u6709\u5728\u4f7f\u7528Twisted =14.0\u65f6\u624d\u53ef\u7528\u3002 \u5982\u679c\u4f7f\u7528\u81ea\u5b9a\u4e49ContextFactory\uff0c\u8bf7\u786e\u4fdd\u5b83\u5728init\u4e2d\u63a5\u53d7 method \u53c2\u6570(\u8fd9\u662f OpenSSL.SSL \u65b9\u6cd5\u6620\u5c04 DOWNLOADER_CLIENT_TLS_METHOD )","title":"DOWNLOADER_CLIENTCONTEXTFACTORY"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#downloader_client_tls_method","text":"\u9ed8\u8ba4: 'TLS' \u4f7f\u7528\u6b64\u8bbe\u7f6e\u81ea\u5b9a\u4e49\u9ed8\u8ba4HTTP/1.1 downloader\u4f7f\u7528\u7684TLS/SSL\u65b9\u6cd5\u3002 \u6b64\u8bbe\u7f6e\u5fc5\u987b\u662f\u4ee5\u4e0b\u5b57\u7b26\u4e32\u503c\u4e4b\u4e00: 'TLS' : \u6620\u5c04\u5230OpenSSL\u7684 TLS_method() (a.k.a SSLv23_method() )\uff0c\u5b83\u5141\u8bb8\u534f\u8bae\u534f\u5546\uff0c\u4ece\u5e73\u53f0\u652f\u6301\u7684\u6700\u9ad8\u7ea7\u522b\u5f00\u59cb; \u9ed8\u8ba4\u60c5\u51b5\u4e0b,\u63a8\u8350 'TLSv1.0' : \u8fd9\u4e2a\u503c\u5f3a\u5236HTTPS\u8fde\u63a5\u4f7f\u7528TLS\u7248\u672c1.0;\u5982\u679c\u4f60\u60f3\u8981Scrapy\u7684\u884c\u4e3a\u8bbe\u7f6e\u8fd9\u4e2a, \u5fc5\u987bScrapy 1.1 'TLSv1.1' : \u5f3a\u5236TLS\u7248\u672c1.1 'TLSv1.2' : \u5f3a\u5236TLS\u7248\u672c1.2 'SSLv3' : \u5f3a\u5236SSL\u7248\u672c3(\u4e0d\u63a8\u8350) \u6211\u4eec\u5efa\u8bae\u60a8\u4f7f\u7528PyOpenSSL =0.13, Twisted =0.13\u6216\u4ee5\u4e0a(Twisted =14.0)\u3002","title":"DOWNLOADER_CLIENT_TLS_METHOD"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#downloader_middlewares","text":"\u9ed8\u8ba4: {} \u5305\u542b\u4f60\u7684\u9879\u76ee\u4e2d\u542f\u7528\u7684downloader middlewares\u53ca\u5176\u5bf9\u5e94\u7684\u6570\u5b57\u7684\u5b57\u5178. \u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1 \u6fc0\u6d3bdownloader middleware \u3002","title":"DOWNLOADER_MIDDLEWARES"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#downloader_middlewares_base","text":"\u9ed8\u8ba4: { 'scrapy.downloadermiddlewares.robotstxt.RobotsTxtMiddleware': 100, 'scrapy.downloadermiddlewares.httpauth.HttpAuthMiddleware': 300, 'scrapy.downloadermiddlewares.downloadtimeout.DownloadTimeoutMiddleware': 350, 'scrapy.downloadermiddlewares.defaultheaders.DefaultHeadersMiddleware': 400, 'scrapy.downloadermiddlewares.useragent.UserAgentMiddleware': 500, 'scrapy.downloadermiddlewares.retry.RetryMiddleware': 550, 'scrapy.downloadermiddlewares.ajaxcrawl.AjaxCrawlMiddleware': 560, 'scrapy.downloadermiddlewares.redirect.MetaRefreshMiddleware': 580, 'scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware': 590, 'scrapy.downloadermiddlewares.redirect.RedirectMiddleware': 600, 'scrapy.downloadermiddlewares.cookies.CookiesMiddleware': 700, 'scrapy.downloadermiddlewares.httpproxy.HttpProxyMiddleware': 750, 'scrapy.downloadermiddlewares.stats.DownloaderStats': 850, 'scrapy.downloadermiddlewares.httpcache.HttpCacheMiddleware': 900, } \u5728Scrapy\u4e2d\u9ed8\u8ba4\u542f\u7528\u7684\u5305\u542bdownloader middlewares\u7684\u5b57\u5178\u3002\u6570\u5b57\u8d8a\u4f4e\u8d8a\u63a5\u8fd1engine\uff0c\u6570\u5b57\u8d8a\u9ad8\u8d8a\u63a5\u8fd1downloader\u3002\u6c38\u8fdc\u4e0d\u8981\u5728\u9879\u76ee\u4e2d\u4fee\u6539\u8fd9\u4e2a\u8bbe\u7f6e\uff0c\u4fee\u6539 downloader_middleware \u9664\u5916\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1 \u6fc0\u6d3bdownloader middleware \u3002","title":"DOWNLOADER_MIDDLEWARES_BASE"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#downloader_stats","text":"\u9ed8\u8ba4: True \u662f\u5426\u542f\u7528\u4e0b\u8f7d\u52a0\u8f7d\u5668\u7edf\u8ba1\u4fe1\u606f\u6536\u96c6\u3002","title":"DOWNLOADER_STATS"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#download_delay","text":"\u9ed8\u8ba4: 0 downloader\u5728\u4ece\u540c\u4e00\u7f51\u7ad9\u4e0b\u8f7d\u8fde\u7eed\u9875\u9762\u4e4b\u524d\u5e94\u8be5\u7b49\u5f85\u7684\u65f6\u95f4(\u4ee5\u79d2\u4e3a\u5355\u4f4d)\u3002\u8fd9\u53ef\u4ee5\u7528\u6765\u63a7\u5236\u722c\u866b\u901f\u5ea6\uff0c\u907f\u514d\u5bf9\u670d\u52a1\u5668\u9020\u6210\u592a\u5927\u7684\u51b2\u51fb\u3002\u652f\u6301\u5341\u8fdb\u5236\u6570\u3002\u4f8b\u5b50: DOWNLOAD_DELAY = 0.25 # \u5ef6\u8fdf250ms \u8fd9\u4e2a\u8bbe\u7f6e\u8fd8\u53d7\u5230 RANDOMIZE_DOWNLOAD_DELAY \u8bbe\u7f6e(\u9ed8\u8ba4\u542f\u7528)\u7684\u5f71\u54cd\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cScrapy\u4e0d\u4f1a\u5728\u8bf7\u6c42\u4e4b\u95f4\u7b49\u5f85\u56fa\u5b9a\u7684\u65f6\u95f4\uff0c\u800c\u662f\u4f7f\u75280.5 * DOWNLOAD_DELAY \u548c1.5 * DOWNLOAD_DELAY \u4e4b\u95f4\u7684\u968f\u673a\u95f4\u9694\u3002 \u5f53 CONCURRENT_REQUESTS_PER_IP \u662f\u975e\u96f6\u65f6\uff0c\u6bcf\u4e2aip\u5730\u5740\u800c\u4e0d\u662f\u6bcf\u4e2adomain\u90fd\u4f1a\u53d1\u751f\u5ef6\u8fdf\u3002 \u8fd8\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e download_delay spider\u5c5e\u6027\u4e3a\u6bcf\u4e2aspider\u66f4\u6539\u6b64setting\u3002","title":"DOWNLOAD_DELAY"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#download_handlers","text":"\u9ed8\u8ba4: {} \u5305\u542b\u5728\u4f60\u7684\u9879\u76ee\u4e2d\u542f\u7528\u7684request downloader handlers\u7684\u5b57\u5178\u3002\u53c2\u89c1 DOWNLOAD_HANDLERS_BASE \u793a\u4f8b\u683c\u5f0f\u3002","title":"DOWNLOAD_HANDLERS"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#download_handlers_base","text":"\u9ed8\u8ba4: { 'file': 'scrapy.core.downloader.handlers.file.FileDownloadHandler', 'http': 'scrapy.core.downloader.handlers.http.HTTPDownloadHandler', 'https': 'scrapy.core.downloader.handlers.http.HTTPDownloadHandler', 's3': 'scrapy.core.downloader.handlers.s3.S3DownloadHandler', 'ftp': 'scrapy.core.downloader.handlers.ftp.FTPDownloadHandler', } \u5728Scrapy\u4e2d\u9ed8\u8ba4\u542f\u7528\u7684\u5305\u542brequest download handlers\u7684\u5b57\u5178\u3002\u6c38\u8fdc\u4e0d\u8981\u5728\u9879\u76ee\u4e2d\u4fee\u6539\u8fd9\u4e2a\u8bbe\u7f6e\uff0c\u4fee\u6539 DOWNLOAD_HANDLERS \u9664\u5916\u3002 \u60a8\u53ef\u4ee5\u901a\u8fc7\u5728 DOWNLOAD_HANDLERS \u4e2d\u4e3a\u5b83\u4eec\u7684URI scheme\u5206\u914d None \u6765\u7981\u7528\u8fd9\u4e9bdownload handlers\u3002\u4f8b\u5982\uff0c\u8981\u7981\u7528\u5185\u7f6e\u7684FTP\u5904\u7406\u7a0b\u5e8f(\u4e0d\u9700\u8981\u66ff\u6362)\uff0c\u8bf7\u5c06\u5176\u653e\u5728\u60a8\u7684 settings.py \u4e2d\u3002 DOWNLOAD_HANDLERS = { 'ftp': None, }","title":"DOWNLOAD_HANDLERS_BASE"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#download_timeout","text":"\u9ed8\u8ba4: 180 downloader\u5728\u8d85\u65f6\u524d\u7b49\u5f85\u7684\u65f6\u95f4(\u4ee5\u79d2\u4e3a\u5355\u4f4d)\u3002 \u53ef\u4ee5\u4e3a\u6bcf\u4e2aspider\u8bbe\u7f6e`download_timeout` spider\u5c5e\u6027\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\uff0c \u4e5f\u53ef\u4ee5\u4f7f\u7528`download_timeout` Request.meta key\u4e3a\u6bcf\u4e2arequest\u4f7f\u7528","title":"DOWNLOAD_TIMEOUT"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#download_maxsize","text":"\u9ed8\u8ba4: 1073741824 (1024MB) downloader\u5c06\u4e0b\u8f7d\u7684\u6700\u5927response\u5927\u5c0f(\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d)\u3002 \u5982\u679c\u4f60\u60f3\u7981\u7528\u5b83\u8bbe\u7f6e\u4e3a0\u3002 \u8fd9\u4e2a\u5927\u5c0f\u53ef\u4ee5\u4f7f\u7528`download_maxsize` spider\u5c5e\u6027\u4e3a\u6bcf\u4e2aspider\u8bbe\u7f6e\uff0c \u4e5f\u53ef\u4ee5\u4f7f\u7528`download_maxsize` Request.meta key\u4e3a\u6bcf\u4e2arequest\u4f7f\u7528 \u8fd9\u4e2a\u7279\u6027\u9700\u8981Twisted = 11.1\u3002","title":"DOWNLOAD_MAXSIZE"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#download_warnsize","text":"\u9ed8\u8ba4: 33554432 (32MB) downloader\u5c06\u5f00\u59cb\u8b66\u544a\u7684response\u5927\u5c0f(\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d)\u3002 \u5982\u679c\u4f60\u60f3\u7981\u7528\u5b83\u8bbe\u7f6e\u4e3a0\u3002 \u8fd9\u4e2a\u5927\u5c0f\u53ef\u4ee5\u4f7f\u7528`download_warnsize` spider\u5c5e\u6027\u4e3a\u6bcf\u4e2a\u722c\u884c\u5668\u8bbe\u7f6e\uff0c \u4e5f\u53ef\u4ee5\u4f7f\u7528`download_warnsize` Request.meta key\u4e3a\u6bcf\u4e2arequest\u4f7f\u7528 \u8fd9\u4e2a\u7279\u6027\u9700\u8981Twisted = 11.1\u3002","title":"DOWNLOAD_WARNSIZE"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#download_fail_on_dataloss","text":"\u9ed8\u8ba4: True \u5728\u4e2d\u65ad\u7684response\u4e0a\u662f\u5426\u5931\u8d25\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u58f0\u660e\u7684 Content-Length \u4e0e\u670d\u52a1\u5668\u53d1\u9001\u7684\u5185\u5bb9\u4e0d\u5339\u914d\uff0c\u6216\u8005\u5757\u72b6\u7684\u54cd\u5e94\u6ca1\u6709\u6b63\u786e\u5b8c\u6210\u3002\u5982\u679c\u4e3a True \uff0c\u8fd9\u4e9bresponse\u5c06\u5f15\u53d1 ResponseFailed([_DataLoss]) \u9519\u8bef\u3002\u5982\u679c\u4e3a False \uff0c\u5219\u4f20\u9012\u8fd9\u4e9bresponses\uff0c\u5e76\u5c06flag(\u6807\u8bb0) dataloss \u6dfb\u52a0\u5230response\u4e2d\uff0c\u5373: 'dataloss' in response.flags \u662f True \u53ef\u9009\u5730\uff0c\u8fd9\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528 download_fail_on_dataloss \u8bbe\u7f6e\u4e3a False \u6765\u8bbe\u7f6e\u6bcf\u4e2arequests\u7684\u57fa\u7840 \u5728\u4e00\u4e9b\u60c5\u51b5\u4e0b\uff0c\u4ece\u670d\u52a1\u5668\u9519\u8bef\u914d\u7f6e\u5230\u7f51\u7edc\u9519\u8bef\uff0c\u518d\u5230\u6570\u636e\u635f\u574f\uff0c \u53ef\u80fd\u4f1a\u51fa\u73b0\u54cd\u5e94\u4e2d\u65ad\u6216\u6570\u636e\u4e22\u5931\u9519\u8bef\u3002\u8003\u8651\u5230\u4e2d\u65ad\u7684\u54cd\u5e94\u53ef\u80fd\u5305\u542b\u90e8\u5206\u5185\u5bb9\u6216\u4e0d\u5b8c\u6574\u7684\u5185\u5bb9\uff0c \u7531\u7528\u6237\u51b3\u5b9a\u662f\u5426\u6709\u5fc5\u8981\u5bf9\u5176\u8fdb\u884c\u5904\u7406\u3002\u5982\u679c[RETRY_ENABLED](#)\u4e3a`True`\uff0c \u4e14\u8be5setting\u4e3a`True`\uff0c\u5219`ResponseFailed([_DataLoss])`\u5931\u8d25\u5c06\u50cf\u5f80\u5e38\u4e00\u6837\u91cd\u8bd5\u3002","title":"DOWNLOAD_FAIL_ON_DATALOSS"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#dupefilter_class","text":"\u9ed8\u8ba4: 'scrapy.dupefilters.RFPDupeFilter' \u7528\u4e8e\u68c0\u6d4b\u548c\u8fc7\u6ee4\u91cd\u590drequests\u7684\u7c7b\u3002 \u9ed8\u8ba4\u7684( RFPDupeFilter )\u8fc7\u6ee4\u5668\u57fa\u4e8e\u4f7f\u7528 scrapy.utils.request.request_fingerprint \u51fd\u6570\u3002\u4e3a\u4e86\u6539\u53d8\u91cd\u590d\u68c0\u67e5\u7684\u65b9\u5f0f\uff0c\u60a8\u53ef\u4ee5\u5b50\u7c7b\u5316 RFPDupeFilter \u5e76\u8986\u76d6\u5b83\u7684 request_fingerprint \u65b9\u6cd5\u3002\u8fd9\u4e2a\u65b9\u6cd5\u5e94\u8be5\u63a5\u53d7scrapy[Request]\u5bf9\u8c61\u5e76\u8fd4\u56de\u5b83\u7684fingerprint(\u4e00\u4e2a\u5b57\u7b26\u4e32)\u3002 \u60a8\u53ef\u4ee5\u901a\u8fc7\u5c06 DUPEFILTER_CLASS \u8bbe\u7f6e\u4e3a 'scrapy.dupefilters.BaseDupeFilter' \u6765\u7981\u7528\u5bf9\u91cd\u590d\u8bf7\u6c42\u7684\u8fc7\u6ee4\u3002\u4f46\u662f\u8981\u975e\u5e38\u5c0f\u5fc3\uff0c\u56e0\u4e3a\u60a8\u53ef\u80fd\u4f1a\u8fdb\u5165\u6293\u53d6\u5faa\u73af\u3002\u5bf9\u4e8e\u4e0d\u5e94\u8be5\u88ab\u8fc7\u6ee4\u7684\u7279\u5b9a Request \uff0c\u6700\u597d\u5c06 dont_filter \u53c2\u6570\u8bbe\u7f6e\u4e3a True \u3002","title":"DUPEFILTER_CLASS"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#dupefilter_debug","text":"\u9ed8\u8ba4: False \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c RFPDupeFilter \u53ea\u8bb0\u5f55\u7b2c\u4e00\u4e2a\u91cd\u590d\u8bf7\u6c42\u3002\u5c06 DUPEFILTER_DEBUG \u8bbe\u7f6e\u4e3a True \u5c06\u4f7f\u5b83\u8bb0\u5f55\u6240\u6709\u91cd\u590d\u7684\u8bf7\u6c42\u3002","title":"DUPEFILTER_DEBUG"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#editor","text":"\u9ed8\u8ba4: vi (\u5728Unix\u7cfb\u7edf\u4e0a)\u6216\u95f2\u7f6e\u7f16\u8f91\u5668(\u5728Windows\u4e0a) \u4f7f\u7528 edit \u547d\u4ee4\u7f16\u8f91spiders\u7684\u7f16\u8f91\u5668\u3002\u6b64\u5916\uff0c\u5982\u679c\u8bbe\u7f6e\u4e86 EDITOR \u73af\u5883\u53d8\u91cf\uff0c\u90a3\u4e48 edit \u547d\u4ee4\u5c06\u66f4\u559c\u6b22\u5b83\u800c\u4e0d\u662f\u9ed8\u8ba4\u8bbe\u7f6e\u3002","title":"EDITOR"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#extensions","text":"\u9ed8\u8ba4: {} \u5305\u542b\u9879\u76ee\u4e2d\u542f\u7528\u7684extensions(\u6269\u5c55)\u53ca\u5176\u5bf9\u5e94\u7684\u6570\u5b57\u7684dict\u3002","title":"EXTENSIONS"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#extensions_base","text":"\u9ed8\u8ba4: { 'scrapy.extensions.corestats.CoreStats': 0, 'scrapy.extensions.telnet.TelnetConsole': 0, 'scrapy.extensions.memusage.MemoryUsage': 0, 'scrapy.extensions.memdebug.MemoryDebugger': 0, 'scrapy.extensions.closespider.CloseSpider': 0, 'scrapy.extensions.feedexport.FeedExporter': 0, 'scrapy.extensions.logstats.LogStats': 0, 'scrapy.extensions.spiderstate.SpiderState': 0, 'scrapy.extensions.throttle.AutoThrottle': 0, } \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cScrapy\u4e2d\u5305\u542b\u9879\u76ee\u4e2d\u542f\u7528\u7684extensions(\u6269\u5c55)\u53ca\u5176\u5bf9\u5e94\u7684\u6570\u5b57\u6743\u91cd\u7684dict\u3002\u6b64\u8bbe\u7f6e\u5305\u542b\u6240\u6709\u7a33\u5b9a\u7684\u5185\u7f6e\u6269\u5c55\u3002\u8bf7\u8bb0\u4f4f\uff0c\u5176\u4e2d\u4e00\u4e9b\u9700\u8981\u901a\u8fc7\u8bbe\u7f6e\u542f\u7528\u3002 \u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 \u6269\u5c55\u7528\u6237\u6307\u5357 \u548c \u53ef\u7528\u6269\u5c55\u5217\u8868 \u3002","title":"EXTENSIONS_BASE"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#feed_tempdir","text":"Feed Temp dir\u5141\u8bb8\u60a8\u5728\u4e0a\u4f20 FTP feed storage \u548c Amazon S3 \u4e4b\u524d\u8bbe\u7f6e\u4e00\u4e2a\u81ea\u5b9a\u4e49\u6587\u4ef6\u5939\u6765\u4fdd\u5b58\u722c\u866b\u4e34\u65f6\u6587\u4ef6\u3002","title":"FEED_TEMPDIR"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#ftp_passive_mode","text":"\u9ed8\u8ba4: True \u542f\u52a8FTP\u4f20\u8f93\u65f6\u662f\u5426\u4f7f\u7528\u88ab\u52a8\u6a21\u5f0f\u3002","title":"FTP_PASSIVE_MODE"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#ftp_password","text":"\u9ed8\u8ba4: \"guest\" \u5f53FTP\u8fde\u63a5\u65f6\u4f7f\u7528\u7684\u5bc6\u7801\u6ca1\u6709\u5199\u5728 Request meta\u91cc\u7684 \"ftp_password\" \u53d9\u8ff0[RFC 1635](https://tools.ietf.org/html/rfc1635)\uff0c \u5c3d\u7ba1\u901a\u5e38\u5728\u533f\u540dFTP\u4e0a\u4f7f\u7528\u201cguest\u201d\u5bc6\u7801\u6216\u7535\u5b50\u90ae\u4ef6\u5730\u5740\u5f88\u5e38\u89c1\uff0c \u4f46\u4e00\u4e9bFTP\u670d\u52a1\u5668\u660e\u786e\u8981\u6c42\u7528\u6237\u7684\u7535\u5b50\u90ae\u4ef6\u5730\u5740\uff0c\u4e0d\u5141\u8bb8\u4f7f\u7528\u201cguest\u201d\u5bc6\u7801\u767b\u5f55\u3002","title":"FTP_PASSWORD"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#ftp_user","text":"\u9ed8\u8ba4: \"anonymous\" \u5f53FTP\u8fde\u63a5\u65f6\u4f7f\u7528\u7684\u5bc6\u7801\u6ca1\u6709\u5199\u5728 Request meta\u91cc\u7684 \"ftp_user\"","title":"FTP_USER"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#item_pipelines","text":"\u9ed8\u8ba4: {} \u4e00\u79cd\u5b57\u5178\uff0c\u5305\u542b\u8981\u4f7f\u7528\u7684item pipelines\u53ca\u5176\u5bf9\u5e94\u7684\u6570\u5b57\u3002\u6570\u5b57\u503c\u662f\u4efb\u610f\u7684\uff0c\u4f46\u662f\u901a\u5e38\u57280-1000\u8303\u56f4\u5185\u5b9a\u4e49\u5b83\u4eec\u3002\u4f4e\u6570\u5b57\u5728\u641e\u6570\u5b57\u4e4b\u524d\u5904\u7406\u3002 \u4f8b\u5b50: ITEM_PIPELINES = { 'mybot.pipelines.validate.ValidateMyItem': 300, 'mybot.pipelines.validate.StoreMyItem': 800, }","title":"ITEM_PIPELINES"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#item_pipelines_base","text":"\u9ed8\u8ba4: {} \u5728Scrapy\u4e2d\u9ed8\u8ba4\u542f\u7528\u7684\u5305\u542bpipelines\u7684dict\u3002\u6c38\u8fdc\u4e0d\u8981\u5728\u9879\u76ee\u4e2d\u4fee\u6539\u8fd9\u4e2a\u8bbe\u7f6e\uff0c\u4fee\u6539 ITEM_PIPELINES \u9664\u5916\u3002","title":"ITEM_PIPELINES_BASE"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#log_enabled","text":"\u9ed8\u8ba4: True \u662f\u5426\u542f\u7528\u65e5\u5fd7\u8bb0\u5f55\u3002","title":"LOG_ENABLED"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#log_encoding","text":"\u9ed8\u8ba4\u503c: 'utf - 8' \u7528\u4e8e\u65e5\u5fd7\u8bb0\u5f55\u7684\u7f16\u7801\u3002","title":"LOG_ENCODING"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#log_file","text":"\u9ed8\u8ba4\u503c: None \u7528\u4e8e\u8bb0\u5f55\u8f93\u51fa\u7684\u6587\u4ef6\u540d\u3002\u5982\u679c\u6ca1\u6709\uff0c\u5219\u4f7f\u7528\u6807\u51c6\u9519\u8bef","title":"LOG_FILE"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#log_format","text":"\u9ed8\u8ba4: '%(asctime)s [%(name)s] %(levelname)s: %(message)s' \u7528\u4e8e\u683c\u5f0f\u5316\u65e5\u5fd7\u6d88\u606f\u7684\u5b57\u7b26\u4e32\u3002\u6709\u5173\u53ef\u7528\u5360\u4f4d\u7b26\u7684\u5b8c\u6574\u5217\u8868\uff0c\u8bf7\u53c2\u9605 Python\u65e5\u5fd7\u8bb0\u5f55\u6587\u6863 \u3002","title":"LOG_FORMAT"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#log_dateformat","text":"Default: '%Y-%m-%d %H:%M:%S' \u7528\u4e8e\u683c\u5f0f\u5316\u65e5\u671f/\u65f6\u95f4\u7684\u5b57\u7b26\u4e32\uff0c\u4ee5 LOG_FORMAT \u5c55\u5f00 %(asctime)s \u7684\u5360\u4f4d\u7b26, \u6709\u5173\u53ef\u7528\u6307\u4ee4\u7684\u5b8c\u6574\u5217\u8868\uff0c\u8bf7\u53c2\u9605 Python datetime\u6587\u6863 \u3002","title":"LOG_DATEFORMAT"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#log_level","text":"\u9ed8\u8ba4: 'DEBUG' \u65e5\u5fd7\u7684\u6700\u4f4e\u7ea7\u522b\u3002\u53ef\u7528\u7684\u7ea7\u522b\u662f: CRITICAL (\u5173\u952e\u7ea7\u522b)\u3001 ERROR (\u9519\u8bef\u7ea7\u522b)\u3001 WARNING (\u8b66\u544a\u7ea7\u522b)\u3001 INFO (\u4fe1\u606f\u7ea7\u522b)\u3001 DEBUG (\u8c03\u8bd5\u7ea7\u522b)\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1 \u65e5\u5fd7\u8bb0\u5f55 \u3002","title":"LOG_LEVEL"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#log_stdout","text":"\u9ed8\u8ba4: False \u5982\u679c\u4e3a True \uff0c\u8fdb\u7a0b\u7684\u6240\u6709\u6807\u51c6\u8f93\u51fa(\u548c\u9519\u8bef)\u5c06\u88ab\u91cd\u5b9a\u5411\u5230\u65e5\u5fd7\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8 print 'hello' \uff0c\u5b83\u5c06\u51fa\u73b0\u5728Scrapy\u65e5\u5fd7\u4e2d\u3002","title":"LOG_STDOUT"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#log_short_names","text":"\u9ed8\u8ba4: False \u5982\u679c\u4e3a True \uff0c\u65e5\u5fd7\u53ea\u5305\u542b\u6839\u8def\u5f84\u3002\u5982\u679c\u8bbe\u7f6e\u4e3a False \uff0c\u5219\u663e\u793a\u8d1f\u8d23\u65e5\u5fd7\u8f93\u51fa\u7684\u7ec4\u4ef6","title":"LOG_SHORT_NAMES"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#memdebug_enabled","text":"\u9ed8\u8ba4: False \u662f\u5426\u542f\u7528\u5185\u5b58\u8c03\u8bd5\u3002","title":"MEMDEBUG_ENABLED"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#memdebug_notify","text":"\u9ed8\u8ba4: [] \u5f53\u542f\u7528\u5185\u5b58\u8c03\u8bd5\u65f6\uff0c\u5982\u679c\u8be5\u8bbe\u7f6e\u4e0d\u662f\u7a7a\u7684\uff0c\u5185\u5b58\u62a5\u544a\u5c06\u88ab\u53d1\u9001\u5230\u6307\u5b9a\u7684\u5730\u5740\uff0c\u5426\u5219\u62a5\u544a\u5c06\u88ab\u5199\u5165\u65e5\u5fd7\u3002 \u4f8b\u5b50: MEMDEBUG_NOTIFY = ['user@example.com']","title":"MEMDEBUG_NOTIFY"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#memusage_enabled","text":"\u9ed8\u8ba4: True \u8303\u56f4: scrapy.extensions.memusage \u662f\u5426\u542f\u7528\u5185\u5b58\u4f7f\u7528\u6269\u5c55\u3002\u6b64\u6269\u5c55\u8ddf\u8e2a\u8fdb\u7a0b\u4f7f\u7528\u7684\u5cf0\u503c\u5185\u5b58(\u5c06\u5176\u5199\u5230stats\u4e2d)\u3002\u5f53\u5185\u5b58\u8d85\u8fc7\u9650\u5236(\u8bf7\u53c2\u9605 MEMUSAGE_LIMIT_MB )\u65f6\uff0c\u5b83\u8fd8\u53ef\u4ee5\u9009\u62e9\u5173\u95edScrapy\u8fdb\u7a0b\uff0c\u5e76\u5728\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\u65f6\u901a\u8fc7\u7535\u5b50\u90ae\u4ef6\u901a\u77e5(\u8bf7\u53c2\u9605 MEMUSAGE_NOTIFY_MAIL )\u3002 \u53c2\u89c1 \u5185\u5b58\u4f7f\u7528\u6269\u5c55 \u3002","title":"MEMUSAGE_ENABLED"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#memusage_limit_mb","text":"\u9ed8\u8ba4: 0 \u8303\u56f4: scrapy.extensions.memusage \u5173\u95edScrapy(\u5982\u679cMEMUSAGE_ENABLED\u4e3aTrue)\u4e4b\u524d\u5141\u8bb8\u7684\u6700\u5927\u5185\u5b58\u6570\u91cf(\u4ee5\u5146\u5b57\u8282\u4e3a\u5355\u4f4d)\u3002\u5982\u679c\u4e3a\u96f6\uff0c\u5219\u4e0d\u6267\u884c\u68c0\u67e5\u3002 \u53c2\u89c1 \u5185\u5b58\u4f7f\u7528\u6269\u5c55 \u3002","title":"MEMUSAGE_LIMIT_MB"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#memusage_check_interval_seconds","text":"\u6700\u65b0\u7248\u672c1.1 \u9ed8\u8ba4: 60.0 \u5185\u5b58\u4f7f\u7528\u6269\u5c55 \u68c0\u67e5\u5f53\u524d\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\uff0c\u800c\u4e0d\u662f MEMUSAGE_LIMIT_MB \u548c MEMUSAGE_WARNING_MB \u5728\u56fa\u5b9a\u65f6\u95f4\u95f4\u9694\u8bbe\u7f6e\u7684\u9650\u5236\u3002 \u8fd9\u5c06\u8bbe\u7f6e\u8fd9\u4e9b\u95f4\u9694\u7684\u957f\u5ea6\uff0c\u4ee5\u79d2\u4e3a\u5355\u4f4d\u3002 \u53c2\u89c1 \u5185\u5b58\u4f7f\u7528\u6269\u5c55 \u3002","title":"MEMUSAGE_CHECK_INTERVAL_SECONDS"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#memusage_notify_mail","text":"\u9ed8\u8ba4: False \u8303\u56f4: scrapy.extensions.memusage \u4e00\u4e2a\u7535\u5b50\u90ae\u4ef6\u5217\u8868\uff0c\u5982\u679c\u5185\u5b58\u8fbe\u5230\u9650\u5236\u5c31\u901a\u77e5\u3002 \u4f8b\u5b50: MEMUSAGE_NOTIFY_MAIL = ['user@example.com'] \u53c2\u89c1 \u5185\u5b58\u4f7f\u7528\u6269\u5c55 \u3002","title":"MEMUSAGE_NOTIFY_MAIL"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#memusage_warning_mb","text":"\u9ed8\u8ba4: 0 \u8303\u56f4: scrapy.extensions.memusage \u53d1\u9001\u8b66\u544a\u90ae\u4ef6\u901a\u77e5\u4e4b\u524d\u5141\u8bb8\u7684\u6700\u5927\u5185\u5b58\u5bb9\u91cf(\u4ee5\u5146\u5b57\u8282\u4e3a\u5355\u4f4d)\u3002\u5982\u679c\u4e3a\u96f6\uff0c\u5219\u4e0d\u4f1a\u53d1\u51fa\u8b66\u544a\u3002","title":"MEMUSAGE_WARNING_MB"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#newspider_module","text":"\u9ed8\u8ba4: '' \u4f7f\u7528genspider\u547d\u4ee4\u521b\u5efa\u65b0spider\u7684\u6a21\u5757\u3002 \u4f8b\u5b50: NEWSPIDER_MODULE = 'mybot.spiders_dev'","title":"NEWSPIDER_MODULE"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#randomize_download_delay","text":"\u9ed8\u8ba4: True \u5982\u679c\u542f\u7528\u4e86,Scrapy\u5728\u4ece\u540c\u4e00\u7f51\u7ad9\u83b7\u53d6\u8bf7\u6c42\u65f6\u5c06\u4f1a\u7b49\u5f85\u4e00\u6bb5\u968f\u673a\u7684\u65f6\u95f4(\u4ecb\u4e8e0.5 * DOWNLOAD_DELAY \u548c1.5 * DOWNLOAD_DELAY \u4e4b\u95f4)\u3002 \u8fd9\u79cd\u968f\u673a\u5316\u964d\u4f4e\u4e86\u722c\u866b\u7a0b\u5e8f\u88ab\u5206\u6790\u8bf7\u6c42\u7684\u7ad9\u70b9\u68c0\u6d4b\u5230(\u5e76\u968f\u540e\u88ab\u963b\u6b62)\u7684\u673a\u4f1a\uff0c\u8fd9\u4e9b\u7ad9\u70b9\u5728\u8bf7\u6c42\u4e4b\u95f4\u5bfb\u627e\u7edf\u8ba1\u4e0a\u663e\u8457\u7684\u76f8\u4f3c\u6027\u3002 \u968f\u673a\u5316\u7b56\u7565\u4e0e wget \u2014-random-wait \u9009\u9879\u76f8\u540c\u3002 \u5982\u679c DOWNLOAD_DELAY \u4e3a\u96f6(\u9ed8\u8ba4)\uff0c\u6b64\u9009\u9879\u65e0\u6548\u3002","title":"RANDOMIZE_DOWNLOAD_DELAY"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#reactor_threadpool_maxsize","text":"\u9ed8\u8ba4: 10 Twisted Reactor\u7ebf\u7a0b\u6c60\u5927\u5c0f\u7684\u6700\u5927\u9650\u5236\u3002\u8fd9\u662f\u5e38\u7528\u7684\u591a\u7528\u9014\u7ebf\u7a0b\u6c60\uff0c\u7528\u4e8e\u5404\u79cd\u65e0\u7528\u7684\u7ec4\u4ef6\u3002\u7ebf\u7a0bDNS\u89e3\u6790\u5668\u3001BlockingFeedStorage\u3001S3FilesStore\u7b49\u7b49\u3002\u5982\u679c\u9047\u5230\u963b\u585eIO\u4e0d\u8db3\u7684\u95ee\u9898\uff0c\u8bf7\u589e\u52a0\u6b64\u503c\u3002","title":"REACTOR_THREADPOOL_MAXSIZE"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#redirect_max_times","text":"\u9ed8\u8ba4: 20 \u5b9a\u4e49\u53ef\u91cd\u5b9a\u5411\u8bf7\u6c42\u7684\u6700\u5927\u6b21\u6570\u3002\u5728\u6b64\u6700\u5927\u503c\u4e4b\u540e\uff0c\u8bf7\u6c42\u7684\u54cd\u5e94\u5c06\u6309\u539f\u6837\u8fd4\u56de\u3002\u5bf9\u4e8e\u540c\u4e00\u4efb\u52a1\uff0c\u6211\u4eec\u4f7f\u7528Firefox\u9ed8\u8ba4\u503c\u3002","title":"REDIRECT_MAX_TIMES"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#redirect_priority_adjust","text":"\u9ed8\u8ba4: +2 \u8303\u56f4: scrapy.downloadermiddlewares.redirect.RedirectMiddleware \u8c03\u6574\u91cd\u5b9a\u5411\u8bf7\u6c42\u4f18\u5148\u7ea7\u76f8\u5bf9\u4e8e\u539f\u59cb\u8bf7\u6c42: \u6b63\u4f18\u5148\u7ea7\u8c03\u6574(\u9ed8\u8ba4)\u610f\u5473\u7740\u66f4\u9ad8\u4f18\u5148\u7ea7\u3002 \u8d1f\u4f18\u5148\u7ea7\u8c03\u6574\u610f\u5473\u7740\u4f4e\u4f18\u5148\u7ea7\u3002","title":"REDIRECT_PRIORITY_ADJUST"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#retry_priority_adjust","text":"\u9ed8\u8ba4: -1 \u8303\u56f4: scrapy.downloadermiddlewares.retry.RetryMiddleware \u8c03\u6574\u91cd\u8bd5\u8bf7\u6c42\u4f18\u5148\u7ea7\u76f8\u5bf9\u4e8e\u539f\u59cb\u8bf7\u6c42: \u6b63\u4f18\u5148\u7ea7\u8c03\u6574\u610f\u5473\u7740\u66f4\u9ad8\u4f18\u5148\u7ea7\u3002 \u8d1f\u4f18\u5148\u7ea7\u8c03\u6574(\u9ed8\u8ba4)\u610f\u5473\u7740\u4f4e\u4f18\u5148\u7ea7\u3002","title":"RETRY_PRIORITY_ADJUST"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#robotstxt_obey","text":"\u9ed8\u8ba4: False \u8303\u56f4: scrapy.downloadermiddlewares.robotstxt \u5982\u679c\u542f\u7528\uff0cScrapy\u5c06\u5c0a\u91cdrobots.txt\u3002\u4e09\u79cd\u653f\u7b56\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 RobotsTxtMiddleware \u3002 \u7531\u4e8e\u5386\u53f2\u539f\u56e0\uff0c\u9ed8\u8ba4\u503c\u4e3a`False`\uff0c\u4f46\u5728\u8bbe\u7f6e\u4e2d\u9ed8\u8ba4\u542f\u7528\u6b64\u9009\u9879\u3002 \u7531`scrapy startproject`\u547d\u4ee4\u751f\u6210\u7684py\u6587\u4ef6\u3002","title":"ROBOTSTXT_OBEY"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#scheduler","text":"\u9ed8\u8ba4: 'scrapy.core.scheduler.Scheduler' \u7528\u4e8e\u6293\u53d6\u7684\u8c03\u5ea6\u7a0b\u5e8f\u3002","title":"SCHEDULER"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#scheduler_debug","text":"\u9ed8\u8ba4: False \u8bbe\u7f6e\u4e3a True \u5c06\u8bb0\u5f55\u6709\u5173requests scheduler\u7684\u8c03\u8bd5\u4fe1\u606f\u3002\u5982\u679crequests\u4e0d\u80fd\u5e8f\u5217\u5316\u5230\u78c1\u76d8\u4e0a\uff0c\u5219\u5f53\u524d\u65e5\u5fd7\u8bb0\u5f55(\u4ec5\u4e00\u6b21)\u3002Stats\u8ba1\u6570\u5668( scheduler/unserializable )\u8ddf\u8e2a\u53d1\u751f\u8fd9\u79cd\u60c5\u51b5\u7684\u6b21\u6570\u3002 \u65e5\u5fd7\u4e2d\u7684\u793a\u4f8b: 1956-01-31 00:00:00+0800 [scrapy.core.scheduler] ERROR: Unable to serialize request: GET http://example.com - reason: cannot serialize Request at 0x9a7c7ec (type Request) - no more unserializable requests will be logged (see 'scheduler/unserializable' stats counter)","title":"SCHEDULER_DEBUG"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#scheduler_disk_queue","text":"\u9ed8\u8ba4: 'scrapy.squeues.PickleLifoDiskQueue' scheduler\u5c06\u4f7f\u7528\u7684\u78c1\u76d8\u961f\u5217\u7684\u7c7b\u578b\u3002 \u5176\u4ed6\u53ef\u7528\u7684\u7c7b\u578b\u662f scrapy.squeues.PickleFifoDiskQueue , scrapy.squeues.MarshalFifoDiskQueue , scrapy.squeues.MarshalLifoDiskQueue","title":"SCHEDULER_DISK_QUEUE"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#scheduler_memory_queue","text":"\u9ed8\u8ba4: 'scrapy.squeues.LifoMemoryQueue' scheduler\u4f7f\u7528\u7684\u5185\u5b58\u961f\u5217\u7684\u7c7b\u578b\u3002\u5176\u4ed6\u53ef\u7528\u7684\u7c7b\u578b\u662f: scrapy.squeues.FifoMemoryQueue","title":"SCHEDULER_MEMORY_QUEUE"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#scheduler_priority_queue","text":"\u9ed8\u8ba4: 'queuelib.PriorityQueue' scheduler\u4f7f\u7528\u7684\u4f18\u5148\u961f\u5217\u7684\u7c7b\u578b\u3002","title":"SCHEDULER_PRIORITY_QUEUE"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#spider_contracts","text":"\u9ed8\u8ba4: {} \u5305\u542b\u5728\u4f60\u7684\u9879\u76ee\u4e2d\u542f\u7528\u7684spider\u7684contracts\u7684dict\uff0c\u7528\u4e8e\u6d4b\u8bd5spiders\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1 Spiders Contracts \u3002","title":"SPIDER_CONTRACTS"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#spider_contracts_base","text":"\u9ed8\u8ba4: { 'scrapy.contracts.default.UrlContract' : 1, 'scrapy.contracts.default.ReturnsContract': 2, 'scrapy.contracts.default.ScrapesContract': 3, } \u5728scrapy\u4e2d\u9ed8\u8ba4\u542f\u7528\u5305\u542bscrapy contracts\u7684dict\u3002\u6c38\u8fdc\u4e0d\u8981\u5728\u9879\u76ee\u4e2d\u4fee\u6539\u8fd9\u4e2a\u8bbe\u7f6e\uff0c\u4fee\u6539 spider_contract \u9664\u5916\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1 Spiders Contracts \u3002 \u60a8\u53ef\u4ee5\u901a\u8fc7\u5728 SPIDER_CONTRACTS \u4e2d\u4e3a\u5b83\u4eec\u7684\u7c7b\u8def\u5f84\u5206\u914d None \u6765\u7981\u7528\u4efb\u4f55\u8fd9\u4e9bcontracts\u3002\u4f8b\u5982\uff0c\u8981\u7981\u7528\u5185\u7f6e\u7684 ScrapesContract \uff0c\u8bf7\u5c06\u5176\u653e\u5728\u60a8\u7684 settings.py \u4e2d\u3002 SPIDER_CONTRACTS = { 'scrapy.contracts.default.ScrapesContract': None, }","title":"SPIDER_CONTRACTS_BASE"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#spider_loader_class","text":"\u9ed8\u8ba4: 'scrapy.spiderloader.SpiderLoader' \u7528\u4e8e\u88c5\u8f7dspider\u7684\u7c7b\uff0c\u5b83\u5fc5\u987b\u5b9e\u73b0 SpiderLoader API \u3002","title":"SPIDER_LOADER_CLASS"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#spider_loader_warn_only","text":"\u6700\u65b0\u7248\u672c1.3.3 \u9ed8\u8ba4: False \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5f53scrapy\u8bd5\u56fe\u4ece SPIDER_MODULES \u4e2d\u5bfc\u5165spider\u7c7b\u65f6\uff0c\u5982\u679c\u5b58\u5728 ImportError \u5f02\u5e38\uff0c\u5b83\u5c06\u4f1a\u663e\u8457\u5931\u8d25\u3002\u4f46\u662f\u60a8\u53ef\u4ee5\u9009\u62e9\u5173\u95ed\u8fd9\u4e2a\u5f02\u5e38\uff0c\u5e76\u901a\u8fc7\u8bbe\u7f6e SPIDER_LOADER_WARN_ONLY = True \u5c06\u5176\u8f6c\u6362\u4e3a\u4e00\u4e2a\u7b80\u5355\u7684\u8b66\u544a\u3002 \u4e00\u4e9b[scrapy\u547d\u4ee4](#)\u5728\u8fd9\u4e2asetting\u4e3aTrue\u65f6\u5df2\u7ecf\u8fd0\u884c(\u5373\u5b83\u4eec\u53ea\u4f1a\u53d1\u51fa\u8b66\u544a\u5e76\u4e14\u4e0d\u4f1a\u5931\u8d25) \uff0c \u56e0\u4e3a\u5b83\u4eec\u5b9e\u9645\u4e0a\u4e0d\u9700\u8981\u52a0\u8f7dspider\u7c7b\u6765\u5de5\u4f5c:[scrapy runspider](#)\u3001[scrapy\u8bbe\u7f6e](#)\u3001 [scrapy startproject](#)\u3001[scrapy\u7248\u672c](#)\u3002","title":"SPIDER_LOADER_WARN_ONLY"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#spider_middlewares","text":"\u9ed8\u8ba4: {} \u5305\u542b\u5728\u60a8\u7684\u9879\u76ee\u4e2d\u542f\u7528\u7684spider middlewares\u53ca\u5176\u5bf9\u5e94\u7684\u6570\u5b57\u7684dict\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1 \u6fc0\u6d3bspider middleware \u3002","title":"SPIDER_MIDDLEWARES"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#spider_middlewares_base","text":"\u9ed8\u8ba4 { 'scrapy.spidermiddlewares.httperror.HttpErrorMiddleware': 50, 'scrapy.spidermiddlewares.offsite.OffsiteMiddleware': 500, 'scrapy.spidermiddlewares.referer.RefererMiddleware': 700, 'scrapy.spidermiddlewares.urllength.UrlLengthMiddleware': 800, 'scrapy.spidermiddlewares.depth.DepthMiddleware': 900, } \u5728Scrapy\u4e2d\u9ed8\u8ba4\u542f\u7528\u7684\u5305\u542bspider middlewares\u53ca\u5176\u5bf9\u5e94\u7684\u6570\u5b57\u7684dict, \u4f4e\u6570\u5b57\u66f4\u63a5\u8fd1engine\uff0c\u9ad8\u6570\u5b57\u66f4\u63a5\u8fd1spider, \u8bf7\u53c2\u89c1 \u6fc0\u6d3bspider middleware \u3002","title":"SPIDER_MIDDLEWARES_BASE"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#spider_modules","text":"\u9ed8\u8ba4: [] \u4e00\u4e2a\u6a21\u5757\u5217\u8868\uff0c\u5176\u4e2dScrapy\u5c06\u67e5\u627espider\u3002 \u4f8b\u5b50: SPIDER_MODULES = ['mybot.spiders_prod', 'mybot.spiders_dev']","title":"SPIDER_MODULES"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#stats_class","text":"\u9ed8\u8ba4: 'scrapy.statscollectors.MemoryStatsCollector' \u7528\u4e8e\u6536\u96c6\u7edf\u8ba1\u6570\u636e\u7684\u7c7b\uff0c\u5b83\u5fc5\u987b\u5b9e\u4f8b\u5316 Stats Collector API \u3002","title":"STATS_CLASS"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#stats_dump","text":"\u9ed8\u8ba4: True \u5728spider\u5b8c\u6210\u540e\uff0c\u5c06 Scrapy stats \u8f6c\u50a8(\u5230Scrapy log)\u3002 \u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1: Stats Collection \u3002","title":"STATS_DUMP"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#statsmailer_rcpts","text":"\u9ed8\u8ba4: [] (\u7a7a\u5217\u8868) \u5728spider\u5b8c\u6210\u6293\u53d6\u540e\u53d1\u9001Scrapy stats\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 StatsMailer \u3002","title":"STATSMAILER_RCPTS"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#telnetconsole_enabled","text":"\u9ed8\u8ba4: True \u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u7528\u4e8e\u6307\u5b9a\u662f\u5426\u542f\u7528 telnet\u63a7\u5236\u53f0 (\u5982\u679c\u5b83\u7684\u6269\u5c55\u4e5f\u662f\u542f\u7528\u7684)\u3002","title":"TELNETCONSOLE_ENABLED"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#telnetconsole_port","text":"\u9ed8\u8ba4: [6023, 6073] \u7528\u4e8etelnet\u63a7\u5236\u53f0\u7684\u7aef\u53e3\u8303\u56f4, \u5982\u679c\u8bbe\u7f6e\u4e3a None \u6216 0 , \uff0c\u5219\u4f7f\u7528\u52a8\u6001\u5206\u914d\u7684\u7aef\u53e3, \u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Telnet\u63a7\u5236\u53f0 \u3002","title":"TELNETCONSOLE_PORT"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#templates_dir","text":"\u9ed8\u8ba4: \u5728scrapy\u6a21\u5757\u5185\u7684 templates \u76ee\u5f55 \u4f7f\u7528 startproject \u547d\u4ee4\u521b\u5efa\u65b0\u9879\u76ee\u548c\u4f7f\u7528 genspider \u547d\u4ee4\u521b\u5efa\u65b0spier\u65f6\u67e5\u627e\u6a21\u677f\u7684\u76ee\u5f55\u3002 \u9879\u76ee\u540d\u79f0\u4e0d\u5f97\u4e0e project \u5b50\u76ee\u5f55\u4e2d\u7684\u81ea\u5b9a\u4e49\u6587\u4ef6\u6216\u76ee\u5f55\u7684\u540d\u79f0\u76f8\u51b2\u7a81\u3002","title":"TEMPLATES_DIR"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#urllength_limit","text":"\u9ed8\u8ba4: 2083 \u8303\u56f4: spidermiddlewares.urllength \u5141\u8bb8\u6293\u53d6URL\u7684\u6700\u5927URL\u957f\u5ea6, \u6709\u5173\u6b64\u8bbe\u7f6e\u7684\u9ed8\u8ba4\u503c\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 https://boutell.com/newfaq/misc/urllength.html","title":"URLLENGTH_LIMIT"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#user_agent","text":"\u9ed8\u8ba4: \"Scrapy/VERSION (+https://scrapy.org)\" \u722c\u884c\u65f6\u8981\u4f7f\u7528\u7684\u9ed8\u8ba4\u7528\u6237\u4ee3\u7406\uff0c\u9664\u975e\u91cd\u5199\u3002","title":"USER_AGENT"},{"location":"2. \u57fa\u672c\u6982\u5ff5/16-settings/#settings_2","text":"\u4ee5\u4e0b\u8bbe\u7f6e\u5df2\u5728\u5176\u4ed6\u5730\u65b9\u8bb0\u5f55\u5728\u6848\uff0c\u8bf7\u68c0\u67e5\u6bcf\u4e2a\u7279\u5b9a\u7684\u60c5\u51b5\uff0c\u4ee5\u67e5\u770b\u5982\u4f55\u542f\u7528\u548c\u4f7f\u7528\u5b83\u4eec\u3002 AJAXCRAWL_ENABLED AUTOTHROTTLE_DEBUG AUTOTHROTTLE_ENABLED AUTOTHROTTLE_MAX_DELAY AUTOTHROTTLE_START_DELAY AUTOTHROTTLE_TARGET_CONCURRENCY CLOSESPIDER_ERRORCOUNT CLOSESPIDER_ITEMCOUNT CLOSESPIDER_PAGECOUNT CLOSESPIDER_TIMEOUT COMMANDS_MODULE COMPRESSION_ENABLED COOKIES_DEBUG COOKIES_ENABLED FEED_EXPORTERS FEED_EXPORTERS_BASE FEED_EXPORT_ENCODING FEED_EXPORT_FIELDS FEED_EXPORT_INDENT FEED_FORMAT FEED_STORAGES FEED_STORAGES_BASE FEED_STORE_EMPTY FEED_URI FILES_EXPIRES FILES_RESULT_FIELD FILES_STORE FILES_STORE_S3_ACL FILES_URLS_FIELD GCS_PROJECT_ID HTTPCACHE_ALWAYS_STORE HTTPCACHE_DBM_MODULE HTTPCACHE_DIR HTTPCACHE_ENABLED HTTPCACHE_EXPIRATION_SECS HTTPCACHE_GZIP HTTPCACHE_IGNORE_HTTP_CODES HTTPCACHE_IGNORE_MISSING HTTPCACHE_IGNORE_RESPONSE_CACHE_CONTROLS HTTPCACHE_IGNORE_SCHEMES HTTPCACHE_POLICY HTTPCACHE_STORAGE HTTPERROR_ALLOWED_CODES HTTPERROR_ALLOW_ALL HTTPPROXY_AUTH_ENCODING HTTPPROXY_ENABLED IMAGES_EXPIRES IMAGES_MIN_HEIGHT IMAGES_MIN_WIDTH IMAGES_RESULT_FIELD IMAGES_STORE IMAGES_STORE_S3_ACL IMAGES_THUMBS IMAGES_URLS_FIELD MAIL_FROM MAIL_HOST MAIL_PASS MAIL_PORT MAIL_SSL MAIL_TLS MAIL_USER MEDIA_ALLOW_REDIRECTS METAREFRESH_ENABLED METAREFRESH_MAXDELAY REDIRECT_ENABLED REDIRECT_MAX_TIMES REFERER_ENABLED REFERRER_POLICY RETRY_ENABLED RETRY_HTTP_CODES RETRY_TIMES TELNETCONSOLE_HOST TELNETCONSOLE_PORT","title":"Settings\u5176\u4ed6\u8bb0\u5f55:"},{"location":"3. \u5185\u7f6e\u670d\u52a1/17-logging/","text":"Logging(\u65e5\u5fd7\u8bb0\u5f55) `scrapy.log`\u5df2\u7ecf\u88ab\u5f03\u7528\uff0c\u5b83\u7684\u529f\u80fd\u652f\u6301\u5bf9Python\u6807\u51c6logging\u7684\u663e\u5f0f\u8c03\u7528\u3002 \u7ee7\u7eed\u9605\u8bfb\u4ee5\u4e86\u89e3\u66f4\u591a\u5173\u4e8e\u65b0logging\u7cfb\u7edf\u7684\u4fe1\u606f\u3002 Scrapy\u4f7f\u7528 Python\u7684\u5185\u7f6elogging\u7cfb\u7edf \u8fdb\u884c\u4e8b\u4ef6\u65e5\u5fd7\u8bb0\u5f55\u3002\u6211\u4eec\u5c06\u63d0\u4f9b\u4e00\u4e9b\u7b80\u5355\u7684\u793a\u4f8b\uff0c\u4ee5\u4f7f\u60a8\u5165\u95e8\uff0c\u4f46\u662f\u5bf9\u4e8e\u66f4\u9ad8\u7ea7\u7684\u7528\u4f8b\uff0c\u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u60a8\u5f7b\u5e95\u9605\u8bfb\u5b83\u7684\u6587\u6863\u3002 Logging\u53ef\u4ee5\u4ece\u76d2\u5b50\u4e2d\u5de5\u4f5c\uff0c\u5e76\u4e14\u53ef\u4ee5\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u914d\u7f6e Logging\u8bbe\u7f6e \u4e2d\u5217\u51fa\u7684Scrapy\u8bbe\u7f6e\u3002 Scrapy\u8c03\u7528 scrapy.utils.log.configure_logging() \u6765\u8bbe\u7f6e\u4e00\u4e9b\u5408\u7406\u7684\u9ed8\u8ba4\u503c\uff0c\u5e76\u5728\u8fd0\u884c\u547d\u4ee4\u65f6\u5728 Logging\u8bbe\u7f6e \u4e2d\u5904\u7406\u8fd9\u4e9bsettings\uff0c\u56e0\u6b64\uff0c\u5982\u679c\u4f60\u5728\u811a\u672c( \u4ece\u811a\u672c\u4e2d\u8fd0\u884c\u526a\u8d34\u7c3f )\u4e2d\u8fd0\u884cScrapy\uff0c\u5efa\u8bae\u624b\u52a8\u8c03\u7528\u5b83 Log\u7ea7\u522b Python\u7684\u5185\u7f6elogging\u5b9a\u4e49\u4e865\u4e2a\u4e0d\u540c\u7684\u7ea7\u522b\uff0c\u4ee5\u6307\u793a\u7ed9\u5b9a\u65e5\u5fd7\u6d88\u606f\u7684\u4e25\u91cd\u6027\u3002\u4e0b\u9762\u662f\u6807\u51c6\u7684\u5217\u8868\uff0c\u6309\u9012\u51cf\u987a\u5e8f\u5217\u51fa\uff1a logging.CRITICAL - \u65e5\u5fd7\u8bb0\u5f55\u3002\u5173\u952e\u9519\u8bef\uff08\u6700\u9ad8\u4e25\u91cd\u6027\uff09 logging.ERROR - \u5e38\u89c4\u9519\u8bef logging.WARNING - \u8b66\u544a\u6d88\u606f logging.INFO - \u4fe1\u606f\u6d88\u606f logging.DEBUG - \u8c03\u8bd5\u6d88\u606f\uff08\u6700\u4f4e\u4e25\u91cd\u6027\uff09 \u5982\u4f55log\u6d88\u606f \u4e0b\u9762\u662f\u4e00\u4e2a\u4f7f\u7528 logging.WARNING \u7ea7\u522b\u6765\u8bb0\u5f55\u6d88\u606f\u7684\u5feb\u901f\u793a\u4f8b import logging logging.warning(u \u8fd9\u662f\u4e00\u4e2a\u8b66\u544a ) \u5728\u4efb\u4f55\u6807\u51c6\u76845\u7ea7\u4e0a\u53d1\u5e03\u65e5\u5fd7\u6d88\u606f\u90fd\u6709\u6377\u5f84\uff0c\u800c\u4e14\u8fd8\u6709\u4e00\u4e2a\u901a\u7528 logging.log \u65b9\u6cd5\uff0c\u5b83\u4ee5\u4e00\u4e2a\u7ed9\u5b9a\u7684\u7ea7\u522b\u4f5c\u4e3a\u53c2\u6570\u3002\u5982\u679c\u9700\u8981\uff0c\u6700\u540e\u4e00\u4e2a\u4f8b\u5b50\u53ef\u4ee5\u91cd\u5199\u4e3a\uff1a import logging logging.log(logging.WARNING, \u8fd9\u662f\u4e00\u4e2a\u8b66\u544a ) \u6700\u91cd\u8981\u7684\u662f\uff0c\u60a8\u53ef\u4ee5\u521b\u5efa\u4e0d\u540c\u7684\u201cloggers\u201d\u6765\u5c01\u88c5\u6d88\u606f\u3002\uff08\u4f8b\u5982\uff0c\u4e00\u4e2a\u5e38\u89c1\u7684\u505a\u6cd5\u662f\u4e3a\u6bcf\u4e2a\u6a21\u5757\u521b\u5efa\u4e0d\u540c\u7684loggers\uff09\u3002\u8fd9\u4e9bloggers\u53ef\u4ee5\u72ec\u7acb\u914d\u7f6e\uff0c\u5e76\u4e14\u5141\u8bb8\u5206\u5c42\u7ed3\u6784\u3002 \u524d\u9762\u7684\u4f8b\u5b50\u5e55\u540e\u4f7f\u7528\u4e86\u6839logger\uff0c\u5b83\u662f\u4e00\u4e2a\u9876\u7ea7\u7684logger\uff0c\u5176\u4e2d\u6240\u6709\u7684\u6d88\u606f\u90fd\u88ab\u4f20\u64ad\u5230\uff08\u9664\u975e\u53e6\u6709\u8bf4\u660e\uff09\u3002\u4f7f\u7528 logging \u52a9\u624b\u4ec5\u4ec5\u662f\u663e\u5f0f\u83b7\u53d6\u6839\u65e5\u5fd7\u8bb0\u5f55\u5668\u7684\u5feb\u6377\u65b9\u5f0f\uff0c\u56e0\u6b64\u8fd9\u4e5f\u76f8\u5f53\u4e8e\u6700\u540e\u7684\u7247\u6bb5\uff1a import logging logger = logging.getLogger() logger.warning(u \u8fd9\u662f\u4e00\u4e2a\u8b66\u544a ) \u60a8\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u4e0d\u540c\u7684logger\uff0c\u53ea\u9700\u901a\u8fc7 logging.getLogger \u51fd\u6570\u83b7\u5f97\u5b83\u7684\u540d\u79f0\uff1a import logging logger = logging.getLogger(u'\u6211\u7684\u81ea\u5b9a\u4e49logger') logger.warning(u \u8fd9\u662f\u4e00\u4e2a\u8b66\u544a ) \u6700\u540e\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 __name__ \u53d8\u91cf\u6765\u786e\u4fdd\u4e3a\u60a8\u6b63\u5728\u5904\u7406\u7684\u4efb\u4f55\u6a21\u5757\u90fd\u6709\u4e00\u4e2a\u81ea\u5b9a\u4e49logger\uff0c\u8be5\u540d\u79f0\u53d8\u91cf\u7531\u5f53\u524d\u6a21\u5757\u7684\u8def\u5f84\u586b\u5145\uff1a import logging logger = logging.getLogger(__name__) logger.warning( This is a warning ) logging\u6a21\u5757, [\u57fa\u672c\u77e5\u8bc6](https://docs.python.org/2/howto/logging.html) \u57fa\u672c\u7684Logging\u6559\u7a0b logging\u6a21\u5757, [Loggers](https://docs.python.org/2/library/logging.html#logger-objects) \u5173\u4e8eLoggers\u7684\u8fdb\u4e00\u6b65\u6587\u6863 Logging from Spiders Scrapy\u5728\u6bcf\u4e2aspider\u5b9e\u4f8b\u4e2d\u63d0\u4f9b\u4e00\u4e2a logger \uff0c\u53ef\u4ee5\u50cf\u8fd9\u6837\u8bbf\u95ee\u548c\u4f7f\u7528\uff1a import scrapy class MySpider(scrapy.Spider): name = 'myspider' start_urls = ['https://scrapinghub.com'] def parse(self, response): self.logger.info(u'\u8c03\u7528\u89e3\u6790\u51fd\u6570 %s', response.url) \u8fd9\u4e2alogger\u662f\u4f7f\u7528Spider\u540d\u79f0\u521b\u5efa\u7684\uff0c\u4f46\u662f\u60a8\u53ef\u4ee5\u4f7f\u7528\u4efb\u4f55\u60a8\u60f3\u8981\u7684\u5b9a\u5236Python logger\u3002\u4f8b\u5982: import logging import scrapy logger = logging.getLogger('mycustomlogger') class MySpider(scrapy.Spider): name = 'myspider' start_urls = ['https://scrapinghub.com'] def parse(self, response): logger.info(u'\u8c03\u7528\u89e3\u6790\u51fd\u6570 %s', response.url) Logging\u914d\u7f6e Loggers\u672c\u8eab\u65e0\u6cd5\u63a7\u5236\u901a\u8fc7\u5b83\u4eec\u53d1\u9001\u7684\u6d88\u606f\u662f\u5982\u4f55\u663e\u793a\u7684\u3002\u5bf9\u4e8e\u8fd9\u4e2a\u4efb\u52a1\uff0c\u4e0d\u540c\u7684\u201chandlers\u201d\u53ef\u4ee5\u9644\u52a0\u5230\u4efb\u4f55logger\u5b9e\u4f8b\uff0c\u5b83\u4eec\u4f1a\u5c06\u8fd9\u4e9b\u6d88\u606f\u91cd\u5b9a\u5411\u5230\u9002\u5f53\u7684\u76ee\u7684\u5730\uff0c\u6bd4\u5982\u6807\u51c6\u8f93\u51fa\u3001\u6587\u4ef6\u3001\u7535\u5b50\u90ae\u4ef6\u7b49\u3002 \u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u57fa\u4e8e\u4e0b\u9762\u7684\u8bbe\u7f6e\uff0cScrapy\u8bbe\u7f6e\u5e76\u914d\u7f6e\u6839logger\u7684handler\u3002 Logging\u8bbe\u7f6e \u8fd9\u4e9b\u8bbe\u7f6e\u53ef\u7528\u4e8e\u914d\u7f6elogging\uff1a LOG_FILE LOG_ENABLED LOG_ENCODING LOG_LEVEL LOG_FORMAT LOG_DATEFORMAT LOG_STDOUT LOG_SHORT_NAMES \u6700\u521d\u7684\u51e0\u4e2a\u8bbe\u7f6e\u5b9a\u4e49\u4e86\u65e5\u5fd7\u6d88\u606f\u7684\u76ee\u7684\u5730\u3002\u5982\u679c\u8bbe\u7f6e\u4e86 LOG_FILE \uff0c\u5219\u901a\u8fc7\u6839logger\u53d1\u9001\u7684\u6d88\u606f\u5c06\u88ab\u91cd\u5b9a\u5411\u5230\u4e00\u4e2a\u540d\u4e3a LOG_FILE \u7684\u6587\u4ef6\uff0c\u5e76\u4f7f\u7528\u7f16\u7801 LOG_ENCODING \u3002\u5982\u679cunset\u548c LOG_ENABLED \u662f True \uff0c\u90a3\u4e48\u65e5\u5fd7\u6d88\u606f\u5c06\u663e\u793a\u5728\u6807\u51c6\u9519\u8bef\u4e0a\u3002\u6700\u540e\uff0c\u5982\u679c LOG_ENABLED \u662f False \uff0c\u5c31\u4e0d\u4f1a\u6709\u4efb\u4f55\u53ef\u89c1\u7684\u65e5\u5fd7\u8f93\u51fa\u3002 LOG_LEVEL \u51b3\u5b9a\u663e\u793a\u7684\u6700\u4f4e\u7ea7\u522b\u7684\u4e25\u91cd\u6027\uff0c\u90a3\u4e9b\u8f83\u4f4e\u7ea7\u522b\u7684\u6d88\u606f\u5c06\u88ab\u8fc7\u6ee4\u6389\u3002\u5b83\u5305\u62ec\u5728 \u65e5\u5fd7\u7ea7\u522b \u4e2d\u5217\u51fa\u7684\u53ef\u80fd\u7ea7\u522b\u3002 LOG_FORMAT \u548c LOG_DATEFORMAT \u6307\u5b9a\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u4f5c\u4e3a\u6240\u6709\u6d88\u606f\u7684\u5e03\u5c40\u3002\u8fd9\u4e9b\u5b57\u7b26\u4e32\u53ef\u4ee5\u5305\u542b\u5728 \u65e5\u5fd7\u8bb0\u5f55\u7684\u65e5\u5fd7\u8bb0\u5f55\u5c5e\u6027\u6587\u6863 \u4e2d\u5217\u51fa\u7684\u4efb\u4f55\u5360\u4f4d\u7b26\uff0c\u5b83\u4eec\u5206\u522b\u662f datetime\u7684strftime\u548cstrptime\u6307\u4ee4 \u3002 \u5982\u679c\u8bbe\u7f6e\u4e86 LOG_SHORT_NAMES \uff0c\u90a3\u4e48\u65e5\u5fd7\u5c06\u4e0d\u4f1a\u663e\u793a\u6253\u5370\u65e5\u5fd7\u7684Scrapy\u7ec4\u4ef6\u3002It is unset by default\uff0c\u56e0\u6b64logs\u5305\u542b\u8d1f\u8d23\u8be5\u65e5\u5fd7\u8f93\u51fa\u7684Scrapy\u7ec4\u4ef6\u3002 \u547d\u4ee4\u884c\u9009\u9879 \u6709\u4e00\u4e9b\u547d\u4ee4\u884c\u53c2\u6570\u53ef\u4f9b\u6240\u6709\u547d\u4ee4\u4f7f\u7528\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u5b83\u6765\u8986\u76d6\u5173\u4e8e\u65e5\u5fd7\u8bb0\u5f55\u7684\u4e00\u4e9b\u526a\u8d34\u8bbe\u7f6e\u3002 --logfile FILE \u8986\u76d6 LOG_FILE --loglevel/-L LEVEL \u8986\u76d6 LOG_LEVEL --nolog \u8bbe\u7f6e LOG_ENABLED \u4e3a False \u8bf7\u53c2\u89c1 [logging.handlers](https://docs.python.org/2/library/logging.handlers.html)\u6a21\u5757 \u5173\u4e8e\u53ef\u7528handlers\u7684\u8fdb\u4e00\u6b65\u6587\u6863 \u9ad8\u7ea7\u5b9a\u5236 \u56e0\u4e3aScrapy\u4f7f\u7528stdlib logging\u6a21\u5757\uff0c\u6240\u4ee5\u60a8\u53ef\u4ee5\u4f7f\u7528stdlib logging\u7684\u6240\u6709\u7279\u6027\u6765\u5b9a\u5236logging\u3002 \u4f8b\u5982\uff0c\u5047\u8bbe\u60a8\u6b63\u5728\u6293\u53d6\u4e00\u4e2a\u8fd4\u56de\u8bb8\u591aHTTP 404\u548c500\u54cd\u5e94\u7684\u7f51\u7ad9\uff0c\u60a8\u60f3\u8981\u9690\u85cf\u6240\u6709\u8fd9\u6837\u7684\u6d88\u606f\uff1a 2016-12-16 22:00:06 [scrapy.spidermiddlewares.httperror] INFO: Ignoring response 500 http://quotes.toscrape.com/page/1-34/ : HTTP status code is not handled or not allowed \u9996\u5148\u8981\u6ce8\u610f\u7684\u662flogger\u7684\u540d\u5b57 - \u5b83\u5728\u62ec\u53f7\u91cc\uff1a [scrapy.spidermiddlewares.httperror] \u3002\u5982\u679c\u4f60\u53ea\u5f97\u5230\u4e86 scrapy \uff0c\u90a3\u4e48 LOG_SHORT_NAMES \u5f88\u53ef\u80fd\u662fTrue;\u628a\u5b83\u8bbe\u7f6e\u4e3aFalse\uff0c\u7136\u540e\u91cd\u65b0\u8fd0\u884ccrawl\u3002 \u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6d88\u606f\u5177\u6709INFO\u7ea7\u522b\u3002\u4e3a\u4e86\u9690\u85cf\u5b83\uff0c\u6211\u4eec\u5e94\u8be5\u8bbe\u7f6e\u6bd4\u4fe1\u606f\u66f4\u9ad8\u7684 scrapy.spidermiddlewares.httperror \u7684\u65e5\u5fd7\u7ea7\u522b;\u4e0b\u4e00\u5c42\u4fe1\u606f\u662fWARNING\u3002\u53ef\u4ee5\u8fd9\u6837\u505a\uff0c\u4f8b\u5982\u5728spider\u7684 __init__ \u65b9\u6cd5\u4e2d\uff1a import logging import scrapy class MySpider(scrapy.Spider): # ... def __init__(self, *args, **kwargs): logger = logging.getLogger('scrapy.spidermiddlewares.httperror') logger.setLevel(logging.WARNING) super().__init__(*args, **kwargs) \u5982\u679c\u60a8\u518d\u6b21\u8fd0\u884c\u8fd9\u4e2aspider\uff0c\u90a3\u4e48\u6765\u81ea scrapy.spidermiddlewares.httperror \u7684logger\u7684\u4fe1\u606f\u5c06\u4f1a\u6d88\u5931\u3002 scrapy.utils.log\u6a21\u5757 scrapy.utils.log.configure_logging(settings=None, install_root_handler=True) \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) \u521d\u59cb\u5316Scrapy\u7684logging\u9ed8\u8ba4\u503c\u3002 \u53c2\u6570: settings (\u5b57\u5178, Settings \u5bf9\u8c61\u6216\u8005 None ) \u2013 \u7528\u4e8e\u4e3a\u6839logger\u521b\u5efa\u548c\u914d\u7f6ehandler\u7684\u8bbe\u7f6e\uff08\u9ed8\u8ba4\uff1aNone\uff09\u3002 install_root_handler (\u5e03\u5c14\u7c7b\u578b) \u2013 \u662f\u5426\u8981\u5b89\u88c5\u6839logging handler\uff08\u9ed8\u8ba4\uff1aTrue\uff09 \u8fd9\u4e2a\u51fd\u6570: \u901a\u8fc7Python\u6807\u51c6\u65e5\u5fd7\u8bb0\u5f55\u8def\u7531\u8b66\u544a\u548ctwisted\u65e5\u5fd7\u8bb0\u5f55 \u5206\u522b\u4e3aScrapy\u548cTwisted loggers\u5206\u914dDEBUG\u548cERROR\u7ea7\u522b \u5982\u679cLOG_STDOUT\u8bbe\u7f6e\u4e3aTrue\uff0c\u5219\u5c06stdout\u8def\u7531\u5230\u65e5\u5fd7 \u5f53 install_root_handler \u4e3aTrue\uff08\u9ed8\u8ba4\uff09\u65f6\uff0c\u8fd9\u4e2a\u51fd\u6570\u4e5f\u4f1a\u6839\u636e\u7ed9\u5b9a\u7684\u8bbe\u7f6e\u4e3a\u6839logger\u521b\u5efa\u4e00\u4e2ahandler\uff08\u53c2\u89c1 Logging settings \uff09\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 settings \u53c2\u6570\u8986\u76d6\u9ed8\u8ba4\u9009\u9879\u3002\u5f53\u8bbe\u7f6e\u4e3a\u7a7a\u6216None\u65f6\uff0c\u4f1a\u4f7f\u7528\u9ed8\u8ba4\u503c\u3002 \u5728\u4f7f\u7528Scrapy\u547d\u4ee4\u65f6\uff0c\u4f1a\u81ea\u52a8\u8c03\u7528 configure_logging \uff0c\u4f46\u662f\u5728\u8fd0\u884c\u81ea\u5b9a\u4e49\u811a\u672c\u65f6\u9700\u8981\u663e\u5f0f\u5730\u8c03\u7528configure_logging\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5b83\u7684\u7528\u6cd5\u4e0d\u662f\u5fc5\u9700\u7684\uff0c\u4f46\u5b83\u662f\u63a8\u8350\u7684\u3002 \u5982\u679c\u60a8\u6253\u7b97\u81ea\u5df1\u914d\u7f6ehandlers\uff0c\u90a3\u4e48\u60a8\u4ecd\u7136\u5efa\u8bae\u60a8\u8c03\u7528\u8fd9\u4e2a\u51fd\u6570\uff0c\u4f20\u9012install_root_handler=False\u3002\u8bf7\u8bb0\u4f4f\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e0d\u4f1a\u8f93\u51fa\u4efb\u4f55\u65e5\u5fd7\u96c6\u3002 \u4e3a\u4e86\u8ba9\u60a8\u5f00\u59cb\u624b\u52a8\u914d\u7f6elogging\u7684\u8f93\u51fa\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 logging.basicConfig() \u6765\u8bbe\u7f6e\u57fa\u672croot handler\u3002\u8fd9\u662f\u4e00\u4e2a\u5173\u4e8e\u5982\u4f55\u5c06 INFO \u6216\u66f4\u9ad8\u6d88\u606f\u91cd\u5b9a\u5411\u5230\u6587\u4ef6\u7684\u793a\u4f8b\uff1a import logging from scrapy.utils.log import configure_logging configure_logging(install_root_handler=False) logging.basicConfig( filename='log.txt', format='%(levelname)s: %(message)s', level=logging.INFO ) \u4ece \u811a\u672c\u4e2d\u5f15\u7528Scrapy \u6765\u4e86\u89e3\u5173\u4e8e\u4f7f\u7528Scrapy\u7684\u66f4\u591a\u7ec6\u8282\u3002","title":"Logging(\u65e5\u5fd7\u8bb0\u5f55)"},{"location":"3. \u5185\u7f6e\u670d\u52a1/17-logging/#logging","text":"`scrapy.log`\u5df2\u7ecf\u88ab\u5f03\u7528\uff0c\u5b83\u7684\u529f\u80fd\u652f\u6301\u5bf9Python\u6807\u51c6logging\u7684\u663e\u5f0f\u8c03\u7528\u3002 \u7ee7\u7eed\u9605\u8bfb\u4ee5\u4e86\u89e3\u66f4\u591a\u5173\u4e8e\u65b0logging\u7cfb\u7edf\u7684\u4fe1\u606f\u3002 Scrapy\u4f7f\u7528 Python\u7684\u5185\u7f6elogging\u7cfb\u7edf \u8fdb\u884c\u4e8b\u4ef6\u65e5\u5fd7\u8bb0\u5f55\u3002\u6211\u4eec\u5c06\u63d0\u4f9b\u4e00\u4e9b\u7b80\u5355\u7684\u793a\u4f8b\uff0c\u4ee5\u4f7f\u60a8\u5165\u95e8\uff0c\u4f46\u662f\u5bf9\u4e8e\u66f4\u9ad8\u7ea7\u7684\u7528\u4f8b\uff0c\u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u60a8\u5f7b\u5e95\u9605\u8bfb\u5b83\u7684\u6587\u6863\u3002 Logging\u53ef\u4ee5\u4ece\u76d2\u5b50\u4e2d\u5de5\u4f5c\uff0c\u5e76\u4e14\u53ef\u4ee5\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u914d\u7f6e Logging\u8bbe\u7f6e \u4e2d\u5217\u51fa\u7684Scrapy\u8bbe\u7f6e\u3002 Scrapy\u8c03\u7528 scrapy.utils.log.configure_logging() \u6765\u8bbe\u7f6e\u4e00\u4e9b\u5408\u7406\u7684\u9ed8\u8ba4\u503c\uff0c\u5e76\u5728\u8fd0\u884c\u547d\u4ee4\u65f6\u5728 Logging\u8bbe\u7f6e \u4e2d\u5904\u7406\u8fd9\u4e9bsettings\uff0c\u56e0\u6b64\uff0c\u5982\u679c\u4f60\u5728\u811a\u672c( \u4ece\u811a\u672c\u4e2d\u8fd0\u884c\u526a\u8d34\u7c3f )\u4e2d\u8fd0\u884cScrapy\uff0c\u5efa\u8bae\u624b\u52a8\u8c03\u7528\u5b83","title":"Logging(\u65e5\u5fd7\u8bb0\u5f55)"},{"location":"3. \u5185\u7f6e\u670d\u52a1/17-logging/#log","text":"Python\u7684\u5185\u7f6elogging\u5b9a\u4e49\u4e865\u4e2a\u4e0d\u540c\u7684\u7ea7\u522b\uff0c\u4ee5\u6307\u793a\u7ed9\u5b9a\u65e5\u5fd7\u6d88\u606f\u7684\u4e25\u91cd\u6027\u3002\u4e0b\u9762\u662f\u6807\u51c6\u7684\u5217\u8868\uff0c\u6309\u9012\u51cf\u987a\u5e8f\u5217\u51fa\uff1a logging.CRITICAL - \u65e5\u5fd7\u8bb0\u5f55\u3002\u5173\u952e\u9519\u8bef\uff08\u6700\u9ad8\u4e25\u91cd\u6027\uff09 logging.ERROR - \u5e38\u89c4\u9519\u8bef logging.WARNING - \u8b66\u544a\u6d88\u606f logging.INFO - \u4fe1\u606f\u6d88\u606f logging.DEBUG - \u8c03\u8bd5\u6d88\u606f\uff08\u6700\u4f4e\u4e25\u91cd\u6027\uff09","title":"Log\u7ea7\u522b"},{"location":"3. \u5185\u7f6e\u670d\u52a1/17-logging/#log_1","text":"\u4e0b\u9762\u662f\u4e00\u4e2a\u4f7f\u7528 logging.WARNING \u7ea7\u522b\u6765\u8bb0\u5f55\u6d88\u606f\u7684\u5feb\u901f\u793a\u4f8b import logging logging.warning(u \u8fd9\u662f\u4e00\u4e2a\u8b66\u544a ) \u5728\u4efb\u4f55\u6807\u51c6\u76845\u7ea7\u4e0a\u53d1\u5e03\u65e5\u5fd7\u6d88\u606f\u90fd\u6709\u6377\u5f84\uff0c\u800c\u4e14\u8fd8\u6709\u4e00\u4e2a\u901a\u7528 logging.log \u65b9\u6cd5\uff0c\u5b83\u4ee5\u4e00\u4e2a\u7ed9\u5b9a\u7684\u7ea7\u522b\u4f5c\u4e3a\u53c2\u6570\u3002\u5982\u679c\u9700\u8981\uff0c\u6700\u540e\u4e00\u4e2a\u4f8b\u5b50\u53ef\u4ee5\u91cd\u5199\u4e3a\uff1a import logging logging.log(logging.WARNING, \u8fd9\u662f\u4e00\u4e2a\u8b66\u544a ) \u6700\u91cd\u8981\u7684\u662f\uff0c\u60a8\u53ef\u4ee5\u521b\u5efa\u4e0d\u540c\u7684\u201cloggers\u201d\u6765\u5c01\u88c5\u6d88\u606f\u3002\uff08\u4f8b\u5982\uff0c\u4e00\u4e2a\u5e38\u89c1\u7684\u505a\u6cd5\u662f\u4e3a\u6bcf\u4e2a\u6a21\u5757\u521b\u5efa\u4e0d\u540c\u7684loggers\uff09\u3002\u8fd9\u4e9bloggers\u53ef\u4ee5\u72ec\u7acb\u914d\u7f6e\uff0c\u5e76\u4e14\u5141\u8bb8\u5206\u5c42\u7ed3\u6784\u3002 \u524d\u9762\u7684\u4f8b\u5b50\u5e55\u540e\u4f7f\u7528\u4e86\u6839logger\uff0c\u5b83\u662f\u4e00\u4e2a\u9876\u7ea7\u7684logger\uff0c\u5176\u4e2d\u6240\u6709\u7684\u6d88\u606f\u90fd\u88ab\u4f20\u64ad\u5230\uff08\u9664\u975e\u53e6\u6709\u8bf4\u660e\uff09\u3002\u4f7f\u7528 logging \u52a9\u624b\u4ec5\u4ec5\u662f\u663e\u5f0f\u83b7\u53d6\u6839\u65e5\u5fd7\u8bb0\u5f55\u5668\u7684\u5feb\u6377\u65b9\u5f0f\uff0c\u56e0\u6b64\u8fd9\u4e5f\u76f8\u5f53\u4e8e\u6700\u540e\u7684\u7247\u6bb5\uff1a import logging logger = logging.getLogger() logger.warning(u \u8fd9\u662f\u4e00\u4e2a\u8b66\u544a ) \u60a8\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u4e0d\u540c\u7684logger\uff0c\u53ea\u9700\u901a\u8fc7 logging.getLogger \u51fd\u6570\u83b7\u5f97\u5b83\u7684\u540d\u79f0\uff1a import logging logger = logging.getLogger(u'\u6211\u7684\u81ea\u5b9a\u4e49logger') logger.warning(u \u8fd9\u662f\u4e00\u4e2a\u8b66\u544a ) \u6700\u540e\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 __name__ \u53d8\u91cf\u6765\u786e\u4fdd\u4e3a\u60a8\u6b63\u5728\u5904\u7406\u7684\u4efb\u4f55\u6a21\u5757\u90fd\u6709\u4e00\u4e2a\u81ea\u5b9a\u4e49logger\uff0c\u8be5\u540d\u79f0\u53d8\u91cf\u7531\u5f53\u524d\u6a21\u5757\u7684\u8def\u5f84\u586b\u5145\uff1a import logging logger = logging.getLogger(__name__) logger.warning( This is a warning ) logging\u6a21\u5757, [\u57fa\u672c\u77e5\u8bc6](https://docs.python.org/2/howto/logging.html) \u57fa\u672c\u7684Logging\u6559\u7a0b logging\u6a21\u5757, [Loggers](https://docs.python.org/2/library/logging.html#logger-objects) \u5173\u4e8eLoggers\u7684\u8fdb\u4e00\u6b65\u6587\u6863","title":"\u5982\u4f55log\u6d88\u606f"},{"location":"3. \u5185\u7f6e\u670d\u52a1/17-logging/#logging-from-spiders","text":"Scrapy\u5728\u6bcf\u4e2aspider\u5b9e\u4f8b\u4e2d\u63d0\u4f9b\u4e00\u4e2a logger \uff0c\u53ef\u4ee5\u50cf\u8fd9\u6837\u8bbf\u95ee\u548c\u4f7f\u7528\uff1a import scrapy class MySpider(scrapy.Spider): name = 'myspider' start_urls = ['https://scrapinghub.com'] def parse(self, response): self.logger.info(u'\u8c03\u7528\u89e3\u6790\u51fd\u6570 %s', response.url) \u8fd9\u4e2alogger\u662f\u4f7f\u7528Spider\u540d\u79f0\u521b\u5efa\u7684\uff0c\u4f46\u662f\u60a8\u53ef\u4ee5\u4f7f\u7528\u4efb\u4f55\u60a8\u60f3\u8981\u7684\u5b9a\u5236Python logger\u3002\u4f8b\u5982: import logging import scrapy logger = logging.getLogger('mycustomlogger') class MySpider(scrapy.Spider): name = 'myspider' start_urls = ['https://scrapinghub.com'] def parse(self, response): logger.info(u'\u8c03\u7528\u89e3\u6790\u51fd\u6570 %s', response.url)","title":"Logging from Spiders"},{"location":"3. \u5185\u7f6e\u670d\u52a1/17-logging/#logging_1","text":"Loggers\u672c\u8eab\u65e0\u6cd5\u63a7\u5236\u901a\u8fc7\u5b83\u4eec\u53d1\u9001\u7684\u6d88\u606f\u662f\u5982\u4f55\u663e\u793a\u7684\u3002\u5bf9\u4e8e\u8fd9\u4e2a\u4efb\u52a1\uff0c\u4e0d\u540c\u7684\u201chandlers\u201d\u53ef\u4ee5\u9644\u52a0\u5230\u4efb\u4f55logger\u5b9e\u4f8b\uff0c\u5b83\u4eec\u4f1a\u5c06\u8fd9\u4e9b\u6d88\u606f\u91cd\u5b9a\u5411\u5230\u9002\u5f53\u7684\u76ee\u7684\u5730\uff0c\u6bd4\u5982\u6807\u51c6\u8f93\u51fa\u3001\u6587\u4ef6\u3001\u7535\u5b50\u90ae\u4ef6\u7b49\u3002 \u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u57fa\u4e8e\u4e0b\u9762\u7684\u8bbe\u7f6e\uff0cScrapy\u8bbe\u7f6e\u5e76\u914d\u7f6e\u6839logger\u7684handler\u3002","title":"Logging\u914d\u7f6e"},{"location":"3. \u5185\u7f6e\u670d\u52a1/17-logging/#logging_2","text":"\u8fd9\u4e9b\u8bbe\u7f6e\u53ef\u7528\u4e8e\u914d\u7f6elogging\uff1a LOG_FILE LOG_ENABLED LOG_ENCODING LOG_LEVEL LOG_FORMAT LOG_DATEFORMAT LOG_STDOUT LOG_SHORT_NAMES \u6700\u521d\u7684\u51e0\u4e2a\u8bbe\u7f6e\u5b9a\u4e49\u4e86\u65e5\u5fd7\u6d88\u606f\u7684\u76ee\u7684\u5730\u3002\u5982\u679c\u8bbe\u7f6e\u4e86 LOG_FILE \uff0c\u5219\u901a\u8fc7\u6839logger\u53d1\u9001\u7684\u6d88\u606f\u5c06\u88ab\u91cd\u5b9a\u5411\u5230\u4e00\u4e2a\u540d\u4e3a LOG_FILE \u7684\u6587\u4ef6\uff0c\u5e76\u4f7f\u7528\u7f16\u7801 LOG_ENCODING \u3002\u5982\u679cunset\u548c LOG_ENABLED \u662f True \uff0c\u90a3\u4e48\u65e5\u5fd7\u6d88\u606f\u5c06\u663e\u793a\u5728\u6807\u51c6\u9519\u8bef\u4e0a\u3002\u6700\u540e\uff0c\u5982\u679c LOG_ENABLED \u662f False \uff0c\u5c31\u4e0d\u4f1a\u6709\u4efb\u4f55\u53ef\u89c1\u7684\u65e5\u5fd7\u8f93\u51fa\u3002 LOG_LEVEL \u51b3\u5b9a\u663e\u793a\u7684\u6700\u4f4e\u7ea7\u522b\u7684\u4e25\u91cd\u6027\uff0c\u90a3\u4e9b\u8f83\u4f4e\u7ea7\u522b\u7684\u6d88\u606f\u5c06\u88ab\u8fc7\u6ee4\u6389\u3002\u5b83\u5305\u62ec\u5728 \u65e5\u5fd7\u7ea7\u522b \u4e2d\u5217\u51fa\u7684\u53ef\u80fd\u7ea7\u522b\u3002 LOG_FORMAT \u548c LOG_DATEFORMAT \u6307\u5b9a\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u4f5c\u4e3a\u6240\u6709\u6d88\u606f\u7684\u5e03\u5c40\u3002\u8fd9\u4e9b\u5b57\u7b26\u4e32\u53ef\u4ee5\u5305\u542b\u5728 \u65e5\u5fd7\u8bb0\u5f55\u7684\u65e5\u5fd7\u8bb0\u5f55\u5c5e\u6027\u6587\u6863 \u4e2d\u5217\u51fa\u7684\u4efb\u4f55\u5360\u4f4d\u7b26\uff0c\u5b83\u4eec\u5206\u522b\u662f datetime\u7684strftime\u548cstrptime\u6307\u4ee4 \u3002 \u5982\u679c\u8bbe\u7f6e\u4e86 LOG_SHORT_NAMES \uff0c\u90a3\u4e48\u65e5\u5fd7\u5c06\u4e0d\u4f1a\u663e\u793a\u6253\u5370\u65e5\u5fd7\u7684Scrapy\u7ec4\u4ef6\u3002It is unset by default\uff0c\u56e0\u6b64logs\u5305\u542b\u8d1f\u8d23\u8be5\u65e5\u5fd7\u8f93\u51fa\u7684Scrapy\u7ec4\u4ef6\u3002","title":"Logging\u8bbe\u7f6e"},{"location":"3. \u5185\u7f6e\u670d\u52a1/17-logging/#_1","text":"\u6709\u4e00\u4e9b\u547d\u4ee4\u884c\u53c2\u6570\u53ef\u4f9b\u6240\u6709\u547d\u4ee4\u4f7f\u7528\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u5b83\u6765\u8986\u76d6\u5173\u4e8e\u65e5\u5fd7\u8bb0\u5f55\u7684\u4e00\u4e9b\u526a\u8d34\u8bbe\u7f6e\u3002 --logfile FILE \u8986\u76d6 LOG_FILE --loglevel/-L LEVEL \u8986\u76d6 LOG_LEVEL --nolog \u8bbe\u7f6e LOG_ENABLED \u4e3a False \u8bf7\u53c2\u89c1 [logging.handlers](https://docs.python.org/2/library/logging.handlers.html)\u6a21\u5757 \u5173\u4e8e\u53ef\u7528handlers\u7684\u8fdb\u4e00\u6b65\u6587\u6863","title":"\u547d\u4ee4\u884c\u9009\u9879"},{"location":"3. \u5185\u7f6e\u670d\u52a1/17-logging/#_2","text":"\u56e0\u4e3aScrapy\u4f7f\u7528stdlib logging\u6a21\u5757\uff0c\u6240\u4ee5\u60a8\u53ef\u4ee5\u4f7f\u7528stdlib logging\u7684\u6240\u6709\u7279\u6027\u6765\u5b9a\u5236logging\u3002 \u4f8b\u5982\uff0c\u5047\u8bbe\u60a8\u6b63\u5728\u6293\u53d6\u4e00\u4e2a\u8fd4\u56de\u8bb8\u591aHTTP 404\u548c500\u54cd\u5e94\u7684\u7f51\u7ad9\uff0c\u60a8\u60f3\u8981\u9690\u85cf\u6240\u6709\u8fd9\u6837\u7684\u6d88\u606f\uff1a 2016-12-16 22:00:06 [scrapy.spidermiddlewares.httperror] INFO: Ignoring response 500 http://quotes.toscrape.com/page/1-34/ : HTTP status code is not handled or not allowed \u9996\u5148\u8981\u6ce8\u610f\u7684\u662flogger\u7684\u540d\u5b57 - \u5b83\u5728\u62ec\u53f7\u91cc\uff1a [scrapy.spidermiddlewares.httperror] \u3002\u5982\u679c\u4f60\u53ea\u5f97\u5230\u4e86 scrapy \uff0c\u90a3\u4e48 LOG_SHORT_NAMES \u5f88\u53ef\u80fd\u662fTrue;\u628a\u5b83\u8bbe\u7f6e\u4e3aFalse\uff0c\u7136\u540e\u91cd\u65b0\u8fd0\u884ccrawl\u3002 \u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6d88\u606f\u5177\u6709INFO\u7ea7\u522b\u3002\u4e3a\u4e86\u9690\u85cf\u5b83\uff0c\u6211\u4eec\u5e94\u8be5\u8bbe\u7f6e\u6bd4\u4fe1\u606f\u66f4\u9ad8\u7684 scrapy.spidermiddlewares.httperror \u7684\u65e5\u5fd7\u7ea7\u522b;\u4e0b\u4e00\u5c42\u4fe1\u606f\u662fWARNING\u3002\u53ef\u4ee5\u8fd9\u6837\u505a\uff0c\u4f8b\u5982\u5728spider\u7684 __init__ \u65b9\u6cd5\u4e2d\uff1a import logging import scrapy class MySpider(scrapy.Spider): # ... def __init__(self, *args, **kwargs): logger = logging.getLogger('scrapy.spidermiddlewares.httperror') logger.setLevel(logging.WARNING) super().__init__(*args, **kwargs) \u5982\u679c\u60a8\u518d\u6b21\u8fd0\u884c\u8fd9\u4e2aspider\uff0c\u90a3\u4e48\u6765\u81ea scrapy.spidermiddlewares.httperror \u7684logger\u7684\u4fe1\u606f\u5c06\u4f1a\u6d88\u5931\u3002","title":"\u9ad8\u7ea7\u5b9a\u5236"},{"location":"3. \u5185\u7f6e\u670d\u52a1/17-logging/#scrapyutilslog","text":"","title":"scrapy.utils.log\u6a21\u5757"},{"location":"3. \u5185\u7f6e\u670d\u52a1/17-logging/#scrapyutilslogconfigure_loggingsettingsnone-install_root_handlertrue-class","text":"\u521d\u59cb\u5316Scrapy\u7684logging\u9ed8\u8ba4\u503c\u3002 \u53c2\u6570: settings (\u5b57\u5178, Settings \u5bf9\u8c61\u6216\u8005 None ) \u2013 \u7528\u4e8e\u4e3a\u6839logger\u521b\u5efa\u548c\u914d\u7f6ehandler\u7684\u8bbe\u7f6e\uff08\u9ed8\u8ba4\uff1aNone\uff09\u3002 install_root_handler (\u5e03\u5c14\u7c7b\u578b) \u2013 \u662f\u5426\u8981\u5b89\u88c5\u6839logging handler\uff08\u9ed8\u8ba4\uff1aTrue\uff09 \u8fd9\u4e2a\u51fd\u6570: \u901a\u8fc7Python\u6807\u51c6\u65e5\u5fd7\u8bb0\u5f55\u8def\u7531\u8b66\u544a\u548ctwisted\u65e5\u5fd7\u8bb0\u5f55 \u5206\u522b\u4e3aScrapy\u548cTwisted loggers\u5206\u914dDEBUG\u548cERROR\u7ea7\u522b \u5982\u679cLOG_STDOUT\u8bbe\u7f6e\u4e3aTrue\uff0c\u5219\u5c06stdout\u8def\u7531\u5230\u65e5\u5fd7 \u5f53 install_root_handler \u4e3aTrue\uff08\u9ed8\u8ba4\uff09\u65f6\uff0c\u8fd9\u4e2a\u51fd\u6570\u4e5f\u4f1a\u6839\u636e\u7ed9\u5b9a\u7684\u8bbe\u7f6e\u4e3a\u6839logger\u521b\u5efa\u4e00\u4e2ahandler\uff08\u53c2\u89c1 Logging settings \uff09\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 settings \u53c2\u6570\u8986\u76d6\u9ed8\u8ba4\u9009\u9879\u3002\u5f53\u8bbe\u7f6e\u4e3a\u7a7a\u6216None\u65f6\uff0c\u4f1a\u4f7f\u7528\u9ed8\u8ba4\u503c\u3002 \u5728\u4f7f\u7528Scrapy\u547d\u4ee4\u65f6\uff0c\u4f1a\u81ea\u52a8\u8c03\u7528 configure_logging \uff0c\u4f46\u662f\u5728\u8fd0\u884c\u81ea\u5b9a\u4e49\u811a\u672c\u65f6\u9700\u8981\u663e\u5f0f\u5730\u8c03\u7528configure_logging\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5b83\u7684\u7528\u6cd5\u4e0d\u662f\u5fc5\u9700\u7684\uff0c\u4f46\u5b83\u662f\u63a8\u8350\u7684\u3002 \u5982\u679c\u60a8\u6253\u7b97\u81ea\u5df1\u914d\u7f6ehandlers\uff0c\u90a3\u4e48\u60a8\u4ecd\u7136\u5efa\u8bae\u60a8\u8c03\u7528\u8fd9\u4e2a\u51fd\u6570\uff0c\u4f20\u9012install_root_handler=False\u3002\u8bf7\u8bb0\u4f4f\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e0d\u4f1a\u8f93\u51fa\u4efb\u4f55\u65e5\u5fd7\u96c6\u3002 \u4e3a\u4e86\u8ba9\u60a8\u5f00\u59cb\u624b\u52a8\u914d\u7f6elogging\u7684\u8f93\u51fa\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 logging.basicConfig() \u6765\u8bbe\u7f6e\u57fa\u672croot handler\u3002\u8fd9\u662f\u4e00\u4e2a\u5173\u4e8e\u5982\u4f55\u5c06 INFO \u6216\u66f4\u9ad8\u6d88\u606f\u91cd\u5b9a\u5411\u5230\u6587\u4ef6\u7684\u793a\u4f8b\uff1a import logging from scrapy.utils.log import configure_logging configure_logging(install_root_handler=False) logging.basicConfig( filename='log.txt', format='%(levelname)s: %(message)s', level=logging.INFO ) \u4ece \u811a\u672c\u4e2d\u5f15\u7528Scrapy \u6765\u4e86\u89e3\u5173\u4e8e\u4f7f\u7528Scrapy\u7684\u66f4\u591a\u7ec6\u8282\u3002","title":"scrapy.utils.log.configure_logging(settings=None, install_root_handler=True)   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"3. \u5185\u7f6e\u670d\u52a1/18-stats-collection/","text":"Stats Collection(\u72b6\u6001\u6536\u96c6) Scrapy\u63d0\u4f9b\u4e86\u4e00\u4e2a\u4ee5\u952e/\u503c\u7684\u5f62\u5f0f\u6536\u96c6\u72b6\u6001\u7684\u65b9\u4fbf\u5de5\u5177\uff0c\u5176\u4e2d\u503c\u901a\u5e38\u662f\u8ba1\u6570\u5668\u3002\u8be5\u5de5\u5177\u88ab\u79f0\u4e3aStats Collector\uff0c\u53ef\u4ee5\u901a\u8fc7 Crawler API \u7684 stats \u5c5e\u6027\u8bbf\u95ee\u5b83\uff0c\u4e0b\u9762\u4e00\u8282\u4e2d\u5e38\u89c1\u7684 Stats Collector\u4f7f\u7528 \u7684\u4f8b\u5b50\u5c31\u8bf4\u660e\u4e86\u8fd9\u4e00\u70b9\u3002 \u4f46\u662f\uff0cStats Collector\u59cb\u7ec8\u662f\u53ef\u7528\u7684\uff0c\u56e0\u6b64\u60a8\u603b\u662f\u53ef\u4ee5\u5728\u6a21\u5757\u4e2d\u5bfc\u5165\u5b83\u5e76\u4f7f\u7528\u5b83\u7684API(\u7528\u4e8e\u9012\u589e\u6216\u8bbe\u7f6e\u65b0\u7684stat\u952e)\uff0c\u800c\u4e0d\u7ba1stats collection\u662f\u5426\u542f\u7528\u3002\u5982\u679c\u5b83\u88ab\u7981\u7528\uff0cAPI\u4ecd\u7136\u53ef\u4ee5\u5de5\u4f5c\uff0c\u4f46\u662f\u5b83\u4e0d\u4f1a\u6536\u96c6\u4efb\u4f55\u4e1c\u897f\u3002\u8fd9\u662f\u4e3a\u4e86\u7b80\u5316stats collector\u7684\u4f7f\u7528:\u5728spider\u3001Scrapy extension\u6216\u4f7f\u7528Stats Collector\u7684\u4efb\u4f55\u4ee3\u7801\u4e2d\uff0c\u60a8\u5e94\u8be5\u53ea\u4f7f\u7528\u4e00\u884c\u4ee3\u7801\u6765\u6536\u96c6stats\u3002 Stats Collector\u7684\u53e6\u4e00\u4e2a\u7279\u6027\u662f\uff0c\u542f\u7528\u65f6\u975e\u5e38\u9ad8\u6548(\u5728\u542f\u7528\u65f6)\uff0c\u7981\u7528\u65f6\u975e\u5e38\u9ad8\u6548(\u51e0\u4e4e\u4e0d\u9700\u8981\u6ce8\u610f)\u3002 Stats Collector\u4e3a\u6bcf\u4e2a\u6253\u5f00\u7684spider\u4fdd\u7559\u4e00\u4e2astats\u8868\uff0c\u5728spider\u6253\u5f00\u65f6\u81ea\u52a8\u6253\u5f00\uff0c\u5728spider\u5173\u95ed\u65f6\u5173\u95ed\u3002 \u4f7f\u7528\u5e38\u7528\u7684Stats Collector \u901a\u8fc7 stats \u5c5e\u6027\u8bbf\u95eestats collector\u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u8bbf\u95ee\u7edf\u8ba1\u6570\u636e\u7684\u6269\u5c55\u793a\u4f8b: class ExtensionThatAccessStats(object): def __init__(self, stats): self.stats = stats @classmethod def from_crawler(cls, crawler): return cls(crawler.stats) \u8bbe\u7f6estat\u7684\u503c stats.set_value('hostname', socket.gethostname()) \u589e\u52a0stat\u7684\u503c stats.inc_value('custom_count') \u53ea\u6709\u5728\u5927\u4e8e\u4e4b\u524d\u7684\u503c\u65f6\u624d\u8bbe\u7f6estat\u503c: stats.max_value('max_items_scraped', value) \u53ea\u6709\u5728\u4f4e\u4e8e\u4e4b\u524d\u7684\u503c\u65f6\u624d\u8bbe\u7f6estat\u503c: stats.min_value('min_free_memory_percent', value) \u83b7\u5f97stat\u7684\u503c stats.get_value('custom_count') 1 \u5f97\u5230\u6240\u6709stat stats.get_stats() {'custom_count': 1, 'start_time': datetime.datetime(2009, 7, 14, 21, 47, 28, 977139)} \u53ef\u7528\u7684Stats Collectors \u9664\u4e86\u57fa\u672c\u7684 StatsCollector \uff0c\u5728Scrapy\u4e2d\u8fd8\u6709\u5176\u4ed6\u7684StaStats Collectors\u53ef\u4ee5\u6269\u5c55\u57fa\u672c\u7684Stats Collector\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7 STATS_CLASS setting\u9009\u62e9\u4f7f\u7528\u54ea\u4e2aStats Collector\u3002\u9ed8\u8ba4\u7684Stats Collector\u662f MemoryStatsCollector \u3002 MemoryStatsCollector scrapy.statscollectors.MemoryStatsCollector \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) \u4e00\u4e2a\u7b80\u5355\u7684stats collector\uff0c\u5b83\u5728\u6bcf\u6b21\u6293\u53d6(\u5bf9\u4e8e\u6bcf\u4e2aspider)\u7ed3\u675f\u540e\uff0c\u5c06\u6700\u540e\u4e00\u6b21\u6293\u53d6\u8fd0\u884c\u7684stats\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\u3002\u53ef\u4ee5\u901a\u8fc7 spider_stats \u5c5e\u6027\u8bbf\u95ee\u8fd9\u4e9bstats\uff0c\u5b83\u662f\u7531spider domain\u540d\u5b57\u4f5c\u4e3a\u952e\u7684\u4e00\u4e2a\u5b57\u5178\u3002 \u8fd9\u662fScrapy\u4e2d\u4f7f\u7528\u7684\u9ed8\u8ba4Stats Collector\u3002 spider_stats \u4e00\u4e2adicts(\u7531spider\u540d\u5b57\u4f5c\u4e3a\u952e)\uff0c\u5305\u542b\u6bcf\u4e2aspider\u6700\u540e\u4e00\u6b21\u6293\u53d6\u8fd0\u884c\u7684stats\u3002 DummyStatsCollector scrapy.statscollectors.DummyStatsCollector \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) \u4e00\u4e2a\u7edf\u8ba1\u6536\u96c6\u5668\u4ec0\u4e48\u4e5f\u4e0d\u505a\uff0c\u4f46\u662f\u975e\u5e38\u9ad8\u6548(\u56e0\u4e3a\u5b83\u4ec0\u4e48\u4e5f\u4e0d\u505a)\u3002\u8fd9\u4e2astats collector\u53ef\u4ee5\u901a\u8fc7 STATS_CLASS setting\u6765\u8bbe\u7f6e\uff0c\u4ee5\u7981\u7528stats collect\uff0c\u4ee5\u63d0\u9ad8\u6027\u80fd\u3002\u7136\u800c\uff0c\u4e0e\u89e3\u6790\u9875\u9762\u7b49\u7e41\u91cd\u7684Scrapy\u5de5\u4f5c\u76f8\u6bd4\uff0cstats collection\u7684\u6027\u80fd\u635f\u5931\u901a\u5e38\u5fae\u4e0d\u8db3\u9053\u3002","title":"Stats Collection(\u72b6\u6001\u6536\u96c6)"},{"location":"3. \u5185\u7f6e\u670d\u52a1/18-stats-collection/#stats-collection","text":"Scrapy\u63d0\u4f9b\u4e86\u4e00\u4e2a\u4ee5\u952e/\u503c\u7684\u5f62\u5f0f\u6536\u96c6\u72b6\u6001\u7684\u65b9\u4fbf\u5de5\u5177\uff0c\u5176\u4e2d\u503c\u901a\u5e38\u662f\u8ba1\u6570\u5668\u3002\u8be5\u5de5\u5177\u88ab\u79f0\u4e3aStats Collector\uff0c\u53ef\u4ee5\u901a\u8fc7 Crawler API \u7684 stats \u5c5e\u6027\u8bbf\u95ee\u5b83\uff0c\u4e0b\u9762\u4e00\u8282\u4e2d\u5e38\u89c1\u7684 Stats Collector\u4f7f\u7528 \u7684\u4f8b\u5b50\u5c31\u8bf4\u660e\u4e86\u8fd9\u4e00\u70b9\u3002 \u4f46\u662f\uff0cStats Collector\u59cb\u7ec8\u662f\u53ef\u7528\u7684\uff0c\u56e0\u6b64\u60a8\u603b\u662f\u53ef\u4ee5\u5728\u6a21\u5757\u4e2d\u5bfc\u5165\u5b83\u5e76\u4f7f\u7528\u5b83\u7684API(\u7528\u4e8e\u9012\u589e\u6216\u8bbe\u7f6e\u65b0\u7684stat\u952e)\uff0c\u800c\u4e0d\u7ba1stats collection\u662f\u5426\u542f\u7528\u3002\u5982\u679c\u5b83\u88ab\u7981\u7528\uff0cAPI\u4ecd\u7136\u53ef\u4ee5\u5de5\u4f5c\uff0c\u4f46\u662f\u5b83\u4e0d\u4f1a\u6536\u96c6\u4efb\u4f55\u4e1c\u897f\u3002\u8fd9\u662f\u4e3a\u4e86\u7b80\u5316stats collector\u7684\u4f7f\u7528:\u5728spider\u3001Scrapy extension\u6216\u4f7f\u7528Stats Collector\u7684\u4efb\u4f55\u4ee3\u7801\u4e2d\uff0c\u60a8\u5e94\u8be5\u53ea\u4f7f\u7528\u4e00\u884c\u4ee3\u7801\u6765\u6536\u96c6stats\u3002 Stats Collector\u7684\u53e6\u4e00\u4e2a\u7279\u6027\u662f\uff0c\u542f\u7528\u65f6\u975e\u5e38\u9ad8\u6548(\u5728\u542f\u7528\u65f6)\uff0c\u7981\u7528\u65f6\u975e\u5e38\u9ad8\u6548(\u51e0\u4e4e\u4e0d\u9700\u8981\u6ce8\u610f)\u3002 Stats Collector\u4e3a\u6bcf\u4e2a\u6253\u5f00\u7684spider\u4fdd\u7559\u4e00\u4e2astats\u8868\uff0c\u5728spider\u6253\u5f00\u65f6\u81ea\u52a8\u6253\u5f00\uff0c\u5728spider\u5173\u95ed\u65f6\u5173\u95ed\u3002","title":"Stats Collection(\u72b6\u6001\u6536\u96c6)"},{"location":"3. \u5185\u7f6e\u670d\u52a1/18-stats-collection/#stats-collector","text":"\u901a\u8fc7 stats \u5c5e\u6027\u8bbf\u95eestats collector\u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u8bbf\u95ee\u7edf\u8ba1\u6570\u636e\u7684\u6269\u5c55\u793a\u4f8b: class ExtensionThatAccessStats(object): def __init__(self, stats): self.stats = stats @classmethod def from_crawler(cls, crawler): return cls(crawler.stats) \u8bbe\u7f6estat\u7684\u503c stats.set_value('hostname', socket.gethostname()) \u589e\u52a0stat\u7684\u503c stats.inc_value('custom_count') \u53ea\u6709\u5728\u5927\u4e8e\u4e4b\u524d\u7684\u503c\u65f6\u624d\u8bbe\u7f6estat\u503c: stats.max_value('max_items_scraped', value) \u53ea\u6709\u5728\u4f4e\u4e8e\u4e4b\u524d\u7684\u503c\u65f6\u624d\u8bbe\u7f6estat\u503c: stats.min_value('min_free_memory_percent', value) \u83b7\u5f97stat\u7684\u503c stats.get_value('custom_count') 1 \u5f97\u5230\u6240\u6709stat stats.get_stats() {'custom_count': 1, 'start_time': datetime.datetime(2009, 7, 14, 21, 47, 28, 977139)}","title":"\u4f7f\u7528\u5e38\u7528\u7684Stats Collector"},{"location":"3. \u5185\u7f6e\u670d\u52a1/18-stats-collection/#stats-collectors","text":"\u9664\u4e86\u57fa\u672c\u7684 StatsCollector \uff0c\u5728Scrapy\u4e2d\u8fd8\u6709\u5176\u4ed6\u7684StaStats Collectors\u53ef\u4ee5\u6269\u5c55\u57fa\u672c\u7684Stats Collector\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7 STATS_CLASS setting\u9009\u62e9\u4f7f\u7528\u54ea\u4e2aStats Collector\u3002\u9ed8\u8ba4\u7684Stats Collector\u662f MemoryStatsCollector \u3002","title":"\u53ef\u7528\u7684Stats Collectors"},{"location":"3. \u5185\u7f6e\u670d\u52a1/18-stats-collection/#memorystatscollector","text":"","title":"MemoryStatsCollector"},{"location":"3. \u5185\u7f6e\u670d\u52a1/18-stats-collection/#scrapystatscollectorsmemorystatscollector-class","text":"\u4e00\u4e2a\u7b80\u5355\u7684stats collector\uff0c\u5b83\u5728\u6bcf\u6b21\u6293\u53d6(\u5bf9\u4e8e\u6bcf\u4e2aspider)\u7ed3\u675f\u540e\uff0c\u5c06\u6700\u540e\u4e00\u6b21\u6293\u53d6\u8fd0\u884c\u7684stats\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\u3002\u53ef\u4ee5\u901a\u8fc7 spider_stats \u5c5e\u6027\u8bbf\u95ee\u8fd9\u4e9bstats\uff0c\u5b83\u662f\u7531spider domain\u540d\u5b57\u4f5c\u4e3a\u952e\u7684\u4e00\u4e2a\u5b57\u5178\u3002 \u8fd9\u662fScrapy\u4e2d\u4f7f\u7528\u7684\u9ed8\u8ba4Stats Collector\u3002 spider_stats \u4e00\u4e2adicts(\u7531spider\u540d\u5b57\u4f5c\u4e3a\u952e)\uff0c\u5305\u542b\u6bcf\u4e2aspider\u6700\u540e\u4e00\u6b21\u6293\u53d6\u8fd0\u884c\u7684stats\u3002","title":"scrapy.statscollectors.MemoryStatsCollector   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"3. \u5185\u7f6e\u670d\u52a1/18-stats-collection/#dummystatscollector","text":"","title":"DummyStatsCollector"},{"location":"3. \u5185\u7f6e\u670d\u52a1/18-stats-collection/#scrapystatscollectorsdummystatscollector-class","text":"\u4e00\u4e2a\u7edf\u8ba1\u6536\u96c6\u5668\u4ec0\u4e48\u4e5f\u4e0d\u505a\uff0c\u4f46\u662f\u975e\u5e38\u9ad8\u6548(\u56e0\u4e3a\u5b83\u4ec0\u4e48\u4e5f\u4e0d\u505a)\u3002\u8fd9\u4e2astats collector\u53ef\u4ee5\u901a\u8fc7 STATS_CLASS setting\u6765\u8bbe\u7f6e\uff0c\u4ee5\u7981\u7528stats collect\uff0c\u4ee5\u63d0\u9ad8\u6027\u80fd\u3002\u7136\u800c\uff0c\u4e0e\u89e3\u6790\u9875\u9762\u7b49\u7e41\u91cd\u7684Scrapy\u5de5\u4f5c\u76f8\u6bd4\uff0cstats collection\u7684\u6027\u80fd\u635f\u5931\u901a\u5e38\u5fae\u4e0d\u8db3\u9053\u3002","title":"scrapy.statscollectors.DummyStatsCollector   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"3. \u5185\u7f6e\u670d\u52a1/19-send-email/","text":"Sending e-mail(\u53d1\u9001\u4e00\u4e2a\u90ae\u4ef6) \u867d\u7136Python\u4f7f\u901a\u8fc7 smtplib \u5e93\u53d1\u9001\u7535\u5b50\u90ae\u4ef6\u76f8\u5bf9\u5bb9\u6613\uff0c\u4f46Scrapy\u63d0\u4f9b\u4e86\u81ea\u5df1\u7684\u7535\u5b50\u90ae\u4ef6\u53d1\u9001\u529f\u80fd\uff0c\u4f7f\u7528\u8d77\u6765\u975e\u5e38\u7b80\u5355\uff0c\u5e76\u4e14\u4f7f\u7528 Twisted\u975e\u963b\u585eIO \u5b9e\u73b0\uff0c\u4ee5\u907f\u514d\u5e72\u6270\u722c\u866b\u7a0b\u5e8f\u7684\u975e\u963b\u585eIO\u3002\u5b83\u8fd8\u4e3a\u53d1\u9001\u9644\u4ef6\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7b80\u5355\u7684API\uff0c\u5e76\u4e14\u975e\u5e38\u5bb9\u6613\u914d\u7f6e\uff0c\u53ea\u6709\u51e0\u4e2a settings \u3002 \u7b80\u5355\u7684\u4f8b\u5b50 \u6709\u4e24\u79cd\u65b9\u6cd5\u53ef\u4ee5\u5b9e\u4f8b\u5316\u90ae\u4ef6\u53d1\u9001\u65b9\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u6807\u51c6\u6784\u9020\u51fd\u6570\u5b9e\u4f8b\u5316\u5b83: from scrapy.mail import MailSender mailer = MailSender() \u6216\u8005\u4f60\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e2aScrapy settings\u5bf9\u8c61\u6765\u5b9e\u4f8b\u5316\u5b83\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u4f1a\u5c0a\u91cd settings : mailer = MailSender.from_settings(settings) \u4e0b\u9762\u662f\u5982\u4f55\u4f7f\u7528\u5b83\u53d1\u9001\u7535\u5b50\u90ae\u4ef6(\u6ca1\u6709\u9644\u4ef6): mailer.send( to=[ someone@example.com ], subject= Some subject , body= Some body , cc=[ another@example.com ] ) MailSender\u7c7b\u5f15\u7528 MailSender\u662f\u4eceScrapy\u53d1\u9001\u7535\u5b50\u90ae\u4ef6\u7684\u9996\u9009\u7c7b\uff0c\u56e0\u4e3a\u5b83\u4f7f\u7528\u4e86 Twisted\u975e\u963b\u585eIO \uff0c\u5c31\u50cf\u6846\u67b6\u7684\u5176\u4ed6\u90e8\u5206\u4e00\u6837\u3002 scrapy.mail.MailSender(smtphost=None, mailfrom=None, smtpuser=None, smtppass=None, smtpport=None) \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) \u53c2\u6570 smtphost (\u5b57\u7b26\u4e32\u6216bytes) \u2013 \u7528\u4e8e\u53d1\u9001\u7535\u5b50\u90ae\u4ef6\u7684SMTP\u4e3b\u673a\u3002\u5982\u679c\u7701\u7565\uff0c\u5c06\u4f7f\u7528 MAIL_HOST settings\u3002 mailfrom (\u5b57\u7b26\u4e32) \u2013 \u7528\u4e8e\u53d1\u9001\u7535\u5b50\u90ae\u4ef6\u7684\u5730\u5740(\u5728 From: header\u4e2d)\u3002\u5982\u679c\u7701\u7565\uff0c\u5c06\u4f7f\u7528 MAIL_FROM settings\u3002 smtpuser \u2013 SMTP\u7528\u6237\u3002\u5982\u679c\u7701\u7565\uff0c\u5c06\u4f7f\u7528 MAIL_USER settings\u3002\u5982\u679c\u6ca1\u6709\u6307\u5b9a\uff0c\u5219\u4e0d\u4f1a\u6267\u884cSMTP\u8eab\u4efd\u9a8c\u8bc1\u3002 smtppass (\u5b57\u7b26\u4e32\u6216bytes) \u2013 \u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u7684SMTP\u5bc6\u7801 smtpport (int) \u2013 \u8981\u8fde\u63a5\u7684SMTP\u7aef\u53e3 smtptls (\u5e03\u5c14\u7c7b\u578b) \u2013 \u5f3a\u5236\u4f7f\u7528SMTP STARTTLS smtpssl (\u5e03\u5c14\u7c7b\u578b) \u2013 \u5f3a\u5236\u4f7f\u7528\u5b89\u5168SSL\u8fde\u63a5 from_settings(settings) \u7c7b\u65b9\u6cd5(classmethod) \u4f7f\u7528\u4e00\u4e2aScrapy settings\u5bf9\u8c61\u5b9e\u4f8b\u5316\uff0c\u8be5\u5bf9\u8c61\u5c06\u5c0a\u91cd \u8fd9\u4e9bScrapy settings \u53c2\u6570 settings ( scrapy.settings.Settings \u5bf9\u8c61) \u2013 \u7535\u5b50\u90ae\u4ef6\u6536\u4ef6\u4eba send(to, subject, body, cc=None, attachs=(), mimetype='text/plain', charset=None) \u5411\u6307\u5b9a\u7684\u6536\u4ef6\u4eba\u53d1\u9001\u7535\u5b50\u90ae\u4ef6\u3002 \u53c2\u6570: to (\u5b57\u7b26\u4e32\u6216\u5b57\u7b26\u4e32\u5217\u8868) \u2013 \u7535\u5b50\u90ae\u4ef6\u6536\u4ef6\u4eba subject (\u5b57\u7b26\u4e32) \u2013 \u7535\u5b50\u90ae\u4ef6\u7684\u4e3b\u9898 cc (\u5b57\u7b26\u4e32\u6216\u5b57\u7b26\u4e32\u5217\u8868) \u2013 \u7ed9CC\u7684\u90ae\u4ef6 body (\u5b57\u7b26\u4e32) \u2013 \u7535\u5b50\u90ae\u4ef6\u7684\u5185\u5bb9 attachs (\u53ef\u8fed\u4ee3) \u2013 \u53ef\u8fed\u4ee3\u7684\u5143\u7ec4 (attach_name, mimetype, file_object) attach_name \u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u8be5\u5b57\u7b26\u4e32\u7684\u540d\u79f0\u5c06\u51fa\u73b0\u5728\u7535\u5b50\u90ae\u4ef6\u7684\u9644\u4ef6\u4e2d\uff0c mimetype \u662f\u9644\u4ef6\u7684mimetype, file_object \u662f\u4e00\u4e2a\u5177\u6709\u9644\u4ef6\u5185\u5bb9\u7684\u53ef\u8bfb\u6587\u4ef6\u5bf9\u8c61 mimetype (\u5b57\u7b26\u4e32) \u2013 \u7535\u5b50\u90ae\u4ef6\u7684MIME\u7c7b\u578b charset (\u5b57\u7b26\u4e32) \u2013 \u7528\u4e8e\u7535\u5b50\u90ae\u4ef6\u5185\u5bb9\u7684\u5b57\u7b26\u7f16\u7801 Mail settings \u8fd9\u4e9bsettings\u5b9a\u4e49\u4e86 MailSender \u7c7b\u7684\u9ed8\u8ba4\u6784\u9020\u51fd\u6570\u503c\uff0c\u53ef\u7528\u4e8e\u5728\u9879\u76ee\u4e2d\u914d\u7f6e\u7535\u5b50\u90ae\u4ef6\u901a\u77e5\uff0c\u800c\u65e0\u9700\u7f16\u5199\u4efb\u4f55\u4ee3\u7801(\u7528\u4e8e\u90a3\u4e9b\u4f7f\u7528 MailSender \u7684\u6269\u5c55\u548c\u4ee3\u7801)\u3002 MAIL_FROM \u9ed8\u8ba4: 'scrapy@localhost' \u53d1\u4ef6\u4eba\u7535\u5b50\u90ae\u4ef6\u4f7f\u7528( From: : header)\u53d1\u9001\u7535\u5b50\u90ae\u4ef6\u3002 MAIL_HOST \u9ed8\u8ba4: 'localhost' \u7528\u4e8e\u53d1\u9001\u7535\u5b50\u90ae\u4ef6\u7684SMTP\u4e3b\u673a\u3002 MAIL_PORT \u9ed8\u8ba4: 25 \u7528\u4e8e\u53d1\u9001\u7535\u5b50\u90ae\u4ef6\u7684SMTP\u7aef\u53e3\u3002 MAIL_USER \u9ed8\u8ba4: None \u7528\u4e8eSMTP\u8eab\u4efd\u9a8c\u8bc1\u7684\u7528\u6237\u3002\u5982\u679c\u7981\u7528\uff0c\u5219\u4e0d\u6267\u884cSMTP\u8eab\u4efd\u9a8c\u8bc1\u3002 MAIL_PASS \u9ed8\u8ba4: None \u7528\u4e8eSMTP\u8eab\u4efd\u9a8c\u8bc1\u7684\u5bc6\u7801\uff0c\u4ee5\u53ca MAIL_USER \u3002 MAIL_TLS \u9ed8\u8ba4: False \u5f3a\u5236\u4f7f\u7528STARTTLS. STARTTLS\u662f\u5c06\u73b0\u6709\u7684\u4e0d\u5b89\u5168\u8fde\u63a5\u5347\u7ea7\u4e3a\u4f7f\u7528SSL/TLS\u7684\u5b89\u5168\u8fde\u63a5\u7684\u4e00\u79cd\u65b9\u6cd5\u3002 MAIL_SSL \u9ed8\u8ba4: False \u4f7f\u7528SSL\u52a0\u5bc6\u7684\u8fde\u63a5\u5f3a\u5236\u8fde\u63a5","title":"Sending e-mail(\u53d1\u9001\u4e00\u4e2a\u90ae\u4ef6)"},{"location":"3. \u5185\u7f6e\u670d\u52a1/19-send-email/#sending-e-mail","text":"\u867d\u7136Python\u4f7f\u901a\u8fc7 smtplib \u5e93\u53d1\u9001\u7535\u5b50\u90ae\u4ef6\u76f8\u5bf9\u5bb9\u6613\uff0c\u4f46Scrapy\u63d0\u4f9b\u4e86\u81ea\u5df1\u7684\u7535\u5b50\u90ae\u4ef6\u53d1\u9001\u529f\u80fd\uff0c\u4f7f\u7528\u8d77\u6765\u975e\u5e38\u7b80\u5355\uff0c\u5e76\u4e14\u4f7f\u7528 Twisted\u975e\u963b\u585eIO \u5b9e\u73b0\uff0c\u4ee5\u907f\u514d\u5e72\u6270\u722c\u866b\u7a0b\u5e8f\u7684\u975e\u963b\u585eIO\u3002\u5b83\u8fd8\u4e3a\u53d1\u9001\u9644\u4ef6\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7b80\u5355\u7684API\uff0c\u5e76\u4e14\u975e\u5e38\u5bb9\u6613\u914d\u7f6e\uff0c\u53ea\u6709\u51e0\u4e2a settings \u3002","title":"Sending e-mail(\u53d1\u9001\u4e00\u4e2a\u90ae\u4ef6)"},{"location":"3. \u5185\u7f6e\u670d\u52a1/19-send-email/#_1","text":"\u6709\u4e24\u79cd\u65b9\u6cd5\u53ef\u4ee5\u5b9e\u4f8b\u5316\u90ae\u4ef6\u53d1\u9001\u65b9\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u6807\u51c6\u6784\u9020\u51fd\u6570\u5b9e\u4f8b\u5316\u5b83: from scrapy.mail import MailSender mailer = MailSender() \u6216\u8005\u4f60\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e2aScrapy settings\u5bf9\u8c61\u6765\u5b9e\u4f8b\u5316\u5b83\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u4f1a\u5c0a\u91cd settings : mailer = MailSender.from_settings(settings) \u4e0b\u9762\u662f\u5982\u4f55\u4f7f\u7528\u5b83\u53d1\u9001\u7535\u5b50\u90ae\u4ef6(\u6ca1\u6709\u9644\u4ef6): mailer.send( to=[ someone@example.com ], subject= Some subject , body= Some body , cc=[ another@example.com ] )","title":"\u7b80\u5355\u7684\u4f8b\u5b50"},{"location":"3. \u5185\u7f6e\u670d\u52a1/19-send-email/#mailsender","text":"MailSender\u662f\u4eceScrapy\u53d1\u9001\u7535\u5b50\u90ae\u4ef6\u7684\u9996\u9009\u7c7b\uff0c\u56e0\u4e3a\u5b83\u4f7f\u7528\u4e86 Twisted\u975e\u963b\u585eIO \uff0c\u5c31\u50cf\u6846\u67b6\u7684\u5176\u4ed6\u90e8\u5206\u4e00\u6837\u3002","title":"MailSender\u7c7b\u5f15\u7528"},{"location":"3. \u5185\u7f6e\u670d\u52a1/19-send-email/#scrapymailmailsendersmtphostnone-mailfromnone-smtpusernone-smtppassnone-smtpportnone-class","text":"\u53c2\u6570 smtphost (\u5b57\u7b26\u4e32\u6216bytes) \u2013 \u7528\u4e8e\u53d1\u9001\u7535\u5b50\u90ae\u4ef6\u7684SMTP\u4e3b\u673a\u3002\u5982\u679c\u7701\u7565\uff0c\u5c06\u4f7f\u7528 MAIL_HOST settings\u3002 mailfrom (\u5b57\u7b26\u4e32) \u2013 \u7528\u4e8e\u53d1\u9001\u7535\u5b50\u90ae\u4ef6\u7684\u5730\u5740(\u5728 From: header\u4e2d)\u3002\u5982\u679c\u7701\u7565\uff0c\u5c06\u4f7f\u7528 MAIL_FROM settings\u3002 smtpuser \u2013 SMTP\u7528\u6237\u3002\u5982\u679c\u7701\u7565\uff0c\u5c06\u4f7f\u7528 MAIL_USER settings\u3002\u5982\u679c\u6ca1\u6709\u6307\u5b9a\uff0c\u5219\u4e0d\u4f1a\u6267\u884cSMTP\u8eab\u4efd\u9a8c\u8bc1\u3002 smtppass (\u5b57\u7b26\u4e32\u6216bytes) \u2013 \u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u7684SMTP\u5bc6\u7801 smtpport (int) \u2013 \u8981\u8fde\u63a5\u7684SMTP\u7aef\u53e3 smtptls (\u5e03\u5c14\u7c7b\u578b) \u2013 \u5f3a\u5236\u4f7f\u7528SMTP STARTTLS smtpssl (\u5e03\u5c14\u7c7b\u578b) \u2013 \u5f3a\u5236\u4f7f\u7528\u5b89\u5168SSL\u8fde\u63a5 from_settings(settings) \u7c7b\u65b9\u6cd5(classmethod) \u4f7f\u7528\u4e00\u4e2aScrapy settings\u5bf9\u8c61\u5b9e\u4f8b\u5316\uff0c\u8be5\u5bf9\u8c61\u5c06\u5c0a\u91cd \u8fd9\u4e9bScrapy settings \u53c2\u6570 settings ( scrapy.settings.Settings \u5bf9\u8c61) \u2013 \u7535\u5b50\u90ae\u4ef6\u6536\u4ef6\u4eba send(to, subject, body, cc=None, attachs=(), mimetype='text/plain', charset=None) \u5411\u6307\u5b9a\u7684\u6536\u4ef6\u4eba\u53d1\u9001\u7535\u5b50\u90ae\u4ef6\u3002 \u53c2\u6570: to (\u5b57\u7b26\u4e32\u6216\u5b57\u7b26\u4e32\u5217\u8868) \u2013 \u7535\u5b50\u90ae\u4ef6\u6536\u4ef6\u4eba subject (\u5b57\u7b26\u4e32) \u2013 \u7535\u5b50\u90ae\u4ef6\u7684\u4e3b\u9898 cc (\u5b57\u7b26\u4e32\u6216\u5b57\u7b26\u4e32\u5217\u8868) \u2013 \u7ed9CC\u7684\u90ae\u4ef6 body (\u5b57\u7b26\u4e32) \u2013 \u7535\u5b50\u90ae\u4ef6\u7684\u5185\u5bb9 attachs (\u53ef\u8fed\u4ee3) \u2013 \u53ef\u8fed\u4ee3\u7684\u5143\u7ec4 (attach_name, mimetype, file_object) attach_name \u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u8be5\u5b57\u7b26\u4e32\u7684\u540d\u79f0\u5c06\u51fa\u73b0\u5728\u7535\u5b50\u90ae\u4ef6\u7684\u9644\u4ef6\u4e2d\uff0c mimetype \u662f\u9644\u4ef6\u7684mimetype, file_object \u662f\u4e00\u4e2a\u5177\u6709\u9644\u4ef6\u5185\u5bb9\u7684\u53ef\u8bfb\u6587\u4ef6\u5bf9\u8c61 mimetype (\u5b57\u7b26\u4e32) \u2013 \u7535\u5b50\u90ae\u4ef6\u7684MIME\u7c7b\u578b charset (\u5b57\u7b26\u4e32) \u2013 \u7528\u4e8e\u7535\u5b50\u90ae\u4ef6\u5185\u5bb9\u7684\u5b57\u7b26\u7f16\u7801","title":"scrapy.mail.MailSender(smtphost=None, mailfrom=None, smtpuser=None, smtppass=None, smtpport=None)   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"3. \u5185\u7f6e\u670d\u52a1/19-send-email/#mail-settings","text":"\u8fd9\u4e9bsettings\u5b9a\u4e49\u4e86 MailSender \u7c7b\u7684\u9ed8\u8ba4\u6784\u9020\u51fd\u6570\u503c\uff0c\u53ef\u7528\u4e8e\u5728\u9879\u76ee\u4e2d\u914d\u7f6e\u7535\u5b50\u90ae\u4ef6\u901a\u77e5\uff0c\u800c\u65e0\u9700\u7f16\u5199\u4efb\u4f55\u4ee3\u7801(\u7528\u4e8e\u90a3\u4e9b\u4f7f\u7528 MailSender \u7684\u6269\u5c55\u548c\u4ee3\u7801)\u3002","title":"Mail settings"},{"location":"3. \u5185\u7f6e\u670d\u52a1/19-send-email/#mail_from","text":"\u9ed8\u8ba4: 'scrapy@localhost' \u53d1\u4ef6\u4eba\u7535\u5b50\u90ae\u4ef6\u4f7f\u7528( From: : header)\u53d1\u9001\u7535\u5b50\u90ae\u4ef6\u3002","title":"MAIL_FROM"},{"location":"3. \u5185\u7f6e\u670d\u52a1/19-send-email/#mail_host","text":"\u9ed8\u8ba4: 'localhost' \u7528\u4e8e\u53d1\u9001\u7535\u5b50\u90ae\u4ef6\u7684SMTP\u4e3b\u673a\u3002","title":"MAIL_HOST"},{"location":"3. \u5185\u7f6e\u670d\u52a1/19-send-email/#mail_port","text":"\u9ed8\u8ba4: 25 \u7528\u4e8e\u53d1\u9001\u7535\u5b50\u90ae\u4ef6\u7684SMTP\u7aef\u53e3\u3002","title":"MAIL_PORT"},{"location":"3. \u5185\u7f6e\u670d\u52a1/19-send-email/#mail_user","text":"\u9ed8\u8ba4: None \u7528\u4e8eSMTP\u8eab\u4efd\u9a8c\u8bc1\u7684\u7528\u6237\u3002\u5982\u679c\u7981\u7528\uff0c\u5219\u4e0d\u6267\u884cSMTP\u8eab\u4efd\u9a8c\u8bc1\u3002","title":"MAIL_USER"},{"location":"3. \u5185\u7f6e\u670d\u52a1/19-send-email/#mail_pass","text":"\u9ed8\u8ba4: None \u7528\u4e8eSMTP\u8eab\u4efd\u9a8c\u8bc1\u7684\u5bc6\u7801\uff0c\u4ee5\u53ca MAIL_USER \u3002","title":"MAIL_PASS"},{"location":"3. \u5185\u7f6e\u670d\u52a1/19-send-email/#mail_tls","text":"\u9ed8\u8ba4: False \u5f3a\u5236\u4f7f\u7528STARTTLS. STARTTLS\u662f\u5c06\u73b0\u6709\u7684\u4e0d\u5b89\u5168\u8fde\u63a5\u5347\u7ea7\u4e3a\u4f7f\u7528SSL/TLS\u7684\u5b89\u5168\u8fde\u63a5\u7684\u4e00\u79cd\u65b9\u6cd5\u3002","title":"MAIL_TLS"},{"location":"3. \u5185\u7f6e\u670d\u52a1/19-send-email/#mail_ssl","text":"\u9ed8\u8ba4: False \u4f7f\u7528SSL\u52a0\u5bc6\u7684\u8fde\u63a5\u5f3a\u5236\u8fde\u63a5","title":"MAIL_SSL"},{"location":"3. \u5185\u7f6e\u670d\u52a1/20-telnet-console/","text":"Telnet Console(Telnet\u63a7\u5236\u53f0) Scrapy\u9644\u5e26\u4e00\u4e2a\u5185\u7f6e\u7684telnet console\uff0c\u7528\u4e8e\u68c0\u67e5\u548c\u63a7\u5236\u4e00\u4e2aScrapy\u8fd0\u884c\u8fc7\u7a0b\u3002telnet console\u53ea\u662f\u5728Scrapy\u8fdb\u7a0b\u5185\u90e8\u8fd0\u884c\u7684\u4e00\u4e2a\u5e38\u89c4python shell\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u4ece\u5b83\u505a\u4efb\u4f55\u4e8b\u60c5\u3002 telnet console\u662f\u4e00\u4e2a \u5185\u7f6e\u7684Scrapy\u6269\u5c55 \uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u542f\u7528\u7684\uff0c\u4f46\u5982\u679c\u9700\u8981\uff0c\u4e5f\u53ef\u4ee5\u7981\u7528\u5b83\u3002\u6709\u5173\u6269\u5c55\u672c\u8eab\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Telnet console\u6269\u5c55 \u3002 \u5982\u4f55\u8bbf\u95eetelnet console telnet console\u76d1\u542c TELNETCONSOLE_PORT setting\u4e2d\u5b9a\u4e49\u7684TCP\u7aef\u53e3\uff0c\u8be5\u8bbe\u7f6e\u9ed8\u8ba4\u4e3a 6023 \u3002\u8981\u8bbf\u95ee\u63a7\u5236\u53f0\uff0c\u60a8\u9700\u8981\u8f93\u5165: telnet localhost 6023 \u60a8\u9700\u8981\u5b89\u88c5telnet\u7a0b\u5e8f\uff0c\u5b83\u9ed8\u8ba4\u5b89\u88c5\u5728Windows\u4e2d\u548c\u5927\u591a\u6570Linux\u53d1\u884c\u7248\u3002 telnet console\u4e2d\u7684\u53ef\u7528\u53d8\u91cf telnet console\u5c31\u50cf\u4e00\u4e2a\u8fd0\u884c\u5728Scrapy\u8fdb\u7a0b\u5185\u90e8\u7684\u5e38\u89c4Python shell\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u901a\u8fc7\u5b83\u505a\u4efb\u4f55\u4e8b\u60c5\uff0c\u5305\u62ec\u5bfc\u5165\u65b0\u7684\u6a21\u5757\u7b49\u7b49\u3002 \u7136\u800c\uff0ctelnet console\u5e26\u6709\u4e00\u4e9b\u4e3a\u65b9\u4fbf\u800c\u5b9a\u4e49\u7684\u9ed8\u8ba4\u53d8\u91cf: \u5feb\u6377\u65b9\u5f0f \u63cf\u8ff0 crawler Scrapy Crawler( scrapy.crawler.Crawler \u5bf9\u8c61) engine Crawler.engine\u5c5e\u6027 spider \u6d3b\u52a8\u7684spider slot engine slot extensions \u6269\u5c55\u7ba1\u7406\u5668(Crawler.extensions\u5c5e\u6027) stats Stats Collector(Crawler.stats\u5c5e\u6027) settings Scrapy settings\u5bf9\u8c61(Crawler.settings\u5c5e\u6027) est print engine status\u62a5\u544a prefs \u6709\u5173\u5185\u5b58\u8c03\u8bd5(\u8bf7\u53c2\u9605 \u8c03\u8bd5\u5185\u5b58\u6cc4\u6f0f ) p pprint.pprint \u51fd\u6570\u7684\u5feb\u6377\u65b9\u5f0f\u3002 hpy \u6709\u5173\u5185\u5b58\u8c03\u8bd5(\u8bf7\u53c2\u9605 \u8c03\u8bd5\u5185\u5b58\u6cc4\u6f0f ) Telnet console\u4f7f\u7528\u793a\u4f8b \u4e0b\u9762\u662f\u4e00\u4e9b\u4f7f\u7528telnet console\u53ef\u4ee5\u5b8c\u6210\u7684\u793a\u4f8b\u4efb\u52a1: engine status\u89c6\u56fe \u60a8\u53ef\u4ee5\u4f7f\u7528Scrapy engine\u7684 est() \u65b9\u6cd5\u4f7f\u7528telnet console\u5feb\u901f\u663e\u793a\u5176\u72b6\u6001: telnet localhost 6023 est() Execution engine status time()-engine.start_time : 8.62972998619 engine.has_capacity() : False len(engine.downloader.active) : 16 engine.scraper.is_idle() : False engine.spider.name : followall engine.spider_is_idle(engine.spider) : False engine.slot.closing : False len(engine.slot.inprogress) : 16 len(engine.slot.scheduler.dqs or []) : 0 len(engine.slot.scheduler.mqs) : 92 len(engine.scraper.slot.queue) : 0 len(engine.scraper.slot.active) : 0 engine.scraper.slot.active_size : 0 engine.scraper.slot.itemproc_size : 0 engine.scraper.slot.needs_backout() : False \u6682\u505c\uff0c\u6062\u590d\u548c\u505c\u6b62Scrapy engine \u6682\u505c: telnet localhost 6023 engine.pause() \u6062\u590d: telnet localhost 6023 engine.unpause() \u505c\u6b62: telnet localhost 6023 engine.stop() Connection closed by foreign host. Telnet Console signals(\u4fe1\u53f7) scrapy.extensions.telnet.update_telnet_vars(telnet_vars) \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) \u5728telnet console\u6253\u5f00\u4e4b\u524d\u53d1\u9001\u3002\u60a8\u53ef\u4ee5\u8fde\u63a5\u5230\u8fd9\u4e2a\u4fe1\u53f7\u6765\u6dfb\u52a0\u3001\u5220\u9664\u6216\u66f4\u65b0telnet\u672c\u5730\u540d\u79f0\u7a7a\u95f4\u4e2d\u53ef\u7528\u7684\u53d8\u91cf\u3002\u4e3a\u4e86\u505a\u5230\u8fd9\u4e00\u70b9\uff0c\u60a8\u9700\u8981\u66f4\u65b0handler\u4e2d\u7684 telnet_vars \u5b57\u5178\u3002 \u53c2\u6570: telnet_vars (\u5b57\u5178) \u2013 telnet\u53d8\u91cf\u7684\u5b57\u5178 Telnet settings \u4ee5\u4e0b\u662f\u63a7\u5236telnet console\u884c\u4e3a\u7684\u8bbe\u7f6e: TELNETCONSOLE_PORT \u9ed8\u8ba4: [6023, 6073] \u7528\u4e8etelnet console\u7684\u7aef\u53e3\u8303\u56f4\u3002\u5982\u679c\u8bbe\u7f6e\u4e3a None \u6216 0 \uff0c\u5219\u4f7f\u7528\u52a8\u6001\u5206\u914d\u7684\u7aef\u53e3\u3002 TELNETCONSOLE_HOST \u9ed8\u8ba4: '127.0.0.1' telnet console\u5e94\u8be5\u76d1\u542c\u7684\u63a5\u53e3","title":"Telnet Console(Telnet\u63a7\u5236\u53f0)"},{"location":"3. \u5185\u7f6e\u670d\u52a1/20-telnet-console/#telnet-consoletelnet","text":"Scrapy\u9644\u5e26\u4e00\u4e2a\u5185\u7f6e\u7684telnet console\uff0c\u7528\u4e8e\u68c0\u67e5\u548c\u63a7\u5236\u4e00\u4e2aScrapy\u8fd0\u884c\u8fc7\u7a0b\u3002telnet console\u53ea\u662f\u5728Scrapy\u8fdb\u7a0b\u5185\u90e8\u8fd0\u884c\u7684\u4e00\u4e2a\u5e38\u89c4python shell\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u4ece\u5b83\u505a\u4efb\u4f55\u4e8b\u60c5\u3002 telnet console\u662f\u4e00\u4e2a \u5185\u7f6e\u7684Scrapy\u6269\u5c55 \uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u542f\u7528\u7684\uff0c\u4f46\u5982\u679c\u9700\u8981\uff0c\u4e5f\u53ef\u4ee5\u7981\u7528\u5b83\u3002\u6709\u5173\u6269\u5c55\u672c\u8eab\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Telnet console\u6269\u5c55 \u3002","title":"Telnet Console(Telnet\u63a7\u5236\u53f0)"},{"location":"3. \u5185\u7f6e\u670d\u52a1/20-telnet-console/#telnet-console","text":"telnet console\u76d1\u542c TELNETCONSOLE_PORT setting\u4e2d\u5b9a\u4e49\u7684TCP\u7aef\u53e3\uff0c\u8be5\u8bbe\u7f6e\u9ed8\u8ba4\u4e3a 6023 \u3002\u8981\u8bbf\u95ee\u63a7\u5236\u53f0\uff0c\u60a8\u9700\u8981\u8f93\u5165: telnet localhost 6023 \u60a8\u9700\u8981\u5b89\u88c5telnet\u7a0b\u5e8f\uff0c\u5b83\u9ed8\u8ba4\u5b89\u88c5\u5728Windows\u4e2d\u548c\u5927\u591a\u6570Linux\u53d1\u884c\u7248\u3002","title":"\u5982\u4f55\u8bbf\u95eetelnet console"},{"location":"3. \u5185\u7f6e\u670d\u52a1/20-telnet-console/#telnet-console_1","text":"telnet console\u5c31\u50cf\u4e00\u4e2a\u8fd0\u884c\u5728Scrapy\u8fdb\u7a0b\u5185\u90e8\u7684\u5e38\u89c4Python shell\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u901a\u8fc7\u5b83\u505a\u4efb\u4f55\u4e8b\u60c5\uff0c\u5305\u62ec\u5bfc\u5165\u65b0\u7684\u6a21\u5757\u7b49\u7b49\u3002 \u7136\u800c\uff0ctelnet console\u5e26\u6709\u4e00\u4e9b\u4e3a\u65b9\u4fbf\u800c\u5b9a\u4e49\u7684\u9ed8\u8ba4\u53d8\u91cf: \u5feb\u6377\u65b9\u5f0f \u63cf\u8ff0 crawler Scrapy Crawler( scrapy.crawler.Crawler \u5bf9\u8c61) engine Crawler.engine\u5c5e\u6027 spider \u6d3b\u52a8\u7684spider slot engine slot extensions \u6269\u5c55\u7ba1\u7406\u5668(Crawler.extensions\u5c5e\u6027) stats Stats Collector(Crawler.stats\u5c5e\u6027) settings Scrapy settings\u5bf9\u8c61(Crawler.settings\u5c5e\u6027) est print engine status\u62a5\u544a prefs \u6709\u5173\u5185\u5b58\u8c03\u8bd5(\u8bf7\u53c2\u9605 \u8c03\u8bd5\u5185\u5b58\u6cc4\u6f0f ) p pprint.pprint \u51fd\u6570\u7684\u5feb\u6377\u65b9\u5f0f\u3002 hpy \u6709\u5173\u5185\u5b58\u8c03\u8bd5(\u8bf7\u53c2\u9605 \u8c03\u8bd5\u5185\u5b58\u6cc4\u6f0f )","title":"telnet console\u4e2d\u7684\u53ef\u7528\u53d8\u91cf"},{"location":"3. \u5185\u7f6e\u670d\u52a1/20-telnet-console/#telnet-console_2","text":"\u4e0b\u9762\u662f\u4e00\u4e9b\u4f7f\u7528telnet console\u53ef\u4ee5\u5b8c\u6210\u7684\u793a\u4f8b\u4efb\u52a1:","title":"Telnet console\u4f7f\u7528\u793a\u4f8b"},{"location":"3. \u5185\u7f6e\u670d\u52a1/20-telnet-console/#engine-status","text":"\u60a8\u53ef\u4ee5\u4f7f\u7528Scrapy engine\u7684 est() \u65b9\u6cd5\u4f7f\u7528telnet console\u5feb\u901f\u663e\u793a\u5176\u72b6\u6001: telnet localhost 6023 est() Execution engine status time()-engine.start_time : 8.62972998619 engine.has_capacity() : False len(engine.downloader.active) : 16 engine.scraper.is_idle() : False engine.spider.name : followall engine.spider_is_idle(engine.spider) : False engine.slot.closing : False len(engine.slot.inprogress) : 16 len(engine.slot.scheduler.dqs or []) : 0 len(engine.slot.scheduler.mqs) : 92 len(engine.scraper.slot.queue) : 0 len(engine.scraper.slot.active) : 0 engine.scraper.slot.active_size : 0 engine.scraper.slot.itemproc_size : 0 engine.scraper.slot.needs_backout() : False","title":"engine status\u89c6\u56fe"},{"location":"3. \u5185\u7f6e\u670d\u52a1/20-telnet-console/#scrapy-engine","text":"\u6682\u505c: telnet localhost 6023 engine.pause() \u6062\u590d: telnet localhost 6023 engine.unpause() \u505c\u6b62: telnet localhost 6023 engine.stop() Connection closed by foreign host.","title":"\u6682\u505c\uff0c\u6062\u590d\u548c\u505c\u6b62Scrapy engine"},{"location":"3. \u5185\u7f6e\u670d\u52a1/20-telnet-console/#telnet-console-signals","text":"","title":"Telnet Console signals(\u4fe1\u53f7)"},{"location":"3. \u5185\u7f6e\u670d\u52a1/20-telnet-console/#scrapyextensionstelnetupdate_telnet_varstelnet_vars-class","text":"\u5728telnet console\u6253\u5f00\u4e4b\u524d\u53d1\u9001\u3002\u60a8\u53ef\u4ee5\u8fde\u63a5\u5230\u8fd9\u4e2a\u4fe1\u53f7\u6765\u6dfb\u52a0\u3001\u5220\u9664\u6216\u66f4\u65b0telnet\u672c\u5730\u540d\u79f0\u7a7a\u95f4\u4e2d\u53ef\u7528\u7684\u53d8\u91cf\u3002\u4e3a\u4e86\u505a\u5230\u8fd9\u4e00\u70b9\uff0c\u60a8\u9700\u8981\u66f4\u65b0handler\u4e2d\u7684 telnet_vars \u5b57\u5178\u3002 \u53c2\u6570: telnet_vars (\u5b57\u5178) \u2013 telnet\u53d8\u91cf\u7684\u5b57\u5178","title":"scrapy.extensions.telnet.update_telnet_vars(telnet_vars)   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"3. \u5185\u7f6e\u670d\u52a1/20-telnet-console/#telnet-settings","text":"\u4ee5\u4e0b\u662f\u63a7\u5236telnet console\u884c\u4e3a\u7684\u8bbe\u7f6e:","title":"Telnet settings"},{"location":"3. \u5185\u7f6e\u670d\u52a1/20-telnet-console/#telnetconsole_port","text":"\u9ed8\u8ba4: [6023, 6073] \u7528\u4e8etelnet console\u7684\u7aef\u53e3\u8303\u56f4\u3002\u5982\u679c\u8bbe\u7f6e\u4e3a None \u6216 0 \uff0c\u5219\u4f7f\u7528\u52a8\u6001\u5206\u914d\u7684\u7aef\u53e3\u3002","title":"TELNETCONSOLE_PORT"},{"location":"3. \u5185\u7f6e\u670d\u52a1/20-telnet-console/#telnetconsole_host","text":"\u9ed8\u8ba4: '127.0.0.1' telnet console\u5e94\u8be5\u76d1\u542c\u7684\u63a5\u53e3","title":"TELNETCONSOLE_HOST"},{"location":"3. \u5185\u7f6e\u670d\u52a1/21-web-service/","text":"Web Service(Web\u670d\u52a1) webservice\u5df2\u7ecf\u88ab\u8f6c\u79fb\u5230\u4e00\u4e2a\u5355\u72ec\u7684\u9879\u76ee\u4e2d\u3002 \u5730\u5740\u662f: https://github.com/scrapy-plugins/scrapy-jsonrpc \u4e0b\u9762\u662f\u6211\u81ea\u5df1\u7ffb\u8bd1\u5e26\u8fc7\u6765\u7684 scrapy-jsonrpc Scrapy -jsonrpc\u662f\u901a\u8fc7JSON-RPC\u63a7\u5236\u4e00\u4e2a\u6b63\u5728\u8fd0\u884c\u7684Scrapy web\u722c\u866b\u7a0b\u5e8f\u7684\u6269\u5c55\u3002\u8be5\u670d\u52a1\u901a\u8fc7 JSON-RPC 2.0 \u534f\u8bae\u63d0\u4f9b\u5bf9\u4e3bCrawler\u5bf9\u8c61\u7684\u8bbf\u95ee\u3002 \u5b89\u88c5 \u4f7f\u7528pip\u5b89\u88c5scrapy-jsonrpc: $ pip install scrapy-jsonrpc \u914d\u7f6e \u9996\u5148\uff0c\u60a8\u9700\u8981\u5728 settings.py \u4e2d\u6253\u5f00\u5bf9 EXTENSIONS dict\u7684\u6ce8\u91ca\u3002\u4f8b\u5982: EXTENSIONS = { 'scrapy_jsonrpc.webservice.WebService': 500, } \u7136\u540e\uff0c\u9700\u8981\u4f7f\u7528 JSONRPC_ENABLED \u8bbe\u7f6e\u542f\u7528extension\uff0c\u8bbe\u7f6e\u4e3a True \u3002 web\u670d\u52a1\u5668\u5c06\u4fa6\u542c JSONRPC_PORT \u4e2d\u6307\u5b9a\u7684\u7aef\u53e3(\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5b83\u5c06\u5c1d\u8bd5\u4fa6\u542c\u7aef\u53e36080)\uff0c\u5e76\u5c06\u767blog\u5230 JSONRPC_LOGFILE \u4e2d\u6307\u5b9a\u7684\u6587\u4ef6\u3002 \u8bbf\u95eecrawler\u5bf9\u8c61\u7684\u7aef\u70b9\u4e3a: http://localhost:6080/crawler \u5ba2\u6237\u7aef\u5b9e\u4f8b \u4e3a\u4e86\u8bf4\u660e\u5982\u4f55\u6784\u5efaclient\uff0c\u63d0\u4f9b\u4e86\u4e00\u4e2a\u547d\u4ee4\u884c\u5de5\u5177\u3002\u60a8\u53ef\u4ee5\u5728 example-client.py \u4e2d\u627e\u5230\u5b83\u3002\u5b83\u652f\u6301\u4e00\u4e9b\u57fa\u672c\u547d\u4ee4\uff0c\u5982\u5217\u51fa\u8fd0\u884c\u4e2d\u7684spider\u7b49\u3002 Settings \u4ee5\u4e0b\u662f\u63a7\u5236web\u670d\u52a1\u884c\u4e3a\u7684\u8bbe\u7f6e: JSONRPC_ENABLED \u9ed8\u8ba4: False \u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u7528\u4e8e\u6307\u5b9a\u662f\u5426\u542f\u7528web\u670d\u52a1(\u5982\u679c\u5b83\u7684\u6269\u5c55\u4e5f\u662f\u542f\u7528\u7684)\u3002 JSONRPC_LOGFILE \u9ed8\u8ba4: None \u7528\u4e8e\u8bb0\u5f55\u5bf9web\u670d\u52a1\u53d1\u51fa\u7684HTTP\u8bf7\u6c42\u7684\u6587\u4ef6\u3002\u5982\u679c\u672a\u8bbe\u7f6eweb\uff0c\u65e5\u5fd7\u5c06\u53d1\u9001\u5230\u6807\u51c6\u7684scrapy\u65e5\u5fd7\u3002 JSONRPC_PORT \u9ed8\u8ba4: [6080, 7030] \u7528\u4e8eweb\u670d\u52a1\u7684\u7aef\u53e3\u8303\u56f4\u3002\u5982\u679c\u8bbe\u7f6e\u4e3a None \u6216 0 \uff0c\u5219\u4f7f\u7528\u52a8\u6001\u5206\u914d\u7684\u7aef\u53e3\u3002 JSONRPC_HOST \u9ed8\u8ba4: '127.0.0.1' web\u670d\u52a1\u5e94\u8be5\u76d1\u542c\u7684\u63a5\u53e3\u3002","title":"Web Service(Web\u670d\u52a1)"},{"location":"3. \u5185\u7f6e\u670d\u52a1/21-web-service/#web-serviceweb","text":"webservice\u5df2\u7ecf\u88ab\u8f6c\u79fb\u5230\u4e00\u4e2a\u5355\u72ec\u7684\u9879\u76ee\u4e2d\u3002 \u5730\u5740\u662f: https://github.com/scrapy-plugins/scrapy-jsonrpc \u4e0b\u9762\u662f\u6211\u81ea\u5df1\u7ffb\u8bd1\u5e26\u8fc7\u6765\u7684","title":"Web Service(Web\u670d\u52a1)"},{"location":"3. \u5185\u7f6e\u670d\u52a1/21-web-service/#scrapy-jsonrpc","text":"Scrapy -jsonrpc\u662f\u901a\u8fc7JSON-RPC\u63a7\u5236\u4e00\u4e2a\u6b63\u5728\u8fd0\u884c\u7684Scrapy web\u722c\u866b\u7a0b\u5e8f\u7684\u6269\u5c55\u3002\u8be5\u670d\u52a1\u901a\u8fc7 JSON-RPC 2.0 \u534f\u8bae\u63d0\u4f9b\u5bf9\u4e3bCrawler\u5bf9\u8c61\u7684\u8bbf\u95ee\u3002","title":"scrapy-jsonrpc"},{"location":"3. \u5185\u7f6e\u670d\u52a1/21-web-service/#_1","text":"\u4f7f\u7528pip\u5b89\u88c5scrapy-jsonrpc: $ pip install scrapy-jsonrpc","title":"\u5b89\u88c5"},{"location":"3. \u5185\u7f6e\u670d\u52a1/21-web-service/#_2","text":"\u9996\u5148\uff0c\u60a8\u9700\u8981\u5728 settings.py \u4e2d\u6253\u5f00\u5bf9 EXTENSIONS dict\u7684\u6ce8\u91ca\u3002\u4f8b\u5982: EXTENSIONS = { 'scrapy_jsonrpc.webservice.WebService': 500, } \u7136\u540e\uff0c\u9700\u8981\u4f7f\u7528 JSONRPC_ENABLED \u8bbe\u7f6e\u542f\u7528extension\uff0c\u8bbe\u7f6e\u4e3a True \u3002 web\u670d\u52a1\u5668\u5c06\u4fa6\u542c JSONRPC_PORT \u4e2d\u6307\u5b9a\u7684\u7aef\u53e3(\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5b83\u5c06\u5c1d\u8bd5\u4fa6\u542c\u7aef\u53e36080)\uff0c\u5e76\u5c06\u767blog\u5230 JSONRPC_LOGFILE \u4e2d\u6307\u5b9a\u7684\u6587\u4ef6\u3002 \u8bbf\u95eecrawler\u5bf9\u8c61\u7684\u7aef\u70b9\u4e3a: http://localhost:6080/crawler","title":"\u914d\u7f6e"},{"location":"3. \u5185\u7f6e\u670d\u52a1/21-web-service/#_3","text":"\u4e3a\u4e86\u8bf4\u660e\u5982\u4f55\u6784\u5efaclient\uff0c\u63d0\u4f9b\u4e86\u4e00\u4e2a\u547d\u4ee4\u884c\u5de5\u5177\u3002\u60a8\u53ef\u4ee5\u5728 example-client.py \u4e2d\u627e\u5230\u5b83\u3002\u5b83\u652f\u6301\u4e00\u4e9b\u57fa\u672c\u547d\u4ee4\uff0c\u5982\u5217\u51fa\u8fd0\u884c\u4e2d\u7684spider\u7b49\u3002","title":"\u5ba2\u6237\u7aef\u5b9e\u4f8b"},{"location":"3. \u5185\u7f6e\u670d\u52a1/21-web-service/#settings","text":"\u4ee5\u4e0b\u662f\u63a7\u5236web\u670d\u52a1\u884c\u4e3a\u7684\u8bbe\u7f6e:","title":"Settings"},{"location":"3. \u5185\u7f6e\u670d\u52a1/21-web-service/#jsonrpc_enabled","text":"\u9ed8\u8ba4: False \u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u7528\u4e8e\u6307\u5b9a\u662f\u5426\u542f\u7528web\u670d\u52a1(\u5982\u679c\u5b83\u7684\u6269\u5c55\u4e5f\u662f\u542f\u7528\u7684)\u3002","title":"JSONRPC_ENABLED"},{"location":"3. \u5185\u7f6e\u670d\u52a1/21-web-service/#jsonrpc_logfile","text":"\u9ed8\u8ba4: None \u7528\u4e8e\u8bb0\u5f55\u5bf9web\u670d\u52a1\u53d1\u51fa\u7684HTTP\u8bf7\u6c42\u7684\u6587\u4ef6\u3002\u5982\u679c\u672a\u8bbe\u7f6eweb\uff0c\u65e5\u5fd7\u5c06\u53d1\u9001\u5230\u6807\u51c6\u7684scrapy\u65e5\u5fd7\u3002","title":"JSONRPC_LOGFILE"},{"location":"3. \u5185\u7f6e\u670d\u52a1/21-web-service/#jsonrpc_port","text":"\u9ed8\u8ba4: [6080, 7030] \u7528\u4e8eweb\u670d\u52a1\u7684\u7aef\u53e3\u8303\u56f4\u3002\u5982\u679c\u8bbe\u7f6e\u4e3a None \u6216 0 \uff0c\u5219\u4f7f\u7528\u52a8\u6001\u5206\u914d\u7684\u7aef\u53e3\u3002","title":"JSONRPC_PORT"},{"location":"3. \u5185\u7f6e\u670d\u52a1/21-web-service/#jsonrpc_host","text":"\u9ed8\u8ba4: '127.0.0.1' web\u670d\u52a1\u5e94\u8be5\u76d1\u542c\u7684\u63a5\u53e3\u3002","title":"JSONRPC_HOST"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/01-\u5e38\u89c1\u95ee\u9898\u89e3\u7b54/","text":"\u5e38\u89c1\u95ee\u9898\u89e3\u7b54 \u4e0eBeautifulSoup\u6216lxml\u76f8\u6bd4\uff0cScrapy\u662f\u600e\u6837\u7684\u5462? BeautifulSoup \u548c lxml \u662f\u89e3\u6790HTML\u548cXML\u7684\u5e93\u3002Scrapy\u662f\u4e00\u4e2a\u7528\u4e8e\u7f16\u5199web spider\u7684\u5e94\u7528\u7a0b\u5e8f\u6846\u67b6\uff0c\u8be5web spider\u80fd\u591f\u6293\u53d6web\u7ad9\u70b9\u5e76\u4ece\u4e2d\u63d0\u53d6\u6570\u636e\u3002 Scrapy\u63d0\u4f9b\u4e86\u4e00\u79cd\u7528\u4e8e\u63d0\u53d6\u6570\u636e\u7684\u5185\u7f6e\u673a\u5236(\u79f0\u4e3a selectors )\uff0c\u4f46\u662f\u60a8\u53ef\u4ee5\u5f88\u5bb9\u6613\u5730\u4f7f\u7528 BeautifulSoup (\u6216 lxml )\u6765\u4ee3\u66ff\u5b83\u3002\u6bd5\u7adf\uff0c\u5b83\u4eec\u53ea\u662f\u89e3\u6790\u53ef\u4ee5\u4ece\u4efb\u4f55Python\u4ee3\u7801\u5bfc\u5165\u548c\u4f7f\u7528\u7684\u5e93\u3002 \u6362\u53e5\u8bdd\u8bf4\uff0c\u5c06 BeautifulSoup (\u6216 lxml )\u4e0eScrapy\u8fdb\u884c\u6bd4\u8f83\u5c31\u50cf\u5c06 jinja2 \u4e0e Django \u8fdb\u884c\u6bd4\u8f83\u4e00\u6837\u3002","title":"\u5e38\u89c1\u95ee\u9898\u89e3\u7b54"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/01-\u5e38\u89c1\u95ee\u9898\u89e3\u7b54/#_1","text":"","title":"\u5e38\u89c1\u95ee\u9898\u89e3\u7b54"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/01-\u5e38\u89c1\u95ee\u9898\u89e3\u7b54/#beautifulsouplxmlscrapy","text":"BeautifulSoup \u548c lxml \u662f\u89e3\u6790HTML\u548cXML\u7684\u5e93\u3002Scrapy\u662f\u4e00\u4e2a\u7528\u4e8e\u7f16\u5199web spider\u7684\u5e94\u7528\u7a0b\u5e8f\u6846\u67b6\uff0c\u8be5web spider\u80fd\u591f\u6293\u53d6web\u7ad9\u70b9\u5e76\u4ece\u4e2d\u63d0\u53d6\u6570\u636e\u3002 Scrapy\u63d0\u4f9b\u4e86\u4e00\u79cd\u7528\u4e8e\u63d0\u53d6\u6570\u636e\u7684\u5185\u7f6e\u673a\u5236(\u79f0\u4e3a selectors )\uff0c\u4f46\u662f\u60a8\u53ef\u4ee5\u5f88\u5bb9\u6613\u5730\u4f7f\u7528 BeautifulSoup (\u6216 lxml )\u6765\u4ee3\u66ff\u5b83\u3002\u6bd5\u7adf\uff0c\u5b83\u4eec\u53ea\u662f\u89e3\u6790\u53ef\u4ee5\u4ece\u4efb\u4f55Python\u4ee3\u7801\u5bfc\u5165\u548c\u4f7f\u7528\u7684\u5e93\u3002 \u6362\u53e5\u8bdd\u8bf4\uff0c\u5c06 BeautifulSoup (\u6216 lxml )\u4e0eScrapy\u8fdb\u884c\u6bd4\u8f83\u5c31\u50cf\u5c06 jinja2 \u4e0e Django \u8fdb\u884c\u6bd4\u8f83\u4e00\u6837\u3002","title":"\u4e0eBeautifulSoup\u6216lxml\u76f8\u6bd4\uff0cScrapy\u662f\u600e\u6837\u7684\u5462?"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/02-debugind-spider/","text":"Debugging Spiders(\u8c03\u8bd5Spiders) \u672c\u6587\u4ecb\u7ecd\u8c03\u8bd5spider\u7684\u6700\u5e38\u89c1\u6280\u672f\u3002\u8003\u8651\u4ee5\u4e0b\u7684scrapy spider: import scrapy from myproject.items import MyItem class MySpider(scrapy.Spider): name = 'myspider' start_urls = ( 'http://example.com/page1', 'http://example.com/page2', ) def parse(self, response): # \u6536\u96c6 `item_urls` for item_url in item_urls: yield scrapy.Request(item_url, self.parse_item) def parse_item(self, response): item = MyItem() # \u586b\u5145 `item` \u5b57\u6bb5 # \u5e76\u4e14\u63d0\u53d6item_details_url yield scrapy.Request(item_details_url, self.parse_details, meta={'item': item}) def parse_details(self, response): item = response.meta['item'] # \u586b\u5145\u66f4\u591a\u7684 `item` \u5b57\u6bb5 return item \u57fa\u672c\u4e0a\uff0c\u8fd9\u662f\u4e00\u4e2a\u7b80\u5355\u7684spider\uff0c\u5b83\u89e3\u6790\u4e24\u9875items(start_urls)\u3002item\u8fd8\u6709\u4e00\u4e2a\u5305\u542b\u9644\u52a0\u4fe1\u606f\u7684\u8be6\u7ec6\u4fe1\u606f\u9875\u9762\uff0c\u56e0\u6b64\u6211\u4eec\u4f7f\u7528 Request \u7684 meta \u529f\u80fd\u4f20\u9012\u90e8\u5206\u586b\u5145\u7684item\u3002 Parse\u547d\u4ee4 \u68c0\u67e5spider\u8f93\u51fa\u7684\u6700\u57fa\u672c\u65b9\u6cd5\u662f\u4f7f\u7528 parse \u547d\u4ee4\u3002\u5b83\u5141\u8bb8\u5728\u65b9\u6cd5\u7ea7\u522b\u68c0\u67e5spider\u7684\u4e0d\u540c\u90e8\u5206\u7684\u884c\u4e3a\u3002\u5b83\u7684\u4f18\u70b9\u662f\u7075\u6d3b\u4e14\u6613\u4e8e\u4f7f\u7528\uff0c\u4f46\u4e0d\u5141\u8bb8\u5728\u65b9\u6cd5\u5185\u90e8\u8c03\u8bd5\u4ee3\u7801\u3002 \u4e3a\u4e86\u770b\u5230\u4ece\u4e00\u4e2a\u7279\u5b9a\u7684url\u6293\u53d6\u7684\u9879\u76ee: $ scrapy parse --spider=myspider -c parse_item -d 2 item_url [ ... scrapy log lines crawling example.com spider ... ] STATUS DEPTH LEVEL 2 # Scraped Items ------------------------------------------------------------ [{'url': item_url }] # Requests ----------------------------------------------------------------- [] \u4f7f\u7528 -verbose \u6216 -v \u9009\u9879\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5728\u6bcf\u4e2a\u6df1\u5ea6\u7ea7\u522b\u7684\u72b6\u6001: $ scrapy parse --spider=myspider -c parse_item -d 2 -v item_url [ ... scrapy log lines crawling example.com spider ... ] DEPTH LEVEL: 1 # Scraped Items ------------------------------------------------------------ [] # Requests ----------------------------------------------------------------- [ GET item_details_url ] DEPTH LEVEL: 2 # Scraped Items ------------------------------------------------------------ [{'url': item_url }] # Requests ----------------------------------------------------------------- [] \u68c0\u67e5\u4ece\u5355\u4e2astart_url\u6293\u53d6\u4e0b\u6765\u7684items\uff0c\u4e5f\u53ef\u4ee5\u5f88\u5bb9\u6613\u5730\u5b9e\u73b0\u4f7f\u7528: $ scrapy parse --spider=myspider -d 3 'http://example.com/page1' Scrapy Shell \u867d\u7136 parse \u547d\u4ee4\u5bf9\u4e8e\u68c0\u67e5spider\u7684\u884c\u4e3a\u975e\u5e38\u6709\u7528\uff0c\u4f46\u662f\u9664\u4e86\u663e\u793a\u63a5\u6536\u5230\u7684\u54cd\u5e94\u548c\u8f93\u51fa\u4e4b\u5916\uff0c\u68c0\u67e5callback\u5185\u90e8\u53d1\u751f\u4e86\u4ec0\u4e48\u5e76\u6ca1\u6709\u4ec0\u4e48\u5e2e\u52a9\u3002\u5f53 parse_details \u6709\u65f6\u4e0d\u63a5\u6536item\u65f6\uff0c\u5982\u4f55\u8c03\u8bd5\u8fd9\u79cd\u60c5\u51b5? \u5e78\u8fd0\u7684\u662f\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c shell \u5c31\u662f\u60a8\u7684\u9762\u5305\u548c\u9ec4\u6cb9(\u53c2\u89c1 \u8c03\u7528spider\u4e2d\u7684shell\u6765\u68c0\u67e5response ): from scrapy.shell import inspect_response def parse_details(self, response): item = response.meta.get('item', None) if item: # \u586b\u5145\u66f4\u591a `item` \u5b57\u6bb5 return item else: inspect_response(response, self) \u53c2\u89c1: \u4ecespider\u8c03\u7528shell\u4ee5\u68c0\u67e5response \u3002 \u6253\u5f00\u6d4f\u89c8\u5668 \u6709\u65f6\u5019\uff0c\u60a8\u53ea\u662f\u60f3\u770b\u770b\u6d4f\u89c8\u5668\u4e2d\u7684\u67d0\u4e2aresposne\u662f\u4ec0\u4e48\u6837\u5b50\u7684\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 open_in_browser \u51fd\u6570\u8fdb\u884c\u5904\u7406\u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u5982\u4f55\u4f7f\u7528\u5b83\u7684\u4f8b\u5b50: from scrapy.utils.response import open_in_browser def parse_details(self, response): if item name not in response.body: open_in_browser(response) open_in_browser \u5c06\u6253\u5f00\u4e00\u4e2a\u6d4f\u89c8\u5668\uff0c\u5176\u4e2d\u5305\u542b\u4eceScrapy\u63a5\u6536\u5230\u7684response\uff0c\u5e76\u8c03\u6574 base tag \uff0c\u4ee5\u4fbf\u6b63\u786e\u663e\u793a\u56fe\u50cf\u548c\u6837\u5f0f\u3002 Logging Logging\u662f\u83b7\u53d6\u6709\u5173spider\u8fd0\u884c\u4fe1\u606f\u7684\u53e6\u4e00\u4e2a\u6709\u7528\u9009\u9879\u3002\u867d\u7136\u4e0d\u90a3\u4e48\u65b9\u4fbf\uff0c\u4f46\u5b83\u7684\u4f18\u70b9\u662f\uff0c\u5982\u679c\u9700\u8981\u65e5\u5fd7\uff0c\u5728\u4ee5\u540e\u7684\u6240\u6709\u8fd0\u884c\u4e2d\u90fd\u53ef\u4ee5\u4f7f\u7528: def parse_details(self, response): item = response.meta.get('item', None) if item: # \u586b\u5145\u66f4\u591a `item` \u5b57\u6bb5 return item else: self.logger.warning('No item received for %s', response.url) \u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Logging \u90e8\u5206\u3002","title":"Debugging Spiders(\u8c03\u8bd5Spiders)"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/02-debugind-spider/#debugging-spidersspiders","text":"\u672c\u6587\u4ecb\u7ecd\u8c03\u8bd5spider\u7684\u6700\u5e38\u89c1\u6280\u672f\u3002\u8003\u8651\u4ee5\u4e0b\u7684scrapy spider: import scrapy from myproject.items import MyItem class MySpider(scrapy.Spider): name = 'myspider' start_urls = ( 'http://example.com/page1', 'http://example.com/page2', ) def parse(self, response): # \u6536\u96c6 `item_urls` for item_url in item_urls: yield scrapy.Request(item_url, self.parse_item) def parse_item(self, response): item = MyItem() # \u586b\u5145 `item` \u5b57\u6bb5 # \u5e76\u4e14\u63d0\u53d6item_details_url yield scrapy.Request(item_details_url, self.parse_details, meta={'item': item}) def parse_details(self, response): item = response.meta['item'] # \u586b\u5145\u66f4\u591a\u7684 `item` \u5b57\u6bb5 return item \u57fa\u672c\u4e0a\uff0c\u8fd9\u662f\u4e00\u4e2a\u7b80\u5355\u7684spider\uff0c\u5b83\u89e3\u6790\u4e24\u9875items(start_urls)\u3002item\u8fd8\u6709\u4e00\u4e2a\u5305\u542b\u9644\u52a0\u4fe1\u606f\u7684\u8be6\u7ec6\u4fe1\u606f\u9875\u9762\uff0c\u56e0\u6b64\u6211\u4eec\u4f7f\u7528 Request \u7684 meta \u529f\u80fd\u4f20\u9012\u90e8\u5206\u586b\u5145\u7684item\u3002","title":"Debugging Spiders(\u8c03\u8bd5Spiders)"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/02-debugind-spider/#parse","text":"\u68c0\u67e5spider\u8f93\u51fa\u7684\u6700\u57fa\u672c\u65b9\u6cd5\u662f\u4f7f\u7528 parse \u547d\u4ee4\u3002\u5b83\u5141\u8bb8\u5728\u65b9\u6cd5\u7ea7\u522b\u68c0\u67e5spider\u7684\u4e0d\u540c\u90e8\u5206\u7684\u884c\u4e3a\u3002\u5b83\u7684\u4f18\u70b9\u662f\u7075\u6d3b\u4e14\u6613\u4e8e\u4f7f\u7528\uff0c\u4f46\u4e0d\u5141\u8bb8\u5728\u65b9\u6cd5\u5185\u90e8\u8c03\u8bd5\u4ee3\u7801\u3002 \u4e3a\u4e86\u770b\u5230\u4ece\u4e00\u4e2a\u7279\u5b9a\u7684url\u6293\u53d6\u7684\u9879\u76ee: $ scrapy parse --spider=myspider -c parse_item -d 2 item_url [ ... scrapy log lines crawling example.com spider ... ] STATUS DEPTH LEVEL 2 # Scraped Items ------------------------------------------------------------ [{'url': item_url }] # Requests ----------------------------------------------------------------- [] \u4f7f\u7528 -verbose \u6216 -v \u9009\u9879\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5728\u6bcf\u4e2a\u6df1\u5ea6\u7ea7\u522b\u7684\u72b6\u6001: $ scrapy parse --spider=myspider -c parse_item -d 2 -v item_url [ ... scrapy log lines crawling example.com spider ... ] DEPTH LEVEL: 1 # Scraped Items ------------------------------------------------------------ [] # Requests ----------------------------------------------------------------- [ GET item_details_url ] DEPTH LEVEL: 2 # Scraped Items ------------------------------------------------------------ [{'url': item_url }] # Requests ----------------------------------------------------------------- [] \u68c0\u67e5\u4ece\u5355\u4e2astart_url\u6293\u53d6\u4e0b\u6765\u7684items\uff0c\u4e5f\u53ef\u4ee5\u5f88\u5bb9\u6613\u5730\u5b9e\u73b0\u4f7f\u7528: $ scrapy parse --spider=myspider -d 3 'http://example.com/page1'","title":"Parse\u547d\u4ee4"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/02-debugind-spider/#scrapy-shell","text":"\u867d\u7136 parse \u547d\u4ee4\u5bf9\u4e8e\u68c0\u67e5spider\u7684\u884c\u4e3a\u975e\u5e38\u6709\u7528\uff0c\u4f46\u662f\u9664\u4e86\u663e\u793a\u63a5\u6536\u5230\u7684\u54cd\u5e94\u548c\u8f93\u51fa\u4e4b\u5916\uff0c\u68c0\u67e5callback\u5185\u90e8\u53d1\u751f\u4e86\u4ec0\u4e48\u5e76\u6ca1\u6709\u4ec0\u4e48\u5e2e\u52a9\u3002\u5f53 parse_details \u6709\u65f6\u4e0d\u63a5\u6536item\u65f6\uff0c\u5982\u4f55\u8c03\u8bd5\u8fd9\u79cd\u60c5\u51b5? \u5e78\u8fd0\u7684\u662f\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c shell \u5c31\u662f\u60a8\u7684\u9762\u5305\u548c\u9ec4\u6cb9(\u53c2\u89c1 \u8c03\u7528spider\u4e2d\u7684shell\u6765\u68c0\u67e5response ): from scrapy.shell import inspect_response def parse_details(self, response): item = response.meta.get('item', None) if item: # \u586b\u5145\u66f4\u591a `item` \u5b57\u6bb5 return item else: inspect_response(response, self) \u53c2\u89c1: \u4ecespider\u8c03\u7528shell\u4ee5\u68c0\u67e5response \u3002","title":"Scrapy Shell"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/02-debugind-spider/#_1","text":"\u6709\u65f6\u5019\uff0c\u60a8\u53ea\u662f\u60f3\u770b\u770b\u6d4f\u89c8\u5668\u4e2d\u7684\u67d0\u4e2aresposne\u662f\u4ec0\u4e48\u6837\u5b50\u7684\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 open_in_browser \u51fd\u6570\u8fdb\u884c\u5904\u7406\u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u5982\u4f55\u4f7f\u7528\u5b83\u7684\u4f8b\u5b50: from scrapy.utils.response import open_in_browser def parse_details(self, response): if item name not in response.body: open_in_browser(response) open_in_browser \u5c06\u6253\u5f00\u4e00\u4e2a\u6d4f\u89c8\u5668\uff0c\u5176\u4e2d\u5305\u542b\u4eceScrapy\u63a5\u6536\u5230\u7684response\uff0c\u5e76\u8c03\u6574 base tag \uff0c\u4ee5\u4fbf\u6b63\u786e\u663e\u793a\u56fe\u50cf\u548c\u6837\u5f0f\u3002","title":"\u6253\u5f00\u6d4f\u89c8\u5668"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/02-debugind-spider/#logging","text":"Logging\u662f\u83b7\u53d6\u6709\u5173spider\u8fd0\u884c\u4fe1\u606f\u7684\u53e6\u4e00\u4e2a\u6709\u7528\u9009\u9879\u3002\u867d\u7136\u4e0d\u90a3\u4e48\u65b9\u4fbf\uff0c\u4f46\u5b83\u7684\u4f18\u70b9\u662f\uff0c\u5982\u679c\u9700\u8981\u65e5\u5fd7\uff0c\u5728\u4ee5\u540e\u7684\u6240\u6709\u8fd0\u884c\u4e2d\u90fd\u53ef\u4ee5\u4f7f\u7528: def parse_details(self, response): item = response.meta.get('item', None) if item: # \u586b\u5145\u66f4\u591a `item` \u5b57\u6bb5 return item else: self.logger.warning('No item received for %s', response.url) \u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Logging \u90e8\u5206\u3002","title":"Logging"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/03-Spiders Contracts/","text":"Spiders Contracts \u6700\u65b0\u7248\u672c0.15 \u8fd9\u662f\u4e00\u4e2a\u65b0\u7279\u6027(\u5728Scrapy 0.15\u4e2d\u4ecb\u7ecd)\uff0c\u53ef\u80fd\u4f1a\u53d7\u5230\u5c0f\u529f\u80fd/API\u66f4\u65b0\u7684\u5f71\u54cd\u3002 \u68c0\u67e5[\u53d1\u5e03\u8bb0\u5f55](https://docs.scrapy.org/en/latest/news.html#news)\uff0c\u4ee5\u901a\u77e5\u66f4\u65b0\u3002 \u6d4b\u8bd5spider\u53ef\u80fd\u4f1a\u7279\u522b\u70e6\u4eba\uff0c\u867d\u7136\u6ca1\u6709\u4ec0\u4e48\u53ef\u4ee5\u963b\u6b62\u60a8\u7f16\u5199\u5355\u5143\u6d4b\u8bd5\uff0c\u4f46\u4efb\u52a1\u4f1a\u5f88\u5feb\u53d8\u5f97\u5f88\u9ebb\u70e6\u3002Scrapy\u63d0\u4f9b\u4e86\u4e00\u79cd\u901a\u8fc7contract\u7684\u65b9\u5f0f\u6765\u6d4b\u8bd5\u60a8\u7684spider\u7684\u7efc\u5408\u65b9\u6cd5\u3002 \u8fd9\u5141\u8bb8\u60a8\u901a\u8fc7\u786c\u7f16\u7801\u793a\u4f8burl\u6765\u6d4b\u8bd5spider\u7684\u6bcf\u4e2acallback\uff0c\u5e76\u68c0\u67e5callback\u5982\u4f55\u5904\u7406response\u7684\u5404\u79cd\u7ea6\u675f\u3002\u6bcf\u4e2acontract\u7684\u524d\u7f00\u90fd\u662f @ \uff0c\u5e76\u5305\u542b\u5728\u6587\u6863\u5b57\u7b26\u4e32\u4e2d\u3002\u8bf7\u770b\u4e0b\u9762\u7684\u4f8b\u5b50: def parse(self, response): \u8be5\u51fd\u6570\u89e3\u6790\u4e86\u4e00\u4e2a\u7b80\u5355\u7684response. \u6709\u4e9bcontract\u4e0e\u8fd9\u4e2a\u6587\u6863\u5b57\u7b26\u4e32\u6df7\u6742\u5728\u4e00\u8d77. @url http://www.amazon.com/s?field-keywords=selfish+gene @returns items 1 16 @returns requests 0 0 @scrapes Title Author Year Price \u6b64callback\u4f7f\u7528\u4e09\u4e2a\u5185\u7f6econtracts\u8fdb\u884c\u6d4b\u8bd5: scrapy.contracts.default.UrlContract \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) \u6b64contract( @url )\u8bbe\u7f6e\u5728\u68c0\u67e5\u6b64spider\u7684\u5176\u4ed6contract\u6761\u4ef6\u65f6\u4f7f\u7528\u7684\u793a\u4f8burl\u3002\u8fd9\u4efdcontract\u662f\u5f3a\u5236\u6027\u7684\u3002\u5728\u8fd0\u884c\u68c0\u67e5\u65f6\uff0c\u6240\u6709\u7f3a\u5c11contract\u7684callback\u90fd\u88ab\u5ffd\u7565: @url url scrapy.contracts.default.ReturnsContract \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) \u8fd9\u4e2acontract( @returns )\u4e3aspider\u8fd4\u56de\u7684items\u548crequests\u8bbe\u7f6e\u4e86\u4e0b\u9650\u548c\u4e0a\u9650\u3002\u4e0a\u9650\u662f\u53ef\u9009\u7684: @returns item(s)|request(s) [min [max]] scrapy.contracts.default.ScrapesContract \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) \u8fd9\u4e2acontract( @scrapes )\u68c0\u67e5callback\u8fd4\u56de\u7684\u6240\u6709items\u662f\u5426\u5177\u6709\u6307\u5b9a\u7684\u5b57\u6bb5: @scrapes field_1 field_2 ... \u81ea\u5b9a\u4e49Contracts \u5982\u679c\u60a8\u53d1\u73b0\u60a8\u9700\u8981\u6bd4\u5185\u7f6e\u7684scrapy contracts\u66f4\u5f3a\u5927\u7684\u529f\u80fd\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 SPIDER_CONTRACTS settings\u5728\u9879\u76ee\u4e2d\u521b\u5efa\u548c\u52a0\u8f7d\u60a8\u81ea\u5df1\u7684contracts: SPIDER_CONTRACTS = { 'myproject.contracts.ResponseCheck': 10, 'myproject.contracts.ItemValidate': 10, } \u6bcf\u4e2a\u5408\u540c\u5fc5\u987b\u4ece scrapy.contracts.Contract \u7ee7\u627f\uff0c\u5e76\u53ef\u4ee5\u8986\u76d6\u4e09\u4e2a\u65b9\u6cd5: scrapy.contracts.Contract(method, *args) \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) \u53c2\u6570: method (\u65b9\u6cd5) \u2013 \u4e0econtract\u76f8\u5173\u8054\u7684callback\u51fd\u6570 args (\u5217\u8868) \u2013 \u4f20\u5165docstring\u7684\u53c2\u6570\u5217\u8868(\u7a7a\u683c\u5206\u9694) adjust_request_args(args) \u8fd9\u5c06\u63a5\u6536\u4e00\u4e2a dict \u4f5c\u4e3a\u4e00\u4e2a\u53c2\u6570\uff0c\u5176\u4e2d\u5305\u542b Request \u5bf9\u8c61\u7684\u9ed8\u8ba4\u53c2\u6570\u3002\u5fc5\u987b\u8fd4\u56de\u5b83\u7684\u76f8\u540c\u6216\u4fee\u6539\u7248\u672c\u3002 pre_process(response) \u8fd9\u5141\u8bb8\u5728\u5c06response\u4f20\u9012\u7ed9callback\u4e4b\u524d\uff0c\u5bf9\u4ece\u5b9e\u4f8brequests\u63a5\u6536\u5230\u7684response\u8fdb\u884c\u5404\u79cd\u68c0\u67e5\u3002 post_process(output) \u8fd9\u5141\u8bb8\u5904\u7406callback\u7684\u8f93\u51fa\u3002\u8fed\u4ee3\u5668\u5728\u4f20\u9012\u5230\u6b64\u94a9\u5b50\u4e4b\u524d\u88ab\u8f6c\u6362\u6210listified\u3002 \u4e0b\u9762\u662f\u4e00\u4e2acontract demo\uff0c\u5b83\u68c0\u67e5\u63a5\u6536\u5230\u7684response\u4e2d\u662f\u5426\u5b58\u5728\u81ea\u5b9a\u4e49\u6807\u5934\u3002\u629b\u51fa scrapy.exceptions.ContractFail \u662f\u4e3a\u4e86\u8ba9\u5931\u8d25\u88ab\u5f88\u597d\u5730\u6253\u5370\u51fa\u6765:: from scrapy.contracts import Contract from scrapy.exceptions import ContractFail class HasHeaderContract(Contract): \u6f14\u793acontract, \u68c0\u67e5\u81ea\u5b9a\u4e49\u7684\u6807\u5934\u662f\u5426\u5b58\u5728 @has_header X-CustomHeader name = 'has_header' def pre_process(self, response): for header in self.args: if header not in response.headers: raise ContractFail('X-CustomHeader not present')","title":"Spiders Contracts"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/03-Spiders Contracts/#spiders-contracts","text":"\u6700\u65b0\u7248\u672c0.15 \u8fd9\u662f\u4e00\u4e2a\u65b0\u7279\u6027(\u5728Scrapy 0.15\u4e2d\u4ecb\u7ecd)\uff0c\u53ef\u80fd\u4f1a\u53d7\u5230\u5c0f\u529f\u80fd/API\u66f4\u65b0\u7684\u5f71\u54cd\u3002 \u68c0\u67e5[\u53d1\u5e03\u8bb0\u5f55](https://docs.scrapy.org/en/latest/news.html#news)\uff0c\u4ee5\u901a\u77e5\u66f4\u65b0\u3002 \u6d4b\u8bd5spider\u53ef\u80fd\u4f1a\u7279\u522b\u70e6\u4eba\uff0c\u867d\u7136\u6ca1\u6709\u4ec0\u4e48\u53ef\u4ee5\u963b\u6b62\u60a8\u7f16\u5199\u5355\u5143\u6d4b\u8bd5\uff0c\u4f46\u4efb\u52a1\u4f1a\u5f88\u5feb\u53d8\u5f97\u5f88\u9ebb\u70e6\u3002Scrapy\u63d0\u4f9b\u4e86\u4e00\u79cd\u901a\u8fc7contract\u7684\u65b9\u5f0f\u6765\u6d4b\u8bd5\u60a8\u7684spider\u7684\u7efc\u5408\u65b9\u6cd5\u3002 \u8fd9\u5141\u8bb8\u60a8\u901a\u8fc7\u786c\u7f16\u7801\u793a\u4f8burl\u6765\u6d4b\u8bd5spider\u7684\u6bcf\u4e2acallback\uff0c\u5e76\u68c0\u67e5callback\u5982\u4f55\u5904\u7406response\u7684\u5404\u79cd\u7ea6\u675f\u3002\u6bcf\u4e2acontract\u7684\u524d\u7f00\u90fd\u662f @ \uff0c\u5e76\u5305\u542b\u5728\u6587\u6863\u5b57\u7b26\u4e32\u4e2d\u3002\u8bf7\u770b\u4e0b\u9762\u7684\u4f8b\u5b50: def parse(self, response): \u8be5\u51fd\u6570\u89e3\u6790\u4e86\u4e00\u4e2a\u7b80\u5355\u7684response. \u6709\u4e9bcontract\u4e0e\u8fd9\u4e2a\u6587\u6863\u5b57\u7b26\u4e32\u6df7\u6742\u5728\u4e00\u8d77. @url http://www.amazon.com/s?field-keywords=selfish+gene @returns items 1 16 @returns requests 0 0 @scrapes Title Author Year Price \u6b64callback\u4f7f\u7528\u4e09\u4e2a\u5185\u7f6econtracts\u8fdb\u884c\u6d4b\u8bd5:","title":"Spiders Contracts"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/03-Spiders Contracts/#scrapycontractsdefaulturlcontract-class","text":"\u6b64contract( @url )\u8bbe\u7f6e\u5728\u68c0\u67e5\u6b64spider\u7684\u5176\u4ed6contract\u6761\u4ef6\u65f6\u4f7f\u7528\u7684\u793a\u4f8burl\u3002\u8fd9\u4efdcontract\u662f\u5f3a\u5236\u6027\u7684\u3002\u5728\u8fd0\u884c\u68c0\u67e5\u65f6\uff0c\u6240\u6709\u7f3a\u5c11contract\u7684callback\u90fd\u88ab\u5ffd\u7565: @url url","title":"scrapy.contracts.default.UrlContract   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/03-Spiders Contracts/#scrapycontractsdefaultreturnscontract-class","text":"\u8fd9\u4e2acontract( @returns )\u4e3aspider\u8fd4\u56de\u7684items\u548crequests\u8bbe\u7f6e\u4e86\u4e0b\u9650\u548c\u4e0a\u9650\u3002\u4e0a\u9650\u662f\u53ef\u9009\u7684: @returns item(s)|request(s) [min [max]]","title":"scrapy.contracts.default.ReturnsContract   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/03-Spiders Contracts/#scrapycontractsdefaultscrapescontract-class","text":"\u8fd9\u4e2acontract( @scrapes )\u68c0\u67e5callback\u8fd4\u56de\u7684\u6240\u6709items\u662f\u5426\u5177\u6709\u6307\u5b9a\u7684\u5b57\u6bb5: @scrapes field_1 field_2 ...","title":"scrapy.contracts.default.ScrapesContract   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/03-Spiders Contracts/#contracts","text":"\u5982\u679c\u60a8\u53d1\u73b0\u60a8\u9700\u8981\u6bd4\u5185\u7f6e\u7684scrapy contracts\u66f4\u5f3a\u5927\u7684\u529f\u80fd\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 SPIDER_CONTRACTS settings\u5728\u9879\u76ee\u4e2d\u521b\u5efa\u548c\u52a0\u8f7d\u60a8\u81ea\u5df1\u7684contracts: SPIDER_CONTRACTS = { 'myproject.contracts.ResponseCheck': 10, 'myproject.contracts.ItemValidate': 10, } \u6bcf\u4e2a\u5408\u540c\u5fc5\u987b\u4ece scrapy.contracts.Contract \u7ee7\u627f\uff0c\u5e76\u53ef\u4ee5\u8986\u76d6\u4e09\u4e2a\u65b9\u6cd5:","title":"\u81ea\u5b9a\u4e49Contracts"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/03-Spiders Contracts/#scrapycontractscontractmethod-42args-class","text":"\u53c2\u6570: method (\u65b9\u6cd5) \u2013 \u4e0econtract\u76f8\u5173\u8054\u7684callback\u51fd\u6570 args (\u5217\u8868) \u2013 \u4f20\u5165docstring\u7684\u53c2\u6570\u5217\u8868(\u7a7a\u683c\u5206\u9694) adjust_request_args(args) \u8fd9\u5c06\u63a5\u6536\u4e00\u4e2a dict \u4f5c\u4e3a\u4e00\u4e2a\u53c2\u6570\uff0c\u5176\u4e2d\u5305\u542b Request \u5bf9\u8c61\u7684\u9ed8\u8ba4\u53c2\u6570\u3002\u5fc5\u987b\u8fd4\u56de\u5b83\u7684\u76f8\u540c\u6216\u4fee\u6539\u7248\u672c\u3002 pre_process(response) \u8fd9\u5141\u8bb8\u5728\u5c06response\u4f20\u9012\u7ed9callback\u4e4b\u524d\uff0c\u5bf9\u4ece\u5b9e\u4f8brequests\u63a5\u6536\u5230\u7684response\u8fdb\u884c\u5404\u79cd\u68c0\u67e5\u3002 post_process(output) \u8fd9\u5141\u8bb8\u5904\u7406callback\u7684\u8f93\u51fa\u3002\u8fed\u4ee3\u5668\u5728\u4f20\u9012\u5230\u6b64\u94a9\u5b50\u4e4b\u524d\u88ab\u8f6c\u6362\u6210listified\u3002 \u4e0b\u9762\u662f\u4e00\u4e2acontract demo\uff0c\u5b83\u68c0\u67e5\u63a5\u6536\u5230\u7684response\u4e2d\u662f\u5426\u5b58\u5728\u81ea\u5b9a\u4e49\u6807\u5934\u3002\u629b\u51fa scrapy.exceptions.ContractFail \u662f\u4e3a\u4e86\u8ba9\u5931\u8d25\u88ab\u5f88\u597d\u5730\u6253\u5370\u51fa\u6765:: from scrapy.contracts import Contract from scrapy.exceptions import ContractFail class HasHeaderContract(Contract): \u6f14\u793acontract, \u68c0\u67e5\u81ea\u5b9a\u4e49\u7684\u6807\u5934\u662f\u5426\u5b58\u5728 @has_header X-CustomHeader name = 'has_header' def pre_process(self, response): for header in self.args: if header not in response.headers: raise ContractFail('X-CustomHeader not present')","title":"scrapy.contracts.Contract(method, *args)   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/04-common-practices/","text":"Common Practices(\u5e38\u7528\u5b9e\u8df5) \u672c\u8282\u8bb0\u5f55\u4f7f\u7528Scrapy\u65f6\u7684\u5e38\u89c1\u5b9e\u8df5\u3002\u8fd9\u4e9b\u5185\u5bb9\u6db5\u76d6\u4e86\u8bb8\u591a\u4e3b\u9898\uff0c\u901a\u5e38\u4e0d\u5c5e\u4e8e\u4efb\u4f55\u5176\u4ed6\u7279\u5b9a\u90e8\u5206\u3002 \u4ece\u811a\u672c\u4e2d\u8fd0\u884cScrapy \u60a8\u53ef\u4ee5\u4f7f\u7528 API \u4ece\u811a\u672c\u4e2d\u8fd0\u884cScrapy\uff0c\u800c\u4e0d\u662f\u901a\u8fc7 scrapy crawl \u5178\u578b\u65b9\u5f0f\u8fd0\u884cScrapy\u3002 \u8bb0\u4f4f\uff0cScrapy\u662f\u5728Twisted\u5f02\u6b65\u7f51\u7edc\u5e93\u4e4b\u4e0a\u6784\u5efa\u7684\uff0c\u6240\u4ee5\u60a8\u9700\u8981\u5728Twisted reactor\u4e2d\u8fd0\u884c\u5b83\u3002 \u8fd0\u884cspiders\u7684\u7b2c\u4e00\u4e2a\u5b9e\u7528\u7a0b\u5e8f\u662f scrapy.crawler.CrawlerProcess \u3002\u8fd9\u4e2a\u7c7b\u5c06\u4e3a\u60a8\u542f\u52a8\u4e00\u4e2aTwisted reactor\uff0c\u914d\u7f6elogging\u5e76\u8bbe\u7f6e\u5173\u95edhandlers\u3002\u8fd9\u4e2a\u7c7b\u662f\u6240\u6709Scrapy\u547d\u4ee4\u6240\u4f7f\u7528\u7684\u7c7b\u3002 \u4e0b\u9762\u662f\u4e00\u4e2a\u793a\u4f8b\uff0c\u6f14\u793a\u5982\u4f55\u4f7f\u7528\u5b83\u8fd0\u884c\u5355\u4e2aspider\u3002 import scrapy from scrapy.crawler import CrawlerProcess class MySpider(scrapy.Spider): # \u5b9a\u4e49\u4f60\u7684spider ... process = CrawlerProcess({ 'USER_AGENT': 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)' }) process.crawl(MySpider) process.start() # \u811a\u672c\u5c06\u5728\u8fd9\u91cc\u963b\u585e\uff0c\u76f4\u5230\u5b8c\u6210\u722c\u884c \u786e\u4fdd\u68c0\u67e5 CrawlerProcess \u6587\u6863\u4ee5\u4e86\u89e3\u5176\u4f7f\u7528\u7ec6\u8282\u3002 \u5982\u679c\u60a8\u5728Scrapy\u9879\u76ee\u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e9b\u989d\u5916\u7684\u52a9\u624b\u6765\u5bfc\u5165\u9879\u76ee\u4e2d\u7684\u7ec4\u4ef6\u3002\u4f60\u53ef\u4ee5\u81ea\u52a8\u5bfc\u5165\u4f60\u7684spider\u901a\u8fc7\u4f20\u9012\u5b83\u4eec\u7684\u540d\u5b57\u7ed9 CrawlerProcess \uff0c\u5e76\u4f7f\u7528 get_project_settings \u83b7\u5f97\u5e26\u6709\u9879\u76eesettings\u7684 Settings \u5b9e\u4f8b\u3002 \u4e0b\u9762\u662f\u4e00\u4e2a\u4f7f\u7528 testspider \u9879\u76ee\u4f5c\u4e3a\u793a\u4f8b\u7684\u5de5\u4f5c\u793a\u4f8b\uff0c\u8bf4\u660e\u5982\u4f55\u505a\u5230\u8fd9\u4e00\u70b9\u3002 from scrapy.crawler import CrawlerProcess from scrapy.utils.project import get_project_settings process = CrawlerProcess(get_project_settings()) # 'followall' \u662f\u8fd9\u4e2a\u9879\u76ee\u7684spider\u7684\u540d\u5b57. process.crawl('followall', domain='scrapinghub.com') process.start() # \u811a\u672c\u5c06\u5728\u8fd9\u91cc\u963b\u585e\uff0c\u76f4\u5230\u5b8c\u6210\u722c\u884c \u8fd8\u6709\u4e00\u4e2aScrapy\u5b9e\u7528\u7a0b\u5e8f\u53ef\u4ee5\u63d0\u4f9b\u5bf9\u6293\u53d6\u8fc7\u7a0b\u7684\u66f4\u591a\u63a7\u5236: scrapy.crawler.CrawlerRunner \u3002\u8fd9\u4e2a\u7c7b\u662f\u4e00\u4e2a\u7626\u5c0f\u7684\u5305\u88c5\u5668\uff0c\u5b83\u5c01\u88c5\u4e86\u4e00\u4e9b\u7b80\u5355\u7684\u52a9\u624b\u6765\u8fd0\u884c\u591a\u4e2acrawlers\uff0c\u4f46\u662f\u5b83\u4e0d\u4f1a\u4ee5\u4efb\u4f55\u65b9\u5f0f\u542f\u52a8\u6216\u5e72\u6270\u73b0\u6709\u7684reactors\u3002 [Twisted Reactor\u7684\u6982\u8ff0](https://twistedmatrix.com/documents/current/core/howto/reactor-basics.html)\u3002 \u5728\u540c\u4e00\u4e2a\u8fdb\u7a0b\u4e2d\u8fd0\u884c\u591a\u4e2aspider \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5f53\u60a8\u8fd0\u884c scrapy crawl \u65f6\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u53ea\u8fd0\u884c\u4e00\u4e2aspider. \u7136\u800c\uff0cScrapy\u652f\u6301\u4f7f\u7528 \u5185\u90e8API \u5728\u6bcf\u4e2a\u8fdb\u7a0b\u4e0a\u8fd0\u884c\u591a\u4e2a\u722c\u884c\u5668\u3002 \u4e0b\u9762\u662f\u4e00\u4e2a\u540c\u65f6\u8fd0\u884c\u591a\u4e2aspider\u7684\u4f8b\u5b50: import scrapy from scrapy.crawler import CrawlerProcess class MySpider1(scrapy.Spider): # \u4f60\u5b9a\u4e49\u7684\u7b2c\u4e00\u4e2aspider ... class MySpider2(scrapy.Spider): # \u4f60\u5b9a\u4e49\u7684\u7b2c\u4e8c\u4e2aspider ... process = CrawlerProcess() process.crawl(MySpider1) process.crawl(MySpider2) process.start() # \u811a\u672c\u5c06\u5728\u8fd9\u91cc\u963b\u585e\uff0c\u76f4\u5230\u6240\u6709\u722c\u884c\u4f5c\u4e1a\u5b8c\u6210 \u4f7f\u7528 CrawlerRunner \u7684\u4f8b\u5b50\u662f\u4e00\u6837\u7684: import scrapy from twisted.internet import reactor from scrapy.crawler import CrawlerRunner from scrapy.utils.log import configure_logging class MySpider1(scrapy.Spider): # \u4f60\u5b9a\u4e49\u7684\u7b2c\u4e00\u4e2aspider ... class MySpider2(scrapy.Spider): # \u4f60\u5b9a\u4e49\u7684\u7b2c\u4e8c\u4e2aspider ... configure_logging() runner = CrawlerRunner() runner.crawl(MySpider1) runner.crawl(MySpider2) d = runner.join() d.addBoth(lambda _: reactor.stop()) reactor.run() # \u811a\u672c\u5c06\u5728\u8fd9\u91cc\u963b\u585e\uff0c\u76f4\u5230\u6240\u6709\u722c\u884c\u4f5c\u4e1a\u5b8c\u6210 \u540c\u6837\u7684\u4f8b\u5b50\uff0c\u4f46\u901a\u8fc7\u4e00\u8fde\u4e32\u7684\u5ef6\u8fdf\u6765\u8fde\u7eed\u8fd0\u884cspider: from twisted.internet import reactor, defer from scrapy.crawler import CrawlerRunner from scrapy.utils.log import configure_logging class MySpider1(scrapy.Spider): # \u4f60\u5b9a\u4e49\u7684\u7b2c\u4e00\u4e2aspider ... class MySpider2(scrapy.Spider): # \u4f60\u5b9a\u4e49\u7684\u7b2c\u4e8c\u4e2aspider ... configure_logging() runner = CrawlerRunner() @defer.inlineCallbacks def crawl(): yield runner.crawl(MySpider1) yield runner.crawl(MySpider2) reactor.stop() crawl() reactor.run() # \u811a\u672c\u5c06\u5728\u8fd9\u91cc\u963b\u585e\uff0c\u76f4\u5230\u6240\u6709\u722c\u884c\u4f5c\u4e1a\u5b8c\u6210 [\u4ece\u811a\u672c\u8fd0\u884cScrapy](#)\u3002 \u5206\u5e03\u5f0f\u722c\u866b Scrapy\u4e0d\u63d0\u4f9b\u4efb\u4f55\u4ee5\u5206\u5e03\u5f0f(\u591a\u670d\u52a1\u5668)\u65b9\u5f0f\u8fd0\u884c\u722c\u884c\u7684\u5185\u7f6e\u529f\u80fd\u3002\u4f46\u662f\uff0c\u6709\u4e00\u4e9b\u5206\u53d1crawls\u7684\u65b9\u6cd5\uff0c\u8fd9\u4e9b\u65b9\u6cd5\u53d6\u51b3\u4e8e\u60a8\u8ba1\u5212\u5982\u4f55\u5206\u53d1\u5b83\u4eec\u3002 \u5982\u679c\u6709\u8bb8\u591aspider\uff0c\u5206\u914d\u8d1f\u8f7d\u7684\u660e\u663e\u65b9\u6cd5\u662f\u8bbe\u7f6e\u8bb8\u591aScrapyd\u5b9e\u4f8b\u5e76\u5728\u8fd9\u4e9b\u5b9e\u4f8b\u4e4b\u95f4\u5206\u53d1spider\u3002 \u5982\u679c\u60a8\u60f3\u5728\u8bb8\u591a\u673a\u5668\u4e0a\u8fd0\u884c\u5355\u4e2a(\u5927\u578b)spider\uff0c\u901a\u5e38\u8981\u505a\u7684\u662f\u5bf9url\u8fdb\u884c\u5206\u533a\uff0c\u7136\u540e\u5c06\u5b83\u4eec\u53d1\u9001\u5230\u6bcf\u4e2a\u5355\u72ec\u7684spider\u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u5177\u4f53\u7684\u4f8b\u5b50: \u9996\u5148\uff0c\u51c6\u5907\u597d\u8981\u6293\u53d6\u7684url\u5217\u8868\uff0c\u5e76\u5c06\u5b83\u4eec\u653e\u5165\u5355\u72ec\u7684\u6587\u4ef6/url\u4e2d: http://somedomain.com/urls-to-crawl/spider1/part1.list http://somedomain.com/urls-to-crawl/spider1/part2.list http://somedomain.com/urls-to-crawl/spider1/part3.list \u7136\u540e\u57283\u4e2a\u4e0d\u540c\u7684Scrapyd\u670d\u52a1\u5668\u4e0a\u542f\u52a8\u4e00\u4e2a\u722c\u884c\u5668\u3002\u722c\u884c\u5668\u5c06\u63a5\u6536\u4e00\u4e2a(spider)\u53c2\u6570 part \uff0c\u5176\u4e2d\u5305\u542b\u8981\u6293\u53d6\u7684\u5206\u533a\u6570\u76ee: curl http://scrapy1.mycompany.com:6800/schedule.json -d project=myproject -d spider=spider1 -d part=1 curl http://scrapy2.mycompany.com:6800/schedule.json -d project=myproject -d spider=spider1 -d part=2 curl http://scrapy3.mycompany.com:6800/schedule.json -d project=myproject -d spider=spider1 -d part=3 \u907f\u514d\u88abban \u4e00\u4e9b\u7f51\u7ad9\u91c7\u53d6\u4e86\u4e00\u5b9a\u7684\u63aa\u65bd\u6765\u9632\u6b62bots\u4ece\u5b83\u4eec\u8eab\u4e0a\u722c\u6765\u722c\u53bb\uff0c\u5176\u590d\u6742\u7a0b\u5ea6\u5404\u4e0d\u76f8\u540c\u3002\u7ed5\u8fc7\u8fd9\u4e9b\u63aa\u65bd\u53ef\u80fd\u662f\u56f0\u96be\u548c\u68d8\u624b\u7684\uff0c\u6709\u65f6\u53ef\u80fd\u9700\u8981\u7279\u6b8a\u7684\u57fa\u7840\u8bbe\u65bd\u3002\u5982\u6709\u7591\u95ee\uff0c\u8bf7\u8003\u8651\u8054\u7cfb \u5546\u4e1a\u652f\u6301 \u3002 \u5728\u5904\u7406\u8fd9\u7c7b\u7f51\u7ad9\u65f6\uff0c\u8fd9\u91cc\u6709\u4e00\u4e9b\u63d0\u793a\u8981\u8bb0\u4f4f: \u5c06user agent\u4ece\u6d4f\u89c8\u5668\u7684\u77e5\u540d\u4ee3\u7406\u6c60\u4e2d\u8f6e\u8be2(\u901a\u8fc7\u8c37\u6b4c\u83b7\u5f97\u5b83\u4eec\u7684\u5217\u8868) \u7981\u7528cookie(\u8bf7\u53c2\u9605 COOKIES_ENABLED )\uff0c\u56e0\u4e3a\u4e00\u4e9b\u7ad9\u70b9\u53ef\u80fd\u4f7f\u7528cookie\u6765\u53d1\u73b0bot\u884c\u4e3a \u4f7f\u7528download delays(2\u6216\u66f4\u9ad8)\u3002\u770b DOWNLOAD_DELAY settings\u3002 \u5982\u679c\u53ef\u80fd\uff0c\u4f7f\u7528 \u8c37\u6b4c\u7f13\u5b58 \u6765\u83b7\u53d6\u9875\u9762\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u8bbf\u95ee\u7ad9\u70b9 \u8f6e\u8be2\u4f7f\u7528ip\u6c60\u3002\u4f8b\u5982\uff0c\u514d\u8d39 Tor\u9879\u76ee \u6216\u4ed8\u8d39\u670d\u52a1\uff0c\u5982 ProxyMesh \u3002\u4e00\u79cd\u5f00\u6e90\u7684\u66ff\u4ee3\u65b9\u6cd5\u662f scrapoxy \uff0c\u4e00\u79cd\u53ef\u4ee5\u5c06\u81ea\u5df1\u7684\u4ee3\u7406\u9644\u52a0\u5230\u5176\u4e0a\u7684\u8d85\u7ea7\u4ee3\u7406\u3002 \u4f7f\u7528\u9ad8\u5ea6\u5206\u5e03\u5f0f\u7684downloader\uff0c\u5b83\u53ef\u4ee5\u7ed5\u8fc7\u5185\u90e8\u7684\u7981\u6b62\uff0c\u8fd9\u6837\u60a8\u5c31\u53ef\u4ee5\u4e13\u6ce8\u4e8e\u89e3\u6790\u5e72\u51c0\u7684\u9875\u9762\u3002\u8fd9\u79cddownloader\u7684\u4e00\u4e2a\u4f8b\u5b50\u662f Crawlera \u5982\u679c\u4f60\u4ecd\u7136\u4e0d\u80fd\u963b\u6b62\u4f60\u7684bot\u88ab\u7981\u6b62\uff0c\u8003\u8651\u8054\u7cfb \u5546\u4e1a\u652f\u6301 \u3002","title":"Common Practices(\u5e38\u7528\u5b9e\u8df5)"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/04-common-practices/#common-practices","text":"\u672c\u8282\u8bb0\u5f55\u4f7f\u7528Scrapy\u65f6\u7684\u5e38\u89c1\u5b9e\u8df5\u3002\u8fd9\u4e9b\u5185\u5bb9\u6db5\u76d6\u4e86\u8bb8\u591a\u4e3b\u9898\uff0c\u901a\u5e38\u4e0d\u5c5e\u4e8e\u4efb\u4f55\u5176\u4ed6\u7279\u5b9a\u90e8\u5206\u3002","title":"Common Practices(\u5e38\u7528\u5b9e\u8df5)"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/04-common-practices/#scrapy","text":"\u60a8\u53ef\u4ee5\u4f7f\u7528 API \u4ece\u811a\u672c\u4e2d\u8fd0\u884cScrapy\uff0c\u800c\u4e0d\u662f\u901a\u8fc7 scrapy crawl \u5178\u578b\u65b9\u5f0f\u8fd0\u884cScrapy\u3002 \u8bb0\u4f4f\uff0cScrapy\u662f\u5728Twisted\u5f02\u6b65\u7f51\u7edc\u5e93\u4e4b\u4e0a\u6784\u5efa\u7684\uff0c\u6240\u4ee5\u60a8\u9700\u8981\u5728Twisted reactor\u4e2d\u8fd0\u884c\u5b83\u3002 \u8fd0\u884cspiders\u7684\u7b2c\u4e00\u4e2a\u5b9e\u7528\u7a0b\u5e8f\u662f scrapy.crawler.CrawlerProcess \u3002\u8fd9\u4e2a\u7c7b\u5c06\u4e3a\u60a8\u542f\u52a8\u4e00\u4e2aTwisted reactor\uff0c\u914d\u7f6elogging\u5e76\u8bbe\u7f6e\u5173\u95edhandlers\u3002\u8fd9\u4e2a\u7c7b\u662f\u6240\u6709Scrapy\u547d\u4ee4\u6240\u4f7f\u7528\u7684\u7c7b\u3002 \u4e0b\u9762\u662f\u4e00\u4e2a\u793a\u4f8b\uff0c\u6f14\u793a\u5982\u4f55\u4f7f\u7528\u5b83\u8fd0\u884c\u5355\u4e2aspider\u3002 import scrapy from scrapy.crawler import CrawlerProcess class MySpider(scrapy.Spider): # \u5b9a\u4e49\u4f60\u7684spider ... process = CrawlerProcess({ 'USER_AGENT': 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)' }) process.crawl(MySpider) process.start() # \u811a\u672c\u5c06\u5728\u8fd9\u91cc\u963b\u585e\uff0c\u76f4\u5230\u5b8c\u6210\u722c\u884c \u786e\u4fdd\u68c0\u67e5 CrawlerProcess \u6587\u6863\u4ee5\u4e86\u89e3\u5176\u4f7f\u7528\u7ec6\u8282\u3002 \u5982\u679c\u60a8\u5728Scrapy\u9879\u76ee\u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e9b\u989d\u5916\u7684\u52a9\u624b\u6765\u5bfc\u5165\u9879\u76ee\u4e2d\u7684\u7ec4\u4ef6\u3002\u4f60\u53ef\u4ee5\u81ea\u52a8\u5bfc\u5165\u4f60\u7684spider\u901a\u8fc7\u4f20\u9012\u5b83\u4eec\u7684\u540d\u5b57\u7ed9 CrawlerProcess \uff0c\u5e76\u4f7f\u7528 get_project_settings \u83b7\u5f97\u5e26\u6709\u9879\u76eesettings\u7684 Settings \u5b9e\u4f8b\u3002 \u4e0b\u9762\u662f\u4e00\u4e2a\u4f7f\u7528 testspider \u9879\u76ee\u4f5c\u4e3a\u793a\u4f8b\u7684\u5de5\u4f5c\u793a\u4f8b\uff0c\u8bf4\u660e\u5982\u4f55\u505a\u5230\u8fd9\u4e00\u70b9\u3002 from scrapy.crawler import CrawlerProcess from scrapy.utils.project import get_project_settings process = CrawlerProcess(get_project_settings()) # 'followall' \u662f\u8fd9\u4e2a\u9879\u76ee\u7684spider\u7684\u540d\u5b57. process.crawl('followall', domain='scrapinghub.com') process.start() # \u811a\u672c\u5c06\u5728\u8fd9\u91cc\u963b\u585e\uff0c\u76f4\u5230\u5b8c\u6210\u722c\u884c \u8fd8\u6709\u4e00\u4e2aScrapy\u5b9e\u7528\u7a0b\u5e8f\u53ef\u4ee5\u63d0\u4f9b\u5bf9\u6293\u53d6\u8fc7\u7a0b\u7684\u66f4\u591a\u63a7\u5236: scrapy.crawler.CrawlerRunner \u3002\u8fd9\u4e2a\u7c7b\u662f\u4e00\u4e2a\u7626\u5c0f\u7684\u5305\u88c5\u5668\uff0c\u5b83\u5c01\u88c5\u4e86\u4e00\u4e9b\u7b80\u5355\u7684\u52a9\u624b\u6765\u8fd0\u884c\u591a\u4e2acrawlers\uff0c\u4f46\u662f\u5b83\u4e0d\u4f1a\u4ee5\u4efb\u4f55\u65b9\u5f0f\u542f\u52a8\u6216\u5e72\u6270\u73b0\u6709\u7684reactors\u3002 [Twisted Reactor\u7684\u6982\u8ff0](https://twistedmatrix.com/documents/current/core/howto/reactor-basics.html)\u3002","title":"\u4ece\u811a\u672c\u4e2d\u8fd0\u884cScrapy"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/04-common-practices/#spider","text":"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5f53\u60a8\u8fd0\u884c scrapy crawl \u65f6\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u53ea\u8fd0\u884c\u4e00\u4e2aspider. \u7136\u800c\uff0cScrapy\u652f\u6301\u4f7f\u7528 \u5185\u90e8API \u5728\u6bcf\u4e2a\u8fdb\u7a0b\u4e0a\u8fd0\u884c\u591a\u4e2a\u722c\u884c\u5668\u3002 \u4e0b\u9762\u662f\u4e00\u4e2a\u540c\u65f6\u8fd0\u884c\u591a\u4e2aspider\u7684\u4f8b\u5b50: import scrapy from scrapy.crawler import CrawlerProcess class MySpider1(scrapy.Spider): # \u4f60\u5b9a\u4e49\u7684\u7b2c\u4e00\u4e2aspider ... class MySpider2(scrapy.Spider): # \u4f60\u5b9a\u4e49\u7684\u7b2c\u4e8c\u4e2aspider ... process = CrawlerProcess() process.crawl(MySpider1) process.crawl(MySpider2) process.start() # \u811a\u672c\u5c06\u5728\u8fd9\u91cc\u963b\u585e\uff0c\u76f4\u5230\u6240\u6709\u722c\u884c\u4f5c\u4e1a\u5b8c\u6210 \u4f7f\u7528 CrawlerRunner \u7684\u4f8b\u5b50\u662f\u4e00\u6837\u7684: import scrapy from twisted.internet import reactor from scrapy.crawler import CrawlerRunner from scrapy.utils.log import configure_logging class MySpider1(scrapy.Spider): # \u4f60\u5b9a\u4e49\u7684\u7b2c\u4e00\u4e2aspider ... class MySpider2(scrapy.Spider): # \u4f60\u5b9a\u4e49\u7684\u7b2c\u4e8c\u4e2aspider ... configure_logging() runner = CrawlerRunner() runner.crawl(MySpider1) runner.crawl(MySpider2) d = runner.join() d.addBoth(lambda _: reactor.stop()) reactor.run() # \u811a\u672c\u5c06\u5728\u8fd9\u91cc\u963b\u585e\uff0c\u76f4\u5230\u6240\u6709\u722c\u884c\u4f5c\u4e1a\u5b8c\u6210 \u540c\u6837\u7684\u4f8b\u5b50\uff0c\u4f46\u901a\u8fc7\u4e00\u8fde\u4e32\u7684\u5ef6\u8fdf\u6765\u8fde\u7eed\u8fd0\u884cspider: from twisted.internet import reactor, defer from scrapy.crawler import CrawlerRunner from scrapy.utils.log import configure_logging class MySpider1(scrapy.Spider): # \u4f60\u5b9a\u4e49\u7684\u7b2c\u4e00\u4e2aspider ... class MySpider2(scrapy.Spider): # \u4f60\u5b9a\u4e49\u7684\u7b2c\u4e8c\u4e2aspider ... configure_logging() runner = CrawlerRunner() @defer.inlineCallbacks def crawl(): yield runner.crawl(MySpider1) yield runner.crawl(MySpider2) reactor.stop() crawl() reactor.run() # \u811a\u672c\u5c06\u5728\u8fd9\u91cc\u963b\u585e\uff0c\u76f4\u5230\u6240\u6709\u722c\u884c\u4f5c\u4e1a\u5b8c\u6210 [\u4ece\u811a\u672c\u8fd0\u884cScrapy](#)\u3002","title":"\u5728\u540c\u4e00\u4e2a\u8fdb\u7a0b\u4e2d\u8fd0\u884c\u591a\u4e2aspider"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/04-common-practices/#_1","text":"Scrapy\u4e0d\u63d0\u4f9b\u4efb\u4f55\u4ee5\u5206\u5e03\u5f0f(\u591a\u670d\u52a1\u5668)\u65b9\u5f0f\u8fd0\u884c\u722c\u884c\u7684\u5185\u7f6e\u529f\u80fd\u3002\u4f46\u662f\uff0c\u6709\u4e00\u4e9b\u5206\u53d1crawls\u7684\u65b9\u6cd5\uff0c\u8fd9\u4e9b\u65b9\u6cd5\u53d6\u51b3\u4e8e\u60a8\u8ba1\u5212\u5982\u4f55\u5206\u53d1\u5b83\u4eec\u3002 \u5982\u679c\u6709\u8bb8\u591aspider\uff0c\u5206\u914d\u8d1f\u8f7d\u7684\u660e\u663e\u65b9\u6cd5\u662f\u8bbe\u7f6e\u8bb8\u591aScrapyd\u5b9e\u4f8b\u5e76\u5728\u8fd9\u4e9b\u5b9e\u4f8b\u4e4b\u95f4\u5206\u53d1spider\u3002 \u5982\u679c\u60a8\u60f3\u5728\u8bb8\u591a\u673a\u5668\u4e0a\u8fd0\u884c\u5355\u4e2a(\u5927\u578b)spider\uff0c\u901a\u5e38\u8981\u505a\u7684\u662f\u5bf9url\u8fdb\u884c\u5206\u533a\uff0c\u7136\u540e\u5c06\u5b83\u4eec\u53d1\u9001\u5230\u6bcf\u4e2a\u5355\u72ec\u7684spider\u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u5177\u4f53\u7684\u4f8b\u5b50: \u9996\u5148\uff0c\u51c6\u5907\u597d\u8981\u6293\u53d6\u7684url\u5217\u8868\uff0c\u5e76\u5c06\u5b83\u4eec\u653e\u5165\u5355\u72ec\u7684\u6587\u4ef6/url\u4e2d: http://somedomain.com/urls-to-crawl/spider1/part1.list http://somedomain.com/urls-to-crawl/spider1/part2.list http://somedomain.com/urls-to-crawl/spider1/part3.list \u7136\u540e\u57283\u4e2a\u4e0d\u540c\u7684Scrapyd\u670d\u52a1\u5668\u4e0a\u542f\u52a8\u4e00\u4e2a\u722c\u884c\u5668\u3002\u722c\u884c\u5668\u5c06\u63a5\u6536\u4e00\u4e2a(spider)\u53c2\u6570 part \uff0c\u5176\u4e2d\u5305\u542b\u8981\u6293\u53d6\u7684\u5206\u533a\u6570\u76ee: curl http://scrapy1.mycompany.com:6800/schedule.json -d project=myproject -d spider=spider1 -d part=1 curl http://scrapy2.mycompany.com:6800/schedule.json -d project=myproject -d spider=spider1 -d part=2 curl http://scrapy3.mycompany.com:6800/schedule.json -d project=myproject -d spider=spider1 -d part=3","title":"\u5206\u5e03\u5f0f\u722c\u866b"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/04-common-practices/#ban","text":"\u4e00\u4e9b\u7f51\u7ad9\u91c7\u53d6\u4e86\u4e00\u5b9a\u7684\u63aa\u65bd\u6765\u9632\u6b62bots\u4ece\u5b83\u4eec\u8eab\u4e0a\u722c\u6765\u722c\u53bb\uff0c\u5176\u590d\u6742\u7a0b\u5ea6\u5404\u4e0d\u76f8\u540c\u3002\u7ed5\u8fc7\u8fd9\u4e9b\u63aa\u65bd\u53ef\u80fd\u662f\u56f0\u96be\u548c\u68d8\u624b\u7684\uff0c\u6709\u65f6\u53ef\u80fd\u9700\u8981\u7279\u6b8a\u7684\u57fa\u7840\u8bbe\u65bd\u3002\u5982\u6709\u7591\u95ee\uff0c\u8bf7\u8003\u8651\u8054\u7cfb \u5546\u4e1a\u652f\u6301 \u3002 \u5728\u5904\u7406\u8fd9\u7c7b\u7f51\u7ad9\u65f6\uff0c\u8fd9\u91cc\u6709\u4e00\u4e9b\u63d0\u793a\u8981\u8bb0\u4f4f: \u5c06user agent\u4ece\u6d4f\u89c8\u5668\u7684\u77e5\u540d\u4ee3\u7406\u6c60\u4e2d\u8f6e\u8be2(\u901a\u8fc7\u8c37\u6b4c\u83b7\u5f97\u5b83\u4eec\u7684\u5217\u8868) \u7981\u7528cookie(\u8bf7\u53c2\u9605 COOKIES_ENABLED )\uff0c\u56e0\u4e3a\u4e00\u4e9b\u7ad9\u70b9\u53ef\u80fd\u4f7f\u7528cookie\u6765\u53d1\u73b0bot\u884c\u4e3a \u4f7f\u7528download delays(2\u6216\u66f4\u9ad8)\u3002\u770b DOWNLOAD_DELAY settings\u3002 \u5982\u679c\u53ef\u80fd\uff0c\u4f7f\u7528 \u8c37\u6b4c\u7f13\u5b58 \u6765\u83b7\u53d6\u9875\u9762\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u8bbf\u95ee\u7ad9\u70b9 \u8f6e\u8be2\u4f7f\u7528ip\u6c60\u3002\u4f8b\u5982\uff0c\u514d\u8d39 Tor\u9879\u76ee \u6216\u4ed8\u8d39\u670d\u52a1\uff0c\u5982 ProxyMesh \u3002\u4e00\u79cd\u5f00\u6e90\u7684\u66ff\u4ee3\u65b9\u6cd5\u662f scrapoxy \uff0c\u4e00\u79cd\u53ef\u4ee5\u5c06\u81ea\u5df1\u7684\u4ee3\u7406\u9644\u52a0\u5230\u5176\u4e0a\u7684\u8d85\u7ea7\u4ee3\u7406\u3002 \u4f7f\u7528\u9ad8\u5ea6\u5206\u5e03\u5f0f\u7684downloader\uff0c\u5b83\u53ef\u4ee5\u7ed5\u8fc7\u5185\u90e8\u7684\u7981\u6b62\uff0c\u8fd9\u6837\u60a8\u5c31\u53ef\u4ee5\u4e13\u6ce8\u4e8e\u89e3\u6790\u5e72\u51c0\u7684\u9875\u9762\u3002\u8fd9\u79cddownloader\u7684\u4e00\u4e2a\u4f8b\u5b50\u662f Crawlera \u5982\u679c\u4f60\u4ecd\u7136\u4e0d\u80fd\u963b\u6b62\u4f60\u7684bot\u88ab\u7981\u6b62\uff0c\u8003\u8651\u8054\u7cfb \u5546\u4e1a\u652f\u6301 \u3002","title":"\u907f\u514d\u88abban"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/05-broad-crawls/","text":"Broad Crawls Scrapy\u9ed8\u8ba4\u662f\u9488\u5bf9\u6293\u53d6\u7279\u5b9a\u7ad9\u70b9\u8fdb\u884c\u4f18\u5316\u7684\u3002\u8fd9\u4e9b\u7ad9\u70b9\u901a\u5e38\u7531\u4e00\u4e2aScrapy spider\u5904\u7406\uff0c\u5c3d\u7ba1\u8fd9\u4e0d\u662f\u5fc5\u987b\u7684\u6216\u5fc5\u9700\u7684(\u4f8b\u5982\uff0c\u6709\u4e00\u4e9b\u901a\u7528\u7684spider\uff0c\u53ef\u4ee5\u5904\u7406\u5411\u5b83\u4eec\u629b\u51fa\u7684\u4efb\u4f55\u7ed9\u5b9a\u7ad9\u70b9)\u3002 \u9664\u4e86\u8fd9\u79cd\u201c\u805a\u7126\u722c\u866b\u201d,\u8fd8\u6709\u53e6\u4e00\u4e2a\u5e38\u89c1\u7684\u722c\u884c\u6db5\u76d6\u6570\u91cf\u5927(\u53ef\u80fd\u662f\u65e0\u9650)\u7684domain,\u5e76\u4e14\u4ec5\u53d7\u65f6\u95f4\u6216\u5176\u4ed6\u4efb\u610f\u7ea6\u675f\u7684\u9650\u5236\uff0c\u800c\u4e0d\u662f\u5728domain\u722c\u884c\u5230\u5b8c\u6210\u65f6\u505c\u6b62\u6216\u8005\u5f53\u6ca1\u6709\u66f4\u591a\u7684\u8bf7\u6c42\u6765\u6267\u884c\u3002\u8fd9\u4e9b\u88ab\u79f0\u4e3a\u201c\u5e7f\u6cdb\u722c\u884c\u201d\uff0c\u662f\u641c\u7d22\u5f15\u64ce\u4f7f\u7528\u7684\u5178\u578b\u7684\u722c\u866b\u3002 \u8fd9\u4e9b\u662f\u4e00\u4e9b\u5e38\u89c1\u7684\u6027\u8d28\uff0c\u7ecf\u5e38\u5728\u5e7f\u6cdb\u7684\u722c\u884c\u53d1\u73b0: \u5b83\u4eec\u641c\u7d22\u8bb8\u591adomain(\u901a\u5e38,\u65e0\u9650)\uff0c\u800c\u4e0d\u662f\u7279\u5b9a\u7684\u4e00\u7ec4\u7ad9\u70b9 \u5b83\u4eec\u5e76\u4e0d\u4e00\u5b9a\u8981\u904d\u5386domain\u624d\u80fd\u5b8c\u6210\uff0c\u56e0\u4e3a\u8fd9\u6837\u505a\u662f\u4e0d\u5b9e\u9645\u7684(\u6216\u4e0d\u53ef\u80fd\u7684)\uff0c\u800c\u662f\u5e94\u8be5\u6839\u636e\u6293\u53d6\u7684\u65f6\u95f4\u6216\u9875\u6570\u6765\u9650\u5236\u6293\u53d6 \u5b83\u4eec\u5728\u903b\u8f91\u4e0a\u66f4\u7b80\u5355(\u4e0e\u5177\u6709\u8bb8\u591a\u63d0\u53d6\u89c4\u5219\u7684\u975e\u5e38\u590d\u6742\u7684\u722c\u884c\u5668\u76f8\u53cd)\uff0c\u56e0\u4e3a\u6570\u636e\u901a\u5e38\u5728\u5355\u72ec\u7684\u9636\u6bb5\u8fdb\u884c\u540e\u671f\u5904\u7406 \u5b83\u4eec\u53ef\u4ee5\u540c\u65f6\u722c\u884c\u591a\u4e2adomain\uff0c\u8fd9\u4f7f\u5f97\u5b83\u4eec\u4e0d\u53d7\u4efb\u4f55\u7279\u5b9a\u7ad9\u70b9\u7ea6\u675f\u7684\u9650\u5236\uff0c\u4ece\u800c\u83b7\u5f97\u66f4\u5feb\u7684\u722c\u884c\u901f\u5ea6(\u4e3a\u4e86\u793c\u8c8c\u8d77\u89c1\uff0c\u6bcf\u4e2a\u7ad9\u70b9\u90fd\u662f\u7f13\u6162\u722c\u884c\u7684\uff0c\u4f46\u662f\u8bb8\u591a\u7ad9\u70b9\u662f\u5e76\u884c\u722c\u884c\u7684) \u5982\u4e0a\u6240\u8ff0\uff0cScrapy\u9ed8\u8ba4\u8bbe\u7f6e\u662f\u9488\u5bf9\u6709\u91cd\u70b9\u7684spider\u800c\u4e0d\u662f\u5e7f\u6cdb\u7684\u722c\u866b\u8fdb\u884c\u4f18\u5316\u7684\u3002\u4f46\u662f\uff0c\u7531\u4e8e\u5176\u5f02\u6b65\u4f53\u7cfb\u7ed3\u6784\uff0cScrapy\u975e\u5e38\u9002\u5408\u6267\u884c\u5feb\u901f\u5e7f\u6cdb\u7684\u722c\u884c\u3002\u8fd9\u4e2a\u9875\u9762\u603b\u7ed3\u4e86\u5728\u4f7f\u7528Scrapy\u8fdb\u884c\u5e7f\u6cdb\u722c\u884c\u65f6\u9700\u8981\u8bb0\u4f4f\u7684\u4e00\u4e9b\u5185\u5bb9\uff0c\u5e76\u63d0\u4f9b\u4e86\u4e00\u4e9bScrapy settings\u5173\u4e8e\u5982\u4f55\u8fdb\u884c\u4f18\u5316\u4ee5\u5b9e\u73b0\u9ad8\u6548\u7684\u5e7f\u6cdb\u722c\u884c\u7684\u5177\u4f53\u5efa\u8bae\u3002 \u63d0\u9ad8\u5e76\u53d1\u6027 \u5e76\u53d1\u6027\u662f\u5e76\u884c\u5904\u7406\u7684\u8bf7\u6c42\u6570\u3002\u6709\u4e00\u4e2a\u5168\u5c40\u9650\u5236\u548c\u4e00\u4e2a\u9488\u5bf9\u6bcf\u4e2adomain\u9650\u5236\u3002 Scrapy\u4e2d\u7684\u9ed8\u8ba4\u5168\u5c40\u5e76\u53d1\u9650\u5236\u4e0d\u9002\u7528\u4e8e\u5e76\u884c\u5730\u722c\u884c\u8bb8\u591a\u4e0d\u540c\u7684domain\uff0c\u56e0\u6b64\u60a8\u9700\u8981\u589e\u52a0\u5b83\u3002\u589e\u52a0\u591a\u5c11\u53d6\u51b3\u4e8e\u722c\u866b\u7a0b\u5e8f\u6709\u591a\u5c11CPU\u53ef\u7528\u3002\u4e00\u4e2a\u597d\u7684\u8d77\u70b9\u662f 100 \uff0c\u4f46\u6700\u597d\u7684\u65b9\u6cd5\u662f\u505a\u4e00\u4e9b\u8bd5\u9a8c\uff0c\u5e76\u786e\u5b9a\u4ec0\u4e48\u5e76\u53d1\u6027\u4f1a\u9650\u5236\u4f60\u7684Scrapy\u5904\u7406\u8fc7\u7a0b\u3002\u4e3a\u4e86\u83b7\u5f97\u6700\u4f73\u6027\u80fd\uff0c\u60a8\u5e94\u8be5\u9009\u62e9CPU\u4f7f\u7528\u7387\u572880-90%\u7684\u5e76\u53d1\u6027\u3002 \u589e\u52a0\u5168\u5c40\u5e76\u53d1\u6027\u7684\u4f7f\u7528: CONCURRENT_REQUESTS = 100 \u589e\u52a0Twisted IO\u7ebf\u7a0b\u6c60\u7684\u6700\u5927\u5bb9\u91cf \u76ee\u524d\uff0cScrapy\u4f7f\u7528\u7ebf\u7a0b\u6c60\u4ee5\u963b\u585e\u7684\u65b9\u5f0f\u8fdb\u884cDNS\u89e3\u6790\u3002\u968f\u7740\u5e76\u53d1\u7ea7\u522b\u7684\u63d0\u9ad8\uff0c\u722c\u884c\u901f\u5ea6\u53ef\u80fd\u4f1a\u53d8\u6162\uff0c\u751a\u81f3\u5931\u8d25\uff0c\u5bfc\u81f4DNS\u89e3\u6790\u8d85\u65f6\u3002\u53ef\u80fd\u7684\u89e3\u51b3\u65b9\u6848\u662f\u589e\u52a0\u5904\u7406DNS\u67e5\u8be2\u7684\u7ebf\u7a0b\u6570\u3002DNS\u961f\u5217\u5c06\u88ab\u66f4\u5feb\u5730\u5904\u7406\uff0c\u52a0\u5feb\u8fde\u63a5\u7684\u5efa\u7acb\u548c\u722c\u884c\u3002 \u589e\u52a0\u6700\u5927\u7ebf\u7a0b\u6c60\u5927\u5c0f\u4f7f\u7528: REACTOR_THREADPOOL_MAXSIZE = 20 \u8bbe\u7f6e\u60a8\u81ea\u5df1\u7684DNS \u5982\u679c\u60a8\u6709\u591a\u4e2a\u722c\u866b\u8fdb\u7a0b\u548c\u4e00\u4e2a\u4e2d\u592eDNS\uff0c\u5b83\u53ef\u80fd\u4f1a\u50cfDoS\u653b\u51fb\u4e00\u6837\u653b\u51fbDNS\u670d\u52a1\u5668\uff0c\u5bfc\u81f4\u6574\u4e2a\u7f51\u7edc\u901f\u5ea6\u51cf\u6162\uff0c\u751a\u81f3\u963b\u585e\u60a8\u7684\u8ba1\u7b97\u673a\u3002\u4e3a\u4e86\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u672c\u5730\u7f13\u5b58\u548c\u4e0a\u6e38\u5230\u4e00\u4e9b\u5927\u578bDNS\u670d\u52a1\u5668\uff0c\u5982OpenDNS\u6216Verizon\u3002 \u51cf\u5c11\u65e5\u5fd7\u7ea7\u522b \u5728\u8fdb\u884c\u5e7f\u6cdb\u7684\u722c\u884c\u65f6\uff0c\u60a8\u901a\u5e38\u53ea\u5bf9\u6240\u83b7\u5f97\u7684\u722c\u884c\u901f\u5ea6\u548c\u53d1\u73b0\u7684\u4efb\u4f55\u9519\u8bef\u611f\u5174\u8da3\u3002\u8fd9\u4e9b\u6570\u636e\u662f\u7531Scrapy\u5728\u4f7f\u7528 INFO \u65e5\u5fd7\u7ea7\u522b\u65f6\u62a5\u544a\u7684\u3002\u4e3a\u4e86\u8282\u7701CPU(\u548c\u65e5\u5fd7\u5b58\u50a8\u9700\u6c42)\uff0c\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u9884\u751f\u6210\u5927\u8303\u56f4\u722c\u866b\u65f6\uff0c\u4e0d\u5e94\u8be5\u4f7f\u7528 DEBUG \u65e5\u5fd7\u7ea7\u522b\u3002\u4e0d\u8fc7\uff0c\u5728\u5f00\u53d1(\u5e7f\u6cdb\u7684)\u722c\u866b\u7a0b\u5e8f\u65f6\u4f7f\u7528 DEBUG \u7ea7\u522b\u53ef\u80fd\u4e0d\u9519\u3002 \u8bbe\u7f6elog\u7ea7\u522b\u4f7f\u7528: LOG_LEVEL = 'INFO' \u7981\u7528Cookies \u9664\u975e\u60a8\u786e\u5b9e\u9700\u8981\uff0c\u5426\u5219\u7981\u7528cookie\u3002\u5728\u8fdb\u884c\u5e7f\u6cdb\u7684\u722c\u866b\u65f6\uff0c\u901a\u5e38\u4e0d\u9700\u8981cookie(\u641c\u7d22\u5f15\u64ce\u722c\u866b\u4f1a\u5ffd\u7565\u5b83\u4eec)\uff0c\u5b83\u4eec\u901a\u8fc7\u8282\u7701CPU\u5468\u671f\u548c\u51cf\u5c11scrapy\u722c\u866b\u7684\u5185\u5b58\u5360\u7528\u6765\u63d0\u9ad8\u6027\u80fd\u3002 \u7981\u7528cookies\u4f7f\u7528: COOKIES_ENABLED = False \u7981\u7528\u91cd\u8bd5 \u91cd\u65b0\u5931\u8d25\u7684HTTP\u8bf7\u6c42\u4f1a\u5927\u5927\u964d\u4f4e\u722c\u884c\u901f\u5ea6\uff0c\u7279\u522b\u662f\u5f53\u7ad9\u70b9\u539f\u56e0\u54cd\u5e94\u975e\u5e38\u6162(\u6216\u5931\u8d25)\u65f6\uff0c\u4f1a\u5bfc\u81f4\u8d85\u65f6\u9519\u8bef\uff0c\u5bfc\u81f4\u591a\u6b21\u4e0d\u5fc5\u8981\u5730\u91cd\u8bd5\uff0c\u4ece\u800c\u963b\u6b62\u722c\u884c\u5668\u5bb9\u91cf\u88ab\u5176\u4ed6domain\u91cd\u7528\u3002 \u7981\u7528\u91cd\u8bd5: RETRY_ENABLED = False \u51cf\u5c11\u4e0b\u8f7d\u8d85\u65f6 \u9664\u975e\u60a8\u6b63\u5728\u4ece\u4e00\u4e2a\u975e\u5e38\u6162\u7684\u8fde\u63a5\u4e2d\u722c\u884c(\u5bf9\u4e8e\u5e7f\u6cdb\u7684\u722c\u884c\u6765\u8bf4\u4e0d\u5e94\u8be5\u662f\u8fd9\u6837\u7684)\uff0c\u5426\u5219\u5e94\u8be5\u5c06\u51cf\u5c11\u4e0b\u8f7d\u8d85\u65f6\uff0c\u4ee5\u4fbf\u5feb\u901f\u4e22\u5f03\u88ab\u5361\u4f4f\u7684\u8bf7\u6c42\uff0c\u5e76\u91ca\u653e\u51fa\u5904\u7406\u4e0b\u4e00\u4e2a\u8bf7\u6c42\u7684\u80fd\u529b\u3002 \u4e3a\u4e86\u51cf\u5c11\u4e0b\u8f7d\u8d85\u65f6\u4f7f\u7528 DOWNLOAD_TIMEOUT = 15 \u7981\u7528\u91cd\u5b9a\u5411 \u8003\u8651\u7981\u7528\u91cd\u5b9a\u5411\uff0c\u9664\u975e\u60a8\u6709\u5174\u8da3\u8ddf\u8e2a\u5b83\u4eec\u3002\u5728\u8fdb\u884c\u5e7f\u6cdb\u7684\u722c\u884c\u65f6\uff0c\u901a\u5e38\u5728\u7a0d\u540e\u7684\u722c\u884c\u4e2d\u91cd\u65b0\u8bbf\u95ee\u7ad9\u70b9\u65f6\u4fdd\u5b58\u91cd\u5b9a\u5411\u5e76\u89e3\u51b3\u5b83\u4eec\u3002\u8fd9\u4e5f\u6709\u52a9\u4e8e\u4fdd\u6301\u6bcf\u6b21\u6293\u53d6\u6279\u5904\u7406\u7684\u8bf7\u6c42\u6570\u91cf\u4e0d\u53d8\uff0c\u5426\u5219\u91cd\u5b9a\u5411\u5faa\u73af\u53ef\u80fd\u4f1a\u5bfc\u81f4\u722c\u866b\u7a0b\u5e8f\u5728\u4efb\u4f55\u7279\u5b9adomain\u4e0a\u5360\u7528\u592a\u591a\u7684\u8d44\u6e90\u3002 \u7981\u6b62\u91cd\u5b9a\u5411\u4f7f\u7528 REDIRECT_ENABLED = False \u542f\u7528\u201cAjax Crawlable\u9875\u9762\u201d\u7684\u722c\u884c \u4e00\u4e9b\u9875\u9762(\u6839\u636e2013\u5e74\u7684\u7ecf\u9a8c\u6570\u636e\uff0c\u6700\u9ad8\u8fbe\u52301%)\u58f0\u660e\u81ea\u5df1\u662fajax crawlable\u3002\u8fd9\u610f\u5473\u7740\u5b83\u4eec\u63d0\u4f9b\u7684\u5185\u5bb9\u7684\u7eafHTML\u7248\u672c\u901a\u5e38\u53ea\u80fd\u901a\u8fc7AJAX\u83b7\u5f97\u3002\u9875\u9762\u53ef\u4ee5\u7528\u4e24\u79cd\u65b9\u5f0f\u8868\u793a: \u5728URL\u4f7f\u7528 #! - \u8fd9\u662f\u9ed8\u8ba4\u7684\u65b9\u5f0f \u4f7f\u7528\u7279\u6b8a\u7684meta tag - \u8fd9\u79cd\u65b9\u6cd5\u5728\u201cmain\u201d\u3001\u201cindex\u201d\u7f51\u7ad9\u9875\u9762\u4e0a\u4f7f\u7528\u3002 Scrapy handles \u81ea\u52a8\u5904\u7406 \u6fc0\u6d3b AjaxCrawlMiddleware AJAXCRAWL_ENABLED = True \u5f53\u8fdb\u884c\u5e7f\u6cdb\u7684\u722c\u884c\u65f6\uff0c\u901a\u5e38\u4f1a\u6293\u53d6\u5927\u91cf\u7684\u201cindex\u201dweb\u9875\u9762; AjaxCrawlMiddleware\u6709\u52a9\u4e8e\u6b63\u786e\u5730\u6293\u53d6\u5b83\u4eec\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5b83\u662f\u5173\u95ed\u7684\uff0c\u56e0\u4e3a\u5b83\u6709\u4e00\u4e9b\u6027\u80fd\u5f00\u9500\uff0c\u542f\u7528\u5b83\u6765\u805a\u7126\u722c\u866b\u6ca1\u6709\u591a\u5927\u610f\u4e49\u3002","title":"Broad Crawls"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/05-broad-crawls/#broad-crawls","text":"Scrapy\u9ed8\u8ba4\u662f\u9488\u5bf9\u6293\u53d6\u7279\u5b9a\u7ad9\u70b9\u8fdb\u884c\u4f18\u5316\u7684\u3002\u8fd9\u4e9b\u7ad9\u70b9\u901a\u5e38\u7531\u4e00\u4e2aScrapy spider\u5904\u7406\uff0c\u5c3d\u7ba1\u8fd9\u4e0d\u662f\u5fc5\u987b\u7684\u6216\u5fc5\u9700\u7684(\u4f8b\u5982\uff0c\u6709\u4e00\u4e9b\u901a\u7528\u7684spider\uff0c\u53ef\u4ee5\u5904\u7406\u5411\u5b83\u4eec\u629b\u51fa\u7684\u4efb\u4f55\u7ed9\u5b9a\u7ad9\u70b9)\u3002 \u9664\u4e86\u8fd9\u79cd\u201c\u805a\u7126\u722c\u866b\u201d,\u8fd8\u6709\u53e6\u4e00\u4e2a\u5e38\u89c1\u7684\u722c\u884c\u6db5\u76d6\u6570\u91cf\u5927(\u53ef\u80fd\u662f\u65e0\u9650)\u7684domain,\u5e76\u4e14\u4ec5\u53d7\u65f6\u95f4\u6216\u5176\u4ed6\u4efb\u610f\u7ea6\u675f\u7684\u9650\u5236\uff0c\u800c\u4e0d\u662f\u5728domain\u722c\u884c\u5230\u5b8c\u6210\u65f6\u505c\u6b62\u6216\u8005\u5f53\u6ca1\u6709\u66f4\u591a\u7684\u8bf7\u6c42\u6765\u6267\u884c\u3002\u8fd9\u4e9b\u88ab\u79f0\u4e3a\u201c\u5e7f\u6cdb\u722c\u884c\u201d\uff0c\u662f\u641c\u7d22\u5f15\u64ce\u4f7f\u7528\u7684\u5178\u578b\u7684\u722c\u866b\u3002 \u8fd9\u4e9b\u662f\u4e00\u4e9b\u5e38\u89c1\u7684\u6027\u8d28\uff0c\u7ecf\u5e38\u5728\u5e7f\u6cdb\u7684\u722c\u884c\u53d1\u73b0: \u5b83\u4eec\u641c\u7d22\u8bb8\u591adomain(\u901a\u5e38,\u65e0\u9650)\uff0c\u800c\u4e0d\u662f\u7279\u5b9a\u7684\u4e00\u7ec4\u7ad9\u70b9 \u5b83\u4eec\u5e76\u4e0d\u4e00\u5b9a\u8981\u904d\u5386domain\u624d\u80fd\u5b8c\u6210\uff0c\u56e0\u4e3a\u8fd9\u6837\u505a\u662f\u4e0d\u5b9e\u9645\u7684(\u6216\u4e0d\u53ef\u80fd\u7684)\uff0c\u800c\u662f\u5e94\u8be5\u6839\u636e\u6293\u53d6\u7684\u65f6\u95f4\u6216\u9875\u6570\u6765\u9650\u5236\u6293\u53d6 \u5b83\u4eec\u5728\u903b\u8f91\u4e0a\u66f4\u7b80\u5355(\u4e0e\u5177\u6709\u8bb8\u591a\u63d0\u53d6\u89c4\u5219\u7684\u975e\u5e38\u590d\u6742\u7684\u722c\u884c\u5668\u76f8\u53cd)\uff0c\u56e0\u4e3a\u6570\u636e\u901a\u5e38\u5728\u5355\u72ec\u7684\u9636\u6bb5\u8fdb\u884c\u540e\u671f\u5904\u7406 \u5b83\u4eec\u53ef\u4ee5\u540c\u65f6\u722c\u884c\u591a\u4e2adomain\uff0c\u8fd9\u4f7f\u5f97\u5b83\u4eec\u4e0d\u53d7\u4efb\u4f55\u7279\u5b9a\u7ad9\u70b9\u7ea6\u675f\u7684\u9650\u5236\uff0c\u4ece\u800c\u83b7\u5f97\u66f4\u5feb\u7684\u722c\u884c\u901f\u5ea6(\u4e3a\u4e86\u793c\u8c8c\u8d77\u89c1\uff0c\u6bcf\u4e2a\u7ad9\u70b9\u90fd\u662f\u7f13\u6162\u722c\u884c\u7684\uff0c\u4f46\u662f\u8bb8\u591a\u7ad9\u70b9\u662f\u5e76\u884c\u722c\u884c\u7684) \u5982\u4e0a\u6240\u8ff0\uff0cScrapy\u9ed8\u8ba4\u8bbe\u7f6e\u662f\u9488\u5bf9\u6709\u91cd\u70b9\u7684spider\u800c\u4e0d\u662f\u5e7f\u6cdb\u7684\u722c\u866b\u8fdb\u884c\u4f18\u5316\u7684\u3002\u4f46\u662f\uff0c\u7531\u4e8e\u5176\u5f02\u6b65\u4f53\u7cfb\u7ed3\u6784\uff0cScrapy\u975e\u5e38\u9002\u5408\u6267\u884c\u5feb\u901f\u5e7f\u6cdb\u7684\u722c\u884c\u3002\u8fd9\u4e2a\u9875\u9762\u603b\u7ed3\u4e86\u5728\u4f7f\u7528Scrapy\u8fdb\u884c\u5e7f\u6cdb\u722c\u884c\u65f6\u9700\u8981\u8bb0\u4f4f\u7684\u4e00\u4e9b\u5185\u5bb9\uff0c\u5e76\u63d0\u4f9b\u4e86\u4e00\u4e9bScrapy settings\u5173\u4e8e\u5982\u4f55\u8fdb\u884c\u4f18\u5316\u4ee5\u5b9e\u73b0\u9ad8\u6548\u7684\u5e7f\u6cdb\u722c\u884c\u7684\u5177\u4f53\u5efa\u8bae\u3002","title":"Broad Crawls"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/05-broad-crawls/#_1","text":"\u5e76\u53d1\u6027\u662f\u5e76\u884c\u5904\u7406\u7684\u8bf7\u6c42\u6570\u3002\u6709\u4e00\u4e2a\u5168\u5c40\u9650\u5236\u548c\u4e00\u4e2a\u9488\u5bf9\u6bcf\u4e2adomain\u9650\u5236\u3002 Scrapy\u4e2d\u7684\u9ed8\u8ba4\u5168\u5c40\u5e76\u53d1\u9650\u5236\u4e0d\u9002\u7528\u4e8e\u5e76\u884c\u5730\u722c\u884c\u8bb8\u591a\u4e0d\u540c\u7684domain\uff0c\u56e0\u6b64\u60a8\u9700\u8981\u589e\u52a0\u5b83\u3002\u589e\u52a0\u591a\u5c11\u53d6\u51b3\u4e8e\u722c\u866b\u7a0b\u5e8f\u6709\u591a\u5c11CPU\u53ef\u7528\u3002\u4e00\u4e2a\u597d\u7684\u8d77\u70b9\u662f 100 \uff0c\u4f46\u6700\u597d\u7684\u65b9\u6cd5\u662f\u505a\u4e00\u4e9b\u8bd5\u9a8c\uff0c\u5e76\u786e\u5b9a\u4ec0\u4e48\u5e76\u53d1\u6027\u4f1a\u9650\u5236\u4f60\u7684Scrapy\u5904\u7406\u8fc7\u7a0b\u3002\u4e3a\u4e86\u83b7\u5f97\u6700\u4f73\u6027\u80fd\uff0c\u60a8\u5e94\u8be5\u9009\u62e9CPU\u4f7f\u7528\u7387\u572880-90%\u7684\u5e76\u53d1\u6027\u3002","title":"\u63d0\u9ad8\u5e76\u53d1\u6027"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/05-broad-crawls/#_2","text":"CONCURRENT_REQUESTS = 100","title":"\u589e\u52a0\u5168\u5c40\u5e76\u53d1\u6027\u7684\u4f7f\u7528:"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/05-broad-crawls/#twisted-io","text":"\u76ee\u524d\uff0cScrapy\u4f7f\u7528\u7ebf\u7a0b\u6c60\u4ee5\u963b\u585e\u7684\u65b9\u5f0f\u8fdb\u884cDNS\u89e3\u6790\u3002\u968f\u7740\u5e76\u53d1\u7ea7\u522b\u7684\u63d0\u9ad8\uff0c\u722c\u884c\u901f\u5ea6\u53ef\u80fd\u4f1a\u53d8\u6162\uff0c\u751a\u81f3\u5931\u8d25\uff0c\u5bfc\u81f4DNS\u89e3\u6790\u8d85\u65f6\u3002\u53ef\u80fd\u7684\u89e3\u51b3\u65b9\u6848\u662f\u589e\u52a0\u5904\u7406DNS\u67e5\u8be2\u7684\u7ebf\u7a0b\u6570\u3002DNS\u961f\u5217\u5c06\u88ab\u66f4\u5feb\u5730\u5904\u7406\uff0c\u52a0\u5feb\u8fde\u63a5\u7684\u5efa\u7acb\u548c\u722c\u884c\u3002 \u589e\u52a0\u6700\u5927\u7ebf\u7a0b\u6c60\u5927\u5c0f\u4f7f\u7528: REACTOR_THREADPOOL_MAXSIZE = 20","title":"\u589e\u52a0Twisted IO\u7ebf\u7a0b\u6c60\u7684\u6700\u5927\u5bb9\u91cf"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/05-broad-crawls/#dns","text":"\u5982\u679c\u60a8\u6709\u591a\u4e2a\u722c\u866b\u8fdb\u7a0b\u548c\u4e00\u4e2a\u4e2d\u592eDNS\uff0c\u5b83\u53ef\u80fd\u4f1a\u50cfDoS\u653b\u51fb\u4e00\u6837\u653b\u51fbDNS\u670d\u52a1\u5668\uff0c\u5bfc\u81f4\u6574\u4e2a\u7f51\u7edc\u901f\u5ea6\u51cf\u6162\uff0c\u751a\u81f3\u963b\u585e\u60a8\u7684\u8ba1\u7b97\u673a\u3002\u4e3a\u4e86\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u672c\u5730\u7f13\u5b58\u548c\u4e0a\u6e38\u5230\u4e00\u4e9b\u5927\u578bDNS\u670d\u52a1\u5668\uff0c\u5982OpenDNS\u6216Verizon\u3002","title":"\u8bbe\u7f6e\u60a8\u81ea\u5df1\u7684DNS"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/05-broad-crawls/#_3","text":"\u5728\u8fdb\u884c\u5e7f\u6cdb\u7684\u722c\u884c\u65f6\uff0c\u60a8\u901a\u5e38\u53ea\u5bf9\u6240\u83b7\u5f97\u7684\u722c\u884c\u901f\u5ea6\u548c\u53d1\u73b0\u7684\u4efb\u4f55\u9519\u8bef\u611f\u5174\u8da3\u3002\u8fd9\u4e9b\u6570\u636e\u662f\u7531Scrapy\u5728\u4f7f\u7528 INFO \u65e5\u5fd7\u7ea7\u522b\u65f6\u62a5\u544a\u7684\u3002\u4e3a\u4e86\u8282\u7701CPU(\u548c\u65e5\u5fd7\u5b58\u50a8\u9700\u6c42)\uff0c\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u9884\u751f\u6210\u5927\u8303\u56f4\u722c\u866b\u65f6\uff0c\u4e0d\u5e94\u8be5\u4f7f\u7528 DEBUG \u65e5\u5fd7\u7ea7\u522b\u3002\u4e0d\u8fc7\uff0c\u5728\u5f00\u53d1(\u5e7f\u6cdb\u7684)\u722c\u866b\u7a0b\u5e8f\u65f6\u4f7f\u7528 DEBUG \u7ea7\u522b\u53ef\u80fd\u4e0d\u9519\u3002 \u8bbe\u7f6elog\u7ea7\u522b\u4f7f\u7528: LOG_LEVEL = 'INFO'","title":"\u51cf\u5c11\u65e5\u5fd7\u7ea7\u522b"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/05-broad-crawls/#cookies","text":"\u9664\u975e\u60a8\u786e\u5b9e\u9700\u8981\uff0c\u5426\u5219\u7981\u7528cookie\u3002\u5728\u8fdb\u884c\u5e7f\u6cdb\u7684\u722c\u866b\u65f6\uff0c\u901a\u5e38\u4e0d\u9700\u8981cookie(\u641c\u7d22\u5f15\u64ce\u722c\u866b\u4f1a\u5ffd\u7565\u5b83\u4eec)\uff0c\u5b83\u4eec\u901a\u8fc7\u8282\u7701CPU\u5468\u671f\u548c\u51cf\u5c11scrapy\u722c\u866b\u7684\u5185\u5b58\u5360\u7528\u6765\u63d0\u9ad8\u6027\u80fd\u3002 \u7981\u7528cookies\u4f7f\u7528: COOKIES_ENABLED = False","title":"\u7981\u7528Cookies"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/05-broad-crawls/#_4","text":"\u91cd\u65b0\u5931\u8d25\u7684HTTP\u8bf7\u6c42\u4f1a\u5927\u5927\u964d\u4f4e\u722c\u884c\u901f\u5ea6\uff0c\u7279\u522b\u662f\u5f53\u7ad9\u70b9\u539f\u56e0\u54cd\u5e94\u975e\u5e38\u6162(\u6216\u5931\u8d25)\u65f6\uff0c\u4f1a\u5bfc\u81f4\u8d85\u65f6\u9519\u8bef\uff0c\u5bfc\u81f4\u591a\u6b21\u4e0d\u5fc5\u8981\u5730\u91cd\u8bd5\uff0c\u4ece\u800c\u963b\u6b62\u722c\u884c\u5668\u5bb9\u91cf\u88ab\u5176\u4ed6domain\u91cd\u7528\u3002 \u7981\u7528\u91cd\u8bd5: RETRY_ENABLED = False","title":"\u7981\u7528\u91cd\u8bd5"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/05-broad-crawls/#_5","text":"\u9664\u975e\u60a8\u6b63\u5728\u4ece\u4e00\u4e2a\u975e\u5e38\u6162\u7684\u8fde\u63a5\u4e2d\u722c\u884c(\u5bf9\u4e8e\u5e7f\u6cdb\u7684\u722c\u884c\u6765\u8bf4\u4e0d\u5e94\u8be5\u662f\u8fd9\u6837\u7684)\uff0c\u5426\u5219\u5e94\u8be5\u5c06\u51cf\u5c11\u4e0b\u8f7d\u8d85\u65f6\uff0c\u4ee5\u4fbf\u5feb\u901f\u4e22\u5f03\u88ab\u5361\u4f4f\u7684\u8bf7\u6c42\uff0c\u5e76\u91ca\u653e\u51fa\u5904\u7406\u4e0b\u4e00\u4e2a\u8bf7\u6c42\u7684\u80fd\u529b\u3002 \u4e3a\u4e86\u51cf\u5c11\u4e0b\u8f7d\u8d85\u65f6\u4f7f\u7528 DOWNLOAD_TIMEOUT = 15","title":"\u51cf\u5c11\u4e0b\u8f7d\u8d85\u65f6"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/05-broad-crawls/#_6","text":"\u8003\u8651\u7981\u7528\u91cd\u5b9a\u5411\uff0c\u9664\u975e\u60a8\u6709\u5174\u8da3\u8ddf\u8e2a\u5b83\u4eec\u3002\u5728\u8fdb\u884c\u5e7f\u6cdb\u7684\u722c\u884c\u65f6\uff0c\u901a\u5e38\u5728\u7a0d\u540e\u7684\u722c\u884c\u4e2d\u91cd\u65b0\u8bbf\u95ee\u7ad9\u70b9\u65f6\u4fdd\u5b58\u91cd\u5b9a\u5411\u5e76\u89e3\u51b3\u5b83\u4eec\u3002\u8fd9\u4e5f\u6709\u52a9\u4e8e\u4fdd\u6301\u6bcf\u6b21\u6293\u53d6\u6279\u5904\u7406\u7684\u8bf7\u6c42\u6570\u91cf\u4e0d\u53d8\uff0c\u5426\u5219\u91cd\u5b9a\u5411\u5faa\u73af\u53ef\u80fd\u4f1a\u5bfc\u81f4\u722c\u866b\u7a0b\u5e8f\u5728\u4efb\u4f55\u7279\u5b9adomain\u4e0a\u5360\u7528\u592a\u591a\u7684\u8d44\u6e90\u3002 \u7981\u6b62\u91cd\u5b9a\u5411\u4f7f\u7528 REDIRECT_ENABLED = False","title":"\u7981\u7528\u91cd\u5b9a\u5411"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/05-broad-crawls/#ajax-crawlable","text":"\u4e00\u4e9b\u9875\u9762(\u6839\u636e2013\u5e74\u7684\u7ecf\u9a8c\u6570\u636e\uff0c\u6700\u9ad8\u8fbe\u52301%)\u58f0\u660e\u81ea\u5df1\u662fajax crawlable\u3002\u8fd9\u610f\u5473\u7740\u5b83\u4eec\u63d0\u4f9b\u7684\u5185\u5bb9\u7684\u7eafHTML\u7248\u672c\u901a\u5e38\u53ea\u80fd\u901a\u8fc7AJAX\u83b7\u5f97\u3002\u9875\u9762\u53ef\u4ee5\u7528\u4e24\u79cd\u65b9\u5f0f\u8868\u793a: \u5728URL\u4f7f\u7528 #! - \u8fd9\u662f\u9ed8\u8ba4\u7684\u65b9\u5f0f \u4f7f\u7528\u7279\u6b8a\u7684meta tag - \u8fd9\u79cd\u65b9\u6cd5\u5728\u201cmain\u201d\u3001\u201cindex\u201d\u7f51\u7ad9\u9875\u9762\u4e0a\u4f7f\u7528\u3002 Scrapy handles \u81ea\u52a8\u5904\u7406 \u6fc0\u6d3b AjaxCrawlMiddleware AJAXCRAWL_ENABLED = True \u5f53\u8fdb\u884c\u5e7f\u6cdb\u7684\u722c\u884c\u65f6\uff0c\u901a\u5e38\u4f1a\u6293\u53d6\u5927\u91cf\u7684\u201cindex\u201dweb\u9875\u9762; AjaxCrawlMiddleware\u6709\u52a9\u4e8e\u6b63\u786e\u5730\u6293\u53d6\u5b83\u4eec\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5b83\u662f\u5173\u95ed\u7684\uff0c\u56e0\u4e3a\u5b83\u6709\u4e00\u4e9b\u6027\u80fd\u5f00\u9500\uff0c\u542f\u7528\u5b83\u6765\u805a\u7126\u722c\u866b\u6ca1\u6709\u591a\u5927\u610f\u4e49\u3002","title":"\u542f\u7528\u201cAjax Crawlable\u9875\u9762\u201d\u7684\u722c\u884c"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/06-use-firefox-scraping/","text":"\u4f7f\u7528Firefox\u8fdb\u884c\u6293\u53d6(\u6ca1\u5199) \u4f7f\u7528Firefox\u8fdb\u884c\u6293\u53d6","title":"\u4f7f\u7528Firefox\u8fdb\u884c\u6293\u53d6(\u6ca1\u5199)"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/06-use-firefox-scraping/#firefox","text":"\u4f7f\u7528Firefox\u8fdb\u884c\u6293\u53d6","title":"\u4f7f\u7528Firefox\u8fdb\u884c\u6293\u53d6(\u6ca1\u5199)"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/07-use-firbug-scraping/","text":"\u4f7f\u7528Firebug\u8fdb\u884c\u6293\u53d6(\u6ca1\u5199) \u70b9\u51fb\u8df3\u8fde\u63a5","title":"\u4f7f\u7528Firebug\u8fdb\u884c\u6293\u53d6(\u6ca1\u5199)"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/07-use-firbug-scraping/#firebug","text":"\u70b9\u51fb\u8df3\u8fde\u63a5","title":"\u4f7f\u7528Firebug\u8fdb\u884c\u6293\u53d6(\u6ca1\u5199)"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/08-debugging-memory/","text":"\u8c03\u8bd5\u5185\u5b58\u6cc4\u6f0f \u5728Scrapy\u4e2d\uff0cRequests\u3001Responses\u548cItems\u7b49\u5bf9\u8c61\u7684\u751f\u547d\u5468\u671f\u662f\u6709\u9650\u7684:\u5b83\u4eec\u88ab\u521b\u5efa\u3001\u4f7f\u7528\u4e00\u6bb5\u65f6\u95f4\uff0c\u6700\u540e\u88ab\u9500\u6bc1\u3002 \u5728\u6240\u6709\u8fd9\u4e9b\u5bf9\u8c61\u4e2d\uff0cRequest\u53ef\u80fd\u662f\u751f\u547d\u5468\u671f\u6700\u957f\u7684\u4e00\u4e2a\uff0c\u56e0\u4e3a\u5b83\u5728Scheduler\u961f\u5217\u4e2d\u7b49\u5f85\uff0c\u76f4\u5230\u5904\u7406\u5b83\u7684\u65f6\u5019\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 \u4f53\u7cfb\u7ed3\u6784\u6982\u8ff0 \u3002 \u7531\u4e8e\u8fd9\u4e9bScrapy\u5bf9\u8c61\u6709\u4e00\u4e2a(\u76f8\u5f53\u957f\u7684)\u751f\u547d\u5468\u671f\uff0c\u56e0\u6b64\u5728\u6ca1\u6709\u9002\u5f53\u91ca\u653e\u5b83\u4eec\u7684\u60c5\u51b5\u4e0b\uff0c\u5728\u5185\u5b58\u4e2d\u79ef\u7d2f\u5b83\u4eec\u603b\u662f\u6709\u98ce\u9669\u7684\uff0c\u4ece\u800c\u5bfc\u81f4\u6240\u8c13\u7684\u201c\u5185\u5b58\u6cc4\u6f0f\u201d\u3002 \u4e3a\u4e86\u5e2e\u52a9\u8c03\u8bd5\u5185\u5b58\u6cc4\u6f0f\uff0cScrapy\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7528\u4e8e\u8ddf\u8e2a\u5bf9\u8c61\u5f15\u7528\u7684\u5185\u7f6e\u673a\u5236\uff0c\u79f0\u4e3a trackref \uff0c\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528\u540d\u4e3a Guppy \u7684\u7b2c\u4e09\u65b9\u5e93\u8fdb\u884c\u66f4\u9ad8\u7ea7\u7684\u5185\u5b58\u8c03\u8bd5(\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u4e0b\u9762)\u3002\u8fd9\u4e24\u79cd\u673a\u5236\u90fd\u5fc5\u987b\u4ece Telnet Console \u4f7f\u7528\u3002 \u5185\u5b58\u6cc4\u6f0f\u7684\u5e38\u89c1\u539f\u56e0 Scrapy\u5f00\u53d1\u4eba\u5458\u7ecf\u5e38 (\u6709\u65f6\u662f\u5076\u7136\u7684\uff0c\u6709\u65f6\u662f\u6545\u610f\u7684) \u4f1a\u4f20\u9012Requests (\u4f8b\u5982\uff0c\u4f7f\u7528 meta \u5c5e\u6027\u6216request callback\u51fd\u6570) \u4e2d\u5f15\u7528\u7684\u5bf9\u8c61\uff0c\u8fd9\u6709\u6548\u5730\u5c06\u8fd9\u4e9b\u5f15\u7528\u5bf9\u8c61\u7684\u751f\u547d\u5468\u671f\u9650\u5236\u5230Requests\u7684\u751f\u547d\u5468\u671f\u3002\u5230\u76ee\u524d\u4e3a\u6b62\uff0c\u8fd9\u662fScrapy\u9879\u76ee\u4e2d\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\u7684\u6700\u5e38\u89c1\u539f\u56e0\uff0c\u800c\u4e14\u5bf9\u4e8e\u65b0\u624b\u6765\u8bf4\u5f88\u96be\u8c03\u8bd5\u3002 \u5728\u5927\u578b\u9879\u76ee\u4e2d\uff0cspider\u901a\u5e38\u7531\u4e0d\u540c\u7684\u4eba\u7f16\u5199\uff0c\u5176\u4e2d\u4e00\u4e9b\u722c\u884c\u5668\u53ef\u80fd\u4f1a\u201c\u6cc4\u6f0f\u201d\uff0c\u56e0\u6b64\uff0c\u5f53\u5176\u4ed6(\u5199\u5f97\u5f88\u597d\u7684)spider\u5e76\u53d1\u8fd0\u884c\u65f6\uff0c\u5176\u4ed6\u7684spider\u4e5f\u4f1a\u53d7\u5230\u5f71\u54cd\uff0c\u8fd9\u53cd\u8fc7\u6765\u53c8\u4f1a\u5f71\u54cd\u6574\u4e2a\u722c\u884c\u8fc7\u7a0b\u3002 \u5982\u679c\u60a8\u6ca1\u6709\u6b63\u786e\u91ca\u653e(\u5148\u524d\u5206\u914d\u7684)\u8d44\u6e90\uff0c\u6cc4\u6f0f\u4e5f\u53ef\u80fd\u6765\u81ea\u60a8\u7f16\u5199\u7684\u81ea\u5b9a\u4e49middleware\u3001pipeline\u6216extension\u3002\u4f8b\u5982\uff0c\u5982\u679c\u5728 \u6bcf\u4e2a\u8fdb\u7a0b\u4e0a\u8fd0\u884c\u591a\u4e2aspider \uff0c\u90a3\u4e48\u5728 spider_opened \u4e0a\u5206\u914d\u8d44\u6e90\u800c\u4e0d\u5728 spider_closed \u4e0a\u91ca\u653e\u8d44\u6e90\u53ef\u80fd\u4f1a\u5bfc\u81f4\u95ee\u9898\u3002 \u592a\u591aRequests? \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cScrapy\u5c06request\u961f\u5217\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d;\u5b83\u5305\u62ec Request \u5bf9\u8c61\u548cRequest\u5c5e\u6027\u4e2d\u5f15\u7528\u7684\u6240\u6709\u5bf9\u8c61(\u4f8b\u5982 meta )\u3002\u867d\u7136\u4e0d\u4e00\u5b9a\u662f\u6cc4\u6f0f\uff0c\u4f46\u8fd9\u4f1a\u5360\u7528\u5927\u91cf\u5185\u5b58\u3002\u542f\u7528 \u6301\u4e45\u4f5c\u4e1a\u961f\u5217 \u53ef\u4ee5\u5e2e\u52a9\u63a7\u5236\u5185\u5b58\u4f7f\u7528\u3002 \u4f7f\u7528trackref\u8c03\u8bd5\u5185\u5b58\u6cc4\u6f0f trackref \u662fScrapy\u63d0\u4f9b\u7684\u4e00\u4e2a\u6a21\u5757\uff0c\u7528\u4e8e\u8c03\u8bd5\u6700\u5e38\u89c1\u7684\u5185\u5b58\u6cc4\u6f0f\u60c5\u51b5\u3002\u5b83\u57fa\u672c\u4e0a\u8ddf\u8e2a\u5bf9\u6240\u6709\u6d3b\u52a8\u7684Requests\u3001Responses\u3001Item\u548cSelector\u5bf9\u8c61\u7684\u5f15\u7528\u3002 \u60a8\u53ef\u4ee5\u8fdb\u5165telnet console\uff0c\u5e76\u4f7f\u7528 prefs() \u51fd\u6570\u68c0\u67e5\u5f53\u524d\u6709\u591a\u5c11\u5bf9\u8c61(\u4e0a\u9762\u63d0\u5230\u7684\u7c7b)\u5728\u8fd0\u884c\uff0c prefs() \u51fd\u6570\u662f print_live_refs() \u51fd\u6570\u7684\u522b\u540d: telnet localhost 6023 prefs() Live References ExampleSpider 1 oldest: 15s ago HtmlResponse 10 oldest: 1s ago Selector 2 oldest: 0s ago FormRequest 878 oldest: 7s ago \u5982\u60a8\u6240\u89c1\uff0c\u8be5\u62a5\u544a\u8fd8\u663e\u793a\u4e86\u6bcf\u4e2a\u7c7b\u4e2doldest(\u6700\u53e4\u8001)\u5bf9\u8c61\u7684\u201cage\u201d\u3002\u5982\u679c\u60a8\u5728\u6bcf\u4e2a\u8fdb\u7a0b\u4e2d\u8fd0\u884c\u591a\u4e2aspider\uff0c\u90a3\u4e48\u60a8\u53ef\u4ee5\u901a\u8fc7\u67e5\u770b\u6700\u8001\u7684request\u6216response\u6765\u786e\u5b9a\u54ea\u4e2aspider\u6b63\u5728\u6cc4\u6f0f\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 get_oldest() \u51fd\u6570(\u4ecetelnet console)\u83b7\u5f97\u6bcf\u4e2a\u7c7b\u7684\u6700\u53e4\u8001\u5bf9\u8c61\u3002 \u8ddf\u8e2a\u54ea\u4e9b\u5bf9\u8c61? trackref \u8ddf\u8e2a\u7684\u5bf9\u8c61\u90fd\u6765\u81ea\u8fd9\u4e9b\u7c7b(\u53ca\u5176\u6240\u6709\u5b50\u7c7b): scrapy.http.Request scrapy.http.Response scrapy.item.Item scrapy.selector.Selector scrapy.spiders.Spider \u4e00\u4e2a\u771f\u5b9e\u7684\u4f8b\u5b50 \u8ba9\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u5185\u5b58\u6cc4\u6f0f\u7684\u5177\u4f53\u4f8b\u5b50\u3002\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e9bspider\uff0c\u5b83\u4eec\u7684\u8def\u7ebf\u548c\u8fd9\u4e2a\u7c7b\u4f3c: return Request( http://www.somenastyspider.com/product.php?pid=%d % product_id, callback=self.parse, meta={referer: response}) \u8fd9\u4e00\u884c\u662f\u5728request\u4e2d\u4f20\u9012\u4e00\u4e2aresponse\u5f15\u7528\uff0c\u8be5\u5f15\u7528\u6709\u6548\u5730\u5c06\u54cdresponse\u751f\u547d\u5468\u671f\u4e0erequest\u7684\u751f\u547d\u5468\u671f\u8054\u7cfb\u8d77\u6765\uff0c\u8fd9\u80af\u5b9a\u4f1a\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\u3002 \u8ba9\u6211\u4eec\u770b\u770b\u5982\u4f55\u901a\u8fc7\u4f7f\u7528 trackref \u5de5\u5177\u6765\u53d1\u73b0\u539f\u56e0(\u5f53\u7136\u4e0d\u662f\u4e8b\u5148\u77e5\u9053\u7684)\u3002 \u722c\u866b\u7a0b\u5e8f\u8fd0\u884c\u51e0\u5206\u949f\u540e\uff0c\u6211\u4eec\u6ce8\u610f\u5230\u5b83\u7684\u5185\u5b58\u4f7f\u7528\u91cf\u589e\u52a0\u4e86\u5f88\u591a\uff0c\u6211\u4eec\u53ef\u4ee5\u8fdb\u5165\u5b83\u7684telnet console\u5e76\u68c0\u67e5\u6d3b\u52a8\u5f15\u7528: prefs() Live References SomenastySpider 1 oldest: 15s ago HtmlResponse 3890 oldest: 265s ago Selector 2 oldest: 0s ago Request 3878 oldest: 250s ago \u6709\u8fd9\u4e48\u591a\u7684\u6d3b\u52a8responses(\u800c\u4e14\u5b83\u4eec\u592a\u8001\u4e86)\u8fd9\u4e00\u4e8b\u5b9e\u65e0\u7591\u662f\u503c\u5f97\u6000\u7591\u7684\uff0c\u56e0\u4e3a\u4e0eRequests\u76f8\u6bd4\uff0cresponses\u7684\u751f\u547d\u5468\u671f\u5e94\u8be5\u76f8\u5bf9\u8f83\u77ed\u3002responses\u7684\u6570\u91cf\u4e0erequests\u7684\u6570\u91cf\u7c7b\u4f3c\uff0c\u6240\u4ee5\u5b83\u4eec\u5728\u67d0\u79cd\u7a0b\u5ea6\u4e0a\u662f\u8054\u7cfb\u5728\u4e00\u8d77\u7684\u3002\u73b0\u5728\uff0c\u6211\u4eec\u53ef\u4ee5\u68c0\u67e5spider\u7684\u4ee3\u7801\uff0c\u4ee5\u53d1\u73b0\u751f\u6210\u6cc4\u6f0f\u7684\u6076\u610f\u4ee3\u7801\u884c(\u5728requests\u4e2d\u4f20\u9012response\u5f15\u7528)\u3002 \u6709\u65f6\u5019\u5173\u4e8e\u6d3b\u52a8\u5bf9\u8c61\u7684\u989d\u5916\u4fe1\u606f\u53ef\u80fd\u4f1a\u6709\u5e2e\u52a9\u3002\u8ba9\u6211\u4eec\u770b\u770b\u6700\u53e4\u8001\u7684response: from scrapy.utils.trackref import get_oldest r = get_oldest('HtmlResponse') r.url 'http://www.somenastyspider.com/product.php?pid=123' \u5982\u679c\u4f60\u60f3\u904d\u5386\u6240\u6709\u5bf9\u8c61\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 scrapy.utils.trackref.iter_all() \u51fd\u6570\u6765\u4ee3\u66ff\u83b7\u53d6get_oldest: from scrapy.utils.trackref import iter_all [r.url for r in iter_all('HtmlResponse')] ['http://www.somenastyspider.com/product.php?pid=123', 'http://www.somenastyspider.com/product.php?pid=584', ... \u592a\u591a\u7684spiders? \u5982\u679c\u60a8\u7684\u9879\u76ee\u6709\u592a\u591a\u5e76\u884c\u6267\u884c\u7684spider\uff0c\u90a3\u4e48 prefs() \u7684\u8f93\u51fa\u53ef\u80fd\u96be\u4ee5\u8bfb\u53d6\u3002\u56e0\u6b64\uff0c\u8be5\u51fd\u6570\u6709\u4e00\u4e2a ignore \u53c2\u6570\uff0c\u53ef\u4ee5\u7528\u6765\u5ffd\u7565\u7279\u5b9a\u7684\u7c7b(\u4ee5\u53ca\u5b83\u7684\u6240\u6709\u5b50\u7c7b)\u3002\u4f8b\u5982\uff0c\u8fd9\u4e0d\u4f1a\u663e\u793a\u4efb\u4f55\u5bf9spider\u7684\u6d3b\u52a8\u5f15\u7528: from scrapy.spiders import Spider prefs(ignore=Spider) scrapy.utils.trackref\u6a21\u5757 \u4e0b\u9762\u662f trackref \u6a21\u5757\u4e2d\u63d0\u4f9b\u7684\u53ef\u7528\u51fd\u6570\u3002 scrapy.utils.trackref.object_ref \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) \u5982\u679c\u60a8\u60f3\u4f7f\u7528 trackref \u6a21\u5757\u8ddf\u8e2a\u6d3b\u52a8\u5b9e\u4f8b\uff0c\u53ef\u4ee5\u4ece\u8fd9\u4e2a\u7c7b(\u800c\u4e0d\u662f\u5bf9\u8c61)\u7ee7\u627f\u3002 scrapy.utils.trackref.print_live_refs(class_name, ignore=NoneType) \u6309\u7c7b\u540d\u5206\u7ec4\uff0c\u6253\u5370\u5b9e\u65f6\u5f15\u7528\u7684\u62a5\u544a\u3002 \u53c2\u6570: ignore (\u7c7b\u6216\u7c7b\u5143\u7ec4) \u2013 \u5982\u679c\u7ed9\u5b9a\uff0c\u6765\u81ea\u6307\u5b9a\u7c7b(\u6216\u7c7b\u7684\u5143\u7ec4)\u7684\u6240\u6709\u5bf9\u8c61\u90fd\u5c06\u88ab\u5ffd\u7565\u3002 scrapy.utils.trackref.get_oldest(class_name) \u8fd4\u56de\u5177\u6709\u7ed9\u5b9a\u7c7b\u540d\u7684\u6700\u53e4\u8001\u5bf9\u8c61\uff0c\u5982\u679c\u6ca1\u6709\u627e\u5230\uff0c\u5219\u8fd4\u56de None \u3002\u9996\u5148\u4f7f\u7528 print_live_refs() \u83b7\u5f97\u6bcf\u4e2a\u7c7b\u540d\u8ddf\u8e2a\u7684\u6240\u6709\u6d3b\u52a8\u5bf9\u8c61\u7684\u5217\u8868\u3002 scrapy.utils.trackref.iter_all(class_name) \u5728\u5177\u6709\u7ed9\u5b9a\u7c7b\u540d\u7684\u6240\u6709\u5bf9\u8c61\u4e0a\u8fd4\u56de\u8fed\u4ee3\u5668\uff0c\u5982\u679c\u6ca1\u6709\u627e\u5230\u7c7b\u540d\uff0c\u5219\u8fd4\u56de None \u3002\u9996\u5148\u4f7f\u7528 print_live_refs() \u83b7\u5f97\u6bcf\u4e2a\u7c7b\u540d\u8ddf\u8e2a\u7684\u6240\u6709\u6d3b\u52a8\u5bf9\u8c61\u7684\u5217\u8868\u3002 \u7528Guppy\u8c03\u8bd5\u5185\u5b58\u6cc4\u6f0f trackref \u63d0\u4f9b\u4e86\u4e00\u79cd\u975e\u5e38\u65b9\u4fbf\u7684\u673a\u5236\u6765\u8ddf\u8e2a\u5185\u5b58\u6cc4\u6f0f\uff0c\u4f46\u662f\u5b83\u53ea\u8ddf\u8e2a\u66f4\u53ef\u80fd\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\u7684\u5bf9\u8c61(Requests\u3001Responses\u3001Items\u548cSelectors)\u3002\u7136\u800c\uff0c\u5728\u5176\u4ed6\u60c5\u51b5\u4e0b\uff0c\u5185\u5b58\u6cc4\u6f0f\u53ef\u80fd\u6765\u81ea\u5176\u4ed6(\u6216\u591a\u6216\u5c11\u6709\u4e9b\u6a21\u7cca\u7684)\u5bf9\u8c61\u3002\u5982\u679c\u8fd9\u662f\u60a8\u7684\u60c5\u51b5\uff0c\u5e76\u4e14\u60a8\u65e0\u6cd5\u4f7f\u7528 trackref \u627e\u5230\u6cc4\u6f0f\uff0c\u90a3\u4e48\u60a8\u8fd8\u6709\u53e6\u4e00\u4e2a\u8d44\u6e90: Guppy\u5e93 \u3002\u5982\u679c\u60a8\u6b63\u5728\u4f7f\u7528Python3\uff0c\u8bf7\u53c2\u9605 \u7528muppy\u8c03\u8bd5\u5185\u5b58\u6cc4\u6f0f \u3002 \u5982\u679c\u4f7f\u7528 pip \uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u5b89\u88c5Guppy: pip install guppy telnet console\u8fd8\u9644\u5e26\u4e00\u4e2a\u5185\u7f6e\u7684\u8bbf\u95eeGuppy heap(\u5806)\u5bf9\u8c61\u7684\u5feb\u6377\u65b9\u5f0f( hpy )\u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u4f7f\u7528Guppy\u67e5\u770bheap\u4e2d\u6240\u6709\u53ef\u7528Python\u5bf9\u8c61\u7684\u793a\u4f8b: x = hpy.heap() x.bytype Partition of a set of 297033 objects. Total size = 52587824 bytes. Index Count % Size % Cumulative % Type 0 22307 8 16423880 31 16423880 31 dict 1 122285 41 12441544 24 28865424 55 str 2 68346 23 5966696 11 34832120 66 tuple 3 227 0 5836528 11 40668648 77 unicode 4 2461 1 2222272 4 42890920 82 type 5 16870 6 2024400 4 44915320 85 function 6 13949 5 1673880 3 46589200 89 types.CodeType 7 13422 5 1653104 3 48242304 92 list 8 3735 1 1173680 2 49415984 94 _sre.SRE_Pattern 9 1209 0 456936 1 49872920 95 scrapy.http.headers.Headers 1676 more rows. Type e.g. '_.more' to view. \u53ef\u4ee5\u770b\u5230\uff0c\u5927\u591a\u6570\u7a7a\u95f4\u90fd\u88abdicts\u4f7f\u7528\u3002\u7136\u540e\uff0c\u5982\u679c\u60a8\u60f3\u4ece\u54ea\u4e2a\u5c5e\u6027\u4e2d\u5f15\u7528\u8fd9\u4e9b\u8bed\u53e5\uff0c\u60a8\u53ef\u4ee5\u8fd9\u6837\u505a: x.bytype[0].byvia Partition of a set of 22307 objects. Total size = 16423880 bytes. Index Count % Size % Cumulative % Referred Via: 0 10982 49 9416336 57 9416336 57 '.__dict__' 1 1820 8 2681504 16 12097840 74 '.__dict__', '.func_globals' 2 3097 14 1122904 7 13220744 80 3 990 4 277200 2 13497944 82 ['cookies'] 4 987 4 276360 2 13774304 84 ['cache'] 5 985 4 275800 2 14050104 86 ['meta'] 6 897 4 251160 2 14301264 87 '[2]' 7 1 0 196888 1 14498152 88 ['moduleDict'] , ['modules'] 8 672 3 188160 1 14686312 89 ['cb_kwargs'] 9 27 0 155016 1 14841328 90 '[1]' 333 more rows. Type e.g. '_.more' to view. \u6b63\u5982\u60a8\u6240\u770b\u5230\u7684\uff0cGuppy\u6a21\u5757\u975e\u5e38\u5f3a\u5927\uff0c\u4f46\u4e5f\u9700\u8981\u4e00\u4e9b\u5173\u4e8ePython\u5185\u90e8\u7684\u6df1\u5165\u77e5\u8bc6\u3002\u6709\u5173Guppy\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Guppy\u6587\u6863 \u3002 \u7528muppy\u8c03\u8bd5\u5185\u5b58\u6cc4\u6f0f \u5982\u679c\u60a8\u6b63\u5728\u4f7f\u7528python3\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 Pympler \u63d0\u4f9b\u7684muppy\u3002 \u5982\u679c\u4f7f\u7528 pip \uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u5b89\u88c5muppy: pip install Pympler \u4e0b\u9762\u662f\u4e00\u4e2a\u4f7f\u7528muppy\u67e5\u770bheap(\u5806)\u4e2d\u6240\u6709\u53ef\u7528Python\u5bf9\u8c61\u7684\u793a\u4f8b: from pympler import muppy all_objects = muppy.get_objects() len(all_objects) 28667 from pympler import summary suml = summary.summarize(all_objects) summary.print_(suml) types | # objects | total size ==================================== | =========== | ============ class 'str | 9822 | 1.10 MB class 'dict | 1658 | 856.62 KB class 'type | 436 | 443.60 KB class 'code | 2974 | 419.56 KB class '_io.BufferedWriter | 2 | 256.34 KB class 'set | 420 | 159.88 KB class '_io.BufferedReader | 1 | 128.17 KB class 'wrapper_descriptor | 1130 | 88.28 KB class 'tuple | 1304 | 86.57 KB class 'weakref | 1013 | 79.14 KB class 'builtin_function_or_method | 958 | 67.36 KB class 'method_descriptor | 865 | 60.82 KB class 'abc.ABCMeta | 62 | 59.96 KB class 'list | 446 | 58.52 KB class 'int | 1425 | 43.20 KB \u6709\u5173muppy\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 muppy\u6587\u6863 \u3002 \u6ca1\u6709\u6cc4\u9732\u7684\u6cc4\u9732 \u6709\u65f6\uff0c\u60a8\u53ef\u80fd\u4f1a\u6ce8\u610f\u5230Scrapy\u8fdb\u7a0b\u7684\u5185\u5b58\u4f7f\u7528\u53ea\u4f1a\u589e\u52a0\uff0c\u4f46\u4e0d\u4f1a\u51cf\u5c11\u3002\u4e0d\u5e78\u7684\u662f\uff0c\u5373\u4f7fScrapy\u548c\u9879\u76ee\u90fd\u6ca1\u6709\u6cc4\u6f0f\u5185\u5b58\uff0c\u4e5f\u53ef\u80fd\u53d1\u751f\u8fd9\u79cd\u60c5\u51b5\u3002\u8fd9\u662f\u7531\u4e8e\u4f17\u6240\u5468\u77e5\u7684Python\u95ee\u9898\uff0c\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u5b83\u53ef\u80fd\u4e0d\u4f1a\u5c06\u91ca\u653e\u7684\u5185\u5b58\u8fd4\u56de\u5230\u64cd\u4f5c\u7cfb\u7edf\u3002\u6709\u5173\u8fd9\u4e2a\u95ee\u9898\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605: Python\u7684\u5185\u5b58\u7ba1\u7406 Python\u7684\u5185\u5b58\u7ba1\u7406\u7b2c2\u90e8\u5206 Python\u7684\u5185\u5b58\u7ba1\u7406\u7b2c3\u90e8\u5206 \u672c\u6587 \u4e2d\u8be6\u7ec6\u4ecb\u7ecd\u4e86Evan Jones\u63d0\u51fa\u7684\u6539\u8fdb\uff0c\u5728Python 2.5\u4e2d\u5f97\u5230\u4e86\u5408\u5e76\uff0c\u4f46\u8fd9\u53ea\u662f\u51cf\u5c11\u4e86\u95ee\u9898\uff0c\u5e76\u6ca1\u6709\u5b8c\u5168\u89e3\u51b3\u95ee\u9898\u3002\u5f15\u7528\u672c\u6587: \u4e0d\u5e78\u7684\u662f\uff0c\u8fd9\u4e2a\u8865\u4e01\u53ea\u80fd\u5728\u4e0d\u518d\u5206\u914d\u5bf9\u8c61\u7684\u60c5\u51b5\u4e0b\u91ca\u653e\u4e00\u4e2a\u7ade\u6280\u573a\u3002\u8fd9\u610f\u5473\u7740\u788e\u7247\u5316\u662f\u4e00\u4e2a\u5927\u95ee\u9898\u3002\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u6709\u8bb8\u591a\u5146\u5b57\u8282\u7684\u7a7a\u95f2\u5185\u5b58\uff0c\u5206\u6563\u5728\u6240\u6709\u7684\u7ade\u6280\u573a\u4e2d\uff0c\u4f46\u662f\u5b83\u4e0d\u80fd\u91ca\u653e\u4efb\u4f55\u4e00\u4e2a\u3002\u8fd9\u662f\u6240\u6709\u5185\u5b58\u5206\u914d\u5668\u90fd\u4f1a\u9047\u5230\u7684\u95ee\u9898\u3002\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u7684\u552f\u4e00\u65b9\u6cd5\u662f\u8f6c\u79fb\u5230\u538b\u7f29\u5783\u573e\u6536\u96c6\u5668\uff0c\u5b83\u80fd\u591f\u5728\u5185\u5b58\u4e2d\u79fb\u52a8\u5bf9\u8c61\u3002\u8fd9\u9700\u8981\u5bf9Python\u89e3\u91ca\u5668\u8fdb\u884c\u91cd\u5927\u66f4\u6539\u3002 \u4e3a\u4e86\u4fdd\u6301\u5408\u7406\u7684\u5185\u5b58\u6d88\u8017\uff0c\u60a8\u53ef\u4ee5\u5c06job\u5206\u5272\u4e3a\u51e0\u4e2a\u8f83\u5c0f\u7684job\uff0c\u6216\u8005\u542f\u7528 \u6301\u4e45\u4f5c\u4e1a\u961f\u5217 \u5e76\u4e0d\u65f6\u5730\u505c\u6b62/\u542f\u52a8spider\u3002","title":"\u8c03\u8bd5\u5185\u5b58\u6cc4\u6f0f"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/08-debugging-memory/#_1","text":"\u5728Scrapy\u4e2d\uff0cRequests\u3001Responses\u548cItems\u7b49\u5bf9\u8c61\u7684\u751f\u547d\u5468\u671f\u662f\u6709\u9650\u7684:\u5b83\u4eec\u88ab\u521b\u5efa\u3001\u4f7f\u7528\u4e00\u6bb5\u65f6\u95f4\uff0c\u6700\u540e\u88ab\u9500\u6bc1\u3002 \u5728\u6240\u6709\u8fd9\u4e9b\u5bf9\u8c61\u4e2d\uff0cRequest\u53ef\u80fd\u662f\u751f\u547d\u5468\u671f\u6700\u957f\u7684\u4e00\u4e2a\uff0c\u56e0\u4e3a\u5b83\u5728Scheduler\u961f\u5217\u4e2d\u7b49\u5f85\uff0c\u76f4\u5230\u5904\u7406\u5b83\u7684\u65f6\u5019\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 \u4f53\u7cfb\u7ed3\u6784\u6982\u8ff0 \u3002 \u7531\u4e8e\u8fd9\u4e9bScrapy\u5bf9\u8c61\u6709\u4e00\u4e2a(\u76f8\u5f53\u957f\u7684)\u751f\u547d\u5468\u671f\uff0c\u56e0\u6b64\u5728\u6ca1\u6709\u9002\u5f53\u91ca\u653e\u5b83\u4eec\u7684\u60c5\u51b5\u4e0b\uff0c\u5728\u5185\u5b58\u4e2d\u79ef\u7d2f\u5b83\u4eec\u603b\u662f\u6709\u98ce\u9669\u7684\uff0c\u4ece\u800c\u5bfc\u81f4\u6240\u8c13\u7684\u201c\u5185\u5b58\u6cc4\u6f0f\u201d\u3002 \u4e3a\u4e86\u5e2e\u52a9\u8c03\u8bd5\u5185\u5b58\u6cc4\u6f0f\uff0cScrapy\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7528\u4e8e\u8ddf\u8e2a\u5bf9\u8c61\u5f15\u7528\u7684\u5185\u7f6e\u673a\u5236\uff0c\u79f0\u4e3a trackref \uff0c\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528\u540d\u4e3a Guppy \u7684\u7b2c\u4e09\u65b9\u5e93\u8fdb\u884c\u66f4\u9ad8\u7ea7\u7684\u5185\u5b58\u8c03\u8bd5(\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u4e0b\u9762)\u3002\u8fd9\u4e24\u79cd\u673a\u5236\u90fd\u5fc5\u987b\u4ece Telnet Console \u4f7f\u7528\u3002","title":"\u8c03\u8bd5\u5185\u5b58\u6cc4\u6f0f"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/08-debugging-memory/#_2","text":"Scrapy\u5f00\u53d1\u4eba\u5458\u7ecf\u5e38 (\u6709\u65f6\u662f\u5076\u7136\u7684\uff0c\u6709\u65f6\u662f\u6545\u610f\u7684) \u4f1a\u4f20\u9012Requests (\u4f8b\u5982\uff0c\u4f7f\u7528 meta \u5c5e\u6027\u6216request callback\u51fd\u6570) \u4e2d\u5f15\u7528\u7684\u5bf9\u8c61\uff0c\u8fd9\u6709\u6548\u5730\u5c06\u8fd9\u4e9b\u5f15\u7528\u5bf9\u8c61\u7684\u751f\u547d\u5468\u671f\u9650\u5236\u5230Requests\u7684\u751f\u547d\u5468\u671f\u3002\u5230\u76ee\u524d\u4e3a\u6b62\uff0c\u8fd9\u662fScrapy\u9879\u76ee\u4e2d\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\u7684\u6700\u5e38\u89c1\u539f\u56e0\uff0c\u800c\u4e14\u5bf9\u4e8e\u65b0\u624b\u6765\u8bf4\u5f88\u96be\u8c03\u8bd5\u3002 \u5728\u5927\u578b\u9879\u76ee\u4e2d\uff0cspider\u901a\u5e38\u7531\u4e0d\u540c\u7684\u4eba\u7f16\u5199\uff0c\u5176\u4e2d\u4e00\u4e9b\u722c\u884c\u5668\u53ef\u80fd\u4f1a\u201c\u6cc4\u6f0f\u201d\uff0c\u56e0\u6b64\uff0c\u5f53\u5176\u4ed6(\u5199\u5f97\u5f88\u597d\u7684)spider\u5e76\u53d1\u8fd0\u884c\u65f6\uff0c\u5176\u4ed6\u7684spider\u4e5f\u4f1a\u53d7\u5230\u5f71\u54cd\uff0c\u8fd9\u53cd\u8fc7\u6765\u53c8\u4f1a\u5f71\u54cd\u6574\u4e2a\u722c\u884c\u8fc7\u7a0b\u3002 \u5982\u679c\u60a8\u6ca1\u6709\u6b63\u786e\u91ca\u653e(\u5148\u524d\u5206\u914d\u7684)\u8d44\u6e90\uff0c\u6cc4\u6f0f\u4e5f\u53ef\u80fd\u6765\u81ea\u60a8\u7f16\u5199\u7684\u81ea\u5b9a\u4e49middleware\u3001pipeline\u6216extension\u3002\u4f8b\u5982\uff0c\u5982\u679c\u5728 \u6bcf\u4e2a\u8fdb\u7a0b\u4e0a\u8fd0\u884c\u591a\u4e2aspider \uff0c\u90a3\u4e48\u5728 spider_opened \u4e0a\u5206\u914d\u8d44\u6e90\u800c\u4e0d\u5728 spider_closed \u4e0a\u91ca\u653e\u8d44\u6e90\u53ef\u80fd\u4f1a\u5bfc\u81f4\u95ee\u9898\u3002","title":"\u5185\u5b58\u6cc4\u6f0f\u7684\u5e38\u89c1\u539f\u56e0"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/08-debugging-memory/#requests","text":"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cScrapy\u5c06request\u961f\u5217\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d;\u5b83\u5305\u62ec Request \u5bf9\u8c61\u548cRequest\u5c5e\u6027\u4e2d\u5f15\u7528\u7684\u6240\u6709\u5bf9\u8c61(\u4f8b\u5982 meta )\u3002\u867d\u7136\u4e0d\u4e00\u5b9a\u662f\u6cc4\u6f0f\uff0c\u4f46\u8fd9\u4f1a\u5360\u7528\u5927\u91cf\u5185\u5b58\u3002\u542f\u7528 \u6301\u4e45\u4f5c\u4e1a\u961f\u5217 \u53ef\u4ee5\u5e2e\u52a9\u63a7\u5236\u5185\u5b58\u4f7f\u7528\u3002","title":"\u592a\u591aRequests?"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/08-debugging-memory/#trackref","text":"trackref \u662fScrapy\u63d0\u4f9b\u7684\u4e00\u4e2a\u6a21\u5757\uff0c\u7528\u4e8e\u8c03\u8bd5\u6700\u5e38\u89c1\u7684\u5185\u5b58\u6cc4\u6f0f\u60c5\u51b5\u3002\u5b83\u57fa\u672c\u4e0a\u8ddf\u8e2a\u5bf9\u6240\u6709\u6d3b\u52a8\u7684Requests\u3001Responses\u3001Item\u548cSelector\u5bf9\u8c61\u7684\u5f15\u7528\u3002 \u60a8\u53ef\u4ee5\u8fdb\u5165telnet console\uff0c\u5e76\u4f7f\u7528 prefs() \u51fd\u6570\u68c0\u67e5\u5f53\u524d\u6709\u591a\u5c11\u5bf9\u8c61(\u4e0a\u9762\u63d0\u5230\u7684\u7c7b)\u5728\u8fd0\u884c\uff0c prefs() \u51fd\u6570\u662f print_live_refs() \u51fd\u6570\u7684\u522b\u540d: telnet localhost 6023 prefs() Live References ExampleSpider 1 oldest: 15s ago HtmlResponse 10 oldest: 1s ago Selector 2 oldest: 0s ago FormRequest 878 oldest: 7s ago \u5982\u60a8\u6240\u89c1\uff0c\u8be5\u62a5\u544a\u8fd8\u663e\u793a\u4e86\u6bcf\u4e2a\u7c7b\u4e2doldest(\u6700\u53e4\u8001)\u5bf9\u8c61\u7684\u201cage\u201d\u3002\u5982\u679c\u60a8\u5728\u6bcf\u4e2a\u8fdb\u7a0b\u4e2d\u8fd0\u884c\u591a\u4e2aspider\uff0c\u90a3\u4e48\u60a8\u53ef\u4ee5\u901a\u8fc7\u67e5\u770b\u6700\u8001\u7684request\u6216response\u6765\u786e\u5b9a\u54ea\u4e2aspider\u6b63\u5728\u6cc4\u6f0f\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 get_oldest() \u51fd\u6570(\u4ecetelnet console)\u83b7\u5f97\u6bcf\u4e2a\u7c7b\u7684\u6700\u53e4\u8001\u5bf9\u8c61\u3002","title":"\u4f7f\u7528trackref\u8c03\u8bd5\u5185\u5b58\u6cc4\u6f0f"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/08-debugging-memory/#_3","text":"trackref \u8ddf\u8e2a\u7684\u5bf9\u8c61\u90fd\u6765\u81ea\u8fd9\u4e9b\u7c7b(\u53ca\u5176\u6240\u6709\u5b50\u7c7b): scrapy.http.Request scrapy.http.Response scrapy.item.Item scrapy.selector.Selector scrapy.spiders.Spider","title":"\u8ddf\u8e2a\u54ea\u4e9b\u5bf9\u8c61?"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/08-debugging-memory/#_4","text":"\u8ba9\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u5185\u5b58\u6cc4\u6f0f\u7684\u5177\u4f53\u4f8b\u5b50\u3002\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e9bspider\uff0c\u5b83\u4eec\u7684\u8def\u7ebf\u548c\u8fd9\u4e2a\u7c7b\u4f3c: return Request( http://www.somenastyspider.com/product.php?pid=%d % product_id, callback=self.parse, meta={referer: response}) \u8fd9\u4e00\u884c\u662f\u5728request\u4e2d\u4f20\u9012\u4e00\u4e2aresponse\u5f15\u7528\uff0c\u8be5\u5f15\u7528\u6709\u6548\u5730\u5c06\u54cdresponse\u751f\u547d\u5468\u671f\u4e0erequest\u7684\u751f\u547d\u5468\u671f\u8054\u7cfb\u8d77\u6765\uff0c\u8fd9\u80af\u5b9a\u4f1a\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\u3002 \u8ba9\u6211\u4eec\u770b\u770b\u5982\u4f55\u901a\u8fc7\u4f7f\u7528 trackref \u5de5\u5177\u6765\u53d1\u73b0\u539f\u56e0(\u5f53\u7136\u4e0d\u662f\u4e8b\u5148\u77e5\u9053\u7684)\u3002 \u722c\u866b\u7a0b\u5e8f\u8fd0\u884c\u51e0\u5206\u949f\u540e\uff0c\u6211\u4eec\u6ce8\u610f\u5230\u5b83\u7684\u5185\u5b58\u4f7f\u7528\u91cf\u589e\u52a0\u4e86\u5f88\u591a\uff0c\u6211\u4eec\u53ef\u4ee5\u8fdb\u5165\u5b83\u7684telnet console\u5e76\u68c0\u67e5\u6d3b\u52a8\u5f15\u7528: prefs() Live References SomenastySpider 1 oldest: 15s ago HtmlResponse 3890 oldest: 265s ago Selector 2 oldest: 0s ago Request 3878 oldest: 250s ago \u6709\u8fd9\u4e48\u591a\u7684\u6d3b\u52a8responses(\u800c\u4e14\u5b83\u4eec\u592a\u8001\u4e86)\u8fd9\u4e00\u4e8b\u5b9e\u65e0\u7591\u662f\u503c\u5f97\u6000\u7591\u7684\uff0c\u56e0\u4e3a\u4e0eRequests\u76f8\u6bd4\uff0cresponses\u7684\u751f\u547d\u5468\u671f\u5e94\u8be5\u76f8\u5bf9\u8f83\u77ed\u3002responses\u7684\u6570\u91cf\u4e0erequests\u7684\u6570\u91cf\u7c7b\u4f3c\uff0c\u6240\u4ee5\u5b83\u4eec\u5728\u67d0\u79cd\u7a0b\u5ea6\u4e0a\u662f\u8054\u7cfb\u5728\u4e00\u8d77\u7684\u3002\u73b0\u5728\uff0c\u6211\u4eec\u53ef\u4ee5\u68c0\u67e5spider\u7684\u4ee3\u7801\uff0c\u4ee5\u53d1\u73b0\u751f\u6210\u6cc4\u6f0f\u7684\u6076\u610f\u4ee3\u7801\u884c(\u5728requests\u4e2d\u4f20\u9012response\u5f15\u7528)\u3002 \u6709\u65f6\u5019\u5173\u4e8e\u6d3b\u52a8\u5bf9\u8c61\u7684\u989d\u5916\u4fe1\u606f\u53ef\u80fd\u4f1a\u6709\u5e2e\u52a9\u3002\u8ba9\u6211\u4eec\u770b\u770b\u6700\u53e4\u8001\u7684response: from scrapy.utils.trackref import get_oldest r = get_oldest('HtmlResponse') r.url 'http://www.somenastyspider.com/product.php?pid=123' \u5982\u679c\u4f60\u60f3\u904d\u5386\u6240\u6709\u5bf9\u8c61\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 scrapy.utils.trackref.iter_all() \u51fd\u6570\u6765\u4ee3\u66ff\u83b7\u53d6get_oldest: from scrapy.utils.trackref import iter_all [r.url for r in iter_all('HtmlResponse')] ['http://www.somenastyspider.com/product.php?pid=123', 'http://www.somenastyspider.com/product.php?pid=584', ...","title":"\u4e00\u4e2a\u771f\u5b9e\u7684\u4f8b\u5b50"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/08-debugging-memory/#spiders","text":"\u5982\u679c\u60a8\u7684\u9879\u76ee\u6709\u592a\u591a\u5e76\u884c\u6267\u884c\u7684spider\uff0c\u90a3\u4e48 prefs() \u7684\u8f93\u51fa\u53ef\u80fd\u96be\u4ee5\u8bfb\u53d6\u3002\u56e0\u6b64\uff0c\u8be5\u51fd\u6570\u6709\u4e00\u4e2a ignore \u53c2\u6570\uff0c\u53ef\u4ee5\u7528\u6765\u5ffd\u7565\u7279\u5b9a\u7684\u7c7b(\u4ee5\u53ca\u5b83\u7684\u6240\u6709\u5b50\u7c7b)\u3002\u4f8b\u5982\uff0c\u8fd9\u4e0d\u4f1a\u663e\u793a\u4efb\u4f55\u5bf9spider\u7684\u6d3b\u52a8\u5f15\u7528: from scrapy.spiders import Spider prefs(ignore=Spider)","title":"\u592a\u591a\u7684spiders?"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/08-debugging-memory/#scrapyutilstrackref","text":"\u4e0b\u9762\u662f trackref \u6a21\u5757\u4e2d\u63d0\u4f9b\u7684\u53ef\u7528\u51fd\u6570\u3002","title":"scrapy.utils.trackref\u6a21\u5757"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/08-debugging-memory/#scrapyutilstrackrefobject_ref-class","text":"\u5982\u679c\u60a8\u60f3\u4f7f\u7528 trackref \u6a21\u5757\u8ddf\u8e2a\u6d3b\u52a8\u5b9e\u4f8b\uff0c\u53ef\u4ee5\u4ece\u8fd9\u4e2a\u7c7b(\u800c\u4e0d\u662f\u5bf9\u8c61)\u7ee7\u627f\u3002 scrapy.utils.trackref.print_live_refs(class_name, ignore=NoneType) \u6309\u7c7b\u540d\u5206\u7ec4\uff0c\u6253\u5370\u5b9e\u65f6\u5f15\u7528\u7684\u62a5\u544a\u3002 \u53c2\u6570: ignore (\u7c7b\u6216\u7c7b\u5143\u7ec4) \u2013 \u5982\u679c\u7ed9\u5b9a\uff0c\u6765\u81ea\u6307\u5b9a\u7c7b(\u6216\u7c7b\u7684\u5143\u7ec4)\u7684\u6240\u6709\u5bf9\u8c61\u90fd\u5c06\u88ab\u5ffd\u7565\u3002 scrapy.utils.trackref.get_oldest(class_name) \u8fd4\u56de\u5177\u6709\u7ed9\u5b9a\u7c7b\u540d\u7684\u6700\u53e4\u8001\u5bf9\u8c61\uff0c\u5982\u679c\u6ca1\u6709\u627e\u5230\uff0c\u5219\u8fd4\u56de None \u3002\u9996\u5148\u4f7f\u7528 print_live_refs() \u83b7\u5f97\u6bcf\u4e2a\u7c7b\u540d\u8ddf\u8e2a\u7684\u6240\u6709\u6d3b\u52a8\u5bf9\u8c61\u7684\u5217\u8868\u3002 scrapy.utils.trackref.iter_all(class_name) \u5728\u5177\u6709\u7ed9\u5b9a\u7c7b\u540d\u7684\u6240\u6709\u5bf9\u8c61\u4e0a\u8fd4\u56de\u8fed\u4ee3\u5668\uff0c\u5982\u679c\u6ca1\u6709\u627e\u5230\u7c7b\u540d\uff0c\u5219\u8fd4\u56de None \u3002\u9996\u5148\u4f7f\u7528 print_live_refs() \u83b7\u5f97\u6bcf\u4e2a\u7c7b\u540d\u8ddf\u8e2a\u7684\u6240\u6709\u6d3b\u52a8\u5bf9\u8c61\u7684\u5217\u8868\u3002","title":"scrapy.utils.trackref.object_ref   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/08-debugging-memory/#guppy","text":"trackref \u63d0\u4f9b\u4e86\u4e00\u79cd\u975e\u5e38\u65b9\u4fbf\u7684\u673a\u5236\u6765\u8ddf\u8e2a\u5185\u5b58\u6cc4\u6f0f\uff0c\u4f46\u662f\u5b83\u53ea\u8ddf\u8e2a\u66f4\u53ef\u80fd\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\u7684\u5bf9\u8c61(Requests\u3001Responses\u3001Items\u548cSelectors)\u3002\u7136\u800c\uff0c\u5728\u5176\u4ed6\u60c5\u51b5\u4e0b\uff0c\u5185\u5b58\u6cc4\u6f0f\u53ef\u80fd\u6765\u81ea\u5176\u4ed6(\u6216\u591a\u6216\u5c11\u6709\u4e9b\u6a21\u7cca\u7684)\u5bf9\u8c61\u3002\u5982\u679c\u8fd9\u662f\u60a8\u7684\u60c5\u51b5\uff0c\u5e76\u4e14\u60a8\u65e0\u6cd5\u4f7f\u7528 trackref \u627e\u5230\u6cc4\u6f0f\uff0c\u90a3\u4e48\u60a8\u8fd8\u6709\u53e6\u4e00\u4e2a\u8d44\u6e90: Guppy\u5e93 \u3002\u5982\u679c\u60a8\u6b63\u5728\u4f7f\u7528Python3\uff0c\u8bf7\u53c2\u9605 \u7528muppy\u8c03\u8bd5\u5185\u5b58\u6cc4\u6f0f \u3002 \u5982\u679c\u4f7f\u7528 pip \uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u5b89\u88c5Guppy: pip install guppy telnet console\u8fd8\u9644\u5e26\u4e00\u4e2a\u5185\u7f6e\u7684\u8bbf\u95eeGuppy heap(\u5806)\u5bf9\u8c61\u7684\u5feb\u6377\u65b9\u5f0f( hpy )\u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u4f7f\u7528Guppy\u67e5\u770bheap\u4e2d\u6240\u6709\u53ef\u7528Python\u5bf9\u8c61\u7684\u793a\u4f8b: x = hpy.heap() x.bytype Partition of a set of 297033 objects. Total size = 52587824 bytes. Index Count % Size % Cumulative % Type 0 22307 8 16423880 31 16423880 31 dict 1 122285 41 12441544 24 28865424 55 str 2 68346 23 5966696 11 34832120 66 tuple 3 227 0 5836528 11 40668648 77 unicode 4 2461 1 2222272 4 42890920 82 type 5 16870 6 2024400 4 44915320 85 function 6 13949 5 1673880 3 46589200 89 types.CodeType 7 13422 5 1653104 3 48242304 92 list 8 3735 1 1173680 2 49415984 94 _sre.SRE_Pattern 9 1209 0 456936 1 49872920 95 scrapy.http.headers.Headers 1676 more rows. Type e.g. '_.more' to view. \u53ef\u4ee5\u770b\u5230\uff0c\u5927\u591a\u6570\u7a7a\u95f4\u90fd\u88abdicts\u4f7f\u7528\u3002\u7136\u540e\uff0c\u5982\u679c\u60a8\u60f3\u4ece\u54ea\u4e2a\u5c5e\u6027\u4e2d\u5f15\u7528\u8fd9\u4e9b\u8bed\u53e5\uff0c\u60a8\u53ef\u4ee5\u8fd9\u6837\u505a: x.bytype[0].byvia Partition of a set of 22307 objects. Total size = 16423880 bytes. Index Count % Size % Cumulative % Referred Via: 0 10982 49 9416336 57 9416336 57 '.__dict__' 1 1820 8 2681504 16 12097840 74 '.__dict__', '.func_globals' 2 3097 14 1122904 7 13220744 80 3 990 4 277200 2 13497944 82 ['cookies'] 4 987 4 276360 2 13774304 84 ['cache'] 5 985 4 275800 2 14050104 86 ['meta'] 6 897 4 251160 2 14301264 87 '[2]' 7 1 0 196888 1 14498152 88 ['moduleDict'] , ['modules'] 8 672 3 188160 1 14686312 89 ['cb_kwargs'] 9 27 0 155016 1 14841328 90 '[1]' 333 more rows. Type e.g. '_.more' to view. \u6b63\u5982\u60a8\u6240\u770b\u5230\u7684\uff0cGuppy\u6a21\u5757\u975e\u5e38\u5f3a\u5927\uff0c\u4f46\u4e5f\u9700\u8981\u4e00\u4e9b\u5173\u4e8ePython\u5185\u90e8\u7684\u6df1\u5165\u77e5\u8bc6\u3002\u6709\u5173Guppy\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Guppy\u6587\u6863 \u3002","title":"\u7528Guppy\u8c03\u8bd5\u5185\u5b58\u6cc4\u6f0f"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/08-debugging-memory/#muppy","text":"\u5982\u679c\u60a8\u6b63\u5728\u4f7f\u7528python3\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 Pympler \u63d0\u4f9b\u7684muppy\u3002 \u5982\u679c\u4f7f\u7528 pip \uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u5b89\u88c5muppy: pip install Pympler \u4e0b\u9762\u662f\u4e00\u4e2a\u4f7f\u7528muppy\u67e5\u770bheap(\u5806)\u4e2d\u6240\u6709\u53ef\u7528Python\u5bf9\u8c61\u7684\u793a\u4f8b: from pympler import muppy all_objects = muppy.get_objects() len(all_objects) 28667 from pympler import summary suml = summary.summarize(all_objects) summary.print_(suml) types | # objects | total size ==================================== | =========== | ============ class 'str | 9822 | 1.10 MB class 'dict | 1658 | 856.62 KB class 'type | 436 | 443.60 KB class 'code | 2974 | 419.56 KB class '_io.BufferedWriter | 2 | 256.34 KB class 'set | 420 | 159.88 KB class '_io.BufferedReader | 1 | 128.17 KB class 'wrapper_descriptor | 1130 | 88.28 KB class 'tuple | 1304 | 86.57 KB class 'weakref | 1013 | 79.14 KB class 'builtin_function_or_method | 958 | 67.36 KB class 'method_descriptor | 865 | 60.82 KB class 'abc.ABCMeta | 62 | 59.96 KB class 'list | 446 | 58.52 KB class 'int | 1425 | 43.20 KB \u6709\u5173muppy\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 muppy\u6587\u6863 \u3002","title":"\u7528muppy\u8c03\u8bd5\u5185\u5b58\u6cc4\u6f0f"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/08-debugging-memory/#_5","text":"\u6709\u65f6\uff0c\u60a8\u53ef\u80fd\u4f1a\u6ce8\u610f\u5230Scrapy\u8fdb\u7a0b\u7684\u5185\u5b58\u4f7f\u7528\u53ea\u4f1a\u589e\u52a0\uff0c\u4f46\u4e0d\u4f1a\u51cf\u5c11\u3002\u4e0d\u5e78\u7684\u662f\uff0c\u5373\u4f7fScrapy\u548c\u9879\u76ee\u90fd\u6ca1\u6709\u6cc4\u6f0f\u5185\u5b58\uff0c\u4e5f\u53ef\u80fd\u53d1\u751f\u8fd9\u79cd\u60c5\u51b5\u3002\u8fd9\u662f\u7531\u4e8e\u4f17\u6240\u5468\u77e5\u7684Python\u95ee\u9898\uff0c\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u5b83\u53ef\u80fd\u4e0d\u4f1a\u5c06\u91ca\u653e\u7684\u5185\u5b58\u8fd4\u56de\u5230\u64cd\u4f5c\u7cfb\u7edf\u3002\u6709\u5173\u8fd9\u4e2a\u95ee\u9898\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605: Python\u7684\u5185\u5b58\u7ba1\u7406 Python\u7684\u5185\u5b58\u7ba1\u7406\u7b2c2\u90e8\u5206 Python\u7684\u5185\u5b58\u7ba1\u7406\u7b2c3\u90e8\u5206 \u672c\u6587 \u4e2d\u8be6\u7ec6\u4ecb\u7ecd\u4e86Evan Jones\u63d0\u51fa\u7684\u6539\u8fdb\uff0c\u5728Python 2.5\u4e2d\u5f97\u5230\u4e86\u5408\u5e76\uff0c\u4f46\u8fd9\u53ea\u662f\u51cf\u5c11\u4e86\u95ee\u9898\uff0c\u5e76\u6ca1\u6709\u5b8c\u5168\u89e3\u51b3\u95ee\u9898\u3002\u5f15\u7528\u672c\u6587: \u4e0d\u5e78\u7684\u662f\uff0c\u8fd9\u4e2a\u8865\u4e01\u53ea\u80fd\u5728\u4e0d\u518d\u5206\u914d\u5bf9\u8c61\u7684\u60c5\u51b5\u4e0b\u91ca\u653e\u4e00\u4e2a\u7ade\u6280\u573a\u3002\u8fd9\u610f\u5473\u7740\u788e\u7247\u5316\u662f\u4e00\u4e2a\u5927\u95ee\u9898\u3002\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u6709\u8bb8\u591a\u5146\u5b57\u8282\u7684\u7a7a\u95f2\u5185\u5b58\uff0c\u5206\u6563\u5728\u6240\u6709\u7684\u7ade\u6280\u573a\u4e2d\uff0c\u4f46\u662f\u5b83\u4e0d\u80fd\u91ca\u653e\u4efb\u4f55\u4e00\u4e2a\u3002\u8fd9\u662f\u6240\u6709\u5185\u5b58\u5206\u914d\u5668\u90fd\u4f1a\u9047\u5230\u7684\u95ee\u9898\u3002\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u7684\u552f\u4e00\u65b9\u6cd5\u662f\u8f6c\u79fb\u5230\u538b\u7f29\u5783\u573e\u6536\u96c6\u5668\uff0c\u5b83\u80fd\u591f\u5728\u5185\u5b58\u4e2d\u79fb\u52a8\u5bf9\u8c61\u3002\u8fd9\u9700\u8981\u5bf9Python\u89e3\u91ca\u5668\u8fdb\u884c\u91cd\u5927\u66f4\u6539\u3002 \u4e3a\u4e86\u4fdd\u6301\u5408\u7406\u7684\u5185\u5b58\u6d88\u8017\uff0c\u60a8\u53ef\u4ee5\u5c06job\u5206\u5272\u4e3a\u51e0\u4e2a\u8f83\u5c0f\u7684job\uff0c\u6216\u8005\u542f\u7528 \u6301\u4e45\u4f5c\u4e1a\u961f\u5217 \u5e76\u4e0d\u65f6\u5730\u505c\u6b62/\u542f\u52a8spider\u3002","title":"\u6ca1\u6709\u6cc4\u9732\u7684\u6cc4\u9732"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/09-down-file-image/","text":"\u4e0b\u8f7d\u5e76\u5904\u7406\u6587\u4ef6\u548c\u56fe\u50cf Scrapy\u63d0\u4f9b\u4e86\u53ef\u91cd\u7528\u7684 item pipelines \uff0c\u7528\u4e8e\u4e0b\u8f7d\u9644\u52a0\u5230\u7279\u5b9aitem\u7684\u6587\u4ef6(\u4f8b\u5982\uff0c\u5f53\u60a8\u6293\u53d6\u4ea7\u54c1\u5e76\u5e0c\u671b\u5728\u672c\u5730\u4e0b\u8f7d\u5176\u56fe\u50cf\u65f6)\u3002\u8fd9\u4e9b\u7ba1\u9053\u5171\u4eab\u4e00\u4e9b\u529f\u80fd\u548c\u7ed3\u6784(\u6211\u4eec\u5c06\u5b83\u4eec\u79f0\u4e3amedia pipelines)\uff0c\u4f46\u901a\u5e38\u60a8\u5c06\u4f7f\u7528Files Pipeline\u6216Images Pipeline\u3002 \u4e24\u4e2apipelines\u90fd\u5b9e\u73b0\u4e86\u4ee5\u4e0b\u7279\u6027: \u907f\u514d\u91cd\u65b0\u4e0b\u8f7d\u6700\u8fd1\u4e0b\u8f7d\u7684media \u6307\u5b9a\u5b58\u50a8media\u7684\u4f4d\u7f6e(\u6587\u4ef6\u7cfb\u7edf\u76ee\u5f55\u3001Amazon S3 bucket\u3001\u8c37\u6b4c\u4e91\u5b58\u50a8bucket) Images Pipeline\u6709\u4e00\u4e9b\u989d\u5916\u7684\u5904\u7406\u56fe\u50cf\u7684\u529f\u80fd: \u5c06\u6240\u6709\u4e0b\u8f7d\u7684\u56fe\u7247\u8f6c\u6362\u4e3a\u901a\u7528\u683c\u5f0f(JPG)\u548c\u6a21\u5f0f(RGB) \u751f\u6210\u7f29\u7565\u56fe \u68c0\u67e5\u56fe\u50cf\u7684\u5bbd\u5ea6/\u9ad8\u5ea6\u4ee5\u786e\u4fdd\u5b83\u4eec\u6ee1\u8db3\u6700\u5c0f\u7ea6\u675f pipelines\u8fd8\u4fdd\u7559\u90a3\u4e9b\u6b63\u5728\u8ba1\u5212\u4e0b\u8f7d\u7684media url\u7684\u5185\u90e8\u961f\u5217\uff0c\u5e76\u5c06\u5305\u542b\u76f8\u540cmedia\u7684responses\u8fde\u63a5\u5230\u8be5\u961f\u5217\u3002\u5f53\u540c\u4e00media\u88ab\u591a\u4e2aitems\u5171\u4eab\u65f6\uff0c\u8fd9\u53ef\u4ee5\u907f\u514d\u591a\u6b21\u4e0b\u8f7d\u3002 \u4f7f\u7528Files Pipeline \u4f7f\u7528 FilesPipeline \u65f6\uff0c\u5178\u578b\u7684\u5de5\u4f5c\u6d41\u662f\u8fd9\u6837\u7684: \u5728spider\u4e2d\uff0c\u60a8\u6293\u53d6\u4e00\u4e2aitem\uff0c\u5e76\u5c06\u6240\u9700\u7684url\u653e\u5165 file_urls (\u5b57\u6bb5) item\u4ecespider\u8fd4\u56de\u5e76\u8fdb\u5165item pipeline\u3002 \u5f53item\u5230\u8fbe FilesPipeline \u65f6\uff0c file_urls \u5b57\u6bb5\u4e2d\u7684url\u5c06\u88ab\u5b89\u6392\u4f7f\u7528\u6807\u51c6\u7684Scrapy scheduler\u548cdownloader(\u8fd9\u610f\u5473\u7740scheduler\u548cdownloader middlewares\u88ab\u91cd\u7528)\u8fdb\u884c\u4e0b\u8f7d\uff0c\u4f46\u662f\u5177\u6709\u66f4\u9ad8\u7684\u4f18\u5148\u7ea7\uff0c\u5728\u5176\u4ed6\u9875\u9762\u88ab\u6293\u53d6\u4e4b\u524d\u5bf9\u5b83\u4eec\u8fdb\u884c\u5904\u7406\u3002\u5728\u6587\u4ef6\u4e0b\u8f7d\u5b8c\u6210(\u6216\u7531\u4e8e\u67d0\u79cd\u539f\u56e0\u5931\u8d25)\u4e4b\u524d\uff0c\u8be5item\u5728\u7279\u5b9a\u7684pipeline\u9636\u6bb5\u4fdd\u6301\u201c\u9501\u5b9a\u201d\u72b6\u6001\u3002 \u4e0b\u8f7d\u6587\u4ef6\u65f6\uff0c\u5c06\u7ed3\u679c\u586b\u5145\u53e6\u4e00\u4e2a\u5b57\u6bb5( files )\u3002\u8be5\u5b57\u6bb5\u5c06\u5305\u542b\u5173\u4e8e\u4e0b\u8f7d\u6587\u4ef6\u7684\u4fe1\u606f\u7684dicts\u5217\u8868\uff0c\u4f8b\u5982\u4e0b\u8f7d\u7684\u8def\u5f84\u3001\u539f\u59cb\u7684\u6293\u53d6url(\u4ece file_urls \u5b57\u6bb5\u4e2d\u83b7\u53d6)\u548c\u6587\u4ef6\u6821\u9a8c\u3002 files \u5b57\u6bb5\u5217\u8868\u4e2d\u7684\u6587\u4ef6\u5c06\u4fdd\u6301\u539f\u59cb file_urls \u5b57\u6bb5\u7684\u987a\u5e8f\u3002\u5982\u679c\u67d0\u4e9b\u6587\u4ef6\u4e0b\u8f7d\u5931\u8d25\uff0c\u5c06log\u4e00\u4e2a\u9519\u8bef\uff0c\u6587\u4ef6\u5c06\u4e0d\u4f1a\u51fa\u73b0\u5728 files \u5b57\u6bb5\u4e2d\u3002 \u4f7f\u7528Images Pipeline \u4f7f\u7528 ImagesPipeline \u975e\u5e38\u7c7b\u4f3c\u4e8e\u4f7f\u7528 FilesPipeline \uff0c\u53ea\u662f\u4f7f\u7528\u7684\u9ed8\u8ba4\u5b57\u6bb5\u540d\u4e0d\u540c:\u4f7f\u7528 image_urls \u4f5c\u4e3aitem\u7684\u56fe\u50cfurl\uff0c\u5b83\u5c06\u586b\u5145\u4e00\u4e2a images \u5b57\u6bb5\u4ee5\u83b7\u5f97\u5173\u4e8e\u4e0b\u8f7d\u56fe\u50cf\u7684\u4fe1\u606f\u3002 \u4f7f\u7528 ImagesPipeline \u5904\u7406\u56fe\u50cf\u6587\u4ef6\u7684\u4f18\u70b9\u662f\uff0c\u60a8\u53ef\u4ee5\u914d\u7f6e\u4e00\u4e9b\u989d\u5916\u7684\u51fd\u6570\uff0c\u6bd4\u5982\u751f\u6210\u7f29\u7565\u56fe\u548c\u6839\u636e\u5b83\u4eec\u7684\u5927\u5c0f\u8fc7\u6ee4\u56fe\u50cf\u3002 Images Pipeline\u4f7f\u7528 Pillow \u5c06\u56fe\u50cf\u538b\u7f29\u5230JPEG/RGB\u683c\u5f0f\uff0c\u56e0\u6b64\u4f60\u9700\u8981\u5b89\u88c5\u8fd9\u4e2a\u5e93\u624d\u80fd\u4f7f\u7528\u5b83\u3002 Python Imaging Library (PIL)\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u4e5f\u53ef\u4ee5\u5de5\u4f5c\uff0c\u4f46\u4f17\u6240\u5468\u77e5\uff0c\u5b83\u4f1a\u5728\u4e00\u4e9b\u8bbe\u7f6e\u4e2d\u5e26\u6765\u9ebb\u70e6\uff0c\u6240\u4ee5\u6211\u4eec\u5efa\u8bae\u4f7f\u7528Pillow\u800c\u4e0d\u662fPIL\u3002 \u542f\u7528Media Pipeline \u8981\u542f\u7528media pipeline\uff0c\u5fc5\u987b\u9996\u5148\u5c06\u5176\u6dfb\u52a0\u5230\u9879\u76ee ITEM_PIPELINES setting\u4e2d\u3002 \u5bf9\u4e8eImages Pipeline\uff0c\u4f7f\u7528: ITEM_PIPELINES = {'scrapy.pipelines.images.ImagesPipeline': 1} \u5bf9\u4e8eFiles Pipeline\uff0c\u4f7f\u7528: ITEM_PIPELINES = {'scrapy.pipelines.files.FilesPipeline': 1} \u60a8\u8fd8\u53ef\u4ee5\u540c\u65f6\u4f7f\u7528Files\u548cImages Pipeline\u3002 \u7136\u540e\uff0c\u5c06\u76ee\u6807\u5b58\u50a8setting\u914d\u7f6e\u4e3a\u4e00\u4e2a\u6709\u6548\u503c\uff0c\u8be5\u6709\u6548\u503c\u5c06\u7528\u4e8e\u5b58\u50a8\u4e0b\u8f7d\u7684\u56fe\u50cf\u3002\u5426\u5219\uff0c\u7ba1\u9053\u5c06\u4fdd\u6301\u7981\u7528\u72b6\u6001\uff0c\u5373\u4f7f\u60a8\u5c06\u5176\u5305\u542b\u5728 ITEM_PIPELINES \u8bbe\u7f6e\u4e2d\u3002 \u5bf9\u4e8eFiles Pipeline\uff0c\u8bbe\u7f6e FILES_STORE setting: FILES_STORE = '/path/to/valid/dir' \u5bf9\u4e8eImages Pipeline\uff0c\u8bbe\u7f6e IMAGES_STORE setting: IMAGES_STORE = '/path/to/valid/dir' \u652f\u6301\u5b58\u50a8 \u6587\u4ef6\u7cfb\u7edf\u662f\u76ee\u524d\u552f\u4e00\u5b98\u65b9\u652f\u6301\u7684\u5b58\u50a8\uff0c\u4f46\u4e5f\u652f\u6301\u5728 Amazon S3 \u548c \u8c37\u6b4c\u4e91\u5b58\u50a8 \u4e2d\u5b58\u50a8\u6587\u4ef6\u3002 \u6587\u4ef6\u7cfb\u7edf\u5b58\u50a8 \u8fd9\u4e9b\u6587\u4ef6\u4f7f\u7528\u5b83\u4eec\u7684url\u7684SHA1 hash\u6765\u5b58\u50a8\u6587\u4ef6\u540d\u3002 \u4f8b\u5982\uff0c\u4ee5\u4e0b\u56fe\u7247URL: http://www.example.com/image.jpg \u5176SHA1\u6563\u5217\u4e3a: 3afec3b4765f8f0a07b78f98c07b83f013567a0a \u5c06\u4e0b\u8f7d\u5e76\u50a8\u5b58\u4e8e\u4ee5\u4e0b\u8def\u5f84: IMAGES_STORE /full/3afec3b4765f8f0a07b78f98c07b83f013567a0a.jpg \u76ee\u6807: IMAGES_STORE \u4e3aImages Pipeline\u5728 IMAGES_STORE \u8bbe\u7f6e\u4e2d\u5b9a\u4e49\u7684\u76ee\u5f55\u3002\u3002 full \u662f\u4e00\u4e2a\u5b50\u76ee\u5f55\uff0c\u7528\u4e8e\u4ece\u7f29\u7565\u56fe(\u5982\u679c\u4f7f\u7528)\u4e2d\u5206\u79bb\u5b8c\u6574\u7684\u56fe\u50cf\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1 \u7f29\u7565\u56fe\u751f\u6210 \u3002 Amazon S3\u5b58\u50a8 FILES_STORE \u548c IMAGES_STORE \u53ef\u4ee5\u8868\u793a\u4e00\u4e2aAmazon S3 bucket\u3002Scrapy\u4f1a\u81ea\u52a8\u5c06\u6587\u4ef6\u4e0a\u4f20\u5230bucket\u3002 \u4f8b\u5982\uff0c\u8fd9\u662f\u4e00\u4e2a\u6709\u6548\u7684 IMAGES_STORE \u503c: IMAGES_STORE = 's3://bucket/images' \u60a8\u53ef\u4ee5\u4fee\u6539\u7528\u4e8e\u5b58\u50a8\u6587\u4ef6\u7684\u8bbf\u95ee\u63a7\u5236\u5217\u8868(ACL)\u7b56\u7565\uff0c\u8be5\u7b56\u7565\u7531 FILES_STORE_S3_ACL \u8bbe\u7f6e\u548c IMAGES_STORE_S3_ACL settings\u5b9a\u4e49\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cACL\u8bbe\u7f6e\u4e3a private \u3002\u8981\u4f7f\u6587\u4ef6\u516c\u5f00\u53ef\u7528\uff0c\u8bf7\u4f7f\u7528 public-read \u7b56\u7565: IMAGES_STORE_S3_ACL = 'public-read' \u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605Amazon S3\u5f00\u53d1\u4eba\u5458\u6307\u5357\u4e2d\u7684 canned ACLs \u3002 \u8c37\u6b4c\u4e91\u5b58\u50a8 FILES_STORE \u548c IMAGES_STORE \u53ef\u4ee5\u8868\u793a\u8c37\u6b4c\u4e91\u5b58\u50a8bucket\u3002Scrapy\u4f1a\u81ea\u52a8\u5c06\u6587\u4ef6\u4e0a\u4f20\u5230bucket\u3002(\u9700\u8981 \u8c37\u6b4c\u4e91\u5b58\u50a8 ) \u4f8b\u5982\uff0c\u8fd9\u4e9b\u662f\u6709\u6548\u7684 IMAGES_STORE \u548c GCS_PROJECT_ID settings: IMAGES_STORE = 'gs://bucket/images/' GCS_PROJECT_ID = 'project_id' \u6709\u5173\u8eab\u4efd\u9a8c\u8bc1\u7684\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u6b64 \u6587\u6863 \u3002 \u4f7f\u7528\u6848\u4f8b \u4e3a\u4e86\u9996\u5148\u4f7f\u7528media pipeline\uff0c\u8bf7 \u542f\u7528\u5b83 \u3002 \u7136\u540e\uff0c\u5982\u679cspider\u8fd4\u56de\u4e00\u4e2a\u5e26\u6709url\u952e(\u5206\u522b\u7528\u4e8e\u6587\u4ef6\u6216\u56fe\u50cf\u7ba1\u9053\u7684 file_urls \u6216 image_urls )\u7684dict\uff0c\u7ba1\u9053\u5c06\u628a\u7ed3\u679c\u653e\u5728\u76f8\u5e94\u7684\u952e( files \u6216 images )\u4e0b\u3002 \u5982\u679c\u60a8\u559c\u6b22\u4f7f\u7528 Item \uff0c\u90a3\u4e48\u53ef\u4ee5\u4f7f\u7528\u5fc5\u8981\u7684\u5b57\u6bb5\u5b9a\u4e49\u4e00\u4e2a\u5b9a\u5236\u7684Item\uff0c\u4f8b\u5982\u5728\u8fd9\u4e2a\u793a\u4f8b\u4e2d\u4e3aImages Pipeline: import scrapy class MyItem(scrapy.Item): # ... \u5176\u4ed6item\u5b57\u6bb5 ... image_urls = scrapy.Field() images = scrapy.Field() \u5982\u679c\u60a8\u60f3\u4e3aurl\u952e\u6216\u7ed3\u679c\u952e\u4f7f\u7528\u53e6\u4e00\u4e2a\u5b57\u6bb5\u540d\uff0c\u4e5f\u53ef\u4ee5\u8986\u76d6\u5b83\u3002 \u5bf9\u4e8eFiles Pipeline\uff0c\u8bbe\u7f6e FILES_URLS_FIELD \u548c/\u6216 FILES_RESULT_FIELD settings: FILES_URLS_FIELD = '\u6587\u4ef6url\u7684\u5b57\u6bb5\u540d' FILES_RESULT_FIELD = '\u5904\u7406\u540e\u7684\u6587\u4ef6\u7684\u5b57\u6bb5\u540d' \u5bf9\u4e8eImages Pipeline\uff0c\u8bbe\u7f6e IMAGES_URLS_FIELD \u548c/\u6216 IMAGES_RESULT_FIELD \u8bbe\u7f6e: IMAGES_URLS_FIELD = '\u56fe\u50cfurl\u7684\u5b57\u6bb5\u540d' IMAGES_RESULT_FIELD = '\u5904\u7406\u540e\u7684\u56fe\u50cf\u7684\u5b57\u6bb5\u540d' \u5982\u679c\u60a8\u9700\u8981\u66f4\u590d\u6742\u7684\u5185\u5bb9\u5e76\u5e0c\u671b\u8986\u76d6\u81ea\u5b9a\u4e49pipeline\u884c\u4e3a\uff0c\u8bf7\u53c2\u9605 \u6269\u5c55Media Pipelines \u3002 \u5982\u679c\u60a8\u6709\u591a\u4e2a\u4eceImagePipeline\u7ee7\u627f\u7684image pipelines\uff0c\u5e76\u4e14\u5e0c\u671b\u5728\u4e0d\u540c\u7684\u7ba1\u9053\u4e2d\u6709\u4e0d\u540c\u7684\u8bbe\u7f6e\uff0c\u90a3\u4e48\u53ef\u4ee5\u8bbe\u7f6e\u5728\u7ba1\u9053\u7c7b\u7684\u5927\u5199\u540d\u79f0\u4e4b\u524d\u7684\u8bbe\u7f6e\u952e\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u7684\u7ba1\u9053\u88ab\u79f0\u4e3aMyPipeline\uff0c\u5e76\u4e14\u60a8\u60f3\u8981\u81ea\u5b9a\u4e49IMAGES_URLS_FIELD\uff0c\u60a8\u53ef\u4ee5\u5b9a\u4e49\u8bbe\u7f6eMYPIPELINE_IMAGES_URLS_FIELD\uff0c\u60a8\u7684\u81ea\u5b9a\u4e49\u8bbe\u7f6e\u5c06\u88ab\u4f7f\u7528\u3002 \u989d\u5916\u7279\u6027 \u6587\u4ef6\u8fc7\u671f Image Pipeline\u907f\u514d\u4e0b\u8f7d\u6700\u8fd1\u4e0b\u8f7d\u7684\u6587\u4ef6\u3002\u8981\u8c03\u6574\u8fd9\u79cd\u4fdd\u7559\u5ef6\u8fdf\uff0c\u4f7f\u7528 FILES_EXPIRES setting(\u6216\u8005 IMAGES_EXPIRES \uff0c\u5982\u679c\u662fImages Pipeline)\uff0c\u5b83\u6307\u5b9a\u5ef6\u8fdf\u5929\u6570: # \u6587\u4ef6\u5ef6\u8fdf\u4fdd\u7559120\u5929 FILES_EXPIRES = 120 # \u56fe\u50cf\u5ef6\u8fdf\u4fdd\u755930\u5929 IMAGES_EXPIRES = 30 \u8fd9\u4e24\u4e2a\u8bbe\u7f6e\u7684\u9ed8\u8ba4\u503c\u90fd\u662f90\u5929\u3002 \u5982\u679c\u4f60\u6709\u8fd9\u4e2a\u5b50\u7c7bFilesPipeline\u5e76\u4e14\u4f60\u5e0c\u671b\u5b83\u6709\u4e0d\u540c\u7684\u8bbe\u7f6e\u4f60\u53ef\u4ee5\u8bbe\u7f6e\u5927\u5199\u7c7b\u540d\u4e4b\u524d\u7684\u8bbe\u7f6e\u952e\u3002\u4f8b\u5982\uff0c\u7ed9\u5b9apipeline\u7c7bMyPipeline\u4f60\u53ef\u4ee5\u8bbe\u7f6e\u8bbe\u7f6e\u952e: MYPIPELINE_FILES_EXPIRES = 180 \u800cpipeline\u7c7bMyPipeline\u7684\u8fc7\u671f\u65f6\u95f4\u5c06\u8bbe\u7f6e\u4e3a180\u3002 \u56fe\u50cf\u7684\u7f29\u7565\u56fe\u751f\u6210 Images Pipeline\u53ef\u4ee5\u81ea\u52a8\u521b\u5efa\u4e0b\u8f7d\u56fe\u50cf\u7684\u7f29\u7565\u56fe\u3002 \u4e3a\u4e86\u4f7f\u7528\u8fd9\u4e2a\u7279\u6027\uff0c\u60a8\u5fc5\u987b\u5c06 IMAGES_THUMBS \u8bbe\u7f6e\u4e3a\u5b57\u5178\uff0c\u5176\u4e2d\u952e\u662f\u7f29\u7565\u56fe\u540d\u79f0\uff0c\u503c\u662f\u5b83\u4eec\u7684\u7ef4\u5ea6\u3002 \u4f8b\u5b50: IMAGES_THUMBS = { 'small': (50, 50), 'big': (270, 270), } \u5f53\u60a8\u4f7f\u7528\u6b64\u529f\u80fd\u65f6\uff0c\u56fe\u50cf\u7ba1\u9053\u5c06\u4f7f\u7528\u4ee5\u4e0b\u683c\u5f0f\u521b\u5efa\u6bcf\u4e2a\u6307\u5b9a\u5927\u5c0f\u7684\u7f29\u7565\u56fe: IMAGES_STORE /thumbs/ size_name / image_id .jpg \u76ee\u6807: size_name \u662f IMAGES_THUMBS \u5b57\u5178\u952e( small , big ,\u7b49\u7b49)\u4e2d\u6307\u5b9a\u7684\u503c image_id \u662f\u56fe\u50cfurl\u7684 SHA1 hash \u56fe\u50cf\u6587\u4ef6\u7684\u4f8b\u5b50\u5b58\u50a8\u4f7f\u7528 small \u548c big \u7f29\u7565\u540d\u79f0: IMAGES_STORE /full/63bbfea82b8880ed33cdb762aa11fab722a90a24.jpg IMAGES_STORE /thumbs/small/63bbfea82b8880ed33cdb762aa11fab722a90a24.jpg IMAGES_STORE /thumbs/big/63bbfea82b8880ed33cdb762aa11fab722a90a24.jpg \u7b2c\u4e00\u4e2a\u662f\u4ece\u7f51\u7ad9\u4e0b\u8f7d\u7684\u5b8c\u6574\u7684\u56fe\u50cf\u3002 \u8fc7\u6ee4\u5c0f\u56fe\u50cf \u5728\u4f7f\u7528Images Pipeline\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u5728 IMAGES_MIN_HEIGHT \u548c IMAGES_MIN_WIDTH settings\u4e2d\u6307\u5b9a\u5141\u8bb8\u7684\u6700\u5c0f\u503c\u6765\u5220\u9664\u592a\u5c0f\u7684\u56fe\u50cf\u3002 \u4f8b\u5b50: IMAGES_MIN_HEIGHT = 110 IMAGES_MIN_WIDTH = 110 \u5c3a\u5bf8\u7ea6\u675f\u5b8c\u5168\u4e0d\u4f1a\u5f71\u54cd\u7f29\u7565\u56fe\u7684\u751f\u6210\u3002 \u53ef\u4ee5\u53ea\u8bbe\u7f6e\u4e00\u4e2a\u5c3a\u5bf8\u7ea6\u675f\uff0c\u4e5f\u53ef\u4ee5\u540c\u65f6\u8bbe\u7f6e\u4e24\u4e2a\u5c3a\u5bf8\u7ea6\u675f\u3002\u5f53\u8bbe\u7f6e\u5b83\u4eec\u65f6\uff0c\u53ea\u4f1a\u4fdd\u5b58\u6ee1\u8db3\u8fd9\u4e24\u4e2a\u6700\u5c0f\u5c3a\u5bf8\u7684\u56fe\u50cf\u3002\u5bf9\u4e8e\u4e0a\u9762\u7684\u793a\u4f8b\uff0c\u5927\u5c0f(105 x 105)\u6216(105 x 200)\u6216(200 x 105)\u7684\u56fe\u50cf\u90fd\u5c06\u88ab\u5220\u9664\uff0c\u56e0\u4e3a\u81f3\u5c11\u6709\u4e00\u4e2a\u7ef4\u5ea6\u6bd4\u7ea6\u675f\u66f4\u77ed\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6ca1\u6709\u5c3a\u5bf8\u9650\u5236\uff0c\u6240\u4ee5\u6240\u6709\u7684\u56fe\u50cf\u90fd\u4f1a\u88ab\u5904\u7406\u3002 \u5141\u8bb8\u91cd\u5b9a\u5411 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cmedia pipelines\u4f1a\u5ffd\u7565\u91cd\u5b9a\u5411\uff0c\u5373HTTP\u91cd\u5b9a\u5411\u5230media\u6587\u4ef6URL\u8bf7\u6c42\u5c06\u610f\u5473\u7740media\u4e0b\u8f7d\u88ab\u8ba4\u4e3a\u5931\u8d25\u3002 \u8981\u5904\u7406media\u91cd\u5b9a\u5411\uff0c\u8bf7\u5c06\u6b64setting\u8bbe\u7f6e\u4e3a True : MEDIA_ALLOW_REDIRECTS = True \u6269\u5c55Media Pipelines \u8bf7\u770b\u8fd9\u91cc\u7684\u65b9\u6cd5\uff0c\u4f60\u53ef\u4ee5\u8986\u76d6\u5728\u4f60\u7684\u81ea\u5b9a\u4e49Files Pipeline: scrapy.pipelines.files.FilesPipeline \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) get_media_requests(item, info) \u6b63\u5982\u5728\u5de5\u4f5c\u6d41\u4e2d\u770b\u5230\u7684\uff0cpipeline\u5c06\u4eceitem\u4e2d\u83b7\u53d6\u56fe\u50cf\u7684url\u3002\u4e3a\u4e86\u505a\u5230\u8fd9\u4e00\u70b9\uff0c\u60a8\u53ef\u4ee5\u8986\u76d6 get_media_requests() \u65b9\u6cd5\uff0c\u5e76\u4e3a\u6bcf\u4e2a\u6587\u4ef6URL\u8fd4\u56de\u4e00\u4e2aRequest: def get_media_requests(self, item, info): for file_url in item['file_urls']: yield scrapy.Request(file_url) \u8fd9\u4e9brequests\u5c06\u7531pipeline\u5904\u7406\uff0c\u5f53\u5b83\u4eec\u5b8c\u6210\u4e0b\u8f7d\u540e\uff0c\u7ed3\u679c\u5c06\u4f5c\u4e3a\u4e00\u4e2a2\u4e2a\u5143\u7d20\u7684\u5143\u7ec4\u5217\u8868\u53d1\u9001\u5230 item_completed() \u65b9\u6cd5\u3002\u6bcf\u4e2a\u5143\u7ec4\u5c06\u5305\u542b (success, file_info_or_error) : success \u662f\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u5982\u679c\u56fe\u7247\u4e0b\u8f7d\u6210\u529f\uff0c\u5219\u4e3a True ;\u5982\u679c\u7531\u4e8e\u67d0\u79cd\u539f\u56e0\u5931\u8d25\uff0c\u5219\u4e3a False file_info_or_error \u662f\u4e00\u4e2a\u5305\u542b\u4ee5\u4e0b\u952e(\u5982\u679csuccess\u662f True )\u7684\u5b57\u5178\uff0c\u5982\u679c\u51fa\u73b0\u95ee\u9898\u5219\u662f Twisted\u9519\u8bef \u3002 url - \u4e0b\u8f7d\u6587\u4ef6\u7684url\u3002\u8fd9\u662f get_media_requests() \u65b9\u6cd5\u8fd4\u56de\u7684request\u7684url\u3002 path - \u5b58\u50a8\u6587\u4ef6\u7684\u8def\u5f84(\u76f8\u5bf9\u4e8e FILES_STORE ) checksum - \u56fe\u50cf\u5185\u5bb9\u7684 MD5 hash item_completed() \u6536\u5230\u7684\u5143\u7ec4\u5217\u8868\u4fdd\u8bc1\u4fdd\u7559 get_media_requests() \u65b9\u6cd5\u8fd4\u56de\u7684requests\u7684\u987a\u5e8f\u76f8\u540c\u3002 \u4e0b\u9762\u662f results \u53c2\u6570\u7684\u4e00\u4e2a\u5178\u578b\u503c: [(True, {'checksum': '2b00042f7481c7b056c4b410d28f33cf', 'path': 'full/0a79c461a4062ac383dc4fade7bc09f1384a3910.jpg', 'url': 'http://www.example.com/files/product1.pdf'}), (False, Failure(...))] \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c get_media_requests() \u65b9\u6cd5\u8fd4\u56de None \uff0c\u8fd9\u610f\u5473\u7740\u6ca1\u6709\u6587\u4ef6\u53ef\u4e0b\u8f7d\u3002 item_completed(results, item, info) \u5f53\u5bf9\u5355\u4e2aitem\u7684\u6240\u6709\u6587\u4ef6requests\u90fd\u5df2\u5b8c\u6210(\u4e0b\u8f7d\u5b8c\u6210\u6216\u7531\u4e8e\u67d0\u79cd\u539f\u56e0\u5931\u8d25)\u65f6\uff0c\u8c03\u7528 FilesPipeline.item_completed() \u65b9\u6cd5\u3002 item_completed() \u65b9\u6cd5\u5fc5\u987b\u8fd4\u56de\u5c06\u53d1\u9001\u5230\u540e\u7eed\u9879\u76ee\u7ba1\u9053\u9636\u6bb5\u7684\u8f93\u51fa\uff0c\u56e0\u6b64\u5fc5\u987b\u8fd4\u56de(\u6216\u5220\u9664)item\uff0c\u5c31\u50cf\u5728\u4efb\u4f55pipeline\u4e2d\u4e00\u6837\u3002 \u4e0b\u9762\u662f item_completed() \u65b9\u6cd5\u7684\u4e00\u4e2a\u4f8b\u5b50\uff0c\u6211\u4eec\u5728 file_paths item\u5b57\u6bb5\u4e2d\u5b58\u50a8\u4e0b\u8f7d\u7684\u6587\u4ef6\u8def\u5f84(\u4ee5\u7ed3\u679c\u7684\u5f62\u5f0f\u4f20\u9012)\uff0c\u5982\u679citem\u4e0d\u5305\u542b\u4efb\u4f55\u6587\u4ef6\uff0c\u6211\u4eec\u5c06\u5220\u9664\u5b83: from scrapy.exceptions import DropItem def item_completed(self, results, item, info): file_paths = [x['path'] for ok, x in results if ok] if not file_paths: raise DropItem( Item contains no files ) item['file_paths'] = file_paths return item \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c item_completed() \u65b9\u6cd5\u8fd4\u56deitem\u3002 \u8bf7\u770b\u8fd9\u91cc\u7684\u65b9\u6cd5\uff0c\u4f60\u53ef\u4ee5\u8986\u76d6\u5728\u4f60\u7684\u5b9a\u5236Images Pipeline: scrapy.pipelines.images.ImagesPipeline \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) ImagesPipeline \u662f FilesPipeline \u7684\u6269\u5c55\uff0c\u5b9a\u5236\u5b57\u6bb5\u540d\u5e76\u4e3a\u56fe\u50cf\u6dfb\u52a0\u81ea\u5b9a\u4e49\u884c\u4e3a\u3002 get_media_requests(item, info) \u65b9\u6cd5\u7684\u5de5\u4f5c\u65b9\u5f0f\u4e0e FilesPipeline.get_media_requests() \u65b9\u6cd5\u76f8\u540c\uff0c\u4f46\u5bf9\u56fe\u50cfurl\u4f7f\u7528\u4e0d\u540c\u7684\u5b57\u6bb5\u540d\u3002 \u5fc5\u987b\u8fd4\u56de\u6bcf\u4e2a\u56fe\u50cfURL\u7684Request\u3002 item_completed(results, item, info) ImagesPipeline.item_completed() \u65b9\u6cd5\u5728\u5355\u4e2aitem\u7684\u6240\u6709\u56fe\u50cfrequests\u90fd\u5b8c\u6210(\u6216\u8005\u4e0b\u8f7d\u5b8c\u6210\uff0c\u6216\u8005\u7531\u4e8e\u67d0\u79cd\u539f\u56e0\u5931\u8d25)\u65f6\u8c03\u7528\u3002 \u5de5\u4f5c\u65b9\u5f0f\u4e0e FilesPipeline.item_completed() \u65b9\u6cd5\u76f8\u540c\uff0c\u4f46\u4f7f\u7528\u4e0d\u540c\u7684\u5b57\u6bb5\u540d\u5b58\u50a8\u56fe\u50cf\u4e0b\u8f7d\u7ed3\u679c\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c item_completed() \u65b9\u6cd5\u8fd4\u56deitem\u3002 \u81ea\u5b9a\u4e49Images pipeline\u793a\u4f8b \u4e0b\u9762\u662fImages Pipeline\u7684\u5b8c\u6574\u793a\u4f8b\uff0c\u5176\u65b9\u6cd5\u5728\u4e0a\u9762\u8fdb\u884c\u4e86\u793a\u4f8b: import scrapy from scrapy.pipelines.images import ImagesPipeline from scrapy.exceptions import DropItem class MyImagesPipeline(ImagesPipeline): def get_media_requests(self, item, info): for image_url in item['image_urls']: yield scrapy.Request(image_url) def item_completed(self, results, item, info): image_paths = [x['path'] for ok, x in results if ok] if not image_paths: raise DropItem( Item contains no images ) item['image_paths'] = image_paths return item","title":"\u4e0b\u8f7d\u5e76\u5904\u7406\u6587\u4ef6\u548c\u56fe\u50cf"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/09-down-file-image/#_1","text":"Scrapy\u63d0\u4f9b\u4e86\u53ef\u91cd\u7528\u7684 item pipelines \uff0c\u7528\u4e8e\u4e0b\u8f7d\u9644\u52a0\u5230\u7279\u5b9aitem\u7684\u6587\u4ef6(\u4f8b\u5982\uff0c\u5f53\u60a8\u6293\u53d6\u4ea7\u54c1\u5e76\u5e0c\u671b\u5728\u672c\u5730\u4e0b\u8f7d\u5176\u56fe\u50cf\u65f6)\u3002\u8fd9\u4e9b\u7ba1\u9053\u5171\u4eab\u4e00\u4e9b\u529f\u80fd\u548c\u7ed3\u6784(\u6211\u4eec\u5c06\u5b83\u4eec\u79f0\u4e3amedia pipelines)\uff0c\u4f46\u901a\u5e38\u60a8\u5c06\u4f7f\u7528Files Pipeline\u6216Images Pipeline\u3002 \u4e24\u4e2apipelines\u90fd\u5b9e\u73b0\u4e86\u4ee5\u4e0b\u7279\u6027: \u907f\u514d\u91cd\u65b0\u4e0b\u8f7d\u6700\u8fd1\u4e0b\u8f7d\u7684media \u6307\u5b9a\u5b58\u50a8media\u7684\u4f4d\u7f6e(\u6587\u4ef6\u7cfb\u7edf\u76ee\u5f55\u3001Amazon S3 bucket\u3001\u8c37\u6b4c\u4e91\u5b58\u50a8bucket) Images Pipeline\u6709\u4e00\u4e9b\u989d\u5916\u7684\u5904\u7406\u56fe\u50cf\u7684\u529f\u80fd: \u5c06\u6240\u6709\u4e0b\u8f7d\u7684\u56fe\u7247\u8f6c\u6362\u4e3a\u901a\u7528\u683c\u5f0f(JPG)\u548c\u6a21\u5f0f(RGB) \u751f\u6210\u7f29\u7565\u56fe \u68c0\u67e5\u56fe\u50cf\u7684\u5bbd\u5ea6/\u9ad8\u5ea6\u4ee5\u786e\u4fdd\u5b83\u4eec\u6ee1\u8db3\u6700\u5c0f\u7ea6\u675f pipelines\u8fd8\u4fdd\u7559\u90a3\u4e9b\u6b63\u5728\u8ba1\u5212\u4e0b\u8f7d\u7684media url\u7684\u5185\u90e8\u961f\u5217\uff0c\u5e76\u5c06\u5305\u542b\u76f8\u540cmedia\u7684responses\u8fde\u63a5\u5230\u8be5\u961f\u5217\u3002\u5f53\u540c\u4e00media\u88ab\u591a\u4e2aitems\u5171\u4eab\u65f6\uff0c\u8fd9\u53ef\u4ee5\u907f\u514d\u591a\u6b21\u4e0b\u8f7d\u3002","title":"\u4e0b\u8f7d\u5e76\u5904\u7406\u6587\u4ef6\u548c\u56fe\u50cf"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/09-down-file-image/#files-pipeline","text":"\u4f7f\u7528 FilesPipeline \u65f6\uff0c\u5178\u578b\u7684\u5de5\u4f5c\u6d41\u662f\u8fd9\u6837\u7684: \u5728spider\u4e2d\uff0c\u60a8\u6293\u53d6\u4e00\u4e2aitem\uff0c\u5e76\u5c06\u6240\u9700\u7684url\u653e\u5165 file_urls (\u5b57\u6bb5) item\u4ecespider\u8fd4\u56de\u5e76\u8fdb\u5165item pipeline\u3002 \u5f53item\u5230\u8fbe FilesPipeline \u65f6\uff0c file_urls \u5b57\u6bb5\u4e2d\u7684url\u5c06\u88ab\u5b89\u6392\u4f7f\u7528\u6807\u51c6\u7684Scrapy scheduler\u548cdownloader(\u8fd9\u610f\u5473\u7740scheduler\u548cdownloader middlewares\u88ab\u91cd\u7528)\u8fdb\u884c\u4e0b\u8f7d\uff0c\u4f46\u662f\u5177\u6709\u66f4\u9ad8\u7684\u4f18\u5148\u7ea7\uff0c\u5728\u5176\u4ed6\u9875\u9762\u88ab\u6293\u53d6\u4e4b\u524d\u5bf9\u5b83\u4eec\u8fdb\u884c\u5904\u7406\u3002\u5728\u6587\u4ef6\u4e0b\u8f7d\u5b8c\u6210(\u6216\u7531\u4e8e\u67d0\u79cd\u539f\u56e0\u5931\u8d25)\u4e4b\u524d\uff0c\u8be5item\u5728\u7279\u5b9a\u7684pipeline\u9636\u6bb5\u4fdd\u6301\u201c\u9501\u5b9a\u201d\u72b6\u6001\u3002 \u4e0b\u8f7d\u6587\u4ef6\u65f6\uff0c\u5c06\u7ed3\u679c\u586b\u5145\u53e6\u4e00\u4e2a\u5b57\u6bb5( files )\u3002\u8be5\u5b57\u6bb5\u5c06\u5305\u542b\u5173\u4e8e\u4e0b\u8f7d\u6587\u4ef6\u7684\u4fe1\u606f\u7684dicts\u5217\u8868\uff0c\u4f8b\u5982\u4e0b\u8f7d\u7684\u8def\u5f84\u3001\u539f\u59cb\u7684\u6293\u53d6url(\u4ece file_urls \u5b57\u6bb5\u4e2d\u83b7\u53d6)\u548c\u6587\u4ef6\u6821\u9a8c\u3002 files \u5b57\u6bb5\u5217\u8868\u4e2d\u7684\u6587\u4ef6\u5c06\u4fdd\u6301\u539f\u59cb file_urls \u5b57\u6bb5\u7684\u987a\u5e8f\u3002\u5982\u679c\u67d0\u4e9b\u6587\u4ef6\u4e0b\u8f7d\u5931\u8d25\uff0c\u5c06log\u4e00\u4e2a\u9519\u8bef\uff0c\u6587\u4ef6\u5c06\u4e0d\u4f1a\u51fa\u73b0\u5728 files \u5b57\u6bb5\u4e2d\u3002","title":"\u4f7f\u7528Files Pipeline"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/09-down-file-image/#images-pipeline","text":"\u4f7f\u7528 ImagesPipeline \u975e\u5e38\u7c7b\u4f3c\u4e8e\u4f7f\u7528 FilesPipeline \uff0c\u53ea\u662f\u4f7f\u7528\u7684\u9ed8\u8ba4\u5b57\u6bb5\u540d\u4e0d\u540c:\u4f7f\u7528 image_urls \u4f5c\u4e3aitem\u7684\u56fe\u50cfurl\uff0c\u5b83\u5c06\u586b\u5145\u4e00\u4e2a images \u5b57\u6bb5\u4ee5\u83b7\u5f97\u5173\u4e8e\u4e0b\u8f7d\u56fe\u50cf\u7684\u4fe1\u606f\u3002 \u4f7f\u7528 ImagesPipeline \u5904\u7406\u56fe\u50cf\u6587\u4ef6\u7684\u4f18\u70b9\u662f\uff0c\u60a8\u53ef\u4ee5\u914d\u7f6e\u4e00\u4e9b\u989d\u5916\u7684\u51fd\u6570\uff0c\u6bd4\u5982\u751f\u6210\u7f29\u7565\u56fe\u548c\u6839\u636e\u5b83\u4eec\u7684\u5927\u5c0f\u8fc7\u6ee4\u56fe\u50cf\u3002 Images Pipeline\u4f7f\u7528 Pillow \u5c06\u56fe\u50cf\u538b\u7f29\u5230JPEG/RGB\u683c\u5f0f\uff0c\u56e0\u6b64\u4f60\u9700\u8981\u5b89\u88c5\u8fd9\u4e2a\u5e93\u624d\u80fd\u4f7f\u7528\u5b83\u3002 Python Imaging Library (PIL)\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u4e5f\u53ef\u4ee5\u5de5\u4f5c\uff0c\u4f46\u4f17\u6240\u5468\u77e5\uff0c\u5b83\u4f1a\u5728\u4e00\u4e9b\u8bbe\u7f6e\u4e2d\u5e26\u6765\u9ebb\u70e6\uff0c\u6240\u4ee5\u6211\u4eec\u5efa\u8bae\u4f7f\u7528Pillow\u800c\u4e0d\u662fPIL\u3002","title":"\u4f7f\u7528Images Pipeline"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/09-down-file-image/#media-pipeline","text":"\u8981\u542f\u7528media pipeline\uff0c\u5fc5\u987b\u9996\u5148\u5c06\u5176\u6dfb\u52a0\u5230\u9879\u76ee ITEM_PIPELINES setting\u4e2d\u3002 \u5bf9\u4e8eImages Pipeline\uff0c\u4f7f\u7528: ITEM_PIPELINES = {'scrapy.pipelines.images.ImagesPipeline': 1} \u5bf9\u4e8eFiles Pipeline\uff0c\u4f7f\u7528: ITEM_PIPELINES = {'scrapy.pipelines.files.FilesPipeline': 1} \u60a8\u8fd8\u53ef\u4ee5\u540c\u65f6\u4f7f\u7528Files\u548cImages Pipeline\u3002 \u7136\u540e\uff0c\u5c06\u76ee\u6807\u5b58\u50a8setting\u914d\u7f6e\u4e3a\u4e00\u4e2a\u6709\u6548\u503c\uff0c\u8be5\u6709\u6548\u503c\u5c06\u7528\u4e8e\u5b58\u50a8\u4e0b\u8f7d\u7684\u56fe\u50cf\u3002\u5426\u5219\uff0c\u7ba1\u9053\u5c06\u4fdd\u6301\u7981\u7528\u72b6\u6001\uff0c\u5373\u4f7f\u60a8\u5c06\u5176\u5305\u542b\u5728 ITEM_PIPELINES \u8bbe\u7f6e\u4e2d\u3002 \u5bf9\u4e8eFiles Pipeline\uff0c\u8bbe\u7f6e FILES_STORE setting: FILES_STORE = '/path/to/valid/dir' \u5bf9\u4e8eImages Pipeline\uff0c\u8bbe\u7f6e IMAGES_STORE setting: IMAGES_STORE = '/path/to/valid/dir'","title":"\u542f\u7528Media Pipeline"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/09-down-file-image/#_2","text":"\u6587\u4ef6\u7cfb\u7edf\u662f\u76ee\u524d\u552f\u4e00\u5b98\u65b9\u652f\u6301\u7684\u5b58\u50a8\uff0c\u4f46\u4e5f\u652f\u6301\u5728 Amazon S3 \u548c \u8c37\u6b4c\u4e91\u5b58\u50a8 \u4e2d\u5b58\u50a8\u6587\u4ef6\u3002","title":"\u652f\u6301\u5b58\u50a8"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/09-down-file-image/#_3","text":"\u8fd9\u4e9b\u6587\u4ef6\u4f7f\u7528\u5b83\u4eec\u7684url\u7684SHA1 hash\u6765\u5b58\u50a8\u6587\u4ef6\u540d\u3002 \u4f8b\u5982\uff0c\u4ee5\u4e0b\u56fe\u7247URL: http://www.example.com/image.jpg \u5176SHA1\u6563\u5217\u4e3a: 3afec3b4765f8f0a07b78f98c07b83f013567a0a \u5c06\u4e0b\u8f7d\u5e76\u50a8\u5b58\u4e8e\u4ee5\u4e0b\u8def\u5f84: IMAGES_STORE /full/3afec3b4765f8f0a07b78f98c07b83f013567a0a.jpg \u76ee\u6807: IMAGES_STORE \u4e3aImages Pipeline\u5728 IMAGES_STORE \u8bbe\u7f6e\u4e2d\u5b9a\u4e49\u7684\u76ee\u5f55\u3002\u3002 full \u662f\u4e00\u4e2a\u5b50\u76ee\u5f55\uff0c\u7528\u4e8e\u4ece\u7f29\u7565\u56fe(\u5982\u679c\u4f7f\u7528)\u4e2d\u5206\u79bb\u5b8c\u6574\u7684\u56fe\u50cf\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1 \u7f29\u7565\u56fe\u751f\u6210 \u3002","title":"\u6587\u4ef6\u7cfb\u7edf\u5b58\u50a8"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/09-down-file-image/#amazon-s3","text":"FILES_STORE \u548c IMAGES_STORE \u53ef\u4ee5\u8868\u793a\u4e00\u4e2aAmazon S3 bucket\u3002Scrapy\u4f1a\u81ea\u52a8\u5c06\u6587\u4ef6\u4e0a\u4f20\u5230bucket\u3002 \u4f8b\u5982\uff0c\u8fd9\u662f\u4e00\u4e2a\u6709\u6548\u7684 IMAGES_STORE \u503c: IMAGES_STORE = 's3://bucket/images' \u60a8\u53ef\u4ee5\u4fee\u6539\u7528\u4e8e\u5b58\u50a8\u6587\u4ef6\u7684\u8bbf\u95ee\u63a7\u5236\u5217\u8868(ACL)\u7b56\u7565\uff0c\u8be5\u7b56\u7565\u7531 FILES_STORE_S3_ACL \u8bbe\u7f6e\u548c IMAGES_STORE_S3_ACL settings\u5b9a\u4e49\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cACL\u8bbe\u7f6e\u4e3a private \u3002\u8981\u4f7f\u6587\u4ef6\u516c\u5f00\u53ef\u7528\uff0c\u8bf7\u4f7f\u7528 public-read \u7b56\u7565: IMAGES_STORE_S3_ACL = 'public-read' \u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605Amazon S3\u5f00\u53d1\u4eba\u5458\u6307\u5357\u4e2d\u7684 canned ACLs \u3002","title":"Amazon S3\u5b58\u50a8"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/09-down-file-image/#_4","text":"FILES_STORE \u548c IMAGES_STORE \u53ef\u4ee5\u8868\u793a\u8c37\u6b4c\u4e91\u5b58\u50a8bucket\u3002Scrapy\u4f1a\u81ea\u52a8\u5c06\u6587\u4ef6\u4e0a\u4f20\u5230bucket\u3002(\u9700\u8981 \u8c37\u6b4c\u4e91\u5b58\u50a8 ) \u4f8b\u5982\uff0c\u8fd9\u4e9b\u662f\u6709\u6548\u7684 IMAGES_STORE \u548c GCS_PROJECT_ID settings: IMAGES_STORE = 'gs://bucket/images/' GCS_PROJECT_ID = 'project_id' \u6709\u5173\u8eab\u4efd\u9a8c\u8bc1\u7684\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u6b64 \u6587\u6863 \u3002","title":"\u8c37\u6b4c\u4e91\u5b58\u50a8"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/09-down-file-image/#_5","text":"\u4e3a\u4e86\u9996\u5148\u4f7f\u7528media pipeline\uff0c\u8bf7 \u542f\u7528\u5b83 \u3002 \u7136\u540e\uff0c\u5982\u679cspider\u8fd4\u56de\u4e00\u4e2a\u5e26\u6709url\u952e(\u5206\u522b\u7528\u4e8e\u6587\u4ef6\u6216\u56fe\u50cf\u7ba1\u9053\u7684 file_urls \u6216 image_urls )\u7684dict\uff0c\u7ba1\u9053\u5c06\u628a\u7ed3\u679c\u653e\u5728\u76f8\u5e94\u7684\u952e( files \u6216 images )\u4e0b\u3002 \u5982\u679c\u60a8\u559c\u6b22\u4f7f\u7528 Item \uff0c\u90a3\u4e48\u53ef\u4ee5\u4f7f\u7528\u5fc5\u8981\u7684\u5b57\u6bb5\u5b9a\u4e49\u4e00\u4e2a\u5b9a\u5236\u7684Item\uff0c\u4f8b\u5982\u5728\u8fd9\u4e2a\u793a\u4f8b\u4e2d\u4e3aImages Pipeline: import scrapy class MyItem(scrapy.Item): # ... \u5176\u4ed6item\u5b57\u6bb5 ... image_urls = scrapy.Field() images = scrapy.Field() \u5982\u679c\u60a8\u60f3\u4e3aurl\u952e\u6216\u7ed3\u679c\u952e\u4f7f\u7528\u53e6\u4e00\u4e2a\u5b57\u6bb5\u540d\uff0c\u4e5f\u53ef\u4ee5\u8986\u76d6\u5b83\u3002 \u5bf9\u4e8eFiles Pipeline\uff0c\u8bbe\u7f6e FILES_URLS_FIELD \u548c/\u6216 FILES_RESULT_FIELD settings: FILES_URLS_FIELD = '\u6587\u4ef6url\u7684\u5b57\u6bb5\u540d' FILES_RESULT_FIELD = '\u5904\u7406\u540e\u7684\u6587\u4ef6\u7684\u5b57\u6bb5\u540d' \u5bf9\u4e8eImages Pipeline\uff0c\u8bbe\u7f6e IMAGES_URLS_FIELD \u548c/\u6216 IMAGES_RESULT_FIELD \u8bbe\u7f6e: IMAGES_URLS_FIELD = '\u56fe\u50cfurl\u7684\u5b57\u6bb5\u540d' IMAGES_RESULT_FIELD = '\u5904\u7406\u540e\u7684\u56fe\u50cf\u7684\u5b57\u6bb5\u540d' \u5982\u679c\u60a8\u9700\u8981\u66f4\u590d\u6742\u7684\u5185\u5bb9\u5e76\u5e0c\u671b\u8986\u76d6\u81ea\u5b9a\u4e49pipeline\u884c\u4e3a\uff0c\u8bf7\u53c2\u9605 \u6269\u5c55Media Pipelines \u3002 \u5982\u679c\u60a8\u6709\u591a\u4e2a\u4eceImagePipeline\u7ee7\u627f\u7684image pipelines\uff0c\u5e76\u4e14\u5e0c\u671b\u5728\u4e0d\u540c\u7684\u7ba1\u9053\u4e2d\u6709\u4e0d\u540c\u7684\u8bbe\u7f6e\uff0c\u90a3\u4e48\u53ef\u4ee5\u8bbe\u7f6e\u5728\u7ba1\u9053\u7c7b\u7684\u5927\u5199\u540d\u79f0\u4e4b\u524d\u7684\u8bbe\u7f6e\u952e\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u7684\u7ba1\u9053\u88ab\u79f0\u4e3aMyPipeline\uff0c\u5e76\u4e14\u60a8\u60f3\u8981\u81ea\u5b9a\u4e49IMAGES_URLS_FIELD\uff0c\u60a8\u53ef\u4ee5\u5b9a\u4e49\u8bbe\u7f6eMYPIPELINE_IMAGES_URLS_FIELD\uff0c\u60a8\u7684\u81ea\u5b9a\u4e49\u8bbe\u7f6e\u5c06\u88ab\u4f7f\u7528\u3002","title":"\u4f7f\u7528\u6848\u4f8b"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/09-down-file-image/#_6","text":"","title":"\u989d\u5916\u7279\u6027"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/09-down-file-image/#_7","text":"Image Pipeline\u907f\u514d\u4e0b\u8f7d\u6700\u8fd1\u4e0b\u8f7d\u7684\u6587\u4ef6\u3002\u8981\u8c03\u6574\u8fd9\u79cd\u4fdd\u7559\u5ef6\u8fdf\uff0c\u4f7f\u7528 FILES_EXPIRES setting(\u6216\u8005 IMAGES_EXPIRES \uff0c\u5982\u679c\u662fImages Pipeline)\uff0c\u5b83\u6307\u5b9a\u5ef6\u8fdf\u5929\u6570: # \u6587\u4ef6\u5ef6\u8fdf\u4fdd\u7559120\u5929 FILES_EXPIRES = 120 # \u56fe\u50cf\u5ef6\u8fdf\u4fdd\u755930\u5929 IMAGES_EXPIRES = 30 \u8fd9\u4e24\u4e2a\u8bbe\u7f6e\u7684\u9ed8\u8ba4\u503c\u90fd\u662f90\u5929\u3002 \u5982\u679c\u4f60\u6709\u8fd9\u4e2a\u5b50\u7c7bFilesPipeline\u5e76\u4e14\u4f60\u5e0c\u671b\u5b83\u6709\u4e0d\u540c\u7684\u8bbe\u7f6e\u4f60\u53ef\u4ee5\u8bbe\u7f6e\u5927\u5199\u7c7b\u540d\u4e4b\u524d\u7684\u8bbe\u7f6e\u952e\u3002\u4f8b\u5982\uff0c\u7ed9\u5b9apipeline\u7c7bMyPipeline\u4f60\u53ef\u4ee5\u8bbe\u7f6e\u8bbe\u7f6e\u952e: MYPIPELINE_FILES_EXPIRES = 180 \u800cpipeline\u7c7bMyPipeline\u7684\u8fc7\u671f\u65f6\u95f4\u5c06\u8bbe\u7f6e\u4e3a180\u3002","title":"\u6587\u4ef6\u8fc7\u671f"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/09-down-file-image/#_8","text":"Images Pipeline\u53ef\u4ee5\u81ea\u52a8\u521b\u5efa\u4e0b\u8f7d\u56fe\u50cf\u7684\u7f29\u7565\u56fe\u3002 \u4e3a\u4e86\u4f7f\u7528\u8fd9\u4e2a\u7279\u6027\uff0c\u60a8\u5fc5\u987b\u5c06 IMAGES_THUMBS \u8bbe\u7f6e\u4e3a\u5b57\u5178\uff0c\u5176\u4e2d\u952e\u662f\u7f29\u7565\u56fe\u540d\u79f0\uff0c\u503c\u662f\u5b83\u4eec\u7684\u7ef4\u5ea6\u3002 \u4f8b\u5b50: IMAGES_THUMBS = { 'small': (50, 50), 'big': (270, 270), } \u5f53\u60a8\u4f7f\u7528\u6b64\u529f\u80fd\u65f6\uff0c\u56fe\u50cf\u7ba1\u9053\u5c06\u4f7f\u7528\u4ee5\u4e0b\u683c\u5f0f\u521b\u5efa\u6bcf\u4e2a\u6307\u5b9a\u5927\u5c0f\u7684\u7f29\u7565\u56fe: IMAGES_STORE /thumbs/ size_name / image_id .jpg \u76ee\u6807: size_name \u662f IMAGES_THUMBS \u5b57\u5178\u952e( small , big ,\u7b49\u7b49)\u4e2d\u6307\u5b9a\u7684\u503c image_id \u662f\u56fe\u50cfurl\u7684 SHA1 hash \u56fe\u50cf\u6587\u4ef6\u7684\u4f8b\u5b50\u5b58\u50a8\u4f7f\u7528 small \u548c big \u7f29\u7565\u540d\u79f0: IMAGES_STORE /full/63bbfea82b8880ed33cdb762aa11fab722a90a24.jpg IMAGES_STORE /thumbs/small/63bbfea82b8880ed33cdb762aa11fab722a90a24.jpg IMAGES_STORE /thumbs/big/63bbfea82b8880ed33cdb762aa11fab722a90a24.jpg \u7b2c\u4e00\u4e2a\u662f\u4ece\u7f51\u7ad9\u4e0b\u8f7d\u7684\u5b8c\u6574\u7684\u56fe\u50cf\u3002","title":"\u56fe\u50cf\u7684\u7f29\u7565\u56fe\u751f\u6210"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/09-down-file-image/#_9","text":"\u5728\u4f7f\u7528Images Pipeline\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u5728 IMAGES_MIN_HEIGHT \u548c IMAGES_MIN_WIDTH settings\u4e2d\u6307\u5b9a\u5141\u8bb8\u7684\u6700\u5c0f\u503c\u6765\u5220\u9664\u592a\u5c0f\u7684\u56fe\u50cf\u3002 \u4f8b\u5b50: IMAGES_MIN_HEIGHT = 110 IMAGES_MIN_WIDTH = 110 \u5c3a\u5bf8\u7ea6\u675f\u5b8c\u5168\u4e0d\u4f1a\u5f71\u54cd\u7f29\u7565\u56fe\u7684\u751f\u6210\u3002 \u53ef\u4ee5\u53ea\u8bbe\u7f6e\u4e00\u4e2a\u5c3a\u5bf8\u7ea6\u675f\uff0c\u4e5f\u53ef\u4ee5\u540c\u65f6\u8bbe\u7f6e\u4e24\u4e2a\u5c3a\u5bf8\u7ea6\u675f\u3002\u5f53\u8bbe\u7f6e\u5b83\u4eec\u65f6\uff0c\u53ea\u4f1a\u4fdd\u5b58\u6ee1\u8db3\u8fd9\u4e24\u4e2a\u6700\u5c0f\u5c3a\u5bf8\u7684\u56fe\u50cf\u3002\u5bf9\u4e8e\u4e0a\u9762\u7684\u793a\u4f8b\uff0c\u5927\u5c0f(105 x 105)\u6216(105 x 200)\u6216(200 x 105)\u7684\u56fe\u50cf\u90fd\u5c06\u88ab\u5220\u9664\uff0c\u56e0\u4e3a\u81f3\u5c11\u6709\u4e00\u4e2a\u7ef4\u5ea6\u6bd4\u7ea6\u675f\u66f4\u77ed\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6ca1\u6709\u5c3a\u5bf8\u9650\u5236\uff0c\u6240\u4ee5\u6240\u6709\u7684\u56fe\u50cf\u90fd\u4f1a\u88ab\u5904\u7406\u3002","title":"\u8fc7\u6ee4\u5c0f\u56fe\u50cf"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/09-down-file-image/#_10","text":"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cmedia pipelines\u4f1a\u5ffd\u7565\u91cd\u5b9a\u5411\uff0c\u5373HTTP\u91cd\u5b9a\u5411\u5230media\u6587\u4ef6URL\u8bf7\u6c42\u5c06\u610f\u5473\u7740media\u4e0b\u8f7d\u88ab\u8ba4\u4e3a\u5931\u8d25\u3002 \u8981\u5904\u7406media\u91cd\u5b9a\u5411\uff0c\u8bf7\u5c06\u6b64setting\u8bbe\u7f6e\u4e3a True : MEDIA_ALLOW_REDIRECTS = True","title":"\u5141\u8bb8\u91cd\u5b9a\u5411"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/09-down-file-image/#media-pipelines","text":"\u8bf7\u770b\u8fd9\u91cc\u7684\u65b9\u6cd5\uff0c\u4f60\u53ef\u4ee5\u8986\u76d6\u5728\u4f60\u7684\u81ea\u5b9a\u4e49Files Pipeline:","title":"\u6269\u5c55Media Pipelines"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/09-down-file-image/#scrapypipelinesfilesfilespipeline-class","text":"get_media_requests(item, info) \u6b63\u5982\u5728\u5de5\u4f5c\u6d41\u4e2d\u770b\u5230\u7684\uff0cpipeline\u5c06\u4eceitem\u4e2d\u83b7\u53d6\u56fe\u50cf\u7684url\u3002\u4e3a\u4e86\u505a\u5230\u8fd9\u4e00\u70b9\uff0c\u60a8\u53ef\u4ee5\u8986\u76d6 get_media_requests() \u65b9\u6cd5\uff0c\u5e76\u4e3a\u6bcf\u4e2a\u6587\u4ef6URL\u8fd4\u56de\u4e00\u4e2aRequest: def get_media_requests(self, item, info): for file_url in item['file_urls']: yield scrapy.Request(file_url) \u8fd9\u4e9brequests\u5c06\u7531pipeline\u5904\u7406\uff0c\u5f53\u5b83\u4eec\u5b8c\u6210\u4e0b\u8f7d\u540e\uff0c\u7ed3\u679c\u5c06\u4f5c\u4e3a\u4e00\u4e2a2\u4e2a\u5143\u7d20\u7684\u5143\u7ec4\u5217\u8868\u53d1\u9001\u5230 item_completed() \u65b9\u6cd5\u3002\u6bcf\u4e2a\u5143\u7ec4\u5c06\u5305\u542b (success, file_info_or_error) : success \u662f\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u5982\u679c\u56fe\u7247\u4e0b\u8f7d\u6210\u529f\uff0c\u5219\u4e3a True ;\u5982\u679c\u7531\u4e8e\u67d0\u79cd\u539f\u56e0\u5931\u8d25\uff0c\u5219\u4e3a False file_info_or_error \u662f\u4e00\u4e2a\u5305\u542b\u4ee5\u4e0b\u952e(\u5982\u679csuccess\u662f True )\u7684\u5b57\u5178\uff0c\u5982\u679c\u51fa\u73b0\u95ee\u9898\u5219\u662f Twisted\u9519\u8bef \u3002 url - \u4e0b\u8f7d\u6587\u4ef6\u7684url\u3002\u8fd9\u662f get_media_requests() \u65b9\u6cd5\u8fd4\u56de\u7684request\u7684url\u3002 path - \u5b58\u50a8\u6587\u4ef6\u7684\u8def\u5f84(\u76f8\u5bf9\u4e8e FILES_STORE ) checksum - \u56fe\u50cf\u5185\u5bb9\u7684 MD5 hash item_completed() \u6536\u5230\u7684\u5143\u7ec4\u5217\u8868\u4fdd\u8bc1\u4fdd\u7559 get_media_requests() \u65b9\u6cd5\u8fd4\u56de\u7684requests\u7684\u987a\u5e8f\u76f8\u540c\u3002 \u4e0b\u9762\u662f results \u53c2\u6570\u7684\u4e00\u4e2a\u5178\u578b\u503c: [(True, {'checksum': '2b00042f7481c7b056c4b410d28f33cf', 'path': 'full/0a79c461a4062ac383dc4fade7bc09f1384a3910.jpg', 'url': 'http://www.example.com/files/product1.pdf'}), (False, Failure(...))] \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c get_media_requests() \u65b9\u6cd5\u8fd4\u56de None \uff0c\u8fd9\u610f\u5473\u7740\u6ca1\u6709\u6587\u4ef6\u53ef\u4e0b\u8f7d\u3002 item_completed(results, item, info) \u5f53\u5bf9\u5355\u4e2aitem\u7684\u6240\u6709\u6587\u4ef6requests\u90fd\u5df2\u5b8c\u6210(\u4e0b\u8f7d\u5b8c\u6210\u6216\u7531\u4e8e\u67d0\u79cd\u539f\u56e0\u5931\u8d25)\u65f6\uff0c\u8c03\u7528 FilesPipeline.item_completed() \u65b9\u6cd5\u3002 item_completed() \u65b9\u6cd5\u5fc5\u987b\u8fd4\u56de\u5c06\u53d1\u9001\u5230\u540e\u7eed\u9879\u76ee\u7ba1\u9053\u9636\u6bb5\u7684\u8f93\u51fa\uff0c\u56e0\u6b64\u5fc5\u987b\u8fd4\u56de(\u6216\u5220\u9664)item\uff0c\u5c31\u50cf\u5728\u4efb\u4f55pipeline\u4e2d\u4e00\u6837\u3002 \u4e0b\u9762\u662f item_completed() \u65b9\u6cd5\u7684\u4e00\u4e2a\u4f8b\u5b50\uff0c\u6211\u4eec\u5728 file_paths item\u5b57\u6bb5\u4e2d\u5b58\u50a8\u4e0b\u8f7d\u7684\u6587\u4ef6\u8def\u5f84(\u4ee5\u7ed3\u679c\u7684\u5f62\u5f0f\u4f20\u9012)\uff0c\u5982\u679citem\u4e0d\u5305\u542b\u4efb\u4f55\u6587\u4ef6\uff0c\u6211\u4eec\u5c06\u5220\u9664\u5b83: from scrapy.exceptions import DropItem def item_completed(self, results, item, info): file_paths = [x['path'] for ok, x in results if ok] if not file_paths: raise DropItem( Item contains no files ) item['file_paths'] = file_paths return item \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c item_completed() \u65b9\u6cd5\u8fd4\u56deitem\u3002 \u8bf7\u770b\u8fd9\u91cc\u7684\u65b9\u6cd5\uff0c\u4f60\u53ef\u4ee5\u8986\u76d6\u5728\u4f60\u7684\u5b9a\u5236Images Pipeline:","title":"scrapy.pipelines.files.FilesPipeline   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/09-down-file-image/#scrapypipelinesimagesimagespipeline-class","text":"ImagesPipeline \u662f FilesPipeline \u7684\u6269\u5c55\uff0c\u5b9a\u5236\u5b57\u6bb5\u540d\u5e76\u4e3a\u56fe\u50cf\u6dfb\u52a0\u81ea\u5b9a\u4e49\u884c\u4e3a\u3002 get_media_requests(item, info) \u65b9\u6cd5\u7684\u5de5\u4f5c\u65b9\u5f0f\u4e0e FilesPipeline.get_media_requests() \u65b9\u6cd5\u76f8\u540c\uff0c\u4f46\u5bf9\u56fe\u50cfurl\u4f7f\u7528\u4e0d\u540c\u7684\u5b57\u6bb5\u540d\u3002 \u5fc5\u987b\u8fd4\u56de\u6bcf\u4e2a\u56fe\u50cfURL\u7684Request\u3002 item_completed(results, item, info) ImagesPipeline.item_completed() \u65b9\u6cd5\u5728\u5355\u4e2aitem\u7684\u6240\u6709\u56fe\u50cfrequests\u90fd\u5b8c\u6210(\u6216\u8005\u4e0b\u8f7d\u5b8c\u6210\uff0c\u6216\u8005\u7531\u4e8e\u67d0\u79cd\u539f\u56e0\u5931\u8d25)\u65f6\u8c03\u7528\u3002 \u5de5\u4f5c\u65b9\u5f0f\u4e0e FilesPipeline.item_completed() \u65b9\u6cd5\u76f8\u540c\uff0c\u4f46\u4f7f\u7528\u4e0d\u540c\u7684\u5b57\u6bb5\u540d\u5b58\u50a8\u56fe\u50cf\u4e0b\u8f7d\u7ed3\u679c\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c item_completed() \u65b9\u6cd5\u8fd4\u56deitem\u3002","title":"scrapy.pipelines.images.ImagesPipeline   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/09-down-file-image/#images-pipeline_1","text":"\u4e0b\u9762\u662fImages Pipeline\u7684\u5b8c\u6574\u793a\u4f8b\uff0c\u5176\u65b9\u6cd5\u5728\u4e0a\u9762\u8fdb\u884c\u4e86\u793a\u4f8b: import scrapy from scrapy.pipelines.images import ImagesPipeline from scrapy.exceptions import DropItem class MyImagesPipeline(ImagesPipeline): def get_media_requests(self, item, info): for image_url in item['image_urls']: yield scrapy.Request(image_url) def item_completed(self, results, item, info): image_paths = [x['path'] for ok, x in results if ok] if not image_paths: raise DropItem( Item contains no images ) item['image_paths'] = image_paths return item","title":"\u81ea\u5b9a\u4e49Images pipeline\u793a\u4f8b"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/10-deploying-spider/","text":"\u90e8\u7f72Spider \u672c\u8282\u63cf\u8ff0\u4e86\u60a8\u53ef\u4ee5\u4f7f\u7528\u5404\u79cd\u4e0d\u540c\u7684\u9009\u9879\u6765\u90e8\u7f72\u60a8\u7684Scrapy spider\uff0c\u4ee5\u4fbf\u5b9a\u671f\u8fd0\u884c\u5b83\u4eec\u3002\u5728\u672c\u5730\u673a\u5668\u4e0a\u8fd0\u884cScrapy spider\u5bf9\u4e8e(\u65e9\u671f)\u5f00\u53d1\u9636\u6bb5\u975e\u5e38\u65b9\u4fbf\uff0c\u4f46\u5728\u9700\u8981\u6267\u884c\u957f\u65f6\u95f4\u8fd0\u884c\u7684spider\u6216\u79fb\u52a8spider\u4ee5\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u8fde\u7eed\u8fd0\u884c\u65f6\uff0c\u5c31\u4e0d\u90a3\u4e48\u65b9\u4fbf\u4e86\u3002\u8fd9\u5c31\u662f\u90e8\u7f72Scrapy spider\u7684\u89e3\u51b3\u65b9\u6848\u3002 \u90e8\u7f72Scrapy spider\u7684\u6d41\u884c\u9009\u62e9\u662f: Scrapyd (\u5f00\u6e90) Scrapy\u4e91 (\u57fa\u4e8e\u4e91) \u90e8\u7f72\u5230Scrapyd\u670d\u52a1\u5668 Scrapyd \u662f\u4e00\u4e2a\u8fd0\u884cScrapy spider\u7684\u5f00\u653e\u6e90\u7801\u5e94\u7528\u7a0b\u5e8f\u3002\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5177\u6709HTTP API\u7684\u670d\u52a1\u5668\uff0c\u80fd\u591f\u8fd0\u884c\u548c\u76d1\u89c6\u5404\u79cdScrapy spider\u3002 \u8981\u5c06spider\u90e8\u7f72\u5230Scrapyd\uff0c\u53ef\u4ee5\u4f7f\u7528 scrapyd-client \u5305\u63d0\u4f9b\u7684scrapyd-deploy\u5de5\u5177\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 scrapyd-deploy\u6587\u6863 \u3002 Scrapyd\u662f\u7531\u4e00\u4e9bScrapy\u5f00\u53d1\u4eba\u5458\u7ef4\u62a4\u7684\u3002 \u90e8\u7f72\u5230Scrapy\u4e91 Scrapy\u4e91 \u662f\u7531 Scrapinghub \u516c\u53f8\u63d0\u4f9b\u7684\u57fa\u4e8e\u4e91\u7684\u6258\u7ba1\u670d\u52a1\u3002 Scrapy\u4e91\u4e0d\u9700\u8981\u5b89\u88c5\u548c\u76d1\u89c6\u670d\u52a1\u5668\uff0c\u5e76\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5f88\u597d\u7684\u7528\u6237UI\u754c\u9762\u6765\u7ba1\u7406spider\u5e76\u67e5\u770b\u5df2\u6293\u53d6\u7684items\u3001log\u548cstats\u3002 \u8981\u5c06spider\u90e8\u7f72\u5230Scrapy\u4e91\uff0c\u53ef\u4ee5\u4f7f\u7528 shub \u547d\u4ee4\u884c\u5de5\u5177\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Scrapy\u4e91\u6587\u6863 \u3002 Scrapy\u4e91\u4e0eScrapyd\u517c\u5bb9\uff0c\u53ef\u4ee5\u6839\u636e\u9700\u8981\u5728\u5b83\u4eec\u4e4b\u95f4\u8fdb\u884c\u5207\u6362 - \u4ece scrapy.cfg \u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6\u5c31\u50cf scrapyd-deploy \u3002","title":"\u90e8\u7f72Spider"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/10-deploying-spider/#spider","text":"\u672c\u8282\u63cf\u8ff0\u4e86\u60a8\u53ef\u4ee5\u4f7f\u7528\u5404\u79cd\u4e0d\u540c\u7684\u9009\u9879\u6765\u90e8\u7f72\u60a8\u7684Scrapy spider\uff0c\u4ee5\u4fbf\u5b9a\u671f\u8fd0\u884c\u5b83\u4eec\u3002\u5728\u672c\u5730\u673a\u5668\u4e0a\u8fd0\u884cScrapy spider\u5bf9\u4e8e(\u65e9\u671f)\u5f00\u53d1\u9636\u6bb5\u975e\u5e38\u65b9\u4fbf\uff0c\u4f46\u5728\u9700\u8981\u6267\u884c\u957f\u65f6\u95f4\u8fd0\u884c\u7684spider\u6216\u79fb\u52a8spider\u4ee5\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u8fde\u7eed\u8fd0\u884c\u65f6\uff0c\u5c31\u4e0d\u90a3\u4e48\u65b9\u4fbf\u4e86\u3002\u8fd9\u5c31\u662f\u90e8\u7f72Scrapy spider\u7684\u89e3\u51b3\u65b9\u6848\u3002 \u90e8\u7f72Scrapy spider\u7684\u6d41\u884c\u9009\u62e9\u662f: Scrapyd (\u5f00\u6e90) Scrapy\u4e91 (\u57fa\u4e8e\u4e91)","title":"\u90e8\u7f72Spider"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/10-deploying-spider/#scrapyd","text":"Scrapyd \u662f\u4e00\u4e2a\u8fd0\u884cScrapy spider\u7684\u5f00\u653e\u6e90\u7801\u5e94\u7528\u7a0b\u5e8f\u3002\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5177\u6709HTTP API\u7684\u670d\u52a1\u5668\uff0c\u80fd\u591f\u8fd0\u884c\u548c\u76d1\u89c6\u5404\u79cdScrapy spider\u3002 \u8981\u5c06spider\u90e8\u7f72\u5230Scrapyd\uff0c\u53ef\u4ee5\u4f7f\u7528 scrapyd-client \u5305\u63d0\u4f9b\u7684scrapyd-deploy\u5de5\u5177\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 scrapyd-deploy\u6587\u6863 \u3002 Scrapyd\u662f\u7531\u4e00\u4e9bScrapy\u5f00\u53d1\u4eba\u5458\u7ef4\u62a4\u7684\u3002","title":"\u90e8\u7f72\u5230Scrapyd\u670d\u52a1\u5668"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/10-deploying-spider/#scrapy","text":"Scrapy\u4e91 \u662f\u7531 Scrapinghub \u516c\u53f8\u63d0\u4f9b\u7684\u57fa\u4e8e\u4e91\u7684\u6258\u7ba1\u670d\u52a1\u3002 Scrapy\u4e91\u4e0d\u9700\u8981\u5b89\u88c5\u548c\u76d1\u89c6\u670d\u52a1\u5668\uff0c\u5e76\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5f88\u597d\u7684\u7528\u6237UI\u754c\u9762\u6765\u7ba1\u7406spider\u5e76\u67e5\u770b\u5df2\u6293\u53d6\u7684items\u3001log\u548cstats\u3002 \u8981\u5c06spider\u90e8\u7f72\u5230Scrapy\u4e91\uff0c\u53ef\u4ee5\u4f7f\u7528 shub \u547d\u4ee4\u884c\u5de5\u5177\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Scrapy\u4e91\u6587\u6863 \u3002 Scrapy\u4e91\u4e0eScrapyd\u517c\u5bb9\uff0c\u53ef\u4ee5\u6839\u636e\u9700\u8981\u5728\u5b83\u4eec\u4e4b\u95f4\u8fdb\u884c\u5207\u6362 - \u4ece scrapy.cfg \u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6\u5c31\u50cf scrapyd-deploy \u3002","title":"\u90e8\u7f72\u5230Scrapy\u4e91"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/11-auto-throttle-extension/","text":"AutoThrottle extension(\u81ea\u52a8\u8282\u6d41\u6269\u5c55) \u8fd9\u662f\u4e00\u4e2a\u6269\u5c55\uff0c\u53ef\u4ee5\u6839\u636eScrapy\u670d\u52a1\u5668\u548c\u8981\u722c\u884c\u7684\u7f51\u7ad9\u7684\u8d1f\u8f7d\u81ea\u52a8\u8c03\u8282\u722c\u884c\u901f\u5ea6\u3002 \u8bbe\u8ba1\u76ee\u6807 \u5bf9\u7f51\u7ad9\u66f4\u597d\uff0c\u800c\u4e0d\u662f\u4f7f\u7528\u9ed8\u8ba4\u7684download delay\u4e3a0 \u81ea\u52a8\u8c03\u6574Scrapy\u7684\u6700\u4f73\u722c\u884c\u901f\u5ea6\uff0c\u6240\u4ee5\u7528\u6237\u4e0d\u5fc5\u8c03\u6574download delay\u6765\u627e\u5230\u6700\u4f73\u7684\u3002\u7528\u6237\u53ea\u9700\u8981\u6307\u5b9a\u5b83\u5141\u8bb8\u7684maximum concurrent request(\u6700\u5927\u5e76\u53d1\u8bf7\u6c42)\uff0c\u6269\u5c55\u5c31\u53ef\u4ee5\u5b8c\u6210\u5269\u4e0b\u7684\u5de5\u4f5c\u3002 \u5982\u4f55\u8fd0\u4f5c \u81ea\u52a8\u8282\u6d41\u6269\u5c55\u52a8\u6001\u8c03\u6574download delay\uff0c\u4f7fspider\u5e73\u5747\u5411\u6bcf\u4e2a\u8fdc\u7a0b\u7f51\u7ad9\u53d1\u9001 AUTOTHROTTLE_TARGET_CONCURRENCY \u5e76\u53d1requests\u3002 \u5b83\u4f7f\u7528download latency\u6765\u8ba1\u7b97\u5ef6\u8fdf\u3002\u5176\u4e3b\u8981\u601d\u60f3\u5982\u4e0b:\u5982\u679c\u670d\u52a1\u5668\u9700\u8981 latency \u79d2\u6765\u54cd\u5e94\uff0c\u90a3\u4e48\u5ba2\u6237\u673a\u5e94\u8be5\u5728\u6bcf latency/N \u79d2\u5185\u53d1\u9001request\uff0c\u4ee5\u4f7f N \u4e2arequest\u5e76\u884c\u5904\u7406\u3002 \u4e0e\u5176\u8c03\u6574\u5ef6\u8fdf\uff0c\u4e0d\u5982\u8bbe\u7f6e\u4e00\u4e2a\u5c0f\u7684\u56fa\u5b9adownload delay\u5e76\u4f7f\u7528 CONCURRENT_REQUESTS_PER_DOMAIN \u6216 CONCURRENT_REQUESTS_PER_IP \u9009\u9879\u5bf9\u5e76\u53d1\u6027\u65bd\u52a0\u786c\u9650\u5236\u3002\u5b83\u5c06\u63d0\u4f9b\u7c7b\u4f3c\u7684\u6548\u679c\uff0c\u4f46\u6709\u4e00\u4e9b\u91cd\u8981\u7684\u533a\u522b: \u56e0\u4e3adownload delay\u5f88\u5c0f\uff0c\u5076\u5c14\u4f1a\u8bf7\u6c42\u7206\u53d1; \u901a\u5e38\uff0c\u975e200(\u9519\u8bef)response\u7684\u8fd4\u56de\u901f\u5ea6\u4f1a\u6bd4\u5e38\u89c4response\u5feb\uff0c\u56e0\u6b64\uff0c\u5f53\u670d\u52a1\u5668\u5f00\u59cb\u8fd4\u56de\u9519\u8bef\u65f6\uff0c\u5e76\u53d1\u9650\u5236\u722c\u866b\u4f1a\u66f4\u5feb\u5730\u5411\u670d\u52a1\u5668\u53d1\u9001\u8bf7\u6c42\u3002\u4f46\u8fd9\u4e0espider\u5e94\u8be5\u505a\u7684\u76f8\u53cd - \u5728\u51fa\u73b0\u9519\u8bef\u65f6\uff0c\u653e\u6162\u901f\u5ea6\u66f4\u6709\u610f\u4e49:\u8fd9\u4e9b\u9519\u8bef\u53ef\u80fd\u662f\u7531\u9ad8request\u9891\u7387\u5f15\u8d77\u7684\u3002 \u81ea\u52a8\u8282\u6d41\u6ca1\u6709\u8fd9\u4e9b\u95ee\u9898\u3002 \u8282\u6d41\u7b97\u6cd5 \u81ea\u52a8\u8282\u6d41\u7b97\u6cd5\u6839\u636e\u4ee5\u4e0b\u89c4\u5219\u8c03\u6574download delay: spider\u603b\u662f\u4ee5 AUTOTHROTTLE_START_DELAY \u7684download delay\u5f00\u59cb \u5f53\u63a5\u6536\u5230response\u65f6\uff0c\u76ee\u6807\u4e0b\u8f7d\u5ef6\u8fdf\u8ba1\u7b97\u4e3a latency / N \uff0c\u5176\u4e2d latency \u662f\u54cd\u5e94\u7684latency(\u5ef6\u8fdf)\uff0c N \u662f AUTOTHROTTLE_TARGET_CONCURRENCY \u3002 \u4e0b\u4e00\u4e2a\u8bf7\u6c42\u7684download delay\u8bbe\u7f6e\u4e3a\u4e4b\u524d\u7684download delay\u548c\u76ee\u6807\u4e0b\u8f7d\u5ef6\u8fdf\u7684\u5e73\u5747\u503c; \u4e0d\u5141\u8bb8\u975e200 response\u5ef6\u8fdf\u4ee5\u51cf\u5c11\u5ef6\u8fdf; download delay\u4e0d\u80fd\u5c0f\u4e8e DOWNLOAD_DELAY \u6216\u5927\u4e8e AUTOTHROTTLE_MAX_DELAY \u81ea\u52a8\u8282\u6d41\u6269\u5c55\u652f\u6301\u6807\u51c6Scrapy\u7684\u5e76\u53d1\u548c\u5ef6\u8fdfsettings\u3002 \u8fd9\u610f\u5473\u7740\u5b83\u5c06\u5c0a\u91cd[CONCURRENT_REQUESTS_PER_DOMAIN](#)\u548c[CONCURRENT_REQUESTS_PER_IP](#)\u9009\u9879\uff0c \u5e76\u4e14\u4e0d\u4f1a\u8bbe\u7f6edownload delay\u4f4e\u4e8e[DOWNLOAD_DELAY](#)\u3002 \u5728Scrapy\u4e2d\uff0cdownload latency\u662f\u6307\u5efa\u7acbTCP\u8fde\u63a5\u548c\u63a5\u6536HTTP headers\u4e4b\u95f4\u7ecf\u8fc7\u7684\u65f6\u95f4\u3002 \u8bf7\u6ce8\u610f\uff0c\u8fd9\u4e9blatency(\u5ef6\u8fdf)\u5728\u534f\u540c\u591a\u4efb\u52a1\u73af\u5883\u4e2d\u5f88\u96be\u7cbe\u786e\u6d4b\u91cf\uff0c\u56e0\u4e3aScrapy\u53ef\u80fd\u6b63\u5fd9\u4e8e\u5904\u7406\u4e00\u4e2aspider callback\uff0c\u4f8b\u5982\uff0c\u65e0\u6cd5\u53c2\u52a0\u4e0b\u8f7d\u3002\u4f46\u662f\uff0c\u8fd9\u4e9blatency(\u5ef6\u8fdf)\u4ecd\u7136\u5e94\u8be5\u80fd\u591f\u5408\u7406\u5730\u4f30\u8ba1\u51faScrapy\u7e41\u5fd9\u7a0b\u5ea6(\u6700\u7ec8\u662f\u670d\u52a1\u5668)\uff0c\u800c\u8fd9\u4e2a\u6269\u5c55\u662f\u5efa\u7acb\u5728\u8fd9\u4e2a\u524d\u63d0\u4e4b\u4e0a\u7684\u3002 Settings \u7528\u4e8e\u63a7\u5236\u81ea\u52a8\u8282\u6d41\u6269\u5c55\u7684settings\u5982\u4e0b: AUTOTHROTTLE_ENABLED AUTOTHROTTLE_START_DELAY AUTOTHROTTLE_MAX_DELAY AUTOTHROTTLE_TARGET_CONCURRENCY AUTOTHROTTLE_DEBUG CONCURRENT_REQUESTS_PER_DOMAIN CONCURRENT_REQUESTS_PER_IP DOWNLOAD_DELAY \u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1\u5b83\u7684 \u5de5\u4f5c\u539f\u7406 \u3002 AUTOTHROTTLE_ENABLED \u9ed8\u8ba4: False \u542f\u7528\u81ea\u52a8\u8282\u6d41\u6269\u5c55\u3002 AUTOTHROTTLE_START_DELAY \u9ed8\u8ba4: 5.0 \u521d\u59cbdownload delay(\u4ee5\u79d2\u4e3a\u5355\u4f4d)\u3002 AUTOTHROTTLE_MAX_DELAY \u9ed8\u8ba4: 60.0 \u6700\u5927download delay(\u4ee5\u79d2\u4e3a\u5355\u4f4d)\u5728\u9ad8latency(\u5ef6\u8fdf)\u60c5\u51b5\u4e0b\u8bbe\u7f6e\u3002 AUTOTHROTTLE_TARGET_CONCURRENCY \u6700\u65b0\u7248\u672c1.1 \u9ed8\u8ba4: 1.0 Scrapy\u8bf7\u6c42\u7684\u5e73\u5747\u6570\u91cf\u5e94\u8be5\u4e0e\u8fdc\u7a0b\u7f51\u7ad9\u5e76\u884c\u53d1\u9001\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u81ea\u52a8\u8282\u6d41\u8c03\u6574\u5ef6\u8fdf\u53d1\u9001\u5355\u4e2a\u5e76\u53d1\u8bf7\u6c42\u5230\u6bcf\u4e2a\u8fdc\u7a0b\u7f51\u7ad9\u3002\u5c06\u6b64\u9009\u9879\u8bbe\u7f6e\u4e3a\u66f4\u9ad8\u7684\u503c(\u4f8b\u5982 2.0 )\uff0c\u4ee5\u589e\u52a0\u8fdc\u7a0b\u670d\u52a1\u5668\u4e0a\u7684\u541e\u5410\u91cf\u548c\u8d1f\u8f7d\u3002\u8f83\u4f4e\u7684 AUTOTHROTTLE_TARGET_CONCURRENCY \u503c(\u4f8b\u5982 0.5 )\u4f7fspider\u66f4\u52a0\u4fdd\u5b88\u548c\u793c\u8c8c\u3002 \u8bf7\u6ce8\u610f\uff0c\u5f53\u542f\u7528\u81ea\u52a8\u8282\u6d41\u6269\u5c55\u65f6\uff0c CONCURRENT_REQUESTS_PER_DOMAIN \u548c CONCURRENT_REQUESTS_PER_IP \u9009\u9879\u4ecd\u7136\u53d7\u5230\u5c0a\u91cd\u3002\u8fd9\u610f\u5473\u7740\uff0c\u5982\u679c AUTOTHROTTLE_TARGET_CONCURRENCY \u8bbe\u7f6e\u7684\u503c\u9ad8\u4e8e CONCURRENT_REQUESTS_PER_DOMAIN \u6216 CONCURRENT_REQUESTS_PER_IP \uff0c\u90a3\u4e48\u722c\u866b\u7a0b\u5e8f\u4e0d\u4f1a\u8fbe\u5230\u8fd9\u4e2a\u5e76\u53d1\u8bf7\u6c42\u6570\u3002 \u5728\u6bcf\u4e2a\u7ed9\u5b9a\u7684\u65f6\u95f4\u70b9\uff0cScrapy\u53ef\u4ee5\u53d1\u9001\u6bd4 AUTOTHROTTLE_TARGET_CONCURRENCY \u6216\u591a\u6216\u5c11\u7684\u5e76\u53d1\u8bf7\u6c42;\u8fd9\u662f\u722c\u866b\u8bd5\u56fe\u63a5\u8fd1\u7684\u4e00\u4e2a\u5efa\u8bae\u503c\uff0c\u800c\u4e0d\u662f\u4e00\u4e2a\u786c\u6027\u9650\u5236\u3002 AUTOTHROTTLE_DEBUG \u9ed8\u8ba4: False \u542f\u7528\u201c\u81ea\u52a8\u8282\u6d41\u201d\u8c03\u8bd5\u6a21\u5f0f\uff0c\u8be5\u6a21\u5f0f\u5c06\u5728\u63a5\u6536\u5230\u7684\u6bcf\u4e2aresponse\u4e0a\u663e\u793astats\u4fe1\u606f\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u770b\u5230\u8282\u6d41\u53c2\u6570\u662f\u5982\u4f55\u5b9e\u65f6\u8c03\u6574\u7684\u3002","title":"AutoThrottle extension(\u81ea\u52a8\u8282\u6d41\u6269\u5c55)"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/11-auto-throttle-extension/#autothrottle-extension","text":"\u8fd9\u662f\u4e00\u4e2a\u6269\u5c55\uff0c\u53ef\u4ee5\u6839\u636eScrapy\u670d\u52a1\u5668\u548c\u8981\u722c\u884c\u7684\u7f51\u7ad9\u7684\u8d1f\u8f7d\u81ea\u52a8\u8c03\u8282\u722c\u884c\u901f\u5ea6\u3002","title":"AutoThrottle extension(\u81ea\u52a8\u8282\u6d41\u6269\u5c55)"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/11-auto-throttle-extension/#_1","text":"\u5bf9\u7f51\u7ad9\u66f4\u597d\uff0c\u800c\u4e0d\u662f\u4f7f\u7528\u9ed8\u8ba4\u7684download delay\u4e3a0 \u81ea\u52a8\u8c03\u6574Scrapy\u7684\u6700\u4f73\u722c\u884c\u901f\u5ea6\uff0c\u6240\u4ee5\u7528\u6237\u4e0d\u5fc5\u8c03\u6574download delay\u6765\u627e\u5230\u6700\u4f73\u7684\u3002\u7528\u6237\u53ea\u9700\u8981\u6307\u5b9a\u5b83\u5141\u8bb8\u7684maximum concurrent request(\u6700\u5927\u5e76\u53d1\u8bf7\u6c42)\uff0c\u6269\u5c55\u5c31\u53ef\u4ee5\u5b8c\u6210\u5269\u4e0b\u7684\u5de5\u4f5c\u3002","title":"\u8bbe\u8ba1\u76ee\u6807"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/11-auto-throttle-extension/#_2","text":"\u81ea\u52a8\u8282\u6d41\u6269\u5c55\u52a8\u6001\u8c03\u6574download delay\uff0c\u4f7fspider\u5e73\u5747\u5411\u6bcf\u4e2a\u8fdc\u7a0b\u7f51\u7ad9\u53d1\u9001 AUTOTHROTTLE_TARGET_CONCURRENCY \u5e76\u53d1requests\u3002 \u5b83\u4f7f\u7528download latency\u6765\u8ba1\u7b97\u5ef6\u8fdf\u3002\u5176\u4e3b\u8981\u601d\u60f3\u5982\u4e0b:\u5982\u679c\u670d\u52a1\u5668\u9700\u8981 latency \u79d2\u6765\u54cd\u5e94\uff0c\u90a3\u4e48\u5ba2\u6237\u673a\u5e94\u8be5\u5728\u6bcf latency/N \u79d2\u5185\u53d1\u9001request\uff0c\u4ee5\u4f7f N \u4e2arequest\u5e76\u884c\u5904\u7406\u3002 \u4e0e\u5176\u8c03\u6574\u5ef6\u8fdf\uff0c\u4e0d\u5982\u8bbe\u7f6e\u4e00\u4e2a\u5c0f\u7684\u56fa\u5b9adownload delay\u5e76\u4f7f\u7528 CONCURRENT_REQUESTS_PER_DOMAIN \u6216 CONCURRENT_REQUESTS_PER_IP \u9009\u9879\u5bf9\u5e76\u53d1\u6027\u65bd\u52a0\u786c\u9650\u5236\u3002\u5b83\u5c06\u63d0\u4f9b\u7c7b\u4f3c\u7684\u6548\u679c\uff0c\u4f46\u6709\u4e00\u4e9b\u91cd\u8981\u7684\u533a\u522b: \u56e0\u4e3adownload delay\u5f88\u5c0f\uff0c\u5076\u5c14\u4f1a\u8bf7\u6c42\u7206\u53d1; \u901a\u5e38\uff0c\u975e200(\u9519\u8bef)response\u7684\u8fd4\u56de\u901f\u5ea6\u4f1a\u6bd4\u5e38\u89c4response\u5feb\uff0c\u56e0\u6b64\uff0c\u5f53\u670d\u52a1\u5668\u5f00\u59cb\u8fd4\u56de\u9519\u8bef\u65f6\uff0c\u5e76\u53d1\u9650\u5236\u722c\u866b\u4f1a\u66f4\u5feb\u5730\u5411\u670d\u52a1\u5668\u53d1\u9001\u8bf7\u6c42\u3002\u4f46\u8fd9\u4e0espider\u5e94\u8be5\u505a\u7684\u76f8\u53cd - \u5728\u51fa\u73b0\u9519\u8bef\u65f6\uff0c\u653e\u6162\u901f\u5ea6\u66f4\u6709\u610f\u4e49:\u8fd9\u4e9b\u9519\u8bef\u53ef\u80fd\u662f\u7531\u9ad8request\u9891\u7387\u5f15\u8d77\u7684\u3002 \u81ea\u52a8\u8282\u6d41\u6ca1\u6709\u8fd9\u4e9b\u95ee\u9898\u3002","title":"\u5982\u4f55\u8fd0\u4f5c"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/11-auto-throttle-extension/#_3","text":"\u81ea\u52a8\u8282\u6d41\u7b97\u6cd5\u6839\u636e\u4ee5\u4e0b\u89c4\u5219\u8c03\u6574download delay: spider\u603b\u662f\u4ee5 AUTOTHROTTLE_START_DELAY \u7684download delay\u5f00\u59cb \u5f53\u63a5\u6536\u5230response\u65f6\uff0c\u76ee\u6807\u4e0b\u8f7d\u5ef6\u8fdf\u8ba1\u7b97\u4e3a latency / N \uff0c\u5176\u4e2d latency \u662f\u54cd\u5e94\u7684latency(\u5ef6\u8fdf)\uff0c N \u662f AUTOTHROTTLE_TARGET_CONCURRENCY \u3002 \u4e0b\u4e00\u4e2a\u8bf7\u6c42\u7684download delay\u8bbe\u7f6e\u4e3a\u4e4b\u524d\u7684download delay\u548c\u76ee\u6807\u4e0b\u8f7d\u5ef6\u8fdf\u7684\u5e73\u5747\u503c; \u4e0d\u5141\u8bb8\u975e200 response\u5ef6\u8fdf\u4ee5\u51cf\u5c11\u5ef6\u8fdf; download delay\u4e0d\u80fd\u5c0f\u4e8e DOWNLOAD_DELAY \u6216\u5927\u4e8e AUTOTHROTTLE_MAX_DELAY \u81ea\u52a8\u8282\u6d41\u6269\u5c55\u652f\u6301\u6807\u51c6Scrapy\u7684\u5e76\u53d1\u548c\u5ef6\u8fdfsettings\u3002 \u8fd9\u610f\u5473\u7740\u5b83\u5c06\u5c0a\u91cd[CONCURRENT_REQUESTS_PER_DOMAIN](#)\u548c[CONCURRENT_REQUESTS_PER_IP](#)\u9009\u9879\uff0c \u5e76\u4e14\u4e0d\u4f1a\u8bbe\u7f6edownload delay\u4f4e\u4e8e[DOWNLOAD_DELAY](#)\u3002 \u5728Scrapy\u4e2d\uff0cdownload latency\u662f\u6307\u5efa\u7acbTCP\u8fde\u63a5\u548c\u63a5\u6536HTTP headers\u4e4b\u95f4\u7ecf\u8fc7\u7684\u65f6\u95f4\u3002 \u8bf7\u6ce8\u610f\uff0c\u8fd9\u4e9blatency(\u5ef6\u8fdf)\u5728\u534f\u540c\u591a\u4efb\u52a1\u73af\u5883\u4e2d\u5f88\u96be\u7cbe\u786e\u6d4b\u91cf\uff0c\u56e0\u4e3aScrapy\u53ef\u80fd\u6b63\u5fd9\u4e8e\u5904\u7406\u4e00\u4e2aspider callback\uff0c\u4f8b\u5982\uff0c\u65e0\u6cd5\u53c2\u52a0\u4e0b\u8f7d\u3002\u4f46\u662f\uff0c\u8fd9\u4e9blatency(\u5ef6\u8fdf)\u4ecd\u7136\u5e94\u8be5\u80fd\u591f\u5408\u7406\u5730\u4f30\u8ba1\u51faScrapy\u7e41\u5fd9\u7a0b\u5ea6(\u6700\u7ec8\u662f\u670d\u52a1\u5668)\uff0c\u800c\u8fd9\u4e2a\u6269\u5c55\u662f\u5efa\u7acb\u5728\u8fd9\u4e2a\u524d\u63d0\u4e4b\u4e0a\u7684\u3002","title":"\u8282\u6d41\u7b97\u6cd5"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/11-auto-throttle-extension/#settings","text":"\u7528\u4e8e\u63a7\u5236\u81ea\u52a8\u8282\u6d41\u6269\u5c55\u7684settings\u5982\u4e0b: AUTOTHROTTLE_ENABLED AUTOTHROTTLE_START_DELAY AUTOTHROTTLE_MAX_DELAY AUTOTHROTTLE_TARGET_CONCURRENCY AUTOTHROTTLE_DEBUG CONCURRENT_REQUESTS_PER_DOMAIN CONCURRENT_REQUESTS_PER_IP DOWNLOAD_DELAY \u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1\u5b83\u7684 \u5de5\u4f5c\u539f\u7406 \u3002","title":"Settings"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/11-auto-throttle-extension/#autothrottle_enabled","text":"\u9ed8\u8ba4: False \u542f\u7528\u81ea\u52a8\u8282\u6d41\u6269\u5c55\u3002","title":"AUTOTHROTTLE_ENABLED"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/11-auto-throttle-extension/#autothrottle_start_delay","text":"\u9ed8\u8ba4: 5.0 \u521d\u59cbdownload delay(\u4ee5\u79d2\u4e3a\u5355\u4f4d)\u3002","title":"AUTOTHROTTLE_START_DELAY"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/11-auto-throttle-extension/#autothrottle_max_delay","text":"\u9ed8\u8ba4: 60.0 \u6700\u5927download delay(\u4ee5\u79d2\u4e3a\u5355\u4f4d)\u5728\u9ad8latency(\u5ef6\u8fdf)\u60c5\u51b5\u4e0b\u8bbe\u7f6e\u3002","title":"AUTOTHROTTLE_MAX_DELAY"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/11-auto-throttle-extension/#autothrottle_target_concurrency","text":"\u6700\u65b0\u7248\u672c1.1 \u9ed8\u8ba4: 1.0 Scrapy\u8bf7\u6c42\u7684\u5e73\u5747\u6570\u91cf\u5e94\u8be5\u4e0e\u8fdc\u7a0b\u7f51\u7ad9\u5e76\u884c\u53d1\u9001\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u81ea\u52a8\u8282\u6d41\u8c03\u6574\u5ef6\u8fdf\u53d1\u9001\u5355\u4e2a\u5e76\u53d1\u8bf7\u6c42\u5230\u6bcf\u4e2a\u8fdc\u7a0b\u7f51\u7ad9\u3002\u5c06\u6b64\u9009\u9879\u8bbe\u7f6e\u4e3a\u66f4\u9ad8\u7684\u503c(\u4f8b\u5982 2.0 )\uff0c\u4ee5\u589e\u52a0\u8fdc\u7a0b\u670d\u52a1\u5668\u4e0a\u7684\u541e\u5410\u91cf\u548c\u8d1f\u8f7d\u3002\u8f83\u4f4e\u7684 AUTOTHROTTLE_TARGET_CONCURRENCY \u503c(\u4f8b\u5982 0.5 )\u4f7fspider\u66f4\u52a0\u4fdd\u5b88\u548c\u793c\u8c8c\u3002 \u8bf7\u6ce8\u610f\uff0c\u5f53\u542f\u7528\u81ea\u52a8\u8282\u6d41\u6269\u5c55\u65f6\uff0c CONCURRENT_REQUESTS_PER_DOMAIN \u548c CONCURRENT_REQUESTS_PER_IP \u9009\u9879\u4ecd\u7136\u53d7\u5230\u5c0a\u91cd\u3002\u8fd9\u610f\u5473\u7740\uff0c\u5982\u679c AUTOTHROTTLE_TARGET_CONCURRENCY \u8bbe\u7f6e\u7684\u503c\u9ad8\u4e8e CONCURRENT_REQUESTS_PER_DOMAIN \u6216 CONCURRENT_REQUESTS_PER_IP \uff0c\u90a3\u4e48\u722c\u866b\u7a0b\u5e8f\u4e0d\u4f1a\u8fbe\u5230\u8fd9\u4e2a\u5e76\u53d1\u8bf7\u6c42\u6570\u3002 \u5728\u6bcf\u4e2a\u7ed9\u5b9a\u7684\u65f6\u95f4\u70b9\uff0cScrapy\u53ef\u4ee5\u53d1\u9001\u6bd4 AUTOTHROTTLE_TARGET_CONCURRENCY \u6216\u591a\u6216\u5c11\u7684\u5e76\u53d1\u8bf7\u6c42;\u8fd9\u662f\u722c\u866b\u8bd5\u56fe\u63a5\u8fd1\u7684\u4e00\u4e2a\u5efa\u8bae\u503c\uff0c\u800c\u4e0d\u662f\u4e00\u4e2a\u786c\u6027\u9650\u5236\u3002","title":"AUTOTHROTTLE_TARGET_CONCURRENCY"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/11-auto-throttle-extension/#autothrottle_debug","text":"\u9ed8\u8ba4: False \u542f\u7528\u201c\u81ea\u52a8\u8282\u6d41\u201d\u8c03\u8bd5\u6a21\u5f0f\uff0c\u8be5\u6a21\u5f0f\u5c06\u5728\u63a5\u6536\u5230\u7684\u6bcf\u4e2aresponse\u4e0a\u663e\u793astats\u4fe1\u606f\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u770b\u5230\u8282\u6d41\u53c2\u6570\u662f\u5982\u4f55\u5b9e\u65f6\u8c03\u6574\u7684\u3002","title":"AUTOTHROTTLE_DEBUG"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/12-Benchmark/","text":"\u57fa\u51c6\u6d4b\u8bd5 \u7248\u672c0.17\u4e2d\u7684\u65b0\u529f\u80fd Scrapy\u9644\u5e26\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u57fa\u51c6\u6d4b\u8bd5\u5957\u4ef6\uff0c\u5b83\u751f\u6210\u4e00\u4e2a\u672c\u5730HTTP\u670d\u52a1\u5668\u5e76\u4ee5\u5c3d\u53ef\u80fd\u5feb\u7684\u901f\u5ea6\u722c\u884c\u3002\u8fd9\u4e2a\u57fa\u51c6\u6d4b\u8bd5\u7684\u76ee\u6807\u662f\u4e86\u89e3Scrapy\u5728\u786c\u4ef6\u4e2d\u7684\u6027\u80fd\uff0c\u4ee5\u4fbf\u6709\u4e00\u4e2a\u6bd4\u8f83\u7684\u516c\u5171\u57fa\u7ebf\u3002\u5b83\u4f7f\u7528\u4e00\u4e2a\u7b80\u5355\u7684spider\uff0c\u5b83\u4ec0\u4e48\u4e5f\u4e0d\u505a\uff0c\u53ea\u662f\u8ddf\u8e2a\u94fe\u63a5\u3002 \u8fd0\u884c\u5b83\u8bf7\u4f7f\u7528: scrapy bench \u60a8\u5e94\u8be5\u4f1a\u770b\u5230\u8fd9\u6837\u7684\u8f93\u51fa: 2016-12-16 21:18:48 [scrapy.utils.log] INFO: Scrapy 1.2.2 started (bot: quotesbot) 2016-12-16 21:18:48 [scrapy.utils.log] INFO: Overridden settings: {'CLOSESPIDER_TIMEOUT': 10, 'ROBOTSTXT_OBEY': True, 'SPIDER_MODULES': ['quotesbot.spiders'], 'LOGSTATS_INTERVAL': 1, 'BOT_NAME': 'quotesbot', 'LOG_LEVEL': 'INFO', 'NEWSPIDER_MODULE': 'quotesbot.spiders'} 2016-12-16 21:18:49 [scrapy.middleware] INFO: Enabled extensions: ['scrapy.extensions.closespider.CloseSpider', 'scrapy.extensions.logstats.LogStats', 'scrapy.extensions.telnet.TelnetConsole', 'scrapy.extensions.corestats.CoreStats'] 2016-12-16 21:18:49 [scrapy.middleware] INFO: Enabled downloader middlewares: ['scrapy.downloadermiddlewares.robotstxt.RobotsTxtMiddleware', 'scrapy.downloadermiddlewares.httpauth.HttpAuthMiddleware', 'scrapy.downloadermiddlewares.downloadtimeout.DownloadTimeoutMiddleware', 'scrapy.downloadermiddlewares.defaultheaders.DefaultHeadersMiddleware', 'scrapy.downloadermiddlewares.useragent.UserAgentMiddleware', 'scrapy.downloadermiddlewares.retry.RetryMiddleware', 'scrapy.downloadermiddlewares.redirect.MetaRefreshMiddleware', 'scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware', 'scrapy.downloadermiddlewares.redirect.RedirectMiddleware', 'scrapy.downloadermiddlewares.cookies.CookiesMiddleware', 'scrapy.downloadermiddlewares.stats.DownloaderStats'] 2016-12-16 21:18:49 [scrapy.middleware] INFO: Enabled spider middlewares: ['scrapy.spidermiddlewares.httperror.HttpErrorMiddleware', 'scrapy.spidermiddlewares.offsite.OffsiteMiddleware', 'scrapy.spidermiddlewares.referer.RefererMiddleware', 'scrapy.spidermiddlewares.urllength.UrlLengthMiddleware', 'scrapy.spidermiddlewares.depth.DepthMiddleware'] 2016-12-16 21:18:49 [scrapy.middleware] INFO: Enabled item pipelines: [] 2016-12-16 21:18:49 [scrapy.core.engine] INFO: Spider opened 2016-12-16 21:18:49 [scrapy.extensions.logstats] INFO: Crawled 0 pages (at 0 pages/min), scraped 0 items (at 0 items/min) 2016-12-16 21:18:50 [scrapy.extensions.logstats] INFO: Crawled 70 pages (at 4200 pages/min), scraped 0 items (at 0 items/min) 2016-12-16 21:18:51 [scrapy.extensions.logstats] INFO: Crawled 134 pages (at 3840 pages/min), scraped 0 items (at 0 items/min) 2016-12-16 21:18:52 [scrapy.extensions.logstats] INFO: Crawled 198 pages (at 3840 pages/min), scraped 0 items (at 0 items/min) 2016-12-16 21:18:53 [scrapy.extensions.logstats] INFO: Crawled 254 pages (at 3360 pages/min), scraped 0 items (at 0 items/min) 2016-12-16 21:18:54 [scrapy.extensions.logstats] INFO: Crawled 302 pages (at 2880 pages/min), scraped 0 items (at 0 items/min) 2016-12-16 21:18:55 [scrapy.extensions.logstats] INFO: Crawled 358 pages (at 3360 pages/min), scraped 0 items (at 0 items/min) 2016-12-16 21:18:56 [scrapy.extensions.logstats] INFO: Crawled 406 pages (at 2880 pages/min), scraped 0 items (at 0 items/min) 2016-12-16 21:18:57 [scrapy.extensions.logstats] INFO: Crawled 438 pages (at 1920 pages/min), scraped 0 items (at 0 items/min) 2016-12-16 21:18:58 [scrapy.extensions.logstats] INFO: Crawled 470 pages (at 1920 pages/min), scraped 0 items (at 0 items/min) 2016-12-16 21:18:59 [scrapy.core.engine] INFO: Closing spider (closespider_timeout) 2016-12-16 21:18:59 [scrapy.extensions.logstats] INFO: Crawled 518 pages (at 2880 pages/min), scraped 0 items (at 0 items/min) 2016-12-16 21:19:00 [scrapy.statscollectors] INFO: Dumping Scrapy stats: {'downloader/request_bytes': 229995, 'downloader/request_count': 534, 'downloader/request_method_count/GET': 534, 'downloader/response_bytes': 1565504, 'downloader/response_count': 534, 'downloader/response_status_count/200': 534, 'finish_reason': 'closespider_timeout', 'finish_time': datetime.datetime(2016, 12, 16, 16, 19, 0, 647725), 'log_count/INFO': 17, 'request_depth_max': 19, 'response_received_count': 534, 'scheduler/dequeued': 533, 'scheduler/dequeued/memory': 533, 'scheduler/enqueued': 10661, 'scheduler/enqueued/memory': 10661, 'start_time': datetime.datetime(2016, 12, 16, 16, 18, 49, 799869)} \u8fd9\u544a\u8bc9\u4f60Scrapy\u5728\u4f60\u8fd0\u884c\u5b83\u7684\u786c\u4ef6\u4e0a\u6bcf\u5206\u949f\u80fd\u722c\u884c3000\u9875\u3002\u6ce8\u610f\uff0c\u8fd9\u662f\u4e00\u4e2a\u975e\u5e38\u7b80\u5355\u7684spider\uff0c\u7528\u4e8e\u8ddf\u8e2a\u94fe\u63a5\uff0c\u60a8\u7f16\u5199\u7684\u4efb\u4f55\u81ea\u5b9a\u4e49\u722c\u884c\u5668\u90fd\u53ef\u80fd\u4f1a\u6267\u884c\u66f4\u591a\u7684\u64cd\u4f5c\uff0c\u4ece\u800c\u5bfc\u81f4\u722c\u884c\u901f\u5ea6\u53d8\u6162\u3002\u901f\u5ea6\u6709\u591a\u6162\u53d6\u51b3\u4e8e\u4f60\u7684spider\u505a\u4e86\u591a\u5c11\uff0c\u4ee5\u53ca\u5b83\u5199\u5f97\u6709\u591a\u597d\u3002 \u5728\u672a\u6765\uff0c\u66f4\u591a\u7684\u6848\u4f8b\u5c06\u88ab\u6dfb\u52a0\u5230\u57fa\u51c6\u6d4b\u8bd5\u5957\u4ef6\u4e2d\uff0c\u4ee5\u6db5\u76d6\u5176\u4ed6\u5e38\u89c1\u573a\u666f\u3002","title":"\u57fa\u51c6\u6d4b\u8bd5"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/12-Benchmark/#_1","text":"\u7248\u672c0.17\u4e2d\u7684\u65b0\u529f\u80fd Scrapy\u9644\u5e26\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u57fa\u51c6\u6d4b\u8bd5\u5957\u4ef6\uff0c\u5b83\u751f\u6210\u4e00\u4e2a\u672c\u5730HTTP\u670d\u52a1\u5668\u5e76\u4ee5\u5c3d\u53ef\u80fd\u5feb\u7684\u901f\u5ea6\u722c\u884c\u3002\u8fd9\u4e2a\u57fa\u51c6\u6d4b\u8bd5\u7684\u76ee\u6807\u662f\u4e86\u89e3Scrapy\u5728\u786c\u4ef6\u4e2d\u7684\u6027\u80fd\uff0c\u4ee5\u4fbf\u6709\u4e00\u4e2a\u6bd4\u8f83\u7684\u516c\u5171\u57fa\u7ebf\u3002\u5b83\u4f7f\u7528\u4e00\u4e2a\u7b80\u5355\u7684spider\uff0c\u5b83\u4ec0\u4e48\u4e5f\u4e0d\u505a\uff0c\u53ea\u662f\u8ddf\u8e2a\u94fe\u63a5\u3002 \u8fd0\u884c\u5b83\u8bf7\u4f7f\u7528: scrapy bench \u60a8\u5e94\u8be5\u4f1a\u770b\u5230\u8fd9\u6837\u7684\u8f93\u51fa: 2016-12-16 21:18:48 [scrapy.utils.log] INFO: Scrapy 1.2.2 started (bot: quotesbot) 2016-12-16 21:18:48 [scrapy.utils.log] INFO: Overridden settings: {'CLOSESPIDER_TIMEOUT': 10, 'ROBOTSTXT_OBEY': True, 'SPIDER_MODULES': ['quotesbot.spiders'], 'LOGSTATS_INTERVAL': 1, 'BOT_NAME': 'quotesbot', 'LOG_LEVEL': 'INFO', 'NEWSPIDER_MODULE': 'quotesbot.spiders'} 2016-12-16 21:18:49 [scrapy.middleware] INFO: Enabled extensions: ['scrapy.extensions.closespider.CloseSpider', 'scrapy.extensions.logstats.LogStats', 'scrapy.extensions.telnet.TelnetConsole', 'scrapy.extensions.corestats.CoreStats'] 2016-12-16 21:18:49 [scrapy.middleware] INFO: Enabled downloader middlewares: ['scrapy.downloadermiddlewares.robotstxt.RobotsTxtMiddleware', 'scrapy.downloadermiddlewares.httpauth.HttpAuthMiddleware', 'scrapy.downloadermiddlewares.downloadtimeout.DownloadTimeoutMiddleware', 'scrapy.downloadermiddlewares.defaultheaders.DefaultHeadersMiddleware', 'scrapy.downloadermiddlewares.useragent.UserAgentMiddleware', 'scrapy.downloadermiddlewares.retry.RetryMiddleware', 'scrapy.downloadermiddlewares.redirect.MetaRefreshMiddleware', 'scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware', 'scrapy.downloadermiddlewares.redirect.RedirectMiddleware', 'scrapy.downloadermiddlewares.cookies.CookiesMiddleware', 'scrapy.downloadermiddlewares.stats.DownloaderStats'] 2016-12-16 21:18:49 [scrapy.middleware] INFO: Enabled spider middlewares: ['scrapy.spidermiddlewares.httperror.HttpErrorMiddleware', 'scrapy.spidermiddlewares.offsite.OffsiteMiddleware', 'scrapy.spidermiddlewares.referer.RefererMiddleware', 'scrapy.spidermiddlewares.urllength.UrlLengthMiddleware', 'scrapy.spidermiddlewares.depth.DepthMiddleware'] 2016-12-16 21:18:49 [scrapy.middleware] INFO: Enabled item pipelines: [] 2016-12-16 21:18:49 [scrapy.core.engine] INFO: Spider opened 2016-12-16 21:18:49 [scrapy.extensions.logstats] INFO: Crawled 0 pages (at 0 pages/min), scraped 0 items (at 0 items/min) 2016-12-16 21:18:50 [scrapy.extensions.logstats] INFO: Crawled 70 pages (at 4200 pages/min), scraped 0 items (at 0 items/min) 2016-12-16 21:18:51 [scrapy.extensions.logstats] INFO: Crawled 134 pages (at 3840 pages/min), scraped 0 items (at 0 items/min) 2016-12-16 21:18:52 [scrapy.extensions.logstats] INFO: Crawled 198 pages (at 3840 pages/min), scraped 0 items (at 0 items/min) 2016-12-16 21:18:53 [scrapy.extensions.logstats] INFO: Crawled 254 pages (at 3360 pages/min), scraped 0 items (at 0 items/min) 2016-12-16 21:18:54 [scrapy.extensions.logstats] INFO: Crawled 302 pages (at 2880 pages/min), scraped 0 items (at 0 items/min) 2016-12-16 21:18:55 [scrapy.extensions.logstats] INFO: Crawled 358 pages (at 3360 pages/min), scraped 0 items (at 0 items/min) 2016-12-16 21:18:56 [scrapy.extensions.logstats] INFO: Crawled 406 pages (at 2880 pages/min), scraped 0 items (at 0 items/min) 2016-12-16 21:18:57 [scrapy.extensions.logstats] INFO: Crawled 438 pages (at 1920 pages/min), scraped 0 items (at 0 items/min) 2016-12-16 21:18:58 [scrapy.extensions.logstats] INFO: Crawled 470 pages (at 1920 pages/min), scraped 0 items (at 0 items/min) 2016-12-16 21:18:59 [scrapy.core.engine] INFO: Closing spider (closespider_timeout) 2016-12-16 21:18:59 [scrapy.extensions.logstats] INFO: Crawled 518 pages (at 2880 pages/min), scraped 0 items (at 0 items/min) 2016-12-16 21:19:00 [scrapy.statscollectors] INFO: Dumping Scrapy stats: {'downloader/request_bytes': 229995, 'downloader/request_count': 534, 'downloader/request_method_count/GET': 534, 'downloader/response_bytes': 1565504, 'downloader/response_count': 534, 'downloader/response_status_count/200': 534, 'finish_reason': 'closespider_timeout', 'finish_time': datetime.datetime(2016, 12, 16, 16, 19, 0, 647725), 'log_count/INFO': 17, 'request_depth_max': 19, 'response_received_count': 534, 'scheduler/dequeued': 533, 'scheduler/dequeued/memory': 533, 'scheduler/enqueued': 10661, 'scheduler/enqueued/memory': 10661, 'start_time': datetime.datetime(2016, 12, 16, 16, 18, 49, 799869)} \u8fd9\u544a\u8bc9\u4f60Scrapy\u5728\u4f60\u8fd0\u884c\u5b83\u7684\u786c\u4ef6\u4e0a\u6bcf\u5206\u949f\u80fd\u722c\u884c3000\u9875\u3002\u6ce8\u610f\uff0c\u8fd9\u662f\u4e00\u4e2a\u975e\u5e38\u7b80\u5355\u7684spider\uff0c\u7528\u4e8e\u8ddf\u8e2a\u94fe\u63a5\uff0c\u60a8\u7f16\u5199\u7684\u4efb\u4f55\u81ea\u5b9a\u4e49\u722c\u884c\u5668\u90fd\u53ef\u80fd\u4f1a\u6267\u884c\u66f4\u591a\u7684\u64cd\u4f5c\uff0c\u4ece\u800c\u5bfc\u81f4\u722c\u884c\u901f\u5ea6\u53d8\u6162\u3002\u901f\u5ea6\u6709\u591a\u6162\u53d6\u51b3\u4e8e\u4f60\u7684spider\u505a\u4e86\u591a\u5c11\uff0c\u4ee5\u53ca\u5b83\u5199\u5f97\u6709\u591a\u597d\u3002 \u5728\u672a\u6765\uff0c\u66f4\u591a\u7684\u6848\u4f8b\u5c06\u88ab\u6dfb\u52a0\u5230\u57fa\u51c6\u6d4b\u8bd5\u5957\u4ef6\u4e2d\uff0c\u4ee5\u6db5\u76d6\u5176\u4ed6\u5e38\u89c1\u573a\u666f\u3002","title":"\u57fa\u51c6\u6d4b\u8bd5"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/13-pausing-resuming-crawls/","text":"\u4f5c\u4e1a: \u6682\u505c\u548c\u6062\u590d\u722c\u866b \u6709\u65f6\u5019\uff0c\u5bf9\u4e8e\u5927\u578b\u7ad9\u70b9\u6765\u8bf4\uff0c\u6682\u505c\u722c\u884c\u5e76\u80fd\u591f\u5728\u7a0d\u540e\u6062\u590d\u5b83\u4eec\u662f\u53ef\u53d6\u7684\u3002 Scrapy\u901a\u8fc7\u63d0\u4f9b\u4ee5\u4e0b\u529f\u80fd\u6765\u652f\u6301\u8fd9\u79cd\u5f00\u7bb1\u5373\u7528\u7684\u529f\u80fd: \u5728\u78c1\u76d8\u4e0a\u6301\u4e45\u5b58\u50a8\u8ba1\u5212\u8bf7\u6c42\u7684scheduler \u4e00\u4e2a\u91cd\u590d\u7684\u8fc7\u6ee4\u5668\uff0c\u5b83\u5c06\u8bbf\u95ee\u7684\u8bf7\u6c42\u4fdd\u5b58\u5728\u78c1\u76d8\u4e0a \u5728\u5206\u6279\u4e4b\u95f4\u4fdd\u6301\u4e00\u4e9bspider\u72b6\u6001(\u952e/\u503c\u5bf9)\u6301\u4e45\u7684\u6269\u5c55 \u4f5c\u4e1a\u76ee\u5f55 \u8981\u542f\u7528\u6301\u4e45\u6027\u652f\u6301\uff0c\u53ea\u9700\u901a\u8fc7 JOBDIR setting\u5b9a\u4e49\u4e00\u4e2a\u4f5c\u4e1a\u76ee\u5f55\u3002\u8fd9\u4e2a\u76ee\u5f55\u5c06\u7528\u4e8e\u5b58\u50a8\u6240\u6709\u9700\u8981\u7684\u6570\u636e\uff0c\u4ee5\u4fdd\u6301\u5355\u4e2a\u4f5c\u4e1a\u7684\u72b6\u6001(\u5373\u3002\u4e00\u4e2aspider\u8fd0\u884c)\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u4e2a\u76ee\u5f55\u4e0d\u80fd\u88ab\u4e0d\u540c\u7684spider\u5171\u4eab\uff0c\u751a\u81f3\u4e0d\u80fd\u88ab\u540c\u4e00\u4e2aspider\u7684\u4e0d\u540c\u4f5c\u4e1a/\u8fd0\u884c\u5171\u4eab\uff0c\u56e0\u4e3a\u5b83\u662f\u7528\u6765\u5b58\u50a8\u5355\u4e2a\u4f5c\u4e1a\u7684\u72b6\u6001\u7684\u3002 \u4f7f\u7528\u65b9\u6cd5 \u8981\u542f\u52a8\u652f\u6301\u6301\u4e45\u5316\u7684\u652f\u6301\u7684spider\uff0c\u8fd0\u884c\u5b83\u5982\u4e0b: scrapy crawl somespider -s JOBDIR=crawls/somespider-1 \u7136\u540e\uff0c\u60a8\u53ef\u4ee5\u5728\u4efb\u4f55\u65f6\u5019\u5b89\u5168\u5730\u505c\u6b62spdier(\u6309Ctrl-C\u6216\u53d1\u9001\u4e00\u4e2a\u4fe1\u53f7)\uff0c\u7136\u540e\u901a\u8fc7\u53d1\u51fa\u76f8\u540c\u7684\u547d\u4ee4\u6062\u590d\u5b83: scrapy crawl somespider -s JOBDIR=crawls/somespider-1 \u4fdd\u6301\u6279\u6b21\u4e4b\u95f4\u7684\u6301\u4e45\u72b6\u6001 \u6709\u65f6\u60a8\u9700\u8981\u5728\u6682\u505c/\u6062\u590d\u6279\u6b21\u4e4b\u95f4\u4fdd\u6301\u4e00\u4e9b\u6301\u4e45\u7684spider state\u3002\u4f60\u53ef\u4ee5\u7528 spider.state \u5c5e\u6027, \u5b83\u5e94\u8be5\u662fdict\u3002\u6709\u4e00\u4e2a\u5185\u7f6e\u7684\u6269\u5c55\uff0c\u5f53spider\u542f\u52a8\u548c\u505c\u6b62\u65f6\uff0c\u5b83\u8d1f\u8d23\u4ece\u4f5c\u4e1a\u76ee\u5f55\u5e8f\u5217\u5316\u3001\u5b58\u50a8\u548c\u52a0\u8f7d\u8be5\u5c5e\u6027\u3002 \u4e0b\u9762\u662f\u4e00\u4e2a\u4f7f\u7528spider state\u7684callback\u793a\u4f8b(\u4e3a\u4e86\u7b80\u6d01\u8d77\u89c1\uff0c\u7701\u7565\u4e86\u5176\u4ed6spider\u4ee3\u7801): def parse_item(self, response): # \u5728\u8fd9\u91cc\u89e3\u6790item self.state['items_count'] = self.state.get('items_count', 0) + 1 \u6301\u4e45\u6027\u95ee\u9898 \u5982\u679c\u60a8\u60f3\u8981\u4f7f\u7528Scrapy\u6301\u4e45\u6027\u652f\u6301\uff0c\u9700\u8981\u8bb0\u4f4f\u4ee5\u4e0b\u51e0\u70b9: Cookies\u8fc7\u671f Cookies\u53ef\u80fd\u4f1a\u8fc7\u671f\u3002\u56e0\u6b64\uff0c\u5982\u679c\u60a8\u4e0d\u8fc5\u901f\u6062\u590dspider\uff0c\u90a3\u4e48\u8ba1\u5212\u4e2d\u7684\u8bf7\u6c42\u53ef\u80fd\u4e0d\u518d\u6709\u6548\u3002\u5982\u679cspider\u4e0d\u4f9d\u8d56cookie\uff0c\u8fd9\u5c31\u4e0d\u662f\u95ee\u9898\u3002 Request\u5e8f\u5217\u5316 Requests\u5fc5\u987b\u7531pickle\u6a21\u5757\u5e8f\u5217\u5316\uff0c\u4ee5\u4fbf\u6301\u4e45\u5316\u5de5\u4f5c\uff0c\u56e0\u6b64\u5e94\u8be5\u786e\u4fddrequests\u662f\u53ef\u5e8f\u5217\u5316\u7684\u3002 \u8fd9\u91cc\u6700\u5e38\u89c1\u7684\u95ee\u9898\u662f\u5bf9\u4e0d\u80fd\u6301\u4e45\u7684request callback\u4f7f\u7528lambda\u51fd\u6570\u3002 \u4f8b\u5982\uff0c\u8fd9\u662f\u884c\u4e0d\u901a\u7684: def some_callback(self, response): somearg = 'test' return scrapy.Request('http://www.example.com', callback=lambda r: self.other_callback(r, somearg)) def other_callback(self, response, somearg): print the argument passed is: , somearg \u4f46\u8fd9\u53ef\u4ee5: def some_callback(self, response): somearg = 'test' return scrapy.Request('http://www.example.com', callback=self.other_callback, meta={'somearg': somearg}) def other_callback(self, response): somearg = response.meta['somearg'] print the argument passed is: , somearg \u5982\u679c\u5e0c\u671blog\u65e0\u6cd5\u5e8f\u5217\u5316\u7684requests\uff0c\u53ef\u4ee5\u5728\u9879\u76ee\u7684settings\u9875\u9762\u4e2d\u5c06 SCHEDULER_DEBUG \u8bbe\u7f6e\u8bbe\u7f6e\u4e3a True \u3002\u9ed8\u8ba4\u4e3a False \u3002","title":"\u4f5c\u4e1a: \u6682\u505c\u548c\u6062\u590d\u722c\u866b"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/13-pausing-resuming-crawls/#_1","text":"\u6709\u65f6\u5019\uff0c\u5bf9\u4e8e\u5927\u578b\u7ad9\u70b9\u6765\u8bf4\uff0c\u6682\u505c\u722c\u884c\u5e76\u80fd\u591f\u5728\u7a0d\u540e\u6062\u590d\u5b83\u4eec\u662f\u53ef\u53d6\u7684\u3002 Scrapy\u901a\u8fc7\u63d0\u4f9b\u4ee5\u4e0b\u529f\u80fd\u6765\u652f\u6301\u8fd9\u79cd\u5f00\u7bb1\u5373\u7528\u7684\u529f\u80fd: \u5728\u78c1\u76d8\u4e0a\u6301\u4e45\u5b58\u50a8\u8ba1\u5212\u8bf7\u6c42\u7684scheduler \u4e00\u4e2a\u91cd\u590d\u7684\u8fc7\u6ee4\u5668\uff0c\u5b83\u5c06\u8bbf\u95ee\u7684\u8bf7\u6c42\u4fdd\u5b58\u5728\u78c1\u76d8\u4e0a \u5728\u5206\u6279\u4e4b\u95f4\u4fdd\u6301\u4e00\u4e9bspider\u72b6\u6001(\u952e/\u503c\u5bf9)\u6301\u4e45\u7684\u6269\u5c55","title":"\u4f5c\u4e1a: \u6682\u505c\u548c\u6062\u590d\u722c\u866b"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/13-pausing-resuming-crawls/#_2","text":"\u8981\u542f\u7528\u6301\u4e45\u6027\u652f\u6301\uff0c\u53ea\u9700\u901a\u8fc7 JOBDIR setting\u5b9a\u4e49\u4e00\u4e2a\u4f5c\u4e1a\u76ee\u5f55\u3002\u8fd9\u4e2a\u76ee\u5f55\u5c06\u7528\u4e8e\u5b58\u50a8\u6240\u6709\u9700\u8981\u7684\u6570\u636e\uff0c\u4ee5\u4fdd\u6301\u5355\u4e2a\u4f5c\u4e1a\u7684\u72b6\u6001(\u5373\u3002\u4e00\u4e2aspider\u8fd0\u884c)\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u4e2a\u76ee\u5f55\u4e0d\u80fd\u88ab\u4e0d\u540c\u7684spider\u5171\u4eab\uff0c\u751a\u81f3\u4e0d\u80fd\u88ab\u540c\u4e00\u4e2aspider\u7684\u4e0d\u540c\u4f5c\u4e1a/\u8fd0\u884c\u5171\u4eab\uff0c\u56e0\u4e3a\u5b83\u662f\u7528\u6765\u5b58\u50a8\u5355\u4e2a\u4f5c\u4e1a\u7684\u72b6\u6001\u7684\u3002","title":"\u4f5c\u4e1a\u76ee\u5f55"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/13-pausing-resuming-crawls/#_3","text":"\u8981\u542f\u52a8\u652f\u6301\u6301\u4e45\u5316\u7684\u652f\u6301\u7684spider\uff0c\u8fd0\u884c\u5b83\u5982\u4e0b: scrapy crawl somespider -s JOBDIR=crawls/somespider-1 \u7136\u540e\uff0c\u60a8\u53ef\u4ee5\u5728\u4efb\u4f55\u65f6\u5019\u5b89\u5168\u5730\u505c\u6b62spdier(\u6309Ctrl-C\u6216\u53d1\u9001\u4e00\u4e2a\u4fe1\u53f7)\uff0c\u7136\u540e\u901a\u8fc7\u53d1\u51fa\u76f8\u540c\u7684\u547d\u4ee4\u6062\u590d\u5b83: scrapy crawl somespider -s JOBDIR=crawls/somespider-1","title":"\u4f7f\u7528\u65b9\u6cd5"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/13-pausing-resuming-crawls/#_4","text":"\u6709\u65f6\u60a8\u9700\u8981\u5728\u6682\u505c/\u6062\u590d\u6279\u6b21\u4e4b\u95f4\u4fdd\u6301\u4e00\u4e9b\u6301\u4e45\u7684spider state\u3002\u4f60\u53ef\u4ee5\u7528 spider.state \u5c5e\u6027, \u5b83\u5e94\u8be5\u662fdict\u3002\u6709\u4e00\u4e2a\u5185\u7f6e\u7684\u6269\u5c55\uff0c\u5f53spider\u542f\u52a8\u548c\u505c\u6b62\u65f6\uff0c\u5b83\u8d1f\u8d23\u4ece\u4f5c\u4e1a\u76ee\u5f55\u5e8f\u5217\u5316\u3001\u5b58\u50a8\u548c\u52a0\u8f7d\u8be5\u5c5e\u6027\u3002 \u4e0b\u9762\u662f\u4e00\u4e2a\u4f7f\u7528spider state\u7684callback\u793a\u4f8b(\u4e3a\u4e86\u7b80\u6d01\u8d77\u89c1\uff0c\u7701\u7565\u4e86\u5176\u4ed6spider\u4ee3\u7801): def parse_item(self, response): # \u5728\u8fd9\u91cc\u89e3\u6790item self.state['items_count'] = self.state.get('items_count', 0) + 1","title":"\u4fdd\u6301\u6279\u6b21\u4e4b\u95f4\u7684\u6301\u4e45\u72b6\u6001"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/13-pausing-resuming-crawls/#_5","text":"\u5982\u679c\u60a8\u60f3\u8981\u4f7f\u7528Scrapy\u6301\u4e45\u6027\u652f\u6301\uff0c\u9700\u8981\u8bb0\u4f4f\u4ee5\u4e0b\u51e0\u70b9:","title":"\u6301\u4e45\u6027\u95ee\u9898"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/13-pausing-resuming-crawls/#cookies","text":"Cookies\u53ef\u80fd\u4f1a\u8fc7\u671f\u3002\u56e0\u6b64\uff0c\u5982\u679c\u60a8\u4e0d\u8fc5\u901f\u6062\u590dspider\uff0c\u90a3\u4e48\u8ba1\u5212\u4e2d\u7684\u8bf7\u6c42\u53ef\u80fd\u4e0d\u518d\u6709\u6548\u3002\u5982\u679cspider\u4e0d\u4f9d\u8d56cookie\uff0c\u8fd9\u5c31\u4e0d\u662f\u95ee\u9898\u3002","title":"Cookies\u8fc7\u671f"},{"location":"4. \u89e3\u51b3\u5177\u4f53\u95ee\u9898/13-pausing-resuming-crawls/#request","text":"Requests\u5fc5\u987b\u7531pickle\u6a21\u5757\u5e8f\u5217\u5316\uff0c\u4ee5\u4fbf\u6301\u4e45\u5316\u5de5\u4f5c\uff0c\u56e0\u6b64\u5e94\u8be5\u786e\u4fddrequests\u662f\u53ef\u5e8f\u5217\u5316\u7684\u3002 \u8fd9\u91cc\u6700\u5e38\u89c1\u7684\u95ee\u9898\u662f\u5bf9\u4e0d\u80fd\u6301\u4e45\u7684request callback\u4f7f\u7528lambda\u51fd\u6570\u3002 \u4f8b\u5982\uff0c\u8fd9\u662f\u884c\u4e0d\u901a\u7684: def some_callback(self, response): somearg = 'test' return scrapy.Request('http://www.example.com', callback=lambda r: self.other_callback(r, somearg)) def other_callback(self, response, somearg): print the argument passed is: , somearg \u4f46\u8fd9\u53ef\u4ee5: def some_callback(self, response): somearg = 'test' return scrapy.Request('http://www.example.com', callback=self.other_callback, meta={'somearg': somearg}) def other_callback(self, response): somearg = response.meta['somearg'] print the argument passed is: , somearg \u5982\u679c\u5e0c\u671blog\u65e0\u6cd5\u5e8f\u5217\u5316\u7684requests\uff0c\u53ef\u4ee5\u5728\u9879\u76ee\u7684settings\u9875\u9762\u4e2d\u5c06 SCHEDULER_DEBUG \u8bbe\u7f6e\u8bbe\u7f6e\u4e3a True \u3002\u9ed8\u8ba4\u4e3a False \u3002","title":"Request\u5e8f\u5217\u5316"},{"location":"5. Scrapy\u6269\u5c55/01-Architecture-overview/","text":"\u67b6\u6784\u6982\u8ff0 \u672c\u6587\u63cf\u8ff0\u4e86Scrapy\u7684\u4f53\u7cfb\u7ed3\u6784\u53ca\u5176\u7ec4\u4ef6\u4e4b\u95f4\u7684\u4ea4\u4e92\u65b9\u5f0f\u3002 \u6982\u8ff0 \u4e0b\u56fe\u663e\u793a\u4e86Scrapy\u4f53\u7cfb\u7ed3\u6784\u53ca\u5176\u7ec4\u4ef6\u7684\u6982\u8ff0\uff0c\u4ee5\u53ca\u7cfb\u7edf\u5185\u90e8\u53d1\u751f\u7684\u6570\u636e\u6d41\u7684\u6982\u8981(\u7ea2\u8272\u7bad\u5934\u6240\u793a)\u3002\u4e0b\u9762\u5305\u542b\u4e86\u5bf9\u7ec4\u4ef6\u7684\u7b80\u8981\u63cf\u8ff0\uff0c\u4ee5\u53ca\u5173\u4e8e\u8fd9\u4e9b\u7ec4\u4ef6\u7684\u8be6\u7ec6\u4fe1\u606f\u7684\u94fe\u63a5\u3002\u4e0b\u9762\u8fd8\u63cf\u8ff0\u4e86\u6570\u636e\u6d41\u3002 \u6570\u636e\u6d41 Scrapy\u4e2d\u7684\u6570\u636e\u6d41\u7531engine\u6267\u884c\u63a7\u5236\uff0c\u5982\u4e0b\u6240\u793a: Engine \u4ece Spider \u4e2d\u83b7\u5f97\u6700\u521d\u7684Requests Engine \u5728 Scheduler \u91cc\u8c03\u5ea6Requests\u5e76\u4e0d\u65ad\u5bfb\u6c42\u4e0b\u4e00\u4e2aRequests\u8fdb\u884c\u6293\u53d6 Scheduler \u5c06\u4e0b\u4e00\u4e2aRequests\u8fd4\u56de\u5230 Engine Engine\u901a\u8fc7 Downloader Middlewares (\u770b process_request() )\u5c06Requests\u53d1\u9001\u5230 Downloader \u4e00\u65e6\u9875\u9762\u4e0b\u8f7d\u5b8c\u6210, Downloader \u751f\u6210Response(\u7528\u8fd9\u4e2a\u9875\u9762), \u5e76\u4e14\u901a\u8fc7 Downloader Middlewares (\u770b process_response() )\u5c06Response\u53d1\u9001\u5230Engine Engine \u63a5\u53d7 Downloader \u53d1\u9001\u8fc7\u6765\u7684Response, \u5e76\u4e14\u901a\u8fc7 Spider Middleware (\u770b process_spider_input() )\u5c06Response\u53d1\u9001\u7ed9 Spider Spider \u5904\u7406Response, \u5e76\u4e14\u901a\u8fc7 Spider Middleware (\u770b process_spider_output() )\u5c06\u6293\u53d6\u7684items\u548c\u65b0Requests\u8fd4\u56de\u7ed9 Engine Engine \u5c06\u5904\u7406\u8fc7\u7684items\u53d1\u9001\u5230 Item Pipelines , \u7136\u540e\u5c06\u540e\u7eedRequests\u53d1\u9001\u5230 Scheduler , \u5e76\u4e14\u5c3d\u53ef\u80fd\u5bfb\u6c42\u4e0b\u4e00\u4e2aRequests\u8fdb\u884c\u6293\u53d6 \u8fd9\u4e2a\u8fc7\u7a0b\u91cd\u590d(\u4ece\u7b2c1\u6b65)\uff0c\u76f4\u5230 Scheduler \u4e0d\u518d\u53d1\u51fa\u8bf7\u6c42\u3002 \u7ec4\u4ef6 Scrapy Engine engine\u8d1f\u8d23\u63a7\u5236\u7cfb\u7edf\u6240\u6709\u7ec4\u4ef6\u4e4b\u95f4\u7684\u6570\u636e\u6d41\uff0c\u5e76\u5728\u67d0\u4e9b\u64cd\u4f5c\u53d1\u751f\u65f6\u89e6\u53d1\u4e8b\u4ef6\u3002\u6709\u5173\u66f4\u591a\u7ec6\u8282\uff0c\u8bf7\u53c2\u9605\u4e0a\u9762\u7684 \u6570\u636e\u6d41 \u90e8\u5206\u3002 Scheduler Scheduler\u63a5\u6536\u6765\u81eaengine\u7684\u8bf7\u6c42\uff0c\u5e76\u5bf9\u5b83\u4eec\u8fdb\u884c\u6392\u961f\uff0c\u4ee5\u4fbf\u5728engine\u8bf7\u6c42\u5b83\u4eec\u65f6\u4ee5\u4fbf\u7a0d\u540e\u63d0\u4f9b\u8fd9\u4e9b\u8bf7\u6c42(\u540c\u65f6\u4e5f\u63d0\u4f9b\u7ed9engine)\u3002 Downloader Downloader\u8d1f\u8d23\u83b7\u53d6web\u9875\u9762\u5e76\u5c06\u5176\u63d0\u4f9b\u7ed9engine\uff0c\u800cengine\u53c8\u5c06\u8fd9\u4e9b\u9875\u9762\u63d0\u4f9b\u7ed9spider\u3002 Spiders Spiders\u662f\u7531Scrapy\u7528\u6237\u7f16\u5199\u7684\u81ea\u5b9a\u4e49\u7c7b\uff0c\u7528\u4e8e\u89e3\u6790responses\u5e76\u4ece\u5176\u4e2d\u63d0\u53d6items (\u4e5f\u79f0\u4e3a\u5df2\u6293\u53d6\u7684items)\u6216\u968f\u540e\u7684\u5176\u4ed6\u8bf7\u6c42\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1 Spiders \u3002 Item Pipeline Item Pipeline\u8d1f\u8d23\u5904\u7406\u88abspider\u63d0\u53d6(\u6216\u5df2\u6293\u53d6)\u7684items\u3002\u5178\u578b\u7684\u4efb\u52a1\u5305\u62ec\u6e05\u7406\u3001\u9a8c\u8bc1\u548c\u6301\u4e45\u6027(\u6bd4\u5982\u5c06item\u5b58\u50a8\u5728\u6570\u636e\u5e93\u4e2d)\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Item Pipeline \u3002 Downloader middlewares Downloader middlewares\u662f\u4f4d\u4e8eEngine\u548cDownloader\u4e4b\u95f4\u7684\u7279\u5b9ahooks(\u94a9\u5b50)\uff0c\u5f53\u5b83\u4eec\u4eceEngine\u4f20\u9012\u5230Downloader\u65f6\uff0c\u5904\u7406requests\uff0c\u4ee5\u53ca\u4eceDownloader\u4f20\u9012\u5230Engine\u7684responses\u3002 \u5982\u679c\u60a8\u9700\u8981\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\u4e4b\u4e00\uff0c\u8bf7\u4f7f\u7528Downloader middleware: \u5728\u5c06request\u53d1\u9001\u5230Downloader\u4e4b\u524d\u5904\u7406request(\u5373\u5728Scrapy\u5c06request\u53d1\u9001\u5230\u7f51\u7ad9\u4e4b\u524d); \u5728\u4f20\u9012\u7ed9spider\u4e4b\u524d\u6536\u5230\u66f4\u6539\u540e\u7684response; \u53d1\u9001\u4e00\u4e2a\u65b0\u7684Request\uff0c\u800c\u4e0d\u662f\u5c06\u63a5\u6536\u5230\u7684response\u4ea4\u7ed9spider; \u5c06response\u4f20\u9012\u7ed9spider\u800c\u4e0d\u662f\u83b7\u53d6web\u9875\u9762 \u9759\u9759\u5730\u5220\u9664\u4e00\u4e9brequests\u3002 \u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1 Downloader Middleware \u3002 Spider middlewares Spider middlewares\u662f\u4f4d\u4e8e\u5f15\u64ce\u548cSpider\u4e4b\u95f4\u7684\u7279\u5b9ahooks(\u94a9\u5b50)\uff0c\u80fd\u591f\u5904\u7406spider\u8f93\u5165(responses)\u548c\u8f93\u51fa(items and requests)\u3002 \u5982\u679c\u9700\u8981\uff0c\u53ef\u4ee5\u4f7f\u7528Spider middleware spider callbacks\u7684post-process(\u540e)\u5904\u7406\u8f93\u51fa-\u66f4\u6539/\u6dfb\u52a0/\u5220\u9664requests\u6216items; start_requests post-process(\u540e)\u5904\u7406; \u5904\u7406\u8718\u86db\u5f02\u5e38; \u5bf9\u4e00\u4e9b\u57fa\u4e8eresponse\u5185\u5bb9\u7684requests\u8c03\u7528errback\u800c\u4e0d\u662fcallback\u3002 \u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1 Spider Middleware \u3002 \u4e8b\u4ef6\u9a71\u52a8\u7684\u7f51\u7edc Scrapy\u662f\u7528Python\u7684\u4e00\u4e2a\u6d41\u884c\u7684\u4e8b\u4ef6\u9a71\u52a8\u7f51\u7edc\u6846\u67b6 Twisted \u7f16\u5199\u7684\u3002\u56e0\u6b64\uff0c\u5b83\u4f7f\u7528\u975e\u963b\u585e(\u5373\u5f02\u6b65)\u4ee3\u7801\u5b9e\u73b0\u5e76\u53d1\u3002 \u6709\u5173\u5f02\u6b65\u7f16\u7a0b\u548cTwisted\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u4ee5\u4e0b\u94fe\u63a5: Twisted\u7684\u5ef6\u8fdf\u4ecb\u7ecd Twisted - hello\uff0c\u5f02\u6b65\u7f16\u7a0b Twisted\u4ecb\u7ecd - Krondo","title":"\u67b6\u6784\u6982\u8ff0"},{"location":"5. Scrapy\u6269\u5c55/01-Architecture-overview/#_1","text":"\u672c\u6587\u63cf\u8ff0\u4e86Scrapy\u7684\u4f53\u7cfb\u7ed3\u6784\u53ca\u5176\u7ec4\u4ef6\u4e4b\u95f4\u7684\u4ea4\u4e92\u65b9\u5f0f\u3002","title":"\u67b6\u6784\u6982\u8ff0"},{"location":"5. Scrapy\u6269\u5c55/01-Architecture-overview/#_2","text":"\u4e0b\u56fe\u663e\u793a\u4e86Scrapy\u4f53\u7cfb\u7ed3\u6784\u53ca\u5176\u7ec4\u4ef6\u7684\u6982\u8ff0\uff0c\u4ee5\u53ca\u7cfb\u7edf\u5185\u90e8\u53d1\u751f\u7684\u6570\u636e\u6d41\u7684\u6982\u8981(\u7ea2\u8272\u7bad\u5934\u6240\u793a)\u3002\u4e0b\u9762\u5305\u542b\u4e86\u5bf9\u7ec4\u4ef6\u7684\u7b80\u8981\u63cf\u8ff0\uff0c\u4ee5\u53ca\u5173\u4e8e\u8fd9\u4e9b\u7ec4\u4ef6\u7684\u8be6\u7ec6\u4fe1\u606f\u7684\u94fe\u63a5\u3002\u4e0b\u9762\u8fd8\u63cf\u8ff0\u4e86\u6570\u636e\u6d41\u3002","title":"\u6982\u8ff0"},{"location":"5. Scrapy\u6269\u5c55/01-Architecture-overview/#_3","text":"Scrapy\u4e2d\u7684\u6570\u636e\u6d41\u7531engine\u6267\u884c\u63a7\u5236\uff0c\u5982\u4e0b\u6240\u793a: Engine \u4ece Spider \u4e2d\u83b7\u5f97\u6700\u521d\u7684Requests Engine \u5728 Scheduler \u91cc\u8c03\u5ea6Requests\u5e76\u4e0d\u65ad\u5bfb\u6c42\u4e0b\u4e00\u4e2aRequests\u8fdb\u884c\u6293\u53d6 Scheduler \u5c06\u4e0b\u4e00\u4e2aRequests\u8fd4\u56de\u5230 Engine Engine\u901a\u8fc7 Downloader Middlewares (\u770b process_request() )\u5c06Requests\u53d1\u9001\u5230 Downloader \u4e00\u65e6\u9875\u9762\u4e0b\u8f7d\u5b8c\u6210, Downloader \u751f\u6210Response(\u7528\u8fd9\u4e2a\u9875\u9762), \u5e76\u4e14\u901a\u8fc7 Downloader Middlewares (\u770b process_response() )\u5c06Response\u53d1\u9001\u5230Engine Engine \u63a5\u53d7 Downloader \u53d1\u9001\u8fc7\u6765\u7684Response, \u5e76\u4e14\u901a\u8fc7 Spider Middleware (\u770b process_spider_input() )\u5c06Response\u53d1\u9001\u7ed9 Spider Spider \u5904\u7406Response, \u5e76\u4e14\u901a\u8fc7 Spider Middleware (\u770b process_spider_output() )\u5c06\u6293\u53d6\u7684items\u548c\u65b0Requests\u8fd4\u56de\u7ed9 Engine Engine \u5c06\u5904\u7406\u8fc7\u7684items\u53d1\u9001\u5230 Item Pipelines , \u7136\u540e\u5c06\u540e\u7eedRequests\u53d1\u9001\u5230 Scheduler , \u5e76\u4e14\u5c3d\u53ef\u80fd\u5bfb\u6c42\u4e0b\u4e00\u4e2aRequests\u8fdb\u884c\u6293\u53d6 \u8fd9\u4e2a\u8fc7\u7a0b\u91cd\u590d(\u4ece\u7b2c1\u6b65)\uff0c\u76f4\u5230 Scheduler \u4e0d\u518d\u53d1\u51fa\u8bf7\u6c42\u3002","title":"\u6570\u636e\u6d41"},{"location":"5. Scrapy\u6269\u5c55/01-Architecture-overview/#_4","text":"","title":"\u7ec4\u4ef6"},{"location":"5. Scrapy\u6269\u5c55/01-Architecture-overview/#scrapy-engine","text":"engine\u8d1f\u8d23\u63a7\u5236\u7cfb\u7edf\u6240\u6709\u7ec4\u4ef6\u4e4b\u95f4\u7684\u6570\u636e\u6d41\uff0c\u5e76\u5728\u67d0\u4e9b\u64cd\u4f5c\u53d1\u751f\u65f6\u89e6\u53d1\u4e8b\u4ef6\u3002\u6709\u5173\u66f4\u591a\u7ec6\u8282\uff0c\u8bf7\u53c2\u9605\u4e0a\u9762\u7684 \u6570\u636e\u6d41 \u90e8\u5206\u3002","title":"Scrapy Engine"},{"location":"5. Scrapy\u6269\u5c55/01-Architecture-overview/#scheduler","text":"Scheduler\u63a5\u6536\u6765\u81eaengine\u7684\u8bf7\u6c42\uff0c\u5e76\u5bf9\u5b83\u4eec\u8fdb\u884c\u6392\u961f\uff0c\u4ee5\u4fbf\u5728engine\u8bf7\u6c42\u5b83\u4eec\u65f6\u4ee5\u4fbf\u7a0d\u540e\u63d0\u4f9b\u8fd9\u4e9b\u8bf7\u6c42(\u540c\u65f6\u4e5f\u63d0\u4f9b\u7ed9engine)\u3002","title":"Scheduler"},{"location":"5. Scrapy\u6269\u5c55/01-Architecture-overview/#downloader","text":"Downloader\u8d1f\u8d23\u83b7\u53d6web\u9875\u9762\u5e76\u5c06\u5176\u63d0\u4f9b\u7ed9engine\uff0c\u800cengine\u53c8\u5c06\u8fd9\u4e9b\u9875\u9762\u63d0\u4f9b\u7ed9spider\u3002","title":"Downloader"},{"location":"5. Scrapy\u6269\u5c55/01-Architecture-overview/#spiders","text":"Spiders\u662f\u7531Scrapy\u7528\u6237\u7f16\u5199\u7684\u81ea\u5b9a\u4e49\u7c7b\uff0c\u7528\u4e8e\u89e3\u6790responses\u5e76\u4ece\u5176\u4e2d\u63d0\u53d6items (\u4e5f\u79f0\u4e3a\u5df2\u6293\u53d6\u7684items)\u6216\u968f\u540e\u7684\u5176\u4ed6\u8bf7\u6c42\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1 Spiders \u3002","title":"Spiders"},{"location":"5. Scrapy\u6269\u5c55/01-Architecture-overview/#item-pipeline","text":"Item Pipeline\u8d1f\u8d23\u5904\u7406\u88abspider\u63d0\u53d6(\u6216\u5df2\u6293\u53d6)\u7684items\u3002\u5178\u578b\u7684\u4efb\u52a1\u5305\u62ec\u6e05\u7406\u3001\u9a8c\u8bc1\u548c\u6301\u4e45\u6027(\u6bd4\u5982\u5c06item\u5b58\u50a8\u5728\u6570\u636e\u5e93\u4e2d)\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Item Pipeline \u3002","title":"Item Pipeline"},{"location":"5. Scrapy\u6269\u5c55/01-Architecture-overview/#downloader-middlewares","text":"Downloader middlewares\u662f\u4f4d\u4e8eEngine\u548cDownloader\u4e4b\u95f4\u7684\u7279\u5b9ahooks(\u94a9\u5b50)\uff0c\u5f53\u5b83\u4eec\u4eceEngine\u4f20\u9012\u5230Downloader\u65f6\uff0c\u5904\u7406requests\uff0c\u4ee5\u53ca\u4eceDownloader\u4f20\u9012\u5230Engine\u7684responses\u3002 \u5982\u679c\u60a8\u9700\u8981\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\u4e4b\u4e00\uff0c\u8bf7\u4f7f\u7528Downloader middleware: \u5728\u5c06request\u53d1\u9001\u5230Downloader\u4e4b\u524d\u5904\u7406request(\u5373\u5728Scrapy\u5c06request\u53d1\u9001\u5230\u7f51\u7ad9\u4e4b\u524d); \u5728\u4f20\u9012\u7ed9spider\u4e4b\u524d\u6536\u5230\u66f4\u6539\u540e\u7684response; \u53d1\u9001\u4e00\u4e2a\u65b0\u7684Request\uff0c\u800c\u4e0d\u662f\u5c06\u63a5\u6536\u5230\u7684response\u4ea4\u7ed9spider; \u5c06response\u4f20\u9012\u7ed9spider\u800c\u4e0d\u662f\u83b7\u53d6web\u9875\u9762 \u9759\u9759\u5730\u5220\u9664\u4e00\u4e9brequests\u3002 \u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1 Downloader Middleware \u3002","title":"Downloader middlewares"},{"location":"5. Scrapy\u6269\u5c55/01-Architecture-overview/#spider-middlewares","text":"Spider middlewares\u662f\u4f4d\u4e8e\u5f15\u64ce\u548cSpider\u4e4b\u95f4\u7684\u7279\u5b9ahooks(\u94a9\u5b50)\uff0c\u80fd\u591f\u5904\u7406spider\u8f93\u5165(responses)\u548c\u8f93\u51fa(items and requests)\u3002 \u5982\u679c\u9700\u8981\uff0c\u53ef\u4ee5\u4f7f\u7528Spider middleware spider callbacks\u7684post-process(\u540e)\u5904\u7406\u8f93\u51fa-\u66f4\u6539/\u6dfb\u52a0/\u5220\u9664requests\u6216items; start_requests post-process(\u540e)\u5904\u7406; \u5904\u7406\u8718\u86db\u5f02\u5e38; \u5bf9\u4e00\u4e9b\u57fa\u4e8eresponse\u5185\u5bb9\u7684requests\u8c03\u7528errback\u800c\u4e0d\u662fcallback\u3002 \u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1 Spider Middleware \u3002","title":"Spider middlewares"},{"location":"5. Scrapy\u6269\u5c55/01-Architecture-overview/#_5","text":"Scrapy\u662f\u7528Python\u7684\u4e00\u4e2a\u6d41\u884c\u7684\u4e8b\u4ef6\u9a71\u52a8\u7f51\u7edc\u6846\u67b6 Twisted \u7f16\u5199\u7684\u3002\u56e0\u6b64\uff0c\u5b83\u4f7f\u7528\u975e\u963b\u585e(\u5373\u5f02\u6b65)\u4ee3\u7801\u5b9e\u73b0\u5e76\u53d1\u3002 \u6709\u5173\u5f02\u6b65\u7f16\u7a0b\u548cTwisted\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u4ee5\u4e0b\u94fe\u63a5: Twisted\u7684\u5ef6\u8fdf\u4ecb\u7ecd Twisted - hello\uff0c\u5f02\u6b65\u7f16\u7a0b Twisted\u4ecb\u7ecd - Krondo","title":"\u4e8b\u4ef6\u9a71\u52a8\u7684\u7f51\u7edc"},{"location":"5. Scrapy\u6269\u5c55/02-Downloader-Middleware/","text":"Downloader Middleware downloader middleware\u662f\u8fde\u63a5\u5230Scrapy\u7684request/response\u5904\u7406\u7684\u94a9\u5b50\u6846\u67b6, \u8fd9\u662f\u4e00\u4e2a\u8f7b\u578b\u3001\u4f4e\u5c42\u6b21\u7684\u7cfb\u7edf\uff0c\u7528\u4e8e\u5168\u5c40\u5730\u4fee\u6539Scrapy\u7684requests\u548cresponses\u3002 \u6fc0\u6d3bdownloader middleware \u8981\u6fc0\u6d3bdownloader middleware\u7ec4\u4ef6\uff0c\u5c06\u5176\u6dfb\u52a0\u5230 DOWNLOADER_MIDDLEWARES setting\u4e2d\uff0c\u8be5\u8bbe\u7f6e\u662f\u4e00\u4e2adict\uff0c\u5176\u952e\u662fmiddleware\u7c7b\u8def\u5f84\uff0c\u5176\u503c\u662f\u5bf9\u5e94\u7684\u6570\u5b57\u3002 \u8fd9\u6709\u4e00\u4e2a\u4f8b\u5b50: DOWNLOADER_MIDDLEWARES = { 'myproject.middlewares.CustomDownloaderMiddleware': 543, } DOWNLOADER_MIDDLEWARES setting\u4e0eScrapy(\u5e76\u4e0d\u610f\u5473\u7740\u88ab\u8986\u76d6)\u4e2d\u5b9a\u4e49\u7684 DOWNLOADER_MIDDLEWARES_BASE setting\u5408\u5e76, \u7136\u540e\u6309\u987a\u5e8f\u6392\u5e8f\uff0c\u5f97\u5230\u6700\u7ec8\u7684\u5df2\u542f\u7528middlewares\u7684\u6392\u5e8f\u5217\u8868: \u7b2c\u4e00\u4e2a\u4e2d\u95f4\u4ef6\u79bbengine\u66f4\u8fd1\uff0c\u6700\u540e\u4e00\u4e2a\u4e2d\u95f4\u4ef6\u79bbdownloader\u66f4\u8fd1\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u5c06\u4ee5\u9012\u589e\u7684middleware\u987a\u5e8f(100, 200, 300, \u2026)\u8c03\u7528\u6bcf\u4e2a\u4e2d\u95f4\u4ef6\u7684 process_request() \u65b9\u6cd5, \u5e76\u4e14\u6bcf\u4e2amiddleware\u7684 process_response() \u65b9\u6cd5\u5c06\u6309\u9012\u51cf\u987a\u5e8f\u88ab\u8c03\u7528\u3002 \u8981\u51b3\u5b9a\u5206\u914d\u7ed9middleware\u7684\u987a\u5e8f\uff0c\u8bf7\u67e5\u770b DOWNLOADER_MIDDLEWARES_BASE setting\uff0c\u7136\u540e\u6839\u636e\u9700\u8981\u63d2\u5165middleware\u7684\u4f4d\u7f6e\u9009\u62e9\u4e00\u4e2a\u503c\u3002\u987a\u5e8f\u786e\u5b9e\u5f88\u91cd\u8981\uff0c\u56e0\u4e3a\u6bcf\u4e2amiddleware\u6267\u884c\u4e0d\u540c\u7684\u64cd\u4f5c\uff0c\u800c\u60a8\u7684middleware\u53ef\u80fd\u4f9d\u8d56\u4e8e\u5e94\u7528\u7684\u67d0\u4e9b\u5148\u524d(\u6216\u540e\u7eed)middleware\u3002 \u5982\u679c\u60a8\u60f3\u7981\u7528\u5185\u7f6emiddleware(\u5373 DOWNLOADER_MIDDLEWARES_BASE \u4e2d\u5b9a\u4e49\u5e76\u9ed8\u8ba4\u542f\u7528\u7684middleware)\uff0c\u90a3\u4e48\u60a8\u5fc5\u987b\u5728\u60a8\u7684\u9879\u76ee DOWNLOADER_MIDDLEWARES setting\u4e2d\u5b9a\u4e49\u5b83\uff0c\u5e76\u6307\u5b9aNone\u4f5c\u4e3a\u5176\u503c\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u60f3\u7981\u7528user-agent middleware: DOWNLOADER_MIDDLEWARES = { 'myproject.middlewares.CustomDownloaderMiddleware': 543, 'scrapy.downloadermiddlewares.useragent.UserAgentMiddleware': None, } \u6700\u540e\uff0c\u8bf7\u8bb0\u4f4f\uff0c\u4e00\u4e9bmiddleware\u53ef\u80fd\u9700\u8981\u901a\u8fc7\u7279\u5b9a\u7684setting\u6765\u542f\u7528\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u6bcf\u4e2amiddleware\u6587\u6863\u3002 \u7f16\u5199\u81ea\u5df1\u7684downloader middleware \u6bcf\u4e2amiddleware\u7ec4\u4ef6\u90fd\u662f\u4e00\u4e2aPython\u7c7b\uff0c\u5b83\u5b9a\u4e49\u4e86\u4e00\u4e2a\u6216\u591a\u4e2a\u4ee5\u4e0b\u65b9\u6cd5: scrapy.downloadermiddlewares.DownloaderMiddleware \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) \u4efb\u4f55downloader middleware\u65b9\u6cd5\u4e5f\u53ef\u80fd\u8fd4\u56de\u5ef6\u8fdf\u3002 process_request(request, spider) \u5bf9\u4e8e\u901a\u8fc7download middleware\u7684\u6bcf\u4e2a\u8bf7\u6c42\u90fd\u8c03\u7528\u6b64\u65b9\u6cd5\u3002 process_request() \u5e94\u8be5:\u8fd4\u56de None \u3001\u8fd4\u56de Response \u5bf9\u8c61\u3001\u8fd4\u56de Request \u5bf9\u8c61\u6216\u629b\u51fa IgnoreRequest \u3002 \u5982\u679c\u5b83\u8fd4\u56de None \uff0cScrapy\u5c06\u7ee7\u7eed\u5904\u7406\u8fd9\u4e2arequest\uff0c\u6267\u884c\u6240\u6709\u5176\u4ed6middleware\uff0c\u76f4\u5230\u6700\u540e\u8c03\u7528\u6240\u6267\u884c\u7684\u8bf7\u6c42(\u4ee5\u53ca\u4e0b\u8f7d\u7684response)\u3002 \u5982\u679c\u8fd4\u56de Response \u5bf9\u8c61\uff0cScrapy\u5c31\u4e0d\u4f1a\u8c03\u7528\u4efb\u4f55\u5176\u4ed6 process_request() \u6216 process_exception() \u65b9\u6cd5\u6216\u9002\u5f53\u7684\u4e0b\u8f7d\u51fd\u6570;\u5b83\u4f1a\u8fd4\u56de\u90a3\u4e2aresponse\u3002\u5bf9\u6bcf\u4e2aresponse\u90fd\u8c03\u7528\u5df2\u5b89\u88c5middleware\u7684 process_response() \u65b9\u6cd5\u3002 \u5982\u679c\u8fd4\u56de Request \u5bf9\u8c61\uff0cScrapy\u5c06\u505c\u6b62\u8c03\u7528process_request\u65b9\u6cd5\u5e76\u91cd\u65b0\u8c03\u5ea6\u8fd4\u56de\u7684request\u3002\u4e00\u65e6\u6267\u884c\u4e86\u65b0\u8fd4\u56de\u7684request\uff0c\u5c06\u5bf9\u4e0b\u8f7d\u7684response\u8c03\u7528\u9002\u5f53\u7684middleware\u94fe\u3002 \u5982\u679c\u5b83\u629b\u51fa\u4e86 IgnoreRequest \u5f02\u5e38\uff0c\u90a3\u4e48\u5c06\u8c03\u7528\u5df2\u5b89\u88c5\u7684downloader middleware\u7684 process_exception() \u65b9\u6cd5\u3002\u5982\u679c\u5b83\u4eec\u90fd\u4e0d\u5904\u7406\u5f02\u5e38\uff0c\u5219\u8c03\u7528request( Request.errback )\u51fd\u6570\u3002\u5982\u679c\u6ca1\u6709\u4ee3\u7801\u5904\u7406\u5f15\u53d1\u7684\u5f02\u5e38\uff0c\u5b83\u5c06\u88ab\u5ffd\u7565\u4e14\u4e0d\u88ablog(\u4e0e\u5176\u4ed6\u5f02\u5e38\u4e0d\u540c)\u3002 \u53c2\u6570: request ( Request \u5bf9\u8c61) \u2013 \u6b63\u5728\u5904\u7406\u7684\u8bf7\u6c42 spider ( Spider \u5bf9\u8c61) \u2013 \u6b64request\u6240\u9488\u5bf9\u7684spider process_response(request, response, spider) process_response() \u5e94\u8be5:\u8fd4\u56de\u4e00\u4e2a Response \u5bf9\u8c61\uff0c\u8fd4\u56de\u4e00\u4e2a Request \u5bf9\u8c61\uff0c\u6216\u8005\u629b\u51fa\u4e00\u4e2a IgnoreRequest \u5f02\u5e38\u3002 \u5982\u679c\u5b83\u8fd4\u56de\u4e00\u4e2a Response (\u53ef\u4ee5\u662f\u76f8\u540c\u7684\u7ed9\u5b9aresponse\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u5168\u65b0\u7684response)\uff0c\u90a3\u4e48\u8be5response\u5c06\u7ee7\u7eed\u4f7f\u7528\u94fe\u4e2d\u4e0b\u4e00\u4e2amiddleware\u7684 process_response() \u8fdb\u884c\u5904\u7406\u3002 \u5982\u679c\u5b83\u8fd4\u56de\u4e00\u4e2a Request \u5bf9\u8c61\uff0c\u5219middleware\u94fe\u5c06\u505c\u6b62\uff0c\u8fd4\u56de\u7684request\u5c06\u91cd\u65b0\u8c03\u5ea6\uff0c\u4ee5\u4fbf\u5c06\u6765\u4e0b\u8f7d\u3002\u8fd9\u4e0e\u4ece process_request() \u8fd4\u56derequest\u7684\u884c\u4e3a\u76f8\u540c\u3002 \u5982\u679c\u5b83\u629b\u51fa\u4e86 IgnoreRequest \u5f02\u5e38\uff0c\u5c31\u4f1a\u8c03\u7528request\u7684( Request.errback )\u51fd\u6570\u3002\u5982\u679c\u6ca1\u6709\u4ee3\u7801\u5904\u7406\u5f15\u53d1\u7684\u5f02\u5e38\uff0c\u5b83\u5c06\u88ab\u5ffd\u7565\u4e14\u4e0d\u88ablog(\u4e0e\u5176\u4ed6\u5f02\u5e38\u4e0d\u540c)\u3002 \u53c2\u6570: request (\u662f\u4e00\u4e2a Request \u5bf9\u8c61) \u2013 \u53d1\u8d77response\u7684request response ( Response \u5bf9\u8c61) \u2013 \u6b63\u5728\u5904\u7406\u7684response spider ( Spider \u5bf9\u8c61) \u2013 \u7528\u4e8e\u6b64ersponse\u7684spider process_exception(request, exception, spider) \u5f53download handler\u6216 process_request() (\u6765\u81eadownloader middleware)\u5f15\u53d1\u5f02\u5e38(\u5305\u62ec IgnoreRequest \u5f02\u5e38)\u65f6\uff0cScrapy\u4f1a\u8c03\u7528 process_exception() process_exception() \u5e94\u8be5\u8fd4\u56de: None \u3001 Response \u5bf9\u8c61\u6216 Request \u5bf9\u8c61\u3002 \u5982\u679c\u5b83\u8fd4\u56de None \uff0cScrapy\u5c06\u7ee7\u7eed\u5904\u7406\u8fd9\u4e2a\u5f02\u5e38\uff0c\u6267\u884c\u5df2\u5b89\u88c5middleware\u7684\u4efb\u4f55\u5176\u4ed6 process_exception() \u65b9\u6cd5\uff0c\u76f4\u5230\u6ca1\u6709middleware\u5b58\u5728\u5e76\u542f\u52a8\u9ed8\u8ba4\u5f02\u5e38\u5904\u7406\u4e3a\u6b62\u3002 \u5982\u679c\u5b83\u8fd4\u56de\u4e00\u4e2a Response \u5bf9\u8c61\uff0c\u5219\u542f\u52a8\u5df2\u5b89\u88c5\u4e2d\u95f4\u4ef6\u7684 process_response() \u65b9\u6cd5\u94fe\uff0cScrapy\u4e0d\u4f1a\u8c03\u7528middleware\u7684\u4efb\u4f55\u5176\u4ed6 process_exception() \u65b9\u6cd5\u3002 \u5982\u679c\u8fd4\u56de\u4e00\u4e2a Request \u5bf9\u8c61\uff0c\u8fd4\u56de\u7684request\u5c06\u88ab\u91cd\u65b0\u8c03\u5ea6\uff0c\u4ee5\u4fbf\u4ee5\u540e\u4e0b\u8f7d\u3002\u8fd9\u5c06\u505c\u6b62middleware\u7684process_exception()\u65b9\u6cd5\u7684\u6267\u884c\uff0c\u5c31\u50cf\u8fd4\u56deresponse\u4e00\u6837\u3002 \u53c2\u6570: request (\u662f\u4e00\u4e2a Request \u5bf9\u8c61) \u2013 \u751f\u6210\u5f02\u5e38\u7684request exception (\u4e00\u4e2a Exception \u5bf9\u8c61) \u2013 \u5f15\u53d1\u5f02\u5e38 spider ( Spider \u5bf9\u8c61) \u2013 \u6b64request\u6240\u9488\u5bf9\u7684spider from_crawler(cls, crawler) \u5982\u679c\u5b58\u5728\uff0c\u5219\u8c03\u7528\u8fd9\u4e2a\u7c7b\u65b9\u6cd5\u6765\u4ece Crawler \u4e2d\u521b\u5efamiddleware\u5b9e\u4f8b\u3002\u5b83\u5fc5\u987b\u8fd4\u56demiddleware\u7684\u65b0\u5b9e\u4f8b\u3002Crawler\u5bf9\u8c61\u63d0\u4f9b\u8bbf\u95ee\u6240\u6709Scrapy\u7684\u6838\u5fc3\u7ec4\u4ef6\uff0c\u5982settings(\u8bbe\u7f6e)\u548csignals(\u4fe1\u53f7);\u5bf9\u4e8emiddleware\u6765\u8bf4\uff0c\u8fd9\u662f\u4e00\u79cd\u8bbf\u95ee\u5b83\u4eec\u5e76\u5c06\u5176\u529f\u80fd\u4e0eScrapy\u6302\u94a9\u7684\u65b9\u5f0f\u3002 \u53c2\u6570: crawler ( Crawler \u5bf9\u8c61) \u2013 \u4f7f\u7528\u6b64middleware\u7684crawler \u5185\u7f6edownloader middleware\u5f15\u7528 \u8fd9\u4e2a\u9875\u9762\u63cf\u8ff0\u4e86\u6240\u6709\u4e0eScrapy\u4e00\u8d77\u63d0\u4f9b\u7684downloader middleware\u3002\u6709\u5173\u5982\u4f55\u4f7f\u7528\u5b83\u4eec\u4ee5\u53ca\u5982\u4f55\u7f16\u5199\u81ea\u5df1\u7684downloader\u4e2d\u95f4\u4ef6\u7684\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 downloader middleware\u4f7f\u7528\u6307\u5357 \u3002 CookiesMiddleware scrapy.downloadermiddlewares.cookies.CookiesMiddleware \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) \u8fd9\u4e2amiddleware\u652f\u6301\u4f7f\u7528\u9700\u8981cookie\u7684\u7ad9\u70b9\uff0c\u6bd4\u5982\u4f7f\u7528session\u7684\u7ad9\u70b9\u3002\u5b83\u8ddf\u8e2aweb\u670d\u52a1\u5668\u53d1\u9001\u7684cookie\uff0c\u5e76\u5728\u540e\u7eed\u8bf7\u6c42(\u6765\u81ea\u8be5spider)\u65f6\u5c06\u5176\u53d1\u56de\uff0c\u5c31\u50cfweb\u6d4f\u89c8\u5668\u4e00\u6837\u3002 \u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0bsettings\u914d\u7f6ecookie middleware: COOKIES_ENABLED COOKIES_DEBUG \u6bcf\u4e2a\u722c\u884c\u5668\u6709\u591a\u4e2acookie sessions 0.15\u7248\u672c\u6700\u65b0\u529f\u80fd \u901a\u8fc7\u4f7f\u7528 cookiejar Request meta\u952e\uff0c\u53ef\u4ee5\u4e3a\u6bcf\u4e2aspider\u4fdd\u5b58\u591a\u4e2acookie sessions\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5b83\u4f7f\u7528\u4e00\u4e2acookie jar(session)\uff0c\u4f46\u662f\u60a8\u53ef\u4ee5\u4f20\u9012\u4e00\u4e2a\u6807\u8bc6\u7b26\u6765\u4f7f\u7528\u4e0d\u540c\u7684cookie jar\u3002 \u4f8b\u5b50: for i, url in enumerate(urls): yield scrapy.Request(url, meta={'cookiejar': i}, callback=self.parse_page) \u8bb0\u4f4f\uff0ccookiejar\u5143\u952e\u4e0d\u662f\u201c\u7c98\u201d\u7684\u3002\u60a8\u9700\u8981\u5728\u540e\u7eed\u7684request\u4e2d\u7ee7\u7eed\u624b\u52a8\u4f20\u9012\u5b83\u3002\u4f8b\u5982: def parse_page(self, response): # \u505a\u4e00\u4e9b\u5904\u7406 return scrapy.Request( http://www.example.com/otherpage , meta={'cookiejar': response.meta['cookiejar']}, callback=self.parse_other_page) COOKIES_ENABLED \u9ed8\u8ba4: True \u662f\u5426\u542f\u7528cookies middleware\u3002\u5982\u679c\u7981\u7528\uff0c\u5219\u4e0d\u4f1a\u5c06cookie\u53d1\u9001\u5230web\u670d\u52a1\u5668\u3002 \u8bf7\u6ce8\u610f\uff0c\u5982\u679c Request. meta['dont_merge_cookies'] \u7684\u503c\u4e3a True \uff0c\u5219\u5c3d\u7ba1\u8bbe\u7f6e\u4e86 COOKIES_ENABLED setting\uff0c\u4f46request cookie \u4e0d \u4f1a\u88ab\u53d1\u9001\u5230web\u670d\u52a1\u5668\uff0c\u5e76\u4e14\u63a5\u6536\u5230\u7684 Response cookie\u4e0d\u4f1a\u4e0e\u73b0\u6709cookie\u5408\u5e76\u3002 \u6709\u5173\u66f4\u8be6\u7ec6\u7684\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Request \u4e2d\u7684 cookie \u53c2\u6570\u3002 COOKIES_DEBUG \u9ed8\u8ba4: False \u5982\u679c\u542f\u7528\u4e86\uff0cScrapy\u5c06log\u6240\u6709\u53d1\u9001requests\u7684cookie(\u5373\u3002 Cookie header)\u548c\u6240\u6709\u7684cookies\u63a5\u6536\u5230\u7684responses(\u5373\u3002 Set-Cookie header)\u3002 \u4e0b\u9762\u662f\u4e00\u4e2a\u542f\u7528\u4e86 COOKIES_DEBUG \u7684log: 2011-04-06 14:35:10-0300 [scrapy.core.engine] INFO: Spider opened 2011-04-06 14:35:10-0300 [scrapy.downloadermiddlewares.cookies] DEBUG: Sending cookies to: GET http://www.diningcity.com/netherlands/index.html Cookie: clientlanguage_nl=en_EN 2011-04-06 14:35:14-0300 [scrapy.downloadermiddlewares.cookies] DEBUG: Received cookies from: 200 http://www.diningcity.com/netherlands/index.html Set-Cookie: JSESSIONID=B~FA4DC0C496C8762AE4F1A620EAB34F38; Path=/ Set-Cookie: ip_isocode=US Set-Cookie: clientlanguage_nl=en_EN; Expires=Thu, 07-Apr-2011 21:21:34 GMT; Path=/ 2011-04-06 14:49:50-0300 [scrapy.core.engine] DEBUG: Crawled (200) GET http://www.diningcity.com/netherlands/index.html (referer: None) [...] DefaultHeadersMiddleware scrapy.downloadermiddlewares.defaultheaders.DefaultHeadersMiddleware \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) \u6b64middleware\u8bbe\u7f6e DEFAULT_REQUEST_HEADERS setting\u4e2d\u6307\u5b9a\u7684\u6240\u6709\u9ed8\u8ba4requests headers\u3002 DownloadTimeoutMiddleware scrapy.downloadermiddlewares.downloadtimeout.DownloadTimeoutMiddleware \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) \u6b64middleware\u4e3a DOWNLOAD_TIMEOUT setting\u6216 DOWNLOAD_TIMEOUT spider\u5c5e\u6027\u4e2d\u6307\u5b9a\u7684requests\u8bbe\u7f6edownload timeout\u3002 \u8fd8\u53ef\u4ee5\u4f7f\u7528[download_timeout](#) Request.meta\u952e\u4e3a\u6bcf\u4e2arequest\u8bbe\u7f6edownload timeout; \u5373\u4f7f\u7981\u7528\u4e86DownloadTimeoutMiddleware\uff0c\u4e5f\u53ef\u4ee5\u652f\u6301\u8fd9\u4e00\u529f\u80fd\u3002 HttpAuthMiddleware scrapy.downloadermiddlewares.httpauth.HttpAuthMiddleware \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) \u6b64middleware\u4f7f\u7528 \u57fa\u672c\u8bbf\u95ee\u8eab\u4efd\u9a8c\u8bc1 (\u53c8\u540dHTTP auth)\u5bf9\u67d0\u4e9bspider\u751f\u6210\u7684\u6240\u6709request\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u3002 \u8981\u542f\u7528\u6765\u81ea\u67d0\u4e9bspider\u7684HTTP\u8eab\u4efd\u9a8c\u8bc1\uff0c\u8bf7\u8bbe\u7f6e\u8fd9\u4e9bspider\u7684http_user\u548chttp_pass spiders\u5c5e\u6027\u3002 \u4f8b\u5b50: from scrapy.spiders import CrawlSpider class SomeIntranetSiteSpider(CrawlSpider): http_user = 'someuser' http_pass = 'somepass' name = 'intranet.example.com' # .. \u5176\u4ed6spider\u5ffd\u7565\u4e86 ... HttpCacheMiddleware scrapy.downloadermiddlewares.httpcache.HttpCacheMiddleware \u8fd9\u662f\u4e00\u4e2a\u7c7b(class) \u8be5middleware\u4e3a\u6240\u6709HTTP requests\u548cresponse\u63d0\u4f9b\u4f4e\u7ea7\u7f13\u5b58\u3002\u5b83\u5fc5\u987b\u4e0e\u7f13\u5b58\u5b58\u50a8\u540e\u7aef\u4ee5\u53ca\u7f13\u5b58\u7b56\u7565\u76f8\u7ed3\u5408\u3002 Scrapy\u9644\u5e26\u4e86\u4e09\u4e2aHTTP\u7f13\u5b58\u5b58\u50a8\u540e\u7aef \u6587\u4ef6\u7cfb\u7edf\u5b58\u50a8\u540e\u7aef(\u9ed8\u8ba4) DBM\u5b58\u50a8\u540e\u7aef LevelDB\u5b58\u50a8\u540e\u7aef \u60a8\u53ef\u4ee5\u4f7f\u7528 HTTPCACHE_STORAGE setting\u6765\u66f4\u6539HTTP\u7f13\u5b58\u5b58\u50a8\u540e\u7aef\u3002\u6216\u8005\u4e5f\u53ef\u4ee5\u5b9e\u73b0\u81ea\u5df1\u7684\u5b58\u50a8\u540e\u7aef\u3002 Scrapy\u9644\u5e26\u4e86\u4e24\u4e2aHTTP\u7f13\u5b58\u7b56\u7565: RFC2616\u7b56\u7565 Dummy\u7b56\u7565(\u9ed8\u8ba4) \u60a8\u53ef\u4ee5\u4f7f\u7528 HTTPCACHE_POLICY \u8bbe\u7f6e\u66f4\u6539HTTP\u7f13\u5b58\u7b56\u7565\u3002\u6216\u8005\u60a8\u4e5f\u53ef\u4ee5\u6267\u884c\u81ea\u5df1\u7684\u7b56\u7565\u3002 \u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528 dont_cache meta\u952e = True\u907f\u514d\u5728\u6bcf\u4e2a\u7b56\u7565\u4e0a\u7f13\u5b58\u54cd\u5e94\u3002 Dummy\u7b56\u7565(\u9ed8\u8ba4) \u6b64\u7b56\u7565\u4e0d\u77e5\u9053\u4efb\u4f55HTTP\u7f13\u5b58\u63a7\u5236\u6307\u4ee4\u3002\u6bcf\u4e2arequest\u53ca\u5176\u76f8\u5e94\u7684response\u90fd\u88ab\u7f13\u5b58\u3002\u5f53\u518d\u6b21\u770b\u5230\u76f8\u540c\u7684request\u65f6\uff0c\u76f4\u63a5\u5c06\u8fd4\u56deresponse\uff0c\u800c\u4e0d\u4f1a\u4eceInternet\u4f20\u8f93\u4efb\u4f55\u5185\u5bb9\u3002 Dummy\u7b56\u7565\u5bf9\u4e8e\u66f4\u5feb\u5730\u6d4b\u8bd5spider(\u65e0\u9700\u6bcf\u6b21\u90fd\u7b49\u5f85\u4e0b\u8f7d)\u548c\u5728Internet\u8fde\u63a5\u4e0d\u53ef\u7528\u65f6\u8131\u673a\u5c1d\u8bd5spider\u975e\u5e38\u6709\u7528\u3002\u6211\u4eec\u7684\u76ee\u6807\u662f\u80fd\u591f\u201creplay\u201d spider\u7684\u8fd0\u884c\u8fc7\u7a0b\uff0c\u5c31\u50cf\u4ee5\u524d\u4e00\u6837\u3002 \u4e3a\u4e86\u4f7f\u7528\u6b64\u7b56\u7565\uff0cset: HTTPCACHE_POLICY \u8bbe\u7f6e scrapy.extensions.httpcache.DummyPolicy RFC2616\u7b56\u7565 \u8be5\u7b56\u7565\u63d0\u4f9b\u4e86RFC2616\u517c\u5bb9\u7684HTTP\u7f13\u5b58\uff0c\u5373\u5177\u6709HTTP\u7f13\u5b58\u63a7\u5236\u610f\u8bc6\uff0c\u5e76\u7528\u4e8e\u8fde\u7eed\u8fd0\u884c\uff0c\u4ee5\u907f\u514d\u4e0b\u8f7d\u672a\u7ecf\u4fee\u6539\u7684\u6570\u636e(\u8282\u7701\u5e26\u5bbd\u548c\u52a0\u5feb\u722c\u866b)\u3002 \u5982\u4f55\u5b9e\u73b0: \u4e0d\u5c1d\u8bd5\u5b58\u50a8responses/requests\u4e0eno-store cache-control\u6307\u4ee4\u96c6 \u5982\u679c\u6ca1\u6709no-cache cache-control\uff0c\u5373\u4f7f\u662f\u65b0\u7684responses\uff0c\u4e5f\u4e0d\u8981\u63d0\u4f9b\u6765\u81ea\u7f13\u5b58\u7684\u54cd\u5e94 \u4ecemax-age\u7f13\u5b58\u63a7\u5236\u6307\u4ee4\u8ba1\u7b97\u65b0\u9c9c\u5ea6\u751f\u547d\u5468\u671f \u4eceExpires response header\u8ba1\u7b97\u65b0\u9c9c\u5ea6\u751f\u547d\u5468\u671f \u4eceLast-Modified response header\u8ba1\u7b97\u65b0\u9c9c\u5ea6\u751f\u547d\u5468\u671f(Firefox\u4f7f\u7528heuristic) \u4eceAge response header\u8ba1\u7b97\u5f53\u524dage \u4eceDate header\u8ba1\u7b97\u5f53\u524dage \u6839\u636eLast-Modified response header\u91cd\u65b0\u9a8c\u8bc1\u9648\u65e7\u7684response \u6839\u636eETag response header\u91cd\u65b0\u9a8c\u8bc1\u9648\u65e7\u7684response \u4e3a\u4efb\u4f55\u672a\u6536\u5230\u7684response\u8bbe\u7f6eDate header \u5728requests\u4e2d\u652f\u6301max-stale cache-control\u6307\u4ee4 \u8fd9\u5141\u8bb8\u4f7f\u7528\u5b8c\u6574\u7684RFC2616\u7f13\u5b58\u7b56\u7565\u914d\u7f6espider\uff0c\u4f46\u907f\u514d\u5728\u9010\u4e2arequest\u7684\u57fa\u7840\u4e0a\u91cd\u65b0\u9a8c\u8bc1\uff0c\u540c\u65f6\u4fdd\u6301\u4e0eHTTP\u89c4\u8303\u7684\u4e00\u81f4\u6027\u3002 \u4f8b\u5b50 \u5411Request headers\u6dfb\u52a0Cache-Control: max-stale=600\uff0c\u4ee5\u63a5\u53d7\u8d85\u8fc7\u8fc7\u671f\u65f6\u95f4\u4e0d\u8d85\u8fc7600\u79d2\u7684responses\u3002 \u53c2\u89c1:RFC2616, 14.9.3 \u7f3a\u4e86\u4ec0\u4e48: Pragma: no - cache\u652f\u6301 https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.9.1 Vary header\u652f\u6301 https://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html#sec13.6 \u66f4\u65b0\u6216\u5220\u9664 https://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html#sec13.10 \u540e\u65e0\u6548 probably others \u4e3a\u4e86\u4f7f\u7528\u6b64\u7b56\u7565\uff0c\u8bbe\u7f6e: HTTPCACHE_POLICY \u53d8\u6210 scrapy.extensions.httpcache.RFC2616Policy \u6587\u4ef6\u7cfb\u7edf\u5b58\u50a8\u540e\u7aef(\u9ed8\u8ba4) HTTP\u7f13\u5b58middleware\u7684\u6587\u4ef6\u7cfb\u7edf\u5b58\u50a8\u540e\u7aef\u53ef\u7528\u4e8eHTTP cache middleware\u3002 \u4e3a\u4e86\u4f7f\u7528\u8fd9\u4e2a\u5b58\u50a8\u540e\u7aef\uff0c\u8bbe\u7f6e: HTTPCACHE_STORAGE \u53d8\u6210 scrapy.extensions.httpcache.FilesystemCacheStorage \u6bcf\u4e2arequest/response\u5bf9\u5b58\u50a8\u5728\u4e0d\u540c\u7684\u76ee\u5f55\u4e2d\uff0c\u5176\u4e2d\u5305\u542b\u4ee5\u4e0b\u6587\u4ef6: request_body - request body request_headers -","title":"Downloader Middleware"},{"location":"5. Scrapy\u6269\u5c55/02-Downloader-Middleware/#downloader-middleware","text":"downloader middleware\u662f\u8fde\u63a5\u5230Scrapy\u7684request/response\u5904\u7406\u7684\u94a9\u5b50\u6846\u67b6, \u8fd9\u662f\u4e00\u4e2a\u8f7b\u578b\u3001\u4f4e\u5c42\u6b21\u7684\u7cfb\u7edf\uff0c\u7528\u4e8e\u5168\u5c40\u5730\u4fee\u6539Scrapy\u7684requests\u548cresponses\u3002","title":"Downloader Middleware"},{"location":"5. Scrapy\u6269\u5c55/02-Downloader-Middleware/#downloader-middleware_1","text":"\u8981\u6fc0\u6d3bdownloader middleware\u7ec4\u4ef6\uff0c\u5c06\u5176\u6dfb\u52a0\u5230 DOWNLOADER_MIDDLEWARES setting\u4e2d\uff0c\u8be5\u8bbe\u7f6e\u662f\u4e00\u4e2adict\uff0c\u5176\u952e\u662fmiddleware\u7c7b\u8def\u5f84\uff0c\u5176\u503c\u662f\u5bf9\u5e94\u7684\u6570\u5b57\u3002 \u8fd9\u6709\u4e00\u4e2a\u4f8b\u5b50: DOWNLOADER_MIDDLEWARES = { 'myproject.middlewares.CustomDownloaderMiddleware': 543, } DOWNLOADER_MIDDLEWARES setting\u4e0eScrapy(\u5e76\u4e0d\u610f\u5473\u7740\u88ab\u8986\u76d6)\u4e2d\u5b9a\u4e49\u7684 DOWNLOADER_MIDDLEWARES_BASE setting\u5408\u5e76, \u7136\u540e\u6309\u987a\u5e8f\u6392\u5e8f\uff0c\u5f97\u5230\u6700\u7ec8\u7684\u5df2\u542f\u7528middlewares\u7684\u6392\u5e8f\u5217\u8868: \u7b2c\u4e00\u4e2a\u4e2d\u95f4\u4ef6\u79bbengine\u66f4\u8fd1\uff0c\u6700\u540e\u4e00\u4e2a\u4e2d\u95f4\u4ef6\u79bbdownloader\u66f4\u8fd1\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u5c06\u4ee5\u9012\u589e\u7684middleware\u987a\u5e8f(100, 200, 300, \u2026)\u8c03\u7528\u6bcf\u4e2a\u4e2d\u95f4\u4ef6\u7684 process_request() \u65b9\u6cd5, \u5e76\u4e14\u6bcf\u4e2amiddleware\u7684 process_response() \u65b9\u6cd5\u5c06\u6309\u9012\u51cf\u987a\u5e8f\u88ab\u8c03\u7528\u3002 \u8981\u51b3\u5b9a\u5206\u914d\u7ed9middleware\u7684\u987a\u5e8f\uff0c\u8bf7\u67e5\u770b DOWNLOADER_MIDDLEWARES_BASE setting\uff0c\u7136\u540e\u6839\u636e\u9700\u8981\u63d2\u5165middleware\u7684\u4f4d\u7f6e\u9009\u62e9\u4e00\u4e2a\u503c\u3002\u987a\u5e8f\u786e\u5b9e\u5f88\u91cd\u8981\uff0c\u56e0\u4e3a\u6bcf\u4e2amiddleware\u6267\u884c\u4e0d\u540c\u7684\u64cd\u4f5c\uff0c\u800c\u60a8\u7684middleware\u53ef\u80fd\u4f9d\u8d56\u4e8e\u5e94\u7528\u7684\u67d0\u4e9b\u5148\u524d(\u6216\u540e\u7eed)middleware\u3002 \u5982\u679c\u60a8\u60f3\u7981\u7528\u5185\u7f6emiddleware(\u5373 DOWNLOADER_MIDDLEWARES_BASE \u4e2d\u5b9a\u4e49\u5e76\u9ed8\u8ba4\u542f\u7528\u7684middleware)\uff0c\u90a3\u4e48\u60a8\u5fc5\u987b\u5728\u60a8\u7684\u9879\u76ee DOWNLOADER_MIDDLEWARES setting\u4e2d\u5b9a\u4e49\u5b83\uff0c\u5e76\u6307\u5b9aNone\u4f5c\u4e3a\u5176\u503c\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u60f3\u7981\u7528user-agent middleware: DOWNLOADER_MIDDLEWARES = { 'myproject.middlewares.CustomDownloaderMiddleware': 543, 'scrapy.downloadermiddlewares.useragent.UserAgentMiddleware': None, } \u6700\u540e\uff0c\u8bf7\u8bb0\u4f4f\uff0c\u4e00\u4e9bmiddleware\u53ef\u80fd\u9700\u8981\u901a\u8fc7\u7279\u5b9a\u7684setting\u6765\u542f\u7528\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u6bcf\u4e2amiddleware\u6587\u6863\u3002","title":"\u6fc0\u6d3bdownloader middleware"},{"location":"5. Scrapy\u6269\u5c55/02-Downloader-Middleware/#downloader-middleware_2","text":"\u6bcf\u4e2amiddleware\u7ec4\u4ef6\u90fd\u662f\u4e00\u4e2aPython\u7c7b\uff0c\u5b83\u5b9a\u4e49\u4e86\u4e00\u4e2a\u6216\u591a\u4e2a\u4ee5\u4e0b\u65b9\u6cd5:","title":"\u7f16\u5199\u81ea\u5df1\u7684downloader middleware"},{"location":"5. Scrapy\u6269\u5c55/02-Downloader-Middleware/#scrapydownloadermiddlewaresdownloadermiddleware-class","text":"\u4efb\u4f55downloader middleware\u65b9\u6cd5\u4e5f\u53ef\u80fd\u8fd4\u56de\u5ef6\u8fdf\u3002 process_request(request, spider) \u5bf9\u4e8e\u901a\u8fc7download middleware\u7684\u6bcf\u4e2a\u8bf7\u6c42\u90fd\u8c03\u7528\u6b64\u65b9\u6cd5\u3002 process_request() \u5e94\u8be5:\u8fd4\u56de None \u3001\u8fd4\u56de Response \u5bf9\u8c61\u3001\u8fd4\u56de Request \u5bf9\u8c61\u6216\u629b\u51fa IgnoreRequest \u3002 \u5982\u679c\u5b83\u8fd4\u56de None \uff0cScrapy\u5c06\u7ee7\u7eed\u5904\u7406\u8fd9\u4e2arequest\uff0c\u6267\u884c\u6240\u6709\u5176\u4ed6middleware\uff0c\u76f4\u5230\u6700\u540e\u8c03\u7528\u6240\u6267\u884c\u7684\u8bf7\u6c42(\u4ee5\u53ca\u4e0b\u8f7d\u7684response)\u3002 \u5982\u679c\u8fd4\u56de Response \u5bf9\u8c61\uff0cScrapy\u5c31\u4e0d\u4f1a\u8c03\u7528\u4efb\u4f55\u5176\u4ed6 process_request() \u6216 process_exception() \u65b9\u6cd5\u6216\u9002\u5f53\u7684\u4e0b\u8f7d\u51fd\u6570;\u5b83\u4f1a\u8fd4\u56de\u90a3\u4e2aresponse\u3002\u5bf9\u6bcf\u4e2aresponse\u90fd\u8c03\u7528\u5df2\u5b89\u88c5middleware\u7684 process_response() \u65b9\u6cd5\u3002 \u5982\u679c\u8fd4\u56de Request \u5bf9\u8c61\uff0cScrapy\u5c06\u505c\u6b62\u8c03\u7528process_request\u65b9\u6cd5\u5e76\u91cd\u65b0\u8c03\u5ea6\u8fd4\u56de\u7684request\u3002\u4e00\u65e6\u6267\u884c\u4e86\u65b0\u8fd4\u56de\u7684request\uff0c\u5c06\u5bf9\u4e0b\u8f7d\u7684response\u8c03\u7528\u9002\u5f53\u7684middleware\u94fe\u3002 \u5982\u679c\u5b83\u629b\u51fa\u4e86 IgnoreRequest \u5f02\u5e38\uff0c\u90a3\u4e48\u5c06\u8c03\u7528\u5df2\u5b89\u88c5\u7684downloader middleware\u7684 process_exception() \u65b9\u6cd5\u3002\u5982\u679c\u5b83\u4eec\u90fd\u4e0d\u5904\u7406\u5f02\u5e38\uff0c\u5219\u8c03\u7528request( Request.errback )\u51fd\u6570\u3002\u5982\u679c\u6ca1\u6709\u4ee3\u7801\u5904\u7406\u5f15\u53d1\u7684\u5f02\u5e38\uff0c\u5b83\u5c06\u88ab\u5ffd\u7565\u4e14\u4e0d\u88ablog(\u4e0e\u5176\u4ed6\u5f02\u5e38\u4e0d\u540c)\u3002 \u53c2\u6570: request ( Request \u5bf9\u8c61) \u2013 \u6b63\u5728\u5904\u7406\u7684\u8bf7\u6c42 spider ( Spider \u5bf9\u8c61) \u2013 \u6b64request\u6240\u9488\u5bf9\u7684spider process_response(request, response, spider) process_response() \u5e94\u8be5:\u8fd4\u56de\u4e00\u4e2a Response \u5bf9\u8c61\uff0c\u8fd4\u56de\u4e00\u4e2a Request \u5bf9\u8c61\uff0c\u6216\u8005\u629b\u51fa\u4e00\u4e2a IgnoreRequest \u5f02\u5e38\u3002 \u5982\u679c\u5b83\u8fd4\u56de\u4e00\u4e2a Response (\u53ef\u4ee5\u662f\u76f8\u540c\u7684\u7ed9\u5b9aresponse\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u5168\u65b0\u7684response)\uff0c\u90a3\u4e48\u8be5response\u5c06\u7ee7\u7eed\u4f7f\u7528\u94fe\u4e2d\u4e0b\u4e00\u4e2amiddleware\u7684 process_response() \u8fdb\u884c\u5904\u7406\u3002 \u5982\u679c\u5b83\u8fd4\u56de\u4e00\u4e2a Request \u5bf9\u8c61\uff0c\u5219middleware\u94fe\u5c06\u505c\u6b62\uff0c\u8fd4\u56de\u7684request\u5c06\u91cd\u65b0\u8c03\u5ea6\uff0c\u4ee5\u4fbf\u5c06\u6765\u4e0b\u8f7d\u3002\u8fd9\u4e0e\u4ece process_request() \u8fd4\u56derequest\u7684\u884c\u4e3a\u76f8\u540c\u3002 \u5982\u679c\u5b83\u629b\u51fa\u4e86 IgnoreRequest \u5f02\u5e38\uff0c\u5c31\u4f1a\u8c03\u7528request\u7684( Request.errback )\u51fd\u6570\u3002\u5982\u679c\u6ca1\u6709\u4ee3\u7801\u5904\u7406\u5f15\u53d1\u7684\u5f02\u5e38\uff0c\u5b83\u5c06\u88ab\u5ffd\u7565\u4e14\u4e0d\u88ablog(\u4e0e\u5176\u4ed6\u5f02\u5e38\u4e0d\u540c)\u3002 \u53c2\u6570: request (\u662f\u4e00\u4e2a Request \u5bf9\u8c61) \u2013 \u53d1\u8d77response\u7684request response ( Response \u5bf9\u8c61) \u2013 \u6b63\u5728\u5904\u7406\u7684response spider ( Spider \u5bf9\u8c61) \u2013 \u7528\u4e8e\u6b64ersponse\u7684spider process_exception(request, exception, spider) \u5f53download handler\u6216 process_request() (\u6765\u81eadownloader middleware)\u5f15\u53d1\u5f02\u5e38(\u5305\u62ec IgnoreRequest \u5f02\u5e38)\u65f6\uff0cScrapy\u4f1a\u8c03\u7528 process_exception() process_exception() \u5e94\u8be5\u8fd4\u56de: None \u3001 Response \u5bf9\u8c61\u6216 Request \u5bf9\u8c61\u3002 \u5982\u679c\u5b83\u8fd4\u56de None \uff0cScrapy\u5c06\u7ee7\u7eed\u5904\u7406\u8fd9\u4e2a\u5f02\u5e38\uff0c\u6267\u884c\u5df2\u5b89\u88c5middleware\u7684\u4efb\u4f55\u5176\u4ed6 process_exception() \u65b9\u6cd5\uff0c\u76f4\u5230\u6ca1\u6709middleware\u5b58\u5728\u5e76\u542f\u52a8\u9ed8\u8ba4\u5f02\u5e38\u5904\u7406\u4e3a\u6b62\u3002 \u5982\u679c\u5b83\u8fd4\u56de\u4e00\u4e2a Response \u5bf9\u8c61\uff0c\u5219\u542f\u52a8\u5df2\u5b89\u88c5\u4e2d\u95f4\u4ef6\u7684 process_response() \u65b9\u6cd5\u94fe\uff0cScrapy\u4e0d\u4f1a\u8c03\u7528middleware\u7684\u4efb\u4f55\u5176\u4ed6 process_exception() \u65b9\u6cd5\u3002 \u5982\u679c\u8fd4\u56de\u4e00\u4e2a Request \u5bf9\u8c61\uff0c\u8fd4\u56de\u7684request\u5c06\u88ab\u91cd\u65b0\u8c03\u5ea6\uff0c\u4ee5\u4fbf\u4ee5\u540e\u4e0b\u8f7d\u3002\u8fd9\u5c06\u505c\u6b62middleware\u7684process_exception()\u65b9\u6cd5\u7684\u6267\u884c\uff0c\u5c31\u50cf\u8fd4\u56deresponse\u4e00\u6837\u3002 \u53c2\u6570: request (\u662f\u4e00\u4e2a Request \u5bf9\u8c61) \u2013 \u751f\u6210\u5f02\u5e38\u7684request exception (\u4e00\u4e2a Exception \u5bf9\u8c61) \u2013 \u5f15\u53d1\u5f02\u5e38 spider ( Spider \u5bf9\u8c61) \u2013 \u6b64request\u6240\u9488\u5bf9\u7684spider from_crawler(cls, crawler) \u5982\u679c\u5b58\u5728\uff0c\u5219\u8c03\u7528\u8fd9\u4e2a\u7c7b\u65b9\u6cd5\u6765\u4ece Crawler \u4e2d\u521b\u5efamiddleware\u5b9e\u4f8b\u3002\u5b83\u5fc5\u987b\u8fd4\u56demiddleware\u7684\u65b0\u5b9e\u4f8b\u3002Crawler\u5bf9\u8c61\u63d0\u4f9b\u8bbf\u95ee\u6240\u6709Scrapy\u7684\u6838\u5fc3\u7ec4\u4ef6\uff0c\u5982settings(\u8bbe\u7f6e)\u548csignals(\u4fe1\u53f7);\u5bf9\u4e8emiddleware\u6765\u8bf4\uff0c\u8fd9\u662f\u4e00\u79cd\u8bbf\u95ee\u5b83\u4eec\u5e76\u5c06\u5176\u529f\u80fd\u4e0eScrapy\u6302\u94a9\u7684\u65b9\u5f0f\u3002 \u53c2\u6570: crawler ( Crawler \u5bf9\u8c61) \u2013 \u4f7f\u7528\u6b64middleware\u7684crawler","title":"scrapy.downloadermiddlewares.DownloaderMiddleware   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"5. Scrapy\u6269\u5c55/02-Downloader-Middleware/#downloader-middleware_3","text":"\u8fd9\u4e2a\u9875\u9762\u63cf\u8ff0\u4e86\u6240\u6709\u4e0eScrapy\u4e00\u8d77\u63d0\u4f9b\u7684downloader middleware\u3002\u6709\u5173\u5982\u4f55\u4f7f\u7528\u5b83\u4eec\u4ee5\u53ca\u5982\u4f55\u7f16\u5199\u81ea\u5df1\u7684downloader\u4e2d\u95f4\u4ef6\u7684\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 downloader middleware\u4f7f\u7528\u6307\u5357 \u3002","title":"\u5185\u7f6edownloader middleware\u5f15\u7528"},{"location":"5. Scrapy\u6269\u5c55/02-Downloader-Middleware/#cookiesmiddleware","text":"","title":"CookiesMiddleware"},{"location":"5. Scrapy\u6269\u5c55/02-Downloader-Middleware/#scrapydownloadermiddlewarescookiescookiesmiddleware-class","text":"\u8fd9\u4e2amiddleware\u652f\u6301\u4f7f\u7528\u9700\u8981cookie\u7684\u7ad9\u70b9\uff0c\u6bd4\u5982\u4f7f\u7528session\u7684\u7ad9\u70b9\u3002\u5b83\u8ddf\u8e2aweb\u670d\u52a1\u5668\u53d1\u9001\u7684cookie\uff0c\u5e76\u5728\u540e\u7eed\u8bf7\u6c42(\u6765\u81ea\u8be5spider)\u65f6\u5c06\u5176\u53d1\u56de\uff0c\u5c31\u50cfweb\u6d4f\u89c8\u5668\u4e00\u6837\u3002 \u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0bsettings\u914d\u7f6ecookie middleware: COOKIES_ENABLED COOKIES_DEBUG","title":"scrapy.downloadermiddlewares.cookies.CookiesMiddleware   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"5. Scrapy\u6269\u5c55/02-Downloader-Middleware/#cookie-sessions","text":"0.15\u7248\u672c\u6700\u65b0\u529f\u80fd \u901a\u8fc7\u4f7f\u7528 cookiejar Request meta\u952e\uff0c\u53ef\u4ee5\u4e3a\u6bcf\u4e2aspider\u4fdd\u5b58\u591a\u4e2acookie sessions\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5b83\u4f7f\u7528\u4e00\u4e2acookie jar(session)\uff0c\u4f46\u662f\u60a8\u53ef\u4ee5\u4f20\u9012\u4e00\u4e2a\u6807\u8bc6\u7b26\u6765\u4f7f\u7528\u4e0d\u540c\u7684cookie jar\u3002 \u4f8b\u5b50: for i, url in enumerate(urls): yield scrapy.Request(url, meta={'cookiejar': i}, callback=self.parse_page) \u8bb0\u4f4f\uff0ccookiejar\u5143\u952e\u4e0d\u662f\u201c\u7c98\u201d\u7684\u3002\u60a8\u9700\u8981\u5728\u540e\u7eed\u7684request\u4e2d\u7ee7\u7eed\u624b\u52a8\u4f20\u9012\u5b83\u3002\u4f8b\u5982: def parse_page(self, response): # \u505a\u4e00\u4e9b\u5904\u7406 return scrapy.Request( http://www.example.com/otherpage , meta={'cookiejar': response.meta['cookiejar']}, callback=self.parse_other_page)","title":"\u6bcf\u4e2a\u722c\u884c\u5668\u6709\u591a\u4e2acookie sessions"},{"location":"5. Scrapy\u6269\u5c55/02-Downloader-Middleware/#cookies_enabled","text":"\u9ed8\u8ba4: True \u662f\u5426\u542f\u7528cookies middleware\u3002\u5982\u679c\u7981\u7528\uff0c\u5219\u4e0d\u4f1a\u5c06cookie\u53d1\u9001\u5230web\u670d\u52a1\u5668\u3002 \u8bf7\u6ce8\u610f\uff0c\u5982\u679c Request. meta['dont_merge_cookies'] \u7684\u503c\u4e3a True \uff0c\u5219\u5c3d\u7ba1\u8bbe\u7f6e\u4e86 COOKIES_ENABLED setting\uff0c\u4f46request cookie \u4e0d \u4f1a\u88ab\u53d1\u9001\u5230web\u670d\u52a1\u5668\uff0c\u5e76\u4e14\u63a5\u6536\u5230\u7684 Response cookie\u4e0d\u4f1a\u4e0e\u73b0\u6709cookie\u5408\u5e76\u3002 \u6709\u5173\u66f4\u8be6\u7ec6\u7684\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Request \u4e2d\u7684 cookie \u53c2\u6570\u3002","title":"COOKIES_ENABLED"},{"location":"5. Scrapy\u6269\u5c55/02-Downloader-Middleware/#cookies_debug","text":"\u9ed8\u8ba4: False \u5982\u679c\u542f\u7528\u4e86\uff0cScrapy\u5c06log\u6240\u6709\u53d1\u9001requests\u7684cookie(\u5373\u3002 Cookie header)\u548c\u6240\u6709\u7684cookies\u63a5\u6536\u5230\u7684responses(\u5373\u3002 Set-Cookie header)\u3002 \u4e0b\u9762\u662f\u4e00\u4e2a\u542f\u7528\u4e86 COOKIES_DEBUG \u7684log: 2011-04-06 14:35:10-0300 [scrapy.core.engine] INFO: Spider opened 2011-04-06 14:35:10-0300 [scrapy.downloadermiddlewares.cookies] DEBUG: Sending cookies to: GET http://www.diningcity.com/netherlands/index.html Cookie: clientlanguage_nl=en_EN 2011-04-06 14:35:14-0300 [scrapy.downloadermiddlewares.cookies] DEBUG: Received cookies from: 200 http://www.diningcity.com/netherlands/index.html Set-Cookie: JSESSIONID=B~FA4DC0C496C8762AE4F1A620EAB34F38; Path=/ Set-Cookie: ip_isocode=US Set-Cookie: clientlanguage_nl=en_EN; Expires=Thu, 07-Apr-2011 21:21:34 GMT; Path=/ 2011-04-06 14:49:50-0300 [scrapy.core.engine] DEBUG: Crawled (200) GET http://www.diningcity.com/netherlands/index.html (referer: None) [...]","title":"COOKIES_DEBUG"},{"location":"5. Scrapy\u6269\u5c55/02-Downloader-Middleware/#defaultheadersmiddleware","text":"","title":"DefaultHeadersMiddleware"},{"location":"5. Scrapy\u6269\u5c55/02-Downloader-Middleware/#scrapydownloadermiddlewaresdefaultheadersdefaultheadersmiddleware-class","text":"\u6b64middleware\u8bbe\u7f6e DEFAULT_REQUEST_HEADERS setting\u4e2d\u6307\u5b9a\u7684\u6240\u6709\u9ed8\u8ba4requests headers\u3002","title":"scrapy.downloadermiddlewares.defaultheaders.DefaultHeadersMiddleware   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"5. Scrapy\u6269\u5c55/02-Downloader-Middleware/#downloadtimeoutmiddleware","text":"","title":"DownloadTimeoutMiddleware"},{"location":"5. Scrapy\u6269\u5c55/02-Downloader-Middleware/#scrapydownloadermiddlewaresdownloadtimeoutdownloadtimeoutmiddleware-class","text":"\u6b64middleware\u4e3a DOWNLOAD_TIMEOUT setting\u6216 DOWNLOAD_TIMEOUT spider\u5c5e\u6027\u4e2d\u6307\u5b9a\u7684requests\u8bbe\u7f6edownload timeout\u3002 \u8fd8\u53ef\u4ee5\u4f7f\u7528[download_timeout](#) Request.meta\u952e\u4e3a\u6bcf\u4e2arequest\u8bbe\u7f6edownload timeout; \u5373\u4f7f\u7981\u7528\u4e86DownloadTimeoutMiddleware\uff0c\u4e5f\u53ef\u4ee5\u652f\u6301\u8fd9\u4e00\u529f\u80fd\u3002","title":"scrapy.downloadermiddlewares.downloadtimeout.DownloadTimeoutMiddleware   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"5. Scrapy\u6269\u5c55/02-Downloader-Middleware/#httpauthmiddleware","text":"","title":"HttpAuthMiddleware"},{"location":"5. Scrapy\u6269\u5c55/02-Downloader-Middleware/#scrapydownloadermiddlewareshttpauthhttpauthmiddleware-class","text":"\u6b64middleware\u4f7f\u7528 \u57fa\u672c\u8bbf\u95ee\u8eab\u4efd\u9a8c\u8bc1 (\u53c8\u540dHTTP auth)\u5bf9\u67d0\u4e9bspider\u751f\u6210\u7684\u6240\u6709request\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u3002 \u8981\u542f\u7528\u6765\u81ea\u67d0\u4e9bspider\u7684HTTP\u8eab\u4efd\u9a8c\u8bc1\uff0c\u8bf7\u8bbe\u7f6e\u8fd9\u4e9bspider\u7684http_user\u548chttp_pass spiders\u5c5e\u6027\u3002 \u4f8b\u5b50: from scrapy.spiders import CrawlSpider class SomeIntranetSiteSpider(CrawlSpider): http_user = 'someuser' http_pass = 'somepass' name = 'intranet.example.com' # .. \u5176\u4ed6spider\u5ffd\u7565\u4e86 ...","title":"scrapy.downloadermiddlewares.httpauth.HttpAuthMiddleware   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"5. Scrapy\u6269\u5c55/02-Downloader-Middleware/#httpcachemiddleware","text":"","title":"HttpCacheMiddleware"},{"location":"5. Scrapy\u6269\u5c55/02-Downloader-Middleware/#scrapydownloadermiddlewareshttpcachehttpcachemiddleware-class","text":"\u8be5middleware\u4e3a\u6240\u6709HTTP requests\u548cresponse\u63d0\u4f9b\u4f4e\u7ea7\u7f13\u5b58\u3002\u5b83\u5fc5\u987b\u4e0e\u7f13\u5b58\u5b58\u50a8\u540e\u7aef\u4ee5\u53ca\u7f13\u5b58\u7b56\u7565\u76f8\u7ed3\u5408\u3002 Scrapy\u9644\u5e26\u4e86\u4e09\u4e2aHTTP\u7f13\u5b58\u5b58\u50a8\u540e\u7aef \u6587\u4ef6\u7cfb\u7edf\u5b58\u50a8\u540e\u7aef(\u9ed8\u8ba4) DBM\u5b58\u50a8\u540e\u7aef LevelDB\u5b58\u50a8\u540e\u7aef \u60a8\u53ef\u4ee5\u4f7f\u7528 HTTPCACHE_STORAGE setting\u6765\u66f4\u6539HTTP\u7f13\u5b58\u5b58\u50a8\u540e\u7aef\u3002\u6216\u8005\u4e5f\u53ef\u4ee5\u5b9e\u73b0\u81ea\u5df1\u7684\u5b58\u50a8\u540e\u7aef\u3002 Scrapy\u9644\u5e26\u4e86\u4e24\u4e2aHTTP\u7f13\u5b58\u7b56\u7565: RFC2616\u7b56\u7565 Dummy\u7b56\u7565(\u9ed8\u8ba4) \u60a8\u53ef\u4ee5\u4f7f\u7528 HTTPCACHE_POLICY \u8bbe\u7f6e\u66f4\u6539HTTP\u7f13\u5b58\u7b56\u7565\u3002\u6216\u8005\u60a8\u4e5f\u53ef\u4ee5\u6267\u884c\u81ea\u5df1\u7684\u7b56\u7565\u3002 \u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528 dont_cache meta\u952e = True\u907f\u514d\u5728\u6bcf\u4e2a\u7b56\u7565\u4e0a\u7f13\u5b58\u54cd\u5e94\u3002","title":"scrapy.downloadermiddlewares.httpcache.HttpCacheMiddleware   \u8fd9\u662f\u4e00\u4e2a\u7c7b(class)"},{"location":"5. Scrapy\u6269\u5c55/02-Downloader-Middleware/#dummy","text":"\u6b64\u7b56\u7565\u4e0d\u77e5\u9053\u4efb\u4f55HTTP\u7f13\u5b58\u63a7\u5236\u6307\u4ee4\u3002\u6bcf\u4e2arequest\u53ca\u5176\u76f8\u5e94\u7684response\u90fd\u88ab\u7f13\u5b58\u3002\u5f53\u518d\u6b21\u770b\u5230\u76f8\u540c\u7684request\u65f6\uff0c\u76f4\u63a5\u5c06\u8fd4\u56deresponse\uff0c\u800c\u4e0d\u4f1a\u4eceInternet\u4f20\u8f93\u4efb\u4f55\u5185\u5bb9\u3002 Dummy\u7b56\u7565\u5bf9\u4e8e\u66f4\u5feb\u5730\u6d4b\u8bd5spider(\u65e0\u9700\u6bcf\u6b21\u90fd\u7b49\u5f85\u4e0b\u8f7d)\u548c\u5728Internet\u8fde\u63a5\u4e0d\u53ef\u7528\u65f6\u8131\u673a\u5c1d\u8bd5spider\u975e\u5e38\u6709\u7528\u3002\u6211\u4eec\u7684\u76ee\u6807\u662f\u80fd\u591f\u201creplay\u201d spider\u7684\u8fd0\u884c\u8fc7\u7a0b\uff0c\u5c31\u50cf\u4ee5\u524d\u4e00\u6837\u3002 \u4e3a\u4e86\u4f7f\u7528\u6b64\u7b56\u7565\uff0cset: HTTPCACHE_POLICY \u8bbe\u7f6e scrapy.extensions.httpcache.DummyPolicy","title":"Dummy\u7b56\u7565(\u9ed8\u8ba4)"},{"location":"5. Scrapy\u6269\u5c55/02-Downloader-Middleware/#rfc2616","text":"\u8be5\u7b56\u7565\u63d0\u4f9b\u4e86RFC2616\u517c\u5bb9\u7684HTTP\u7f13\u5b58\uff0c\u5373\u5177\u6709HTTP\u7f13\u5b58\u63a7\u5236\u610f\u8bc6\uff0c\u5e76\u7528\u4e8e\u8fde\u7eed\u8fd0\u884c\uff0c\u4ee5\u907f\u514d\u4e0b\u8f7d\u672a\u7ecf\u4fee\u6539\u7684\u6570\u636e(\u8282\u7701\u5e26\u5bbd\u548c\u52a0\u5feb\u722c\u866b)\u3002 \u5982\u4f55\u5b9e\u73b0: \u4e0d\u5c1d\u8bd5\u5b58\u50a8responses/requests\u4e0eno-store cache-control\u6307\u4ee4\u96c6 \u5982\u679c\u6ca1\u6709no-cache cache-control\uff0c\u5373\u4f7f\u662f\u65b0\u7684responses\uff0c\u4e5f\u4e0d\u8981\u63d0\u4f9b\u6765\u81ea\u7f13\u5b58\u7684\u54cd\u5e94 \u4ecemax-age\u7f13\u5b58\u63a7\u5236\u6307\u4ee4\u8ba1\u7b97\u65b0\u9c9c\u5ea6\u751f\u547d\u5468\u671f \u4eceExpires response header\u8ba1\u7b97\u65b0\u9c9c\u5ea6\u751f\u547d\u5468\u671f \u4eceLast-Modified response header\u8ba1\u7b97\u65b0\u9c9c\u5ea6\u751f\u547d\u5468\u671f(Firefox\u4f7f\u7528heuristic) \u4eceAge response header\u8ba1\u7b97\u5f53\u524dage \u4eceDate header\u8ba1\u7b97\u5f53\u524dage \u6839\u636eLast-Modified response header\u91cd\u65b0\u9a8c\u8bc1\u9648\u65e7\u7684response \u6839\u636eETag response header\u91cd\u65b0\u9a8c\u8bc1\u9648\u65e7\u7684response \u4e3a\u4efb\u4f55\u672a\u6536\u5230\u7684response\u8bbe\u7f6eDate header \u5728requests\u4e2d\u652f\u6301max-stale cache-control\u6307\u4ee4 \u8fd9\u5141\u8bb8\u4f7f\u7528\u5b8c\u6574\u7684RFC2616\u7f13\u5b58\u7b56\u7565\u914d\u7f6espider\uff0c\u4f46\u907f\u514d\u5728\u9010\u4e2arequest\u7684\u57fa\u7840\u4e0a\u91cd\u65b0\u9a8c\u8bc1\uff0c\u540c\u65f6\u4fdd\u6301\u4e0eHTTP\u89c4\u8303\u7684\u4e00\u81f4\u6027\u3002 \u4f8b\u5b50 \u5411Request headers\u6dfb\u52a0Cache-Control: max-stale=600\uff0c\u4ee5\u63a5\u53d7\u8d85\u8fc7\u8fc7\u671f\u65f6\u95f4\u4e0d\u8d85\u8fc7600\u79d2\u7684responses\u3002 \u53c2\u89c1:RFC2616, 14.9.3 \u7f3a\u4e86\u4ec0\u4e48: Pragma: no - cache\u652f\u6301 https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.9.1 Vary header\u652f\u6301 https://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html#sec13.6 \u66f4\u65b0\u6216\u5220\u9664 https://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html#sec13.10 \u540e\u65e0\u6548 probably others \u4e3a\u4e86\u4f7f\u7528\u6b64\u7b56\u7565\uff0c\u8bbe\u7f6e: HTTPCACHE_POLICY \u53d8\u6210 scrapy.extensions.httpcache.RFC2616Policy","title":"RFC2616\u7b56\u7565"},{"location":"5. Scrapy\u6269\u5c55/02-Downloader-Middleware/#_1","text":"HTTP\u7f13\u5b58middleware\u7684\u6587\u4ef6\u7cfb\u7edf\u5b58\u50a8\u540e\u7aef\u53ef\u7528\u4e8eHTTP cache middleware\u3002 \u4e3a\u4e86\u4f7f\u7528\u8fd9\u4e2a\u5b58\u50a8\u540e\u7aef\uff0c\u8bbe\u7f6e: HTTPCACHE_STORAGE \u53d8\u6210 scrapy.extensions.httpcache.FilesystemCacheStorage \u6bcf\u4e2arequest/response\u5bf9\u5b58\u50a8\u5728\u4e0d\u540c\u7684\u76ee\u5f55\u4e2d\uff0c\u5176\u4e2d\u5305\u542b\u4ee5\u4e0b\u6587\u4ef6: request_body - request body request_headers -","title":"\u6587\u4ef6\u7cfb\u7edf\u5b58\u50a8\u540e\u7aef(\u9ed8\u8ba4)"}]}